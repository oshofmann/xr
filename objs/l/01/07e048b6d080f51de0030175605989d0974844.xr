var __xr_tmp = [
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#PTR_ERR\">PTR_ERR</a>(<a class=\"id\" href=\"#ipcp\">ipcp</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#msq\">msq</a> = <a class=\"id\" href=\"#container_of\">container_of</a>(<a class=\"id\" href=\"#ipcp\">ipcp</a>, struct <a class=\"id\" href=\"#msg_queue\">msg_queue</a>, <a class=\"id\" href=\"#q_perm\">q_perm</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = <a class=\"id\" href=\"#security_msg_queue_msgctl\">security_msg_queue_msgctl</a>(<a class=\"id\" href=\"#msq\">msq</a>, <a class=\"id\" href=\"#cmd\">cmd</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#err\">err</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out_unlock\">out_unlock</a>;", 
"", 
"<span class=\"ts\"/>switch (<a class=\"id\" href=\"#cmd\">cmd</a>) {", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#IPC_RMID\">IPC_RMID</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#freeque\">freeque</a>(<a class=\"id\" href=\"#ns\">ns</a>, <a class=\"id\" href=\"#ipcp\">ipcp</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out_up\">out_up</a>;", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#IPC_SET\">IPC_SET</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#msqid64\">msqid64</a>.<a class=\"id\" href=\"#msg_qbytes\">msg_qbytes</a> &gt; <a class=\"id\" href=\"#ns\">ns</a>-><a class=\"id\" href=\"#msg_ctlmnb\">msg_ctlmnb</a> &&", 
"<span class=\"ts\"/><span class=\"ts\"/>    !<a class=\"id\" href=\"#capable\">capable</a>(<a class=\"id\" href=\"#CAP_SYS_RESOURCE\">CAP_SYS_RESOURCE</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#EPERM\">EPERM</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out_unlock\">out_unlock</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_qbytes\">q_qbytes</a> = <a class=\"id\" href=\"#msqid64\">msqid64</a>.<a class=\"id\" href=\"#msg_qbytes\">msg_qbytes</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ipc_update_perm\">ipc_update_perm</a>(&amp;<a class=\"id\" href=\"#msqid64\">msqid64</a>.<a class=\"id\" href=\"#msg_perm\">msg_perm</a>, <a class=\"id\" href=\"#ipcp\">ipcp</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_ctime\">q_ctime</a> = <a class=\"id\" href=\"#get_seconds\">get_seconds</a>();", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* sleeping receivers might be excluded by</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * stricter permissions.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#expunge_all\">expunge_all</a>(<a class=\"id\" href=\"#msq\">msq</a>, -<a class=\"id\" href=\"#EAGAIN\">EAGAIN</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* sleeping senders might be able to send</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * due to a larger queue size.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ss_wakeup\">ss_wakeup</a>(&amp;<a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_senders\">q_senders</a>, 0);", 
"<span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>default:", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"<span class=\"ts\"/>}", 
"<a class=\"id\" href=\"#out_unlock\">out_unlock</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#msg_unlock\">msg_unlock</a>(<a class=\"id\" href=\"#msq\">msq</a>);", 
"<a class=\"id\" href=\"#out_up\">out_up</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#up_write\">up_write</a>(&amp;<a class=\"id\" href=\"#msg_ids\">msg_ids</a>(<a class=\"id\" href=\"#ns\">ns</a>).<a class=\"id\" href=\"#rw_mutex\">rw_mutex</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#err\">err</a>;", 
"}", 
"", 
"<a class=\"id\" href=\"#SYSCALL_DEFINE3\">SYSCALL_DEFINE3</a>(<a class=\"id\" href=\"#msgctl\">msgctl</a>, int, <a class=\"id\" href=\"#msqid\">msqid</a>, int, <a class=\"id\" href=\"#cmd\">cmd</a>, struct <a class=\"id\" href=\"#msqid_ds\">msqid_ds</a> <a class=\"id\" href=\"#__user\">__user</a> *, <a class=\"id\" href=\"#buf\">buf</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#msg_queue\">msg_queue</a> *<a class=\"id\" href=\"#msq\">msq</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#err\">err</a>, <a class=\"id\" href=\"#version\">version</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ipc_namespace\">ipc_namespace</a> *<a class=\"id\" href=\"#ns\">ns</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#msqid\">msqid</a> &lt; 0 || <a class=\"id\" href=\"#cmd\">cmd</a> &lt; 0)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#version\">version</a> = <a class=\"id\" href=\"#ipc_parse_version\">ipc_parse_version</a>(&amp;<a class=\"id\" href=\"#cmd\">cmd</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ns\">ns</a> = <a class=\"id\" href=\"#current\">current</a>-><a class=\"id\" href=\"#nsproxy\">nsproxy</a>-><a class=\"id\" href=\"#ipc_ns\">ipc_ns</a>;", 
"", 
"<span class=\"ts\"/>switch (<a class=\"id\" href=\"#cmd\">cmd</a>) {", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#IPC_INFO\">IPC_INFO</a>:", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#MSG_INFO\">MSG_INFO</a>:", 
"<span class=\"ts\"/>{", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#msginfo\">msginfo</a> <a class=\"id\" href=\"#msginfo\">msginfo</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>int <a class=\"id\" href=\"#max_id\">max_id</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#buf\">buf</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EFAULT\">EFAULT</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * We must not return kernel stack data.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * due to padding, it's not enough</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * to set all member fields.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = <a class=\"id\" href=\"#security_msg_queue_msgctl\">security_msg_queue_msgctl</a>(<a class=\"id\" href=\"#NULL\">NULL</a>, <a class=\"id\" href=\"#cmd\">cmd</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#err\">err</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#err\">err</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#memset\">memset</a>(&amp;<a class=\"id\" href=\"#msginfo\">msginfo</a>, 0, sizeof(<a class=\"id\" href=\"#msginfo\">msginfo</a>));", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msginfo\">msginfo</a>.<a class=\"id\" href=\"#msgmni\">msgmni</a> = <a class=\"id\" href=\"#ns\">ns</a>-><a class=\"id\" href=\"#msg_ctlmni\">msg_ctlmni</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msginfo\">msginfo</a>.<a class=\"id\" href=\"#msgmax\">msgmax</a> = <a class=\"id\" href=\"#ns\">ns</a>-><a class=\"id\" href=\"#msg_ctlmax\">msg_ctlmax</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msginfo\">msginfo</a>.<a class=\"id\" href=\"#msgmnb\">msgmnb</a> = <a class=\"id\" href=\"#ns\">ns</a>-><a class=\"id\" href=\"#msg_ctlmnb\">msg_ctlmnb</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msginfo\">msginfo</a>.<a class=\"id\" href=\"#msgssz\">msgssz</a> = <a class=\"id\" href=\"#MSGSSZ\">MSGSSZ</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msginfo\">msginfo</a>.<a class=\"id\" href=\"#msgseg\">msgseg</a> = <a class=\"id\" href=\"#MSGSEG\">MSGSEG</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#down_read\">down_read</a>(&amp;<a class=\"id\" href=\"#msg_ids\">msg_ids</a>(<a class=\"id\" href=\"#ns\">ns</a>).<a class=\"id\" href=\"#rw_mutex\">rw_mutex</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#cmd\">cmd</a> == <a class=\"id\" href=\"#MSG_INFO\">MSG_INFO</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msginfo\">msginfo</a>.<a class=\"id\" href=\"#msgpool\">msgpool</a> = <a class=\"id\" href=\"#msg_ids\">msg_ids</a>(<a class=\"id\" href=\"#ns\">ns</a>).<a class=\"id\" href=\"#in_use\">in_use</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msginfo\">msginfo</a>.<a class=\"id\" href=\"#msgmap\">msgmap</a> = <a class=\"id\" href=\"#atomic_read\">atomic_read</a>(&amp;<a class=\"id\" href=\"#ns\">ns</a>-><a class=\"id\" href=\"#msg_hdrs\">msg_hdrs</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msginfo\">msginfo</a>.<a class=\"id\" href=\"#msgtql\">msgtql</a> = <a class=\"id\" href=\"#atomic_read\">atomic_read</a>(&amp;<a class=\"id\" href=\"#ns\">ns</a>-><a class=\"id\" href=\"#msg_bytes\">msg_bytes</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>} else {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msginfo\">msginfo</a>.<a class=\"id\" href=\"#msgmap\">msgmap</a> = <a class=\"id\" href=\"#MSGMAP\">MSGMAP</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msginfo\">msginfo</a>.<a class=\"id\" href=\"#msgpool\">msgpool</a> = <a class=\"id\" href=\"#MSGPOOL\">MSGPOOL</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msginfo\">msginfo</a>.<a class=\"id\" href=\"#msgtql\">msgtql</a> = <a class=\"id\" href=\"#MSGTQL\">MSGTQL</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#max_id\">max_id</a> = <a class=\"id\" href=\"#ipc_get_maxid\">ipc_get_maxid</a>(&amp;<a class=\"id\" href=\"#msg_ids\">msg_ids</a>(<a class=\"id\" href=\"#ns\">ns</a>));", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#up_read\">up_read</a>(&amp;<a class=\"id\" href=\"#msg_ids\">msg_ids</a>(<a class=\"id\" href=\"#ns\">ns</a>).<a class=\"id\" href=\"#rw_mutex\">rw_mutex</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#copy_to_user\">copy_to_user</a>(<a class=\"id\" href=\"#buf\">buf</a>, &amp;<a class=\"id\" href=\"#msginfo\">msginfo</a>, sizeof(struct <a class=\"id\" href=\"#msginfo\">msginfo</a>)))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EFAULT\">EFAULT</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>return (<a class=\"id\" href=\"#max_id\">max_id</a> &lt; 0) ? 0 : <a class=\"id\" href=\"#max_id\">max_id</a>;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#MSG_STAT\">MSG_STAT</a>:<span class=\"ts\"/><span class=\"comment\">/* msqid is an index rather than a msg queue id */</span>", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#IPC_STAT\">IPC_STAT</a>:", 
"<span class=\"ts\"/>{", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#msqid64_ds\">msqid64_ds</a> <a class=\"id\" href=\"#tbuf\">tbuf</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>int <a class=\"id\" href=\"#success_return\">success_return</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#buf\">buf</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EFAULT\">EFAULT</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#cmd\">cmd</a> == <a class=\"id\" href=\"#MSG_STAT\">MSG_STAT</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msq\">msq</a> = <a class=\"id\" href=\"#msg_lock\">msg_lock</a>(<a class=\"id\" href=\"#ns\">ns</a>, <a class=\"id\" href=\"#msqid\">msqid</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#IS_ERR\">IS_ERR</a>(<a class=\"id\" href=\"#msq\">msq</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#PTR_ERR\">PTR_ERR</a>(<a class=\"id\" href=\"#msq\">msq</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#success_return\">success_return</a> = <a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_perm\">q_perm</a>.<a class=\"id\" href=\"#id\">id</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>} else {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msq\">msq</a> = <a class=\"id\" href=\"#msg_lock_check\">msg_lock_check</a>(<a class=\"id\" href=\"#ns\">ns</a>, <a class=\"id\" href=\"#msqid\">msqid</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#IS_ERR\">IS_ERR</a>(<a class=\"id\" href=\"#msq\">msq</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#PTR_ERR\">PTR_ERR</a>(<a class=\"id\" href=\"#msq\">msq</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#success_return\">success_return</a> = 0;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#EACCES\">EACCES</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#ipcperms\">ipcperms</a>(&amp;<a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_perm\">q_perm</a>, <a class=\"id\" href=\"#S_IRUGO\">S_IRUGO</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out_unlock\">out_unlock</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = <a class=\"id\" href=\"#security_msg_queue_msgctl\">security_msg_queue_msgctl</a>(<a class=\"id\" href=\"#msq\">msq</a>, <a class=\"id\" href=\"#cmd\">cmd</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#err\">err</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out_unlock\">out_unlock</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#memset\">memset</a>(&amp;<a class=\"id\" href=\"#tbuf\">tbuf</a>, 0, sizeof(<a class=\"id\" href=\"#tbuf\">tbuf</a>));", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#kernel_to_ipc64_perm\">kernel_to_ipc64_perm</a>(&amp;<a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_perm\">q_perm</a>, &amp;<a class=\"id\" href=\"#tbuf\">tbuf</a>.<a class=\"id\" href=\"#msg_perm\">msg_perm</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tbuf\">tbuf</a>.<a class=\"id\" href=\"#msg_stime\">msg_stime</a>  = <a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_stime\">q_stime</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tbuf\">tbuf</a>.<a class=\"id\" href=\"#msg_rtime\">msg_rtime</a>  = <a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_rtime\">q_rtime</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tbuf\">tbuf</a>.<a class=\"id\" href=\"#msg_ctime\">msg_ctime</a>  = <a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_ctime\">q_ctime</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tbuf\">tbuf</a>.<a class=\"id\" href=\"#msg_cbytes\">msg_cbytes</a> = <a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_cbytes\">q_cbytes</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tbuf\">tbuf</a>.<a class=\"id\" href=\"#msg_qnum\">msg_qnum</a>   = <a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_qnum\">q_qnum</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tbuf\">tbuf</a>.<a class=\"id\" href=\"#msg_qbytes\">msg_qbytes</a> = <a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_qbytes\">q_qbytes</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tbuf\">tbuf</a>.<a class=\"id\" href=\"#msg_lspid\">msg_lspid</a>  = <a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_lspid\">q_lspid</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tbuf\">tbuf</a>.<a class=\"id\" href=\"#msg_lrpid\">msg_lrpid</a>  = <a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_lrpid\">q_lrpid</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msg_unlock\">msg_unlock</a>(<a class=\"id\" href=\"#msq\">msq</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#copy_msqid_to_user\">copy_msqid_to_user</a>(<a class=\"id\" href=\"#buf\">buf</a>, &amp;<a class=\"id\" href=\"#tbuf\">tbuf</a>, <a class=\"id\" href=\"#version\">version</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EFAULT\">EFAULT</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#success_return\">success_return</a>;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#IPC_SET\">IPC_SET</a>:", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#IPC_RMID\">IPC_RMID</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = <a class=\"id\" href=\"#msgctl_down\">msgctl_down</a>(<a class=\"id\" href=\"#ns\">ns</a>, <a class=\"id\" href=\"#msqid\">msqid</a>, <a class=\"id\" href=\"#cmd\">cmd</a>, <a class=\"id\" href=\"#buf\">buf</a>, <a class=\"id\" href=\"#version\">version</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#err\">err</a>;", 
"<span class=\"ts\"/>default:", 
"<span class=\"ts\"/><span class=\"ts\"/>return  -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<a class=\"id\" href=\"#out_unlock\">out_unlock</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#msg_unlock\">msg_unlock</a>(<a class=\"id\" href=\"#msq\">msq</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#err\">err</a>;", 
"}", 
"", 
"static int <a class=\"id\" href=\"#testmsg\">testmsg</a>(struct <a class=\"id\" href=\"#msg_msg\">msg_msg</a> *<a class=\"id\" href=\"#msg\">msg</a>, long <a class=\"id\" href=\"#type\">type</a>, int <a class=\"id\" href=\"#mode\">mode</a>)", 
"{", 
"<span class=\"ts\"/>switch(<a class=\"id\" href=\"#mode\">mode</a>)", 
"<span class=\"ts\"/>{", 
"<span class=\"ts\"/><span class=\"ts\"/>case <a class=\"id\" href=\"#SEARCH_ANY\">SEARCH_ANY</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return 1;", 
"<span class=\"ts\"/><span class=\"ts\"/>case <a class=\"id\" href=\"#SEARCH_LESSEQUAL\">SEARCH_LESSEQUAL</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#m_type\">m_type</a> <=<a class=\"id\" href=\"#type\">type</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return 1;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>case <a class=\"id\" href=\"#SEARCH_EQUAL\">SEARCH_EQUAL</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#m_type\">m_type</a> == <a class=\"id\" href=\"#type\">type</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return 1;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>case <a class=\"id\" href=\"#SEARCH_NOTEQUAL\">SEARCH_NOTEQUAL</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#m_type\">m_type</a> != <a class=\"id\" href=\"#type\">type</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return 1;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"static <a class=\"id\" href=\"#inline\">inline</a> int <a class=\"id\" href=\"#pipelined_send\">pipelined_send</a>(struct <a class=\"id\" href=\"#msg_queue\">msg_queue</a> *<a class=\"id\" href=\"#msq\">msq</a>, struct <a class=\"id\" href=\"#msg_msg\">msg_msg</a> *<a class=\"id\" href=\"#msg\">msg</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#list_head\">list_head</a> *<a class=\"id\" href=\"#tmp\">tmp</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tmp\">tmp</a> = <a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_receivers\">q_receivers</a>.<a class=\"id\" href=\"#next\">next</a>;", 
"<span class=\"ts\"/>while (<a class=\"id\" href=\"#tmp\">tmp</a> != &amp;<a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_receivers\">q_receivers</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#msg_receiver\">msg_receiver</a> *<a class=\"id\" href=\"#msr\">msr</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msr\">msr</a> = <a class=\"id\" href=\"#list_entry\">list_entry</a>(<a class=\"id\" href=\"#tmp\">tmp</a>, struct <a class=\"id\" href=\"#msg_receiver\">msg_receiver</a>, <a class=\"id\" href=\"#r_list\">r_list</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tmp\">tmp</a> = <a class=\"id\" href=\"#tmp\">tmp</a>-><a class=\"id\" href=\"#next\">next</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#testmsg\">testmsg</a>(<a class=\"id\" href=\"#msg\">msg</a>, <a class=\"id\" href=\"#msr\">msr</a>-><a class=\"id\" href=\"#r_msgtype\">r_msgtype</a>, <a class=\"id\" href=\"#msr\">msr</a>-><a class=\"id\" href=\"#r_mode\">r_mode</a>) &&", 
"<span class=\"ts\"/><span class=\"ts\"/>    !<a class=\"id\" href=\"#security_msg_queue_msgrcv\">security_msg_queue_msgrcv</a>(<a class=\"id\" href=\"#msq\">msq</a>, <a class=\"id\" href=\"#msg\">msg</a>, <a class=\"id\" href=\"#msr\">msr</a>-><a class=\"id\" href=\"#r_tsk\">r_tsk</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       <a class=\"id\" href=\"#msr\">msr</a>-><a class=\"id\" href=\"#r_msgtype\">r_msgtype</a>, <a class=\"id\" href=\"#msr\">msr</a>-><a class=\"id\" href=\"#r_mode\">r_mode</a>)) {", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#list_del\">list_del</a>(&amp;<a class=\"id\" href=\"#msr\">msr</a>-><a class=\"id\" href=\"#r_list\">r_list</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#msr\">msr</a>-><a class=\"id\" href=\"#r_maxsize\">r_maxsize</a> &lt; <a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#m_ts\">m_ts</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msr\">msr</a>-><a class=\"id\" href=\"#r_msg\">r_msg</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#wake_up_process\">wake_up_process</a>(<a class=\"id\" href=\"#msr\">msr</a>-><a class=\"id\" href=\"#r_tsk\">r_tsk</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#smp_mb\">smp_mb</a>();", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msr\">msr</a>-><a class=\"id\" href=\"#r_msg\">r_msg</a> = <a class=\"id\" href=\"#ERR_PTR\">ERR_PTR</a>(-<a class=\"id\" href=\"#E2BIG\">E2BIG</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>} else {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msr\">msr</a>-><a class=\"id\" href=\"#r_msg\">r_msg</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_lrpid\">q_lrpid</a> = <a class=\"id\" href=\"#task_pid_vnr\">task_pid_vnr</a>(<a class=\"id\" href=\"#msr\">msr</a>-><a class=\"id\" href=\"#r_tsk\">r_tsk</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_rtime\">q_rtime</a> = <a class=\"id\" href=\"#get_seconds\">get_seconds</a>();", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#wake_up_process\">wake_up_process</a>(<a class=\"id\" href=\"#msr\">msr</a>-><a class=\"id\" href=\"#r_tsk\">r_tsk</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#smp_mb\">smp_mb</a>();", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msr\">msr</a>-><a class=\"id\" href=\"#r_msg\">r_msg</a> = <a class=\"id\" href=\"#msg\">msg</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return 1;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"long <a class=\"id\" href=\"#do_msgsnd\">do_msgsnd</a>(int <a class=\"id\" href=\"#msqid\">msqid</a>, long <a class=\"id\" href=\"#mtype\">mtype</a>, void <a class=\"id\" href=\"#__user\">__user</a> *<a class=\"id\" href=\"#mtext\">mtext</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#size_t\">size_t</a> <a class=\"id\" href=\"#msgsz\">msgsz</a>, int <a class=\"id\" href=\"#msgflg\">msgflg</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#msg_queue\">msg_queue</a> *<a class=\"id\" href=\"#msq\">msq</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#msg_msg\">msg_msg</a> *<a class=\"id\" href=\"#msg\">msg</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#err\">err</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ipc_namespace\">ipc_namespace</a> *<a class=\"id\" href=\"#ns\">ns</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ns\">ns</a> = <a class=\"id\" href=\"#current\">current</a>-><a class=\"id\" href=\"#nsproxy\">nsproxy</a>-><a class=\"id\" href=\"#ipc_ns\">ipc_ns</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#msgsz\">msgsz</a> &gt; <a class=\"id\" href=\"#ns\">ns</a>-><a class=\"id\" href=\"#msg_ctlmax\">msg_ctlmax</a> || (long) <a class=\"id\" href=\"#msgsz\">msgsz</a> &lt; 0 || <a class=\"id\" href=\"#msqid\">msqid</a> &lt; 0)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#mtype\">mtype</a> &lt; 1)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#msg\">msg</a> = <a class=\"id\" href=\"#load_msg\">load_msg</a>(<a class=\"id\" href=\"#mtext\">mtext</a>, <a class=\"id\" href=\"#msgsz\">msgsz</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#IS_ERR\">IS_ERR</a>(<a class=\"id\" href=\"#msg\">msg</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#PTR_ERR\">PTR_ERR</a>(<a class=\"id\" href=\"#msg\">msg</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#m_type\">m_type</a> = <a class=\"id\" href=\"#mtype\">mtype</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#m_ts\">m_ts</a> = <a class=\"id\" href=\"#msgsz\">msgsz</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#msq\">msq</a> = <a class=\"id\" href=\"#msg_lock_check\">msg_lock_check</a>(<a class=\"id\" href=\"#ns\">ns</a>, <a class=\"id\" href=\"#msqid\">msqid</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#IS_ERR\">IS_ERR</a>(<a class=\"id\" href=\"#msq\">msq</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = <a class=\"id\" href=\"#PTR_ERR\">PTR_ERR</a>(<a class=\"id\" href=\"#msq\">msq</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out_free\">out_free</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>for (;;) {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#msg_sender\">msg_sender</a> <a class=\"id\" href=\"#s\">s</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#EACCES\">EACCES</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#ipcperms\">ipcperms</a>(&amp;<a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_perm\">q_perm</a>, <a class=\"id\" href=\"#S_IWUGO\">S_IWUGO</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out_unlock_free\">out_unlock_free</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = <a class=\"id\" href=\"#security_msg_queue_msgsnd\">security_msg_queue_msgsnd</a>(<a class=\"id\" href=\"#msq\">msq</a>, <a class=\"id\" href=\"#msg\">msg</a>, <a class=\"id\" href=\"#msgflg\">msgflg</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#err\">err</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out_unlock_free\">out_unlock_free</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#msgsz\">msgsz</a> + <a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_cbytes\">q_cbytes</a> <= <a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_qbytes\">q_qbytes</a> &&", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>1 + <a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_qnum\">q_qnum</a> <= <a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_qbytes\">q_qbytes</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* queue full, wait: */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#msgflg\">msgflg</a> &amp; <a class=\"id\" href=\"#IPC_NOWAIT\">IPC_NOWAIT</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#EAGAIN\">EAGAIN</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out_unlock_free\">out_unlock_free</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ss_add\">ss_add</a>(<a class=\"id\" href=\"#msq\">msq</a>, &amp;<a class=\"id\" href=\"#s\">s</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ipc_rcu_getref\">ipc_rcu_getref</a>(<a class=\"id\" href=\"#msq\">msq</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msg_unlock\">msg_unlock</a>(<a class=\"id\" href=\"#msq\">msq</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#schedule\">schedule</a>();", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ipc_lock_by_ptr\">ipc_lock_by_ptr</a>(&amp;<a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_perm\">q_perm</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ipc_rcu_putref\">ipc_rcu_putref</a>(<a class=\"id\" href=\"#msq\">msq</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_perm\">q_perm</a>.<a class=\"id\" href=\"#deleted\">deleted</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#EIDRM\">EIDRM</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out_unlock_free\">out_unlock_free</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ss_del\">ss_del</a>(&amp;<a class=\"id\" href=\"#s\">s</a>);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#signal_pending\">signal_pending</a>(<a class=\"id\" href=\"#current\">current</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#ERESTARTNOHAND\">ERESTARTNOHAND</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out_unlock_free\">out_unlock_free</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_lspid\">q_lspid</a> = <a class=\"id\" href=\"#task_tgid_vnr\">task_tgid_vnr</a>(<a class=\"id\" href=\"#current\">current</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_stime\">q_stime</a> = <a class=\"id\" href=\"#get_seconds\">get_seconds</a>();", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#pipelined_send\">pipelined_send</a>(<a class=\"id\" href=\"#msq\">msq</a>, <a class=\"id\" href=\"#msg\">msg</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* noone is waiting for this message, enqueue it */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#list_add_tail\">list_add_tail</a>(&amp;<a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#m_list\">m_list</a>, &amp;<a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_messages\">q_messages</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_cbytes\">q_cbytes</a> += <a class=\"id\" href=\"#msgsz\">msgsz</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_qnum\">q_qnum</a>++;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#atomic_add\">atomic_add</a>(<a class=\"id\" href=\"#msgsz\">msgsz</a>, &amp;<a class=\"id\" href=\"#ns\">ns</a>-><a class=\"id\" href=\"#msg_bytes\">msg_bytes</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#atomic_inc\">atomic_inc</a>(&amp;<a class=\"id\" href=\"#ns\">ns</a>-><a class=\"id\" href=\"#msg_hdrs\">msg_hdrs</a>);", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#msg\">msg</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"", 
"<a class=\"id\" href=\"#out_unlock_free\">out_unlock_free</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#msg_unlock\">msg_unlock</a>(<a class=\"id\" href=\"#msq\">msq</a>);", 
"<a class=\"id\" href=\"#out_free\">out_free</a>:", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#msg\">msg</a> != <a class=\"id\" href=\"#NULL\">NULL</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#free_msg\">free_msg</a>(<a class=\"id\" href=\"#msg\">msg</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#err\">err</a>;", 
"}", 
"", 
"<a class=\"id\" href=\"#SYSCALL_DEFINE4\">SYSCALL_DEFINE4</a>(<a class=\"id\" href=\"#msgsnd\">msgsnd</a>, int, <a class=\"id\" href=\"#msqid\">msqid</a>, struct <a class=\"id\" href=\"#msgbuf\">msgbuf</a> <a class=\"id\" href=\"#__user\">__user</a> *, <a class=\"id\" href=\"#msgp\">msgp</a>, <a class=\"id\" href=\"#size_t\">size_t</a>, <a class=\"id\" href=\"#msgsz\">msgsz</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/>int, <a class=\"id\" href=\"#msgflg\">msgflg</a>)", 
"{", 
"<span class=\"ts\"/>long <a class=\"id\" href=\"#mtype\">mtype</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#get_user\">get_user</a>(<a class=\"id\" href=\"#mtype\">mtype</a>, &amp;<a class=\"id\" href=\"#msgp\">msgp</a>-><a class=\"id\" href=\"#mtype\">mtype</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EFAULT\">EFAULT</a>;", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#do_msgsnd\">do_msgsnd</a>(<a class=\"id\" href=\"#msqid\">msqid</a>, <a class=\"id\" href=\"#mtype\">mtype</a>, <a class=\"id\" href=\"#msgp\">msgp</a>-><a class=\"id\" href=\"#mtext\">mtext</a>, <a class=\"id\" href=\"#msgsz\">msgsz</a>, <a class=\"id\" href=\"#msgflg\">msgflg</a>);", 
"}", 
"", 
"static <a class=\"id\" href=\"#inline\">inline</a> int <a class=\"id\" href=\"#convert_mode\">convert_mode</a>(long *<a class=\"id\" href=\"#msgtyp\">msgtyp</a>, int <a class=\"id\" href=\"#msgflg\">msgflg</a>)", 
"{", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> *  find message of correct type.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> *  msgtyp = 0 =&gt; get first.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> *  msgtyp &gt; 0 =&gt; get first message of matching type.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> *  msgtyp &lt; 0 =&gt; get message with least type must be &lt; abs(msgtype).</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/>if (*<a class=\"id\" href=\"#msgtyp\">msgtyp</a> == 0)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#SEARCH_ANY\">SEARCH_ANY</a>;", 
"<span class=\"ts\"/>if (*<a class=\"id\" href=\"#msgtyp\">msgtyp</a> &lt; 0) {", 
"<span class=\"ts\"/><span class=\"ts\"/>*<a class=\"id\" href=\"#msgtyp\">msgtyp</a> = -*<a class=\"id\" href=\"#msgtyp\">msgtyp</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#SEARCH_LESSEQUAL\">SEARCH_LESSEQUAL</a>;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#msgflg\">msgflg</a> &amp; <a class=\"id\" href=\"#MSG_EXCEPT\">MSG_EXCEPT</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#SEARCH_NOTEQUAL\">SEARCH_NOTEQUAL</a>;", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#SEARCH_EQUAL\">SEARCH_EQUAL</a>;", 
"}", 
"", 
"long <a class=\"id\" href=\"#do_msgrcv\">do_msgrcv</a>(int <a class=\"id\" href=\"#msqid\">msqid</a>, long *<a class=\"id\" href=\"#pmtype\">pmtype</a>, void <a class=\"id\" href=\"#__user\">__user</a> *<a class=\"id\" href=\"#mtext\">mtext</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#size_t\">size_t</a> <a class=\"id\" href=\"#msgsz\">msgsz</a>, long <a class=\"id\" href=\"#msgtyp\">msgtyp</a>, int <a class=\"id\" href=\"#msgflg\">msgflg</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#msg_queue\">msg_queue</a> *<a class=\"id\" href=\"#msq\">msq</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#msg_msg\">msg_msg</a> *<a class=\"id\" href=\"#msg\">msg</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#mode\">mode</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ipc_namespace\">ipc_namespace</a> *<a class=\"id\" href=\"#ns\">ns</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#msqid\">msqid</a> &lt; 0 || (long) <a class=\"id\" href=\"#msgsz\">msgsz</a> &lt; 0)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mode\">mode</a> = <a class=\"id\" href=\"#convert_mode\">convert_mode</a>(&amp;<a class=\"id\" href=\"#msgtyp\">msgtyp</a>, <a class=\"id\" href=\"#msgflg\">msgflg</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ns\">ns</a> = <a class=\"id\" href=\"#current\">current</a>-><a class=\"id\" href=\"#nsproxy\">nsproxy</a>-><a class=\"id\" href=\"#ipc_ns\">ipc_ns</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#msq\">msq</a> = <a class=\"id\" href=\"#msg_lock_check\">msg_lock_check</a>(<a class=\"id\" href=\"#ns\">ns</a>, <a class=\"id\" href=\"#msqid\">msqid</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#IS_ERR\">IS_ERR</a>(<a class=\"id\" href=\"#msq\">msq</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#PTR_ERR\">PTR_ERR</a>(<a class=\"id\" href=\"#msq\">msq</a>);", 
"", 
"<span class=\"ts\"/>for (;;) {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#msg_receiver\">msg_receiver</a> <a class=\"id\" href=\"#msr_d\">msr_d</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#list_head\">list_head</a> *<a class=\"id\" href=\"#tmp\">tmp</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msg\">msg</a> = <a class=\"id\" href=\"#ERR_PTR\">ERR_PTR</a>(-<a class=\"id\" href=\"#EACCES\">EACCES</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#ipcperms\">ipcperms</a>(&amp;<a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_perm\">q_perm</a>, <a class=\"id\" href=\"#S_IRUGO\">S_IRUGO</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out_unlock\">out_unlock</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msg\">msg</a> = <a class=\"id\" href=\"#ERR_PTR\">ERR_PTR</a>(-<a class=\"id\" href=\"#EAGAIN\">EAGAIN</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tmp\">tmp</a> = <a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_messages\">q_messages</a>.<a class=\"id\" href=\"#next\">next</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>while (<a class=\"id\" href=\"#tmp\">tmp</a> != &amp;<a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_messages\">q_messages</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#msg_msg\">msg_msg</a> *<a class=\"id\" href=\"#walk_msg\">walk_msg</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#walk_msg\">walk_msg</a> = <a class=\"id\" href=\"#list_entry\">list_entry</a>(<a class=\"id\" href=\"#tmp\">tmp</a>, struct <a class=\"id\" href=\"#msg_msg\">msg_msg</a>, <a class=\"id\" href=\"#m_list\">m_list</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#testmsg\">testmsg</a>(<a class=\"id\" href=\"#walk_msg\">walk_msg</a>, <a class=\"id\" href=\"#msgtyp\">msgtyp</a>, <a class=\"id\" href=\"#mode\">mode</a>) &&", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>    !<a class=\"id\" href=\"#security_msg_queue_msgrcv\">security_msg_queue_msgrcv</a>(<a class=\"id\" href=\"#msq\">msq</a>, <a class=\"id\" href=\"#walk_msg\">walk_msg</a>, <a class=\"id\" href=\"#current\">current</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       <a class=\"id\" href=\"#msgtyp\">msgtyp</a>, <a class=\"id\" href=\"#mode\">mode</a>)) {", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msg\">msg</a> = <a class=\"id\" href=\"#walk_msg\">walk_msg</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#mode\">mode</a> == <a class=\"id\" href=\"#SEARCH_LESSEQUAL\">SEARCH_LESSEQUAL</a> &&", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#walk_msg\">walk_msg</a>-><a class=\"id\" href=\"#m_type\">m_type</a> != 1) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msg\">msg</a> = <a class=\"id\" href=\"#walk_msg\">walk_msg</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msgtyp\">msgtyp</a> = <a class=\"id\" href=\"#walk_msg\">walk_msg</a>-><a class=\"id\" href=\"#m_type\">m_type</a> - 1;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>} else {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msg\">msg</a> = <a class=\"id\" href=\"#walk_msg\">walk_msg</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tmp\">tmp</a> = <a class=\"id\" href=\"#tmp\">tmp</a>-><a class=\"id\" href=\"#next\">next</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#IS_ERR\">IS_ERR</a>(<a class=\"id\" href=\"#msg\">msg</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> * Found a suitable message.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> * Unlink it from the queue.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if ((<a class=\"id\" href=\"#msgsz\">msgsz</a> &lt; <a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#m_ts\">m_ts</a>) && !(<a class=\"id\" href=\"#msgflg\">msgflg</a> &amp; <a class=\"id\" href=\"#MSG_NOERROR\">MSG_NOERROR</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msg\">msg</a> = <a class=\"id\" href=\"#ERR_PTR\">ERR_PTR</a>(-<a class=\"id\" href=\"#E2BIG\">E2BIG</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out_unlock\">out_unlock</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#list_del\">list_del</a>(&amp;<a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#m_list\">m_list</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_qnum\">q_qnum</a>--;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_rtime\">q_rtime</a> = <a class=\"id\" href=\"#get_seconds\">get_seconds</a>();", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_lrpid\">q_lrpid</a> = <a class=\"id\" href=\"#task_tgid_vnr\">task_tgid_vnr</a>(<a class=\"id\" href=\"#current\">current</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_cbytes\">q_cbytes</a> -= <a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#m_ts\">m_ts</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#atomic_sub\">atomic_sub</a>(<a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#m_ts\">m_ts</a>, &amp;<a class=\"id\" href=\"#ns\">ns</a>-><a class=\"id\" href=\"#msg_bytes\">msg_bytes</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#atomic_dec\">atomic_dec</a>(&amp;<a class=\"id\" href=\"#ns\">ns</a>-><a class=\"id\" href=\"#msg_hdrs\">msg_hdrs</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ss_wakeup\">ss_wakeup</a>(&amp;<a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_senders\">q_senders</a>, 0);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msg_unlock\">msg_unlock</a>(<a class=\"id\" href=\"#msq\">msq</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* No message waiting. Wait for a message */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#msgflg\">msgflg</a> &amp; <a class=\"id\" href=\"#IPC_NOWAIT\">IPC_NOWAIT</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msg\">msg</a> = <a class=\"id\" href=\"#ERR_PTR\">ERR_PTR</a>(-<a class=\"id\" href=\"#ENOMSG\">ENOMSG</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out_unlock\">out_unlock</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#list_add_tail\">list_add_tail</a>(&amp;<a class=\"id\" href=\"#msr_d\">msr_d</a>.<a class=\"id\" href=\"#r_list\">r_list</a>, &amp;<a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_receivers\">q_receivers</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msr_d\">msr_d</a>.<a class=\"id\" href=\"#r_tsk\">r_tsk</a> = <a class=\"id\" href=\"#current\">current</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msr_d\">msr_d</a>.<a class=\"id\" href=\"#r_msgtype\">r_msgtype</a> = <a class=\"id\" href=\"#msgtyp\">msgtyp</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msr_d\">msr_d</a>.<a class=\"id\" href=\"#r_mode\">r_mode</a> = <a class=\"id\" href=\"#mode\">mode</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#msgflg\">msgflg</a> &amp; <a class=\"id\" href=\"#MSG_NOERROR\">MSG_NOERROR</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msr_d\">msr_d</a>.<a class=\"id\" href=\"#r_maxsize\">r_maxsize</a> = <a class=\"id\" href=\"#INT_MAX\">INT_MAX</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>else", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msr_d\">msr_d</a>.<a class=\"id\" href=\"#r_maxsize\">r_maxsize</a> = <a class=\"id\" href=\"#msgsz\">msgsz</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msr_d\">msr_d</a>.<a class=\"id\" href=\"#r_msg\">r_msg</a> = <a class=\"id\" href=\"#ERR_PTR\">ERR_PTR</a>(-<a class=\"id\" href=\"#EAGAIN\">EAGAIN</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#current\">current</a>-><a class=\"id\" href=\"#state\">state</a> = <a class=\"id\" href=\"#TASK_INTERRUPTIBLE\">TASK_INTERRUPTIBLE</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msg_unlock\">msg_unlock</a>(<a class=\"id\" href=\"#msq\">msq</a>);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#schedule\">schedule</a>();", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Lockless receive, part 1:</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * Disable preemption.  We don't hold a reference to the queue</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * and getting a reference would defeat the idea of a lockless</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * operation, thus the code relies on rcu to guarantee the</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * existance of msq:</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * Prior to destruction, expunge_all(-EIRDM) changes r_msg.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * Thus if r_msg is -EAGAIN, then the queue not yet destroyed.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * rcu_read_lock() prevents preemption between reading r_msg</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * and the spin_lock() inside ipc_lock_by_ptr().</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rcu_read_lock\">rcu_read_lock</a>();", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Lockless receive, part 2:</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * Wait until pipelined_send or expunge_all are outside of</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * wake_up_process(). There is a race with exit(), see</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * ipc/mqueue.c for the details.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msg\">msg</a> = (struct <a class=\"id\" href=\"#msg_msg\">msg_msg</a>*)<a class=\"id\" href=\"#msr_d\">msr_d</a>.<a class=\"id\" href=\"#r_msg\">r_msg</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>while (<a class=\"id\" href=\"#msg\">msg</a> == <a class=\"id\" href=\"#NULL\">NULL</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#cpu_relax\">cpu_relax</a>();", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msg\">msg</a> = (struct <a class=\"id\" href=\"#msg_msg\">msg_msg</a> *)<a class=\"id\" href=\"#msr_d\">msr_d</a>.<a class=\"id\" href=\"#r_msg\">r_msg</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Lockless receive, part 3:</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * If there is a message or an error then accept it without</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * locking.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#msg\">msg</a> != <a class=\"id\" href=\"#ERR_PTR\">ERR_PTR</a>(-<a class=\"id\" href=\"#EAGAIN\">EAGAIN</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rcu_read_unlock\">rcu_read_unlock</a>();", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Lockless receive, part 3:</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * Acquire the queue spinlock.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ipc_lock_by_ptr\">ipc_lock_by_ptr</a>(&amp;<a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_perm\">q_perm</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rcu_read_unlock\">rcu_read_unlock</a>();", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Lockless receive, part 4:</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * Repeat test after acquiring the spinlock.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msg\">msg</a> = (struct <a class=\"id\" href=\"#msg_msg\">msg_msg</a>*)<a class=\"id\" href=\"#msr_d\">msr_d</a>.<a class=\"id\" href=\"#r_msg\">r_msg</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#msg\">msg</a> != <a class=\"id\" href=\"#ERR_PTR\">ERR_PTR</a>(-<a class=\"id\" href=\"#EAGAIN\">EAGAIN</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out_unlock\">out_unlock</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#list_del\">list_del</a>(&amp;<a class=\"id\" href=\"#msr_d\">msr_d</a>.<a class=\"id\" href=\"#r_list\">r_list</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#signal_pending\">signal_pending</a>(<a class=\"id\" href=\"#current\">current</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msg\">msg</a> = <a class=\"id\" href=\"#ERR_PTR\">ERR_PTR</a>(-<a class=\"id\" href=\"#ERESTARTNOHAND\">ERESTARTNOHAND</a>);", 
"<a class=\"id\" href=\"#out_unlock\">out_unlock</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msg_unlock\">msg_unlock</a>(<a class=\"id\" href=\"#msq\">msq</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#IS_ERR\">IS_ERR</a>(<a class=\"id\" href=\"#msg\">msg</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#PTR_ERR\">PTR_ERR</a>(<a class=\"id\" href=\"#msg\">msg</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#msgsz\">msgsz</a> = (<a class=\"id\" href=\"#msgsz\">msgsz</a> &gt; <a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#m_ts\">m_ts</a>) ? <a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#m_ts\">m_ts</a> : <a class=\"id\" href=\"#msgsz\">msgsz</a>;", 
"<span class=\"ts\"/>*<a class=\"id\" href=\"#pmtype\">pmtype</a> = <a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#m_type\">m_type</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#store_msg\">store_msg</a>(<a class=\"id\" href=\"#mtext\">mtext</a>, <a class=\"id\" href=\"#msg\">msg</a>, <a class=\"id\" href=\"#msgsz\">msgsz</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msgsz\">msgsz</a> = -<a class=\"id\" href=\"#EFAULT\">EFAULT</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#free_msg\">free_msg</a>(<a class=\"id\" href=\"#msg\">msg</a>);", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#msgsz\">msgsz</a>;", 
"}", 
"", 
"<a class=\"id\" href=\"#SYSCALL_DEFINE5\">SYSCALL_DEFINE5</a>(<a class=\"id\" href=\"#msgrcv\">msgrcv</a>, int, <a class=\"id\" href=\"#msqid\">msqid</a>, struct <a class=\"id\" href=\"#msgbuf\">msgbuf</a> <a class=\"id\" href=\"#__user\">__user</a> *, <a class=\"id\" href=\"#msgp\">msgp</a>, <a class=\"id\" href=\"#size_t\">size_t</a>, <a class=\"id\" href=\"#msgsz\">msgsz</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/>long, <a class=\"id\" href=\"#msgtyp\">msgtyp</a>, int, <a class=\"id\" href=\"#msgflg\">msgflg</a>)", 
"{", 
"<span class=\"ts\"/>long <a class=\"id\" href=\"#err\">err</a>, <a class=\"id\" href=\"#mtype\">mtype</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> =  <a class=\"id\" href=\"#do_msgrcv\">do_msgrcv</a>(<a class=\"id\" href=\"#msqid\">msqid</a>, &amp;<a class=\"id\" href=\"#mtype\">mtype</a>, <a class=\"id\" href=\"#msgp\">msgp</a>-><a class=\"id\" href=\"#mtext\">mtext</a>, <a class=\"id\" href=\"#msgsz\">msgsz</a>, <a class=\"id\" href=\"#msgtyp\">msgtyp</a>, <a class=\"id\" href=\"#msgflg\">msgflg</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#err\">err</a> &lt; 0)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#put_user\">put_user</a>(<a class=\"id\" href=\"#mtype\">mtype</a>, &amp;<a class=\"id\" href=\"#msgp\">msgp</a>-><a class=\"id\" href=\"#mtype\">mtype</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#EFAULT\">EFAULT</a>;", 
"<a class=\"id\" href=\"#out\">out</a>:", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#err\">err</a>;", 
"}", 
"", 
"#<a class=\"id\" href=\"#ifdef\">ifdef</a> <a class=\"id\" href=\"#CONFIG_PROC_FS\">CONFIG_PROC_FS</a>", 
"static int <a class=\"id\" href=\"#sysvipc_msg_proc_show\">sysvipc_msg_proc_show</a>(struct <a class=\"id\" href=\"#seq_file\">seq_file</a> *<a class=\"id\" href=\"#s\">s</a>, void *<a class=\"id\" href=\"#it\">it</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#msg_queue\">msg_queue</a> *<a class=\"id\" href=\"#msq\">msq</a> = <a class=\"id\" href=\"#it\">it</a>;", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#seq_printf\">seq_printf</a>(<a class=\"id\" href=\"#s\">s</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>\"%10d %10d  %4o  %10lu %10lu %5u %5u %5u %5u %5u %5u %10lu %10lu %10lu\\n\",", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_perm\">q_perm</a>.<a class=\"id\" href=\"#key\">key</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_perm\">q_perm</a>.<a class=\"id\" href=\"#id\">id</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_perm\">q_perm</a>.<a class=\"id\" href=\"#mode\">mode</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_cbytes\">q_cbytes</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_qnum\">q_qnum</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_lspid\">q_lspid</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_lrpid\">q_lrpid</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_perm\">q_perm</a>.<a class=\"id\" href=\"#uid\">uid</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_perm\">q_perm</a>.<a class=\"id\" href=\"#gid\">gid</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_perm\">q_perm</a>.<a class=\"id\" href=\"#cuid\">cuid</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_perm\">q_perm</a>.<a class=\"id\" href=\"#cgid\">cgid</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_stime\">q_stime</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_rtime\">q_rtime</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msq\">msq</a>-><a class=\"id\" href=\"#q_ctime\">q_ctime</a>);", 
"}", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
];
xr_frag_insert('l/01/07e048b6d080f51de0030175605989d0974844.xr', __xr_tmp);
