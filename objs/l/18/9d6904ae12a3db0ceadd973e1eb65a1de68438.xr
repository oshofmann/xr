var __xr_tmp = [
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * dcookies.c</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Copyright 2002 John Levon &lt;levon@movementarian.org&gt;</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Persistent cookie-path mappings. These are used by</span>", 
"<span class=\"comment\"> * profilers to convert a per-task EIP value into something</span>", 
"<span class=\"comment\"> * non-transitory that can be processed at a later date.</span>", 
"<span class=\"comment\"> * This is done by locking the dentry/vfsmnt pair in the</span>", 
"<span class=\"comment\"> * kernel until released by the tasks needing the persistent</span>", 
"<span class=\"comment\"> * objects. The tag is simply an unsigned long that refers</span>", 
"<span class=\"comment\"> * to the pair and can be looked up from userspace.</span>", 
"<span class=\"comment\"> */</span>", 
"", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#syscalls\">syscalls</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#module\">module</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#slab\">slab</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#list\">list</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#mount\">mount</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#capability\">capability</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#dcache\">dcache</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#mm\">mm</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#err\">err</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#errno\">errno</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#dcookies\">dcookies</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#mutex\">mutex</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#path\">path</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#asm\">asm</a>/<a class=\"id\" href=\"#uaccess\">uaccess</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"", 
"<span class=\"comment\">/* The dcookies are allocated from a kmem_cache and</span>", 
"<span class=\"comment\"> * hashed onto a small number of lists. None of the</span>", 
"<span class=\"comment\"> * code here is particularly performance critical</span>", 
"<span class=\"comment\"> */</span>", 
"struct <a class=\"id\" href=\"#dcookie_struct\">dcookie_struct</a> {", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#path\">path</a> <a class=\"id\" href=\"#path\">path</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#list_head\">list_head</a> <a class=\"id\" href=\"#hash_list\">hash_list</a>;", 
"};", 
"", 
"static <a class=\"id\" href=\"#LIST_HEAD\">LIST_HEAD</a>(<a class=\"id\" href=\"#dcookie_users\">dcookie_users</a>);", 
"static <a class=\"id\" href=\"#DEFINE_MUTEX\">DEFINE_MUTEX</a>(<a class=\"id\" href=\"#dcookie_mutex\">dcookie_mutex</a>);", 
"static struct <a class=\"id\" href=\"#kmem_cache\">kmem_cache</a> *<a class=\"id\" href=\"#dcookie_cache\">dcookie_cache</a> <a class=\"id\" href=\"#__read_mostly\">__read_mostly</a>;", 
"static struct <a class=\"id\" href=\"#list_head\">list_head</a> *<a class=\"id\" href=\"#dcookie_hashtable\">dcookie_hashtable</a> <a class=\"id\" href=\"#__read_mostly\">__read_mostly</a>;", 
"static <a class=\"id\" href=\"#size_t\">size_t</a> <a class=\"id\" href=\"#hash_size\">hash_size</a> <a class=\"id\" href=\"#__read_mostly\">__read_mostly</a>;", 
"", 
"static <a class=\"id\" href=\"#inline\">inline</a> int <a class=\"id\" href=\"#is_live\">is_live</a>(void)", 
"{", 
"<span class=\"ts\"/>return !(<a class=\"id\" href=\"#list_empty\">list_empty</a>(&amp;<a class=\"id\" href=\"#dcookie_users\">dcookie_users</a>));", 
"}", 
"", 
"", 
"<span class=\"comment\">/* The dentry is locked, its address will do for the cookie */</span>", 
"static <a class=\"id\" href=\"#inline\">inline</a> unsigned long <a class=\"id\" href=\"#dcookie_value\">dcookie_value</a>(struct <a class=\"id\" href=\"#dcookie_struct\">dcookie_struct</a> * <a class=\"id\" href=\"#dcs\">dcs</a>)", 
"{", 
"<span class=\"ts\"/>return (unsigned long)<a class=\"id\" href=\"#dcs\">dcs</a>-><a class=\"id\" href=\"#path\">path</a>.<a class=\"id\" href=\"#dentry\">dentry</a>;", 
"}", 
"", 
"", 
"static <a class=\"id\" href=\"#size_t\">size_t</a> <a class=\"id\" href=\"#dcookie_hash\">dcookie_hash</a>(unsigned long <a class=\"id\" href=\"#dcookie\">dcookie</a>)", 
"{", 
"<span class=\"ts\"/>return (<a class=\"id\" href=\"#dcookie\">dcookie</a> >> <a class=\"id\" href=\"#L1_CACHE_SHIFT\">L1_CACHE_SHIFT</a>) &amp; (<a class=\"id\" href=\"#hash_size\">hash_size</a> - 1);", 
"}", 
"", 
"", 
"static struct <a class=\"id\" href=\"#dcookie_struct\">dcookie_struct</a> * <a class=\"id\" href=\"#find_dcookie\">find_dcookie</a>(unsigned long <a class=\"id\" href=\"#dcookie\">dcookie</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#dcookie_struct\">dcookie_struct</a> *<a class=\"id\" href=\"#found\">found</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#dcookie_struct\">dcookie_struct</a> * <a class=\"id\" href=\"#dcs\">dcs</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#list_head\">list_head</a> * <a class=\"id\" href=\"#pos\">pos</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#list_head\">list_head</a> * <a class=\"id\" href=\"#list\">list</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list\">list</a> = <a class=\"id\" href=\"#dcookie_hashtable\">dcookie_hashtable</a> + <a class=\"id\" href=\"#dcookie_hash\">dcookie_hash</a>(<a class=\"id\" href=\"#dcookie\">dcookie</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_for_each\">list_for_each</a>(<a class=\"id\" href=\"#pos\">pos</a>, <a class=\"id\" href=\"#list\">list</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#dcs\">dcs</a> = <a class=\"id\" href=\"#list_entry\">list_entry</a>(<a class=\"id\" href=\"#pos\">pos</a>, struct <a class=\"id\" href=\"#dcookie_struct\">dcookie_struct</a>, <a class=\"id\" href=\"#hash_list\">hash_list</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#dcookie_value\">dcookie_value</a>(<a class=\"id\" href=\"#dcs\">dcs</a>) == <a class=\"id\" href=\"#dcookie\">dcookie</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#found\">found</a> = <a class=\"id\" href=\"#dcs\">dcs</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#found\">found</a>;", 
"}", 
"", 
"", 
"static void <a class=\"id\" href=\"#hash_dcookie\">hash_dcookie</a>(struct <a class=\"id\" href=\"#dcookie_struct\">dcookie_struct</a> * <a class=\"id\" href=\"#dcs\">dcs</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#list_head\">list_head</a> * <a class=\"id\" href=\"#list\">list</a> = <a class=\"id\" href=\"#dcookie_hashtable\">dcookie_hashtable</a> + <a class=\"id\" href=\"#dcookie_hash\">dcookie_hash</a>(<a class=\"id\" href=\"#dcookie_value\">dcookie_value</a>(<a class=\"id\" href=\"#dcs\">dcs</a>));", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_add\">list_add</a>(&amp;<a class=\"id\" href=\"#dcs\">dcs</a>-><a class=\"id\" href=\"#hash_list\">hash_list</a>, <a class=\"id\" href=\"#list\">list</a>);", 
"}", 
"", 
"", 
"static struct <a class=\"id\" href=\"#dcookie_struct\">dcookie_struct</a> *<a class=\"id\" href=\"#alloc_dcookie\">alloc_dcookie</a>(struct <a class=\"id\" href=\"#path\">path</a> *<a class=\"id\" href=\"#path\">path</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#dcookie_struct\">dcookie_struct</a> *<a class=\"id\" href=\"#dcs\">dcs</a> = <a class=\"id\" href=\"#kmem_cache_alloc\">kmem_cache_alloc</a>(<a class=\"id\" href=\"#dcookie_cache\">dcookie_cache</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#GFP_KERNEL\">GFP_KERNEL</a>);", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#dentry\">dentry</a> *<a class=\"id\" href=\"#d\">d</a>;", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#dcs\">dcs</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#d\">d</a> = <a class=\"id\" href=\"#path\">path</a>-><a class=\"id\" href=\"#dentry\">dentry</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock\">spin_lock</a>(&amp;<a class=\"id\" href=\"#d\">d</a>-><a class=\"id\" href=\"#d_lock\">d_lock</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#d\">d</a>-><a class=\"id\" href=\"#d_flags\">d_flags</a> |= <a class=\"id\" href=\"#DCACHE_COOKIE\">DCACHE_COOKIE</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock\">spin_unlock</a>(&amp;<a class=\"id\" href=\"#d\">d</a>-><a class=\"id\" href=\"#d_lock\">d_lock</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dcs\">dcs</a>-><a class=\"id\" href=\"#path\">path</a> = *<a class=\"id\" href=\"#path\">path</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#path_get\">path_get</a>(<a class=\"id\" href=\"#path\">path</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#hash_dcookie\">hash_dcookie</a>(<a class=\"id\" href=\"#dcs\">dcs</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#dcs\">dcs</a>;", 
"}", 
"", 
"", 
"<span class=\"comment\">/* This is the main kernel-side routine that retrieves the cookie</span>", 
"<span class=\"comment\"> * value for a dentry/vfsmnt pair.</span>", 
"<span class=\"comment\"> */</span>", 
"int <a class=\"id\" href=\"#get_dcookie\">get_dcookie</a>(struct <a class=\"id\" href=\"#path\">path</a> *<a class=\"id\" href=\"#path\">path</a>, unsigned long *<a class=\"id\" href=\"#cookie\">cookie</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#err\">err</a> = 0;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#dcookie_struct\">dcookie_struct</a> * <a class=\"id\" href=\"#dcs\">dcs</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_lock\">mutex_lock</a>(&amp;<a class=\"id\" href=\"#dcookie_mutex\">dcookie_mutex</a>);", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#is_live\">is_live</a>()) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#path\">path</a>-><a class=\"id\" href=\"#dentry\">dentry</a>-><a class=\"id\" href=\"#d_flags\">d_flags</a> &amp; <a class=\"id\" href=\"#DCACHE_COOKIE\">DCACHE_COOKIE</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#dcs\">dcs</a> = <a class=\"id\" href=\"#find_dcookie\">find_dcookie</a>((unsigned long)<a class=\"id\" href=\"#path\">path</a>-><a class=\"id\" href=\"#dentry\">dentry</a>);", 
"<span class=\"ts\"/>} else {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#dcs\">dcs</a> = <a class=\"id\" href=\"#alloc_dcookie\">alloc_dcookie</a>(<a class=\"id\" href=\"#path\">path</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#dcs\">dcs</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>*<a class=\"id\" href=\"#cookie\">cookie</a> = <a class=\"id\" href=\"#dcookie_value\">dcookie_value</a>(<a class=\"id\" href=\"#dcs\">dcs</a>);", 
"", 
"<a class=\"id\" href=\"#out\">out</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_unlock\">mutex_unlock</a>(&amp;<a class=\"id\" href=\"#dcookie_mutex\">dcookie_mutex</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#err\">err</a>;", 
"}", 
"", 
"", 
"<span class=\"comment\">/* And here is where the userspace process can look up the cookie value</span>", 
"<span class=\"comment\"> * to retrieve the path.</span>", 
"<span class=\"comment\"> */</span>", 
"<a class=\"id\" href=\"#SYSCALL_DEFINE\">SYSCALL_DEFINE</a>(<a class=\"id\" href=\"#lookup_dcookie\">lookup_dcookie</a>)(<a class=\"id\" href=\"#u64\">u64</a> <a class=\"id\" href=\"#cookie64\">cookie64</a>, char <a class=\"id\" href=\"#__user\">__user</a> * <a class=\"id\" href=\"#buf\">buf</a>, <a class=\"id\" href=\"#size_t\">size_t</a> <a class=\"id\" href=\"#len\">len</a>)", 
"{", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#cookie\">cookie</a> = (unsigned long)<a class=\"id\" href=\"#cookie64\">cookie64</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"<span class=\"ts\"/>char * <a class=\"id\" href=\"#kbuf\">kbuf</a>;", 
"<span class=\"ts\"/>char * <a class=\"id\" href=\"#path\">path</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#size_t\">size_t</a> <a class=\"id\" href=\"#pathlen\">pathlen</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#dcookie_struct\">dcookie_struct</a> * <a class=\"id\" href=\"#dcs\">dcs</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* we could leak path information to users</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * without dir read permission without this</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#capable\">capable</a>(<a class=\"id\" href=\"#CAP_SYS_ADMIN\">CAP_SYS_ADMIN</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EPERM\">EPERM</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_lock\">mutex_lock</a>(&amp;<a class=\"id\" href=\"#dcookie_mutex\">dcookie_mutex</a>);", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#is_live\">is_live</a>()) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>if (!(<a class=\"id\" href=\"#dcs\">dcs</a> = <a class=\"id\" href=\"#find_dcookie\">find_dcookie</a>(<a class=\"id\" href=\"#cookie\">cookie</a>)))", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kbuf\">kbuf</a> = <a class=\"id\" href=\"#kmalloc\">kmalloc</a>(<a class=\"id\" href=\"#PAGE_SIZE\">PAGE_SIZE</a>, <a class=\"id\" href=\"#GFP_KERNEL\">GFP_KERNEL</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#kbuf\">kbuf</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* FIXME: (deleted) ? */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#path\">path</a> = <a class=\"id\" href=\"#d_path\">d_path</a>(&amp;<a class=\"id\" href=\"#dcs\">dcs</a>-><a class=\"id\" href=\"#path\">path</a>, <a class=\"id\" href=\"#kbuf\">kbuf</a>, <a class=\"id\" href=\"#PAGE_SIZE\">PAGE_SIZE</a>);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#IS_ERR\">IS_ERR</a>(<a class=\"id\" href=\"#path\">path</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = <a class=\"id\" href=\"#PTR_ERR\">PTR_ERR</a>(<a class=\"id\" href=\"#path\">path</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out_free\">out_free</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#ERANGE\">ERANGE</a>;", 
" ", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pathlen\">pathlen</a> = <a class=\"id\" href=\"#kbuf\">kbuf</a> + <a class=\"id\" href=\"#PAGE_SIZE\">PAGE_SIZE</a> - <a class=\"id\" href=\"#path\">path</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#pathlen\">pathlen</a> <= <a class=\"id\" href=\"#len\">len</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = <a class=\"id\" href=\"#pathlen\">pathlen</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#copy_to_user\">copy_to_user</a>(<a class=\"id\" href=\"#buf\">buf</a>, <a class=\"id\" href=\"#path\">path</a>, <a class=\"id\" href=\"#pathlen\">pathlen</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#EFAULT\">EFAULT</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<a class=\"id\" href=\"#out_free\">out_free</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#kbuf\">kbuf</a>);", 
"<a class=\"id\" href=\"#out\">out</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_unlock\">mutex_unlock</a>(&amp;<a class=\"id\" href=\"#dcookie_mutex\">dcookie_mutex</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#err\">err</a>;", 
"}", 
"#<a class=\"id\" href=\"#ifdef\">ifdef</a> <a class=\"id\" href=\"#CONFIG_HAVE_SYSCALL_WRAPPERS\">CONFIG_HAVE_SYSCALL_WRAPPERS</a>", 
"<a class=\"id\" href=\"#asmlinkage\">asmlinkage</a> long <a class=\"id\" href=\"#SyS_lookup_dcookie\">SyS_lookup_dcookie</a>(<a class=\"id\" href=\"#u64\">u64</a> <a class=\"id\" href=\"#cookie64\">cookie64</a>, long <a class=\"id\" href=\"#buf\">buf</a>, long <a class=\"id\" href=\"#len\">len</a>)", 
"{", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#SYSC_lookup_dcookie\">SYSC_lookup_dcookie</a>(<a class=\"id\" href=\"#cookie64\">cookie64</a>, (char <a class=\"id\" href=\"#__user\">__user</a> *) <a class=\"id\" href=\"#buf\">buf</a>, (<a class=\"id\" href=\"#size_t\">size_t</a>) <a class=\"id\" href=\"#len\">len</a>);", 
"}", 
"<a class=\"id\" href=\"#SYSCALL_ALIAS\">SYSCALL_ALIAS</a>(<a class=\"id\" href=\"#sys_lookup_dcookie\">sys_lookup_dcookie</a>, <a class=\"id\" href=\"#SyS_lookup_dcookie\">SyS_lookup_dcookie</a>);", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
"", 
"static int <a class=\"id\" href=\"#dcookie_init\">dcookie_init</a>(void)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#list_head\">list_head</a> * <a class=\"id\" href=\"#d\">d</a>;", 
"<span class=\"ts\"/>unsigned int <a class=\"id\" href=\"#i\">i</a>, <a class=\"id\" href=\"#hash_bits\">hash_bits</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dcookie_cache\">dcookie_cache</a> = <a class=\"id\" href=\"#kmem_cache_create\">kmem_cache_create</a>(\"dcookie_cache\",", 
"<span class=\"ts\"/><span class=\"ts\"/>sizeof(struct <a class=\"id\" href=\"#dcookie_struct\">dcookie_struct</a>),", 
"<span class=\"ts\"/><span class=\"ts\"/>0, 0, <a class=\"id\" href=\"#NULL\">NULL</a>);", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#dcookie_cache\">dcookie_cache</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dcookie_hashtable\">dcookie_hashtable</a> = <a class=\"id\" href=\"#kmalloc\">kmalloc</a>(<a class=\"id\" href=\"#PAGE_SIZE\">PAGE_SIZE</a>, <a class=\"id\" href=\"#GFP_KERNEL\">GFP_KERNEL</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#dcookie_hashtable\">dcookie_hashtable</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out_kmem\">out_kmem</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = 0;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Find the power-of-two list-heads that can fit into the allocation..</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * We don't guarantee that \"sizeof(struct list_head)\" is necessarily</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * a power-of-two.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#hash_size\">hash_size</a> = <a class=\"id\" href=\"#PAGE_SIZE\">PAGE_SIZE</a> / sizeof(struct <a class=\"id\" href=\"#list_head\">list_head</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#hash_bits\">hash_bits</a> = 0;", 
"<span class=\"ts\"/>do {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#hash_bits\">hash_bits</a>++;", 
"<span class=\"ts\"/>} while ((<a class=\"id\" href=\"#hash_size\">hash_size</a> >> <a class=\"id\" href=\"#hash_bits\">hash_bits</a>) != 0);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#hash_bits\">hash_bits</a>--;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Re-calculate the actual number of entries and the mask</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * from the number of bits we can fit.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#hash_size\">hash_size</a> = 1UL << <a class=\"id\" href=\"#hash_bits\">hash_bits</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* And initialize the newly allocated array */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#d\">d</a> = <a class=\"id\" href=\"#dcookie_hashtable\">dcookie_hashtable</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#i\">i</a> = <a class=\"id\" href=\"#hash_size\">hash_size</a>;", 
"<span class=\"ts\"/>do {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#INIT_LIST_HEAD\">INIT_LIST_HEAD</a>(<a class=\"id\" href=\"#d\">d</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#d\">d</a>++;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#i\">i</a>--;", 
"<span class=\"ts\"/>} while (<a class=\"id\" href=\"#i\">i</a>);", 
"", 
"<a class=\"id\" href=\"#out\">out</a>:", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#err\">err</a>;", 
"<a class=\"id\" href=\"#out_kmem\">out_kmem</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kmem_cache_destroy\">kmem_cache_destroy</a>(<a class=\"id\" href=\"#dcookie_cache\">dcookie_cache</a>);", 
"<span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"}", 
"", 
"", 
"static void <a class=\"id\" href=\"#free_dcookie\">free_dcookie</a>(struct <a class=\"id\" href=\"#dcookie_struct\">dcookie_struct</a> * <a class=\"id\" href=\"#dcs\">dcs</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#dentry\">dentry</a> *<a class=\"id\" href=\"#d\">d</a> = <a class=\"id\" href=\"#dcs\">dcs</a>-><a class=\"id\" href=\"#path\">path</a>.<a class=\"id\" href=\"#dentry\">dentry</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock\">spin_lock</a>(&amp;<a class=\"id\" href=\"#d\">d</a>-><a class=\"id\" href=\"#d_lock\">d_lock</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#d\">d</a>-><a class=\"id\" href=\"#d_flags\">d_flags</a> &= ~<a class=\"id\" href=\"#DCACHE_COOKIE\">DCACHE_COOKIE</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock\">spin_unlock</a>(&amp;<a class=\"id\" href=\"#d\">d</a>-><a class=\"id\" href=\"#d_lock\">d_lock</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#path_put\">path_put</a>(&amp;<a class=\"id\" href=\"#dcs\">dcs</a>-><a class=\"id\" href=\"#path\">path</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kmem_cache_free\">kmem_cache_free</a>(<a class=\"id\" href=\"#dcookie_cache\">dcookie_cache</a>, <a class=\"id\" href=\"#dcs\">dcs</a>);", 
"}", 
"", 
"", 
"static void <a class=\"id\" href=\"#dcookie_exit\">dcookie_exit</a>(void)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#list_head\">list_head</a> * <a class=\"id\" href=\"#list\">list</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#list_head\">list_head</a> * <a class=\"id\" href=\"#pos\">pos</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#list_head\">list_head</a> * <a class=\"id\" href=\"#pos2\">pos2</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#dcookie_struct\">dcookie_struct</a> * <a class=\"id\" href=\"#dcs\">dcs</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#size_t\">size_t</a> <a class=\"id\" href=\"#i\">i</a>;", 
"", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = 0; <a class=\"id\" href=\"#i\">i</a> &lt; <a class=\"id\" href=\"#hash_size\">hash_size</a>; ++<a class=\"id\" href=\"#i\">i</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#list\">list</a> = <a class=\"id\" href=\"#dcookie_hashtable\">dcookie_hashtable</a> + <a class=\"id\" href=\"#i\">i</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#list_for_each_safe\">list_for_each_safe</a>(<a class=\"id\" href=\"#pos\">pos</a>, <a class=\"id\" href=\"#pos2\">pos2</a>, <a class=\"id\" href=\"#list\">list</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#dcs\">dcs</a> = <a class=\"id\" href=\"#list_entry\">list_entry</a>(<a class=\"id\" href=\"#pos\">pos</a>, struct <a class=\"id\" href=\"#dcookie_struct\">dcookie_struct</a>, <a class=\"id\" href=\"#hash_list\">hash_list</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#list_del\">list_del</a>(&amp;<a class=\"id\" href=\"#dcs\">dcs</a>-><a class=\"id\" href=\"#hash_list\">hash_list</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#free_dcookie\">free_dcookie</a>(<a class=\"id\" href=\"#dcs\">dcs</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#dcookie_hashtable\">dcookie_hashtable</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kmem_cache_destroy\">kmem_cache_destroy</a>(<a class=\"id\" href=\"#dcookie_cache\">dcookie_cache</a>);", 
"}", 
"", 
"", 
"struct <a class=\"id\" href=\"#dcookie_user\">dcookie_user</a> {", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#list_head\">list_head</a> <a class=\"id\" href=\"#next\">next</a>;", 
"};", 
" ", 
"struct <a class=\"id\" href=\"#dcookie_user\">dcookie_user</a> * <a class=\"id\" href=\"#dcookie_register\">dcookie_register</a>(void)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#dcookie_user\">dcookie_user</a> * <a class=\"id\" href=\"#user\">user</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_lock\">mutex_lock</a>(&amp;<a class=\"id\" href=\"#dcookie_mutex\">dcookie_mutex</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#user\">user</a> = <a class=\"id\" href=\"#kmalloc\">kmalloc</a>(sizeof(struct <a class=\"id\" href=\"#dcookie_user\">dcookie_user</a>), <a class=\"id\" href=\"#GFP_KERNEL\">GFP_KERNEL</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#user\">user</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#is_live\">is_live</a>() && <a class=\"id\" href=\"#dcookie_init\">dcookie_init</a>())", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out_free\">out_free</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_add\">list_add</a>(&amp;<a class=\"id\" href=\"#user\">user</a>-><a class=\"id\" href=\"#next\">next</a>, &amp;<a class=\"id\" href=\"#dcookie_users\">dcookie_users</a>);", 
"", 
"<a class=\"id\" href=\"#out\">out</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_unlock\">mutex_unlock</a>(&amp;<a class=\"id\" href=\"#dcookie_mutex\">dcookie_mutex</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#user\">user</a>;", 
"<a class=\"id\" href=\"#out_free\">out_free</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#user\">user</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#user\">user</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"}", 
"", 
"", 
"void <a class=\"id\" href=\"#dcookie_unregister\">dcookie_unregister</a>(struct <a class=\"id\" href=\"#dcookie_user\">dcookie_user</a> * <a class=\"id\" href=\"#user\">user</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_lock\">mutex_lock</a>(&amp;<a class=\"id\" href=\"#dcookie_mutex\">dcookie_mutex</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_del\">list_del</a>(&amp;<a class=\"id\" href=\"#user\">user</a>-><a class=\"id\" href=\"#next\">next</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#user\">user</a>);", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#is_live\">is_live</a>())", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#dcookie_exit\">dcookie_exit</a>();", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_unlock\">mutex_unlock</a>(&amp;<a class=\"id\" href=\"#dcookie_mutex\">dcookie_mutex</a>);", 
"}", 
"", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#dcookie_register\">dcookie_register</a>);", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#dcookie_unregister\">dcookie_unregister</a>);", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#get_dcookie\">get_dcookie</a>);", 
];
xr_frag_insert('l/18/9d6904ae12a3db0ceadd973e1eb65a1de68438.xr', __xr_tmp);
