var __xr_tmp = [
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#module\">module</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#sched\">sched</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#kthread\">kthread</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#workqueue\">workqueue</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#asm\">asm</a>/<a class=\"id\" href=\"#e820\">e820</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#asm\">asm</a>/<a class=\"id\" href=\"#proto\">proto</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Some BIOSes seem to corrupt the low 64k of memory during events</span>", 
"<span class=\"comment\"> * like suspend/resume and unplugging an HDMI cable.  Reserve all</span>", 
"<span class=\"comment\"> * remaining free memory in that area and fill it with a distinct</span>", 
"<span class=\"comment\"> * pattern.</span>", 
"<span class=\"comment\"> */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#MAX_SCAN_AREAS\">MAX_SCAN_AREAS</a><span class=\"ts\"/>8", 
"", 
"static int <a class=\"id\" href=\"#__read_mostly\">__read_mostly</a> <a class=\"id\" href=\"#memory_corruption_check\">memory_corruption_check</a> = -1;", 
"", 
"static unsigned <a class=\"id\" href=\"#__read_mostly\">__read_mostly</a> <a class=\"id\" href=\"#corruption_check_size\">corruption_check_size</a> = 64*1024;", 
"static unsigned <a class=\"id\" href=\"#__read_mostly\">__read_mostly</a> <a class=\"id\" href=\"#corruption_check_period\">corruption_check_period</a> = 60; <span class=\"comment\">/* seconds */</span>", 
"", 
"static struct <a class=\"id\" href=\"#e820entry\">e820entry</a> <a class=\"id\" href=\"#scan_areas\">scan_areas</a>[<a class=\"id\" href=\"#MAX_SCAN_AREAS\">MAX_SCAN_AREAS</a>];", 
"static int <a class=\"id\" href=\"#num_scan_areas\">num_scan_areas</a>;", 
"", 
"", 
"static <a class=\"id\" href=\"#__init\">__init</a> int <a class=\"id\" href=\"#set_corruption_check\">set_corruption_check</a>(char *<a class=\"id\" href=\"#arg\">arg</a>)", 
"{", 
"<span class=\"ts\"/>char *<a class=\"id\" href=\"#end\">end</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#memory_corruption_check\">memory_corruption_check</a> = <a class=\"id\" href=\"#simple_strtol\">simple_strtol</a>(<a class=\"id\" href=\"#arg\">arg</a>, &amp;<a class=\"id\" href=\"#end\">end</a>, 10);", 
"", 
"<span class=\"ts\"/>return (*<a class=\"id\" href=\"#end\">end</a> == 0) ? 0 : -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"}", 
"<a class=\"id\" href=\"#early_param\">early_param</a>(\"memory_corruption_check\", <a class=\"id\" href=\"#set_corruption_check\">set_corruption_check</a>);", 
"", 
"static <a class=\"id\" href=\"#__init\">__init</a> int <a class=\"id\" href=\"#set_corruption_check_period\">set_corruption_check_period</a>(char *<a class=\"id\" href=\"#arg\">arg</a>)", 
"{", 
"<span class=\"ts\"/>char *<a class=\"id\" href=\"#end\">end</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#corruption_check_period\">corruption_check_period</a> = <a class=\"id\" href=\"#simple_strtoul\">simple_strtoul</a>(<a class=\"id\" href=\"#arg\">arg</a>, &amp;<a class=\"id\" href=\"#end\">end</a>, 10);", 
"", 
"<span class=\"ts\"/>return (*<a class=\"id\" href=\"#end\">end</a> == 0) ? 0 : -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"}", 
"<a class=\"id\" href=\"#early_param\">early_param</a>(\"memory_corruption_check_period\", <a class=\"id\" href=\"#set_corruption_check_period\">set_corruption_check_period</a>);", 
"", 
"static <a class=\"id\" href=\"#__init\">__init</a> int <a class=\"id\" href=\"#set_corruption_check_size\">set_corruption_check_size</a>(char *<a class=\"id\" href=\"#arg\">arg</a>)", 
"{", 
"<span class=\"ts\"/>char *<a class=\"id\" href=\"#end\">end</a>;", 
"<span class=\"ts\"/>unsigned <a class=\"id\" href=\"#size\">size</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#size\">size</a> = <a class=\"id\" href=\"#memparse\">memparse</a>(<a class=\"id\" href=\"#arg\">arg</a>, &amp;<a class=\"id\" href=\"#end\">end</a>);", 
"", 
"<span class=\"ts\"/>if (*<a class=\"id\" href=\"#end\">end</a> == '\\0')", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#corruption_check_size\">corruption_check_size</a> = <a class=\"id\" href=\"#size\">size</a>;", 
"", 
"<span class=\"ts\"/>return (<a class=\"id\" href=\"#size\">size</a> == <a class=\"id\" href=\"#corruption_check_size\">corruption_check_size</a>) ? 0 : -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"}", 
"<a class=\"id\" href=\"#early_param\">early_param</a>(\"memory_corruption_check_size\", <a class=\"id\" href=\"#set_corruption_check_size\">set_corruption_check_size</a>);", 
"", 
"", 
"void <a class=\"id\" href=\"#__init\">__init</a> <a class=\"id\" href=\"#setup_bios_corruption_check\">setup_bios_corruption_check</a>(void)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u64\">u64</a> <a class=\"id\" href=\"#addr\">addr</a> = <a class=\"id\" href=\"#PAGE_SIZE\">PAGE_SIZE</a>;<span class=\"ts\"/><span class=\"comment\">/* assume first page is reserved anyway */</span>", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#memory_corruption_check\">memory_corruption_check</a> == -1) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#memory_corruption_check\">memory_corruption_check</a> =", 
"#<a class=\"id\" href=\"#ifdef\">ifdef</a> <a class=\"id\" href=\"#CONFIG_X86_BOOTPARAM_MEMORY_CORRUPTION_CHECK\">CONFIG_X86_BOOTPARAM_MEMORY_CORRUPTION_CHECK</a>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>1", 
"#else", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>0", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#corruption_check_size\">corruption_check_size</a> == 0)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#memory_corruption_check\">memory_corruption_check</a> = 0;", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#memory_corruption_check\">memory_corruption_check</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#corruption_check_size\">corruption_check_size</a> = <a class=\"id\" href=\"#round_up\">round_up</a>(<a class=\"id\" href=\"#corruption_check_size\">corruption_check_size</a>, <a class=\"id\" href=\"#PAGE_SIZE\">PAGE_SIZE</a>);", 
"", 
"<span class=\"ts\"/>while (<a class=\"id\" href=\"#addr\">addr</a> &lt; <a class=\"id\" href=\"#corruption_check_size\">corruption_check_size</a> && <a class=\"id\" href=\"#num_scan_areas\">num_scan_areas</a> &lt; <a class=\"id\" href=\"#MAX_SCAN_AREAS\">MAX_SCAN_AREAS</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#u64\">u64</a> <a class=\"id\" href=\"#size\">size</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#addr\">addr</a> = <a class=\"id\" href=\"#find_e820_area_size\">find_e820_area_size</a>(<a class=\"id\" href=\"#addr\">addr</a>, &amp;<a class=\"id\" href=\"#size\">size</a>, <a class=\"id\" href=\"#PAGE_SIZE\">PAGE_SIZE</a>);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!(<a class=\"id\" href=\"#addr\">addr</a> + 1))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#addr\">addr</a> >= <a class=\"id\" href=\"#corruption_check_size\">corruption_check_size</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if ((<a class=\"id\" href=\"#addr\">addr</a> + <a class=\"id\" href=\"#size\">size</a>) &gt; <a class=\"id\" href=\"#corruption_check_size\">corruption_check_size</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#size\">size</a> = <a class=\"id\" href=\"#corruption_check_size\">corruption_check_size</a> - <a class=\"id\" href=\"#addr\">addr</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#e820_update_range\">e820_update_range</a>(<a class=\"id\" href=\"#addr\">addr</a>, <a class=\"id\" href=\"#size\">size</a>, <a class=\"id\" href=\"#E820_RAM\">E820_RAM</a>, <a class=\"id\" href=\"#E820_RESERVED\">E820_RESERVED</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#scan_areas\">scan_areas</a>[<a class=\"id\" href=\"#num_scan_areas\">num_scan_areas</a>].<a class=\"id\" href=\"#addr\">addr</a> = <a class=\"id\" href=\"#addr\">addr</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#scan_areas\">scan_areas</a>[<a class=\"id\" href=\"#num_scan_areas\">num_scan_areas</a>].<a class=\"id\" href=\"#size\">size</a> = <a class=\"id\" href=\"#size\">size</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#num_scan_areas\">num_scan_areas</a>++;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Assume we've already mapped this early memory */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#memset\">memset</a>(<a class=\"id\" href=\"#__va\">__va</a>(<a class=\"id\" href=\"#addr\">addr</a>), 0, <a class=\"id\" href=\"#size\">size</a>);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#addr\">addr</a> += <a class=\"id\" href=\"#size\">size</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_INFO\">KERN_INFO</a> \"Scanning %d areas for low memory corruption\\n\",", 
"<span class=\"ts\"/>       <a class=\"id\" href=\"#num_scan_areas\">num_scan_areas</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#update_e820\">update_e820</a>();", 
"}", 
"", 
"", 
"void <a class=\"id\" href=\"#check_for_bios_corruption\">check_for_bios_corruption</a>(void)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#i\">i</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#corruption\">corruption</a> = 0;", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#memory_corruption_check\">memory_corruption_check</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = 0; <a class=\"id\" href=\"#i\">i</a> &lt; <a class=\"id\" href=\"#num_scan_areas\">num_scan_areas</a>; <a class=\"id\" href=\"#i\">i</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/>unsigned long *<a class=\"id\" href=\"#addr\">addr</a> = <a class=\"id\" href=\"#__va\">__va</a>(<a class=\"id\" href=\"#scan_areas\">scan_areas</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#addr\">addr</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#size\">size</a> = <a class=\"id\" href=\"#scan_areas\">scan_areas</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#size\">size</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>for (; <a class=\"id\" href=\"#size\">size</a>; <a class=\"id\" href=\"#addr\">addr</a>++, <a class=\"id\" href=\"#size\">size</a> -= sizeof(unsigned long)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (!*<a class=\"id\" href=\"#addr\">addr</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_ERR\">KERN_ERR</a> \"Corrupted low memory at %p (%lx phys) = %08lx\\n\",", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       <a class=\"id\" href=\"#addr\">addr</a>, <a class=\"id\" href=\"#__pa\">__pa</a>(<a class=\"id\" href=\"#addr\">addr</a>), *<a class=\"id\" href=\"#addr\">addr</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#corruption\">corruption</a> = 1;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>*<a class=\"id\" href=\"#addr\">addr</a> = 0;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#WARN_ONCE\">WARN_ONCE</a>(<a class=\"id\" href=\"#corruption\">corruption</a>, <a class=\"id\" href=\"#KERN_ERR\">KERN_ERR</a> \"Memory corruption detected in low memory\\n\");", 
"}", 
"", 
"static void <a class=\"id\" href=\"#check_corruption\">check_corruption</a>(struct <a class=\"id\" href=\"#work_struct\">work_struct</a> *<a class=\"id\" href=\"#dummy\">dummy</a>);", 
"static <a class=\"id\" href=\"#DECLARE_DELAYED_WORK\">DECLARE_DELAYED_WORK</a>(<a class=\"id\" href=\"#bios_check_work\">bios_check_work</a>, <a class=\"id\" href=\"#check_corruption\">check_corruption</a>);", 
"", 
"static void <a class=\"id\" href=\"#check_corruption\">check_corruption</a>(struct <a class=\"id\" href=\"#work_struct\">work_struct</a> *<a class=\"id\" href=\"#dummy\">dummy</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#check_for_bios_corruption\">check_for_bios_corruption</a>();", 
"<span class=\"ts\"/><a class=\"id\" href=\"#schedule_delayed_work\">schedule_delayed_work</a>(&amp;<a class=\"id\" href=\"#bios_check_work\">bios_check_work</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#round_jiffies_relative\">round_jiffies_relative</a>(<a class=\"id\" href=\"#corruption_check_period\">corruption_check_period</a>*<a class=\"id\" href=\"#HZ\">HZ</a>)); ", 
"}", 
"", 
"static int <a class=\"id\" href=\"#start_periodic_check_for_corruption\">start_periodic_check_for_corruption</a>(void)", 
"{", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#memory_corruption_check\">memory_corruption_check</a> || <a class=\"id\" href=\"#corruption_check_period\">corruption_check_period</a> == 0)", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_INFO\">KERN_INFO</a> \"Scanning for low memory corruption every %d seconds\\n\",", 
"<span class=\"ts\"/>       <a class=\"id\" href=\"#corruption_check_period\">corruption_check_period</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* First time we run the checks right away */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#schedule_delayed_work\">schedule_delayed_work</a>(&amp;<a class=\"id\" href=\"#bios_check_work\">bios_check_work</a>, 0);", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"<a class=\"id\" href=\"#module_init\">module_init</a>(<a class=\"id\" href=\"#start_periodic_check_for_corruption\">start_periodic_check_for_corruption</a>);", 
"", 
];
xr_frag_insert('l/25/e0710f0c4c1b5279162c26534a3323331676fb.xr', __xr_tmp);
