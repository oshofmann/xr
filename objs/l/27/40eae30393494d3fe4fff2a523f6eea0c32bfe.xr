var __xr_tmp = [
"<span class=\"comment\">/* permission.c: key permission determination</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Copyright (C) 2005 Red Hat, Inc. All Rights Reserved.</span>", 
"<span class=\"comment\"> * Written by David Howells (dhowells@redhat.com)</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * This program is free software; you can redistribute it and/or</span>", 
"<span class=\"comment\"> * modify it under the terms of the GNU General Public License</span>", 
"<span class=\"comment\"> * as published by the Free Software Foundation; either version</span>", 
"<span class=\"comment\"> * 2 of the License, or (at your option) any later version.</span>", 
"<span class=\"comment\"> */</span>", 
"", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#module\">module</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#security\">security</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> \"internal.h\"", 
"", 
"<span class=\"comment\">/*****************************************************************************/</span>", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * key_task_permission - Check a key can be used</span>", 
"<span class=\"comment\"> * @key_ref: The key to check</span>", 
"<span class=\"comment\"> * @cred: The credentials to use</span>", 
"<span class=\"comment\"> * @perm: The permissions to check for</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Check to see whether permission is granted to use a key in the desired way,</span>", 
"<span class=\"comment\"> * but permit the security modules to override.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * The caller must hold either a ref on cred or must hold the RCU readlock or a</span>", 
"<span class=\"comment\"> * spinlock.</span>", 
"<span class=\"comment\"> */</span>", 
"int <a class=\"id\" href=\"#key_task_permission\">key_task_permission</a>(const <a class=\"id\" href=\"#key_ref_t\">key_ref_t</a> <a class=\"id\" href=\"#key_ref\">key_ref</a>, const struct <a class=\"id\" href=\"#cred\">cred</a> *<a class=\"id\" href=\"#cred\">cred</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#key_perm_t\">key_perm_t</a> <a class=\"id\" href=\"#perm\">perm</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#key\">key</a> *<a class=\"id\" href=\"#key\">key</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#key_perm_t\">key_perm_t</a> <a class=\"id\" href=\"#kperm\">kperm</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#ret\">ret</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#key\">key</a> = <a class=\"id\" href=\"#key_ref_to_ptr\">key_ref_to_ptr</a>(<a class=\"id\" href=\"#key_ref\">key_ref</a>);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#key\">key</a>-><a class=\"id\" href=\"#user\">user</a>-><a class=\"id\" href=\"#user_ns\">user_ns</a> != <a class=\"id\" href=\"#cred\">cred</a>-><a class=\"id\" href=\"#user\">user</a>-><a class=\"id\" href=\"#user_ns\">user_ns</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#use_other_perms\">use_other_perms</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* use the second 8-bits of permissions for keys the caller owns */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#key\">key</a>-><a class=\"id\" href=\"#uid\">uid</a> == <a class=\"id\" href=\"#cred\">cred</a>-><a class=\"id\" href=\"#fsuid\">fsuid</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#kperm\">kperm</a> = <a class=\"id\" href=\"#key\">key</a>-><a class=\"id\" href=\"#perm\">perm</a> >> 16;", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#use_these_perms\">use_these_perms</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* use the third 8-bits of permissions for keys the caller has a group</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * membership in common with */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#key\">key</a>-><a class=\"id\" href=\"#gid\">gid</a> != -1 && <a class=\"id\" href=\"#key\">key</a>-><a class=\"id\" href=\"#perm\">perm</a> &amp; <a class=\"id\" href=\"#KEY_GRP_ALL\">KEY_GRP_ALL</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#key\">key</a>-><a class=\"id\" href=\"#gid\">gid</a> == <a class=\"id\" href=\"#cred\">cred</a>-><a class=\"id\" href=\"#fsgid\">fsgid</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#kperm\">kperm</a> = <a class=\"id\" href=\"#key\">key</a>-><a class=\"id\" href=\"#perm\">perm</a> >> 8;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#use_these_perms\">use_these_perms</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#groups_search\">groups_search</a>(<a class=\"id\" href=\"#cred\">cred</a>-><a class=\"id\" href=\"#group_info\">group_info</a>, <a class=\"id\" href=\"#key\">key</a>-><a class=\"id\" href=\"#gid\">gid</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#ret\">ret</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#kperm\">kperm</a> = <a class=\"id\" href=\"#key\">key</a>-><a class=\"id\" href=\"#perm\">perm</a> >> 8;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#use_these_perms\">use_these_perms</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"", 
"<a class=\"id\" href=\"#use_other_perms\">use_other_perms</a>:", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* otherwise use the least-significant 8-bits */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kperm\">kperm</a> = <a class=\"id\" href=\"#key\">key</a>-><a class=\"id\" href=\"#perm\">perm</a>;", 
"", 
"<a class=\"id\" href=\"#use_these_perms\">use_these_perms</a>:", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* use the top 8-bits of permissions for keys the caller possesses</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * - possessor permissions are additive with other permissions</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#is_key_possessed\">is_key_possessed</a>(<a class=\"id\" href=\"#key_ref\">key_ref</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#kperm\">kperm</a> |= <a class=\"id\" href=\"#key\">key</a>-><a class=\"id\" href=\"#perm\">perm</a> >> 24;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kperm\">kperm</a> = <a class=\"id\" href=\"#kperm\">kperm</a> &amp; <a class=\"id\" href=\"#perm\">perm</a> &amp; <a class=\"id\" href=\"#KEY_ALL\">KEY_ALL</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#kperm\">kperm</a> != <a class=\"id\" href=\"#perm\">perm</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EACCES\">EACCES</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* let LSM be the final arbiter */</span>", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#security_key_permission\">security_key_permission</a>(<a class=\"id\" href=\"#key_ref\">key_ref</a>, <a class=\"id\" href=\"#cred\">cred</a>, <a class=\"id\" href=\"#perm\">perm</a>);", 
"", 
"} <span class=\"comment\">/* end key_task_permission() */</span>", 
"", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL\">EXPORT_SYMBOL</a>(<a class=\"id\" href=\"#key_task_permission\">key_task_permission</a>);", 
"", 
"<span class=\"comment\">/*****************************************************************************/</span>", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * validate a key</span>", 
"<span class=\"comment\"> */</span>", 
"int <a class=\"id\" href=\"#key_validate\">key_validate</a>(struct <a class=\"id\" href=\"#key\">key</a> *<a class=\"id\" href=\"#key\">key</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#timespec\">timespec</a> <a class=\"id\" href=\"#now\">now</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#ret\">ret</a> = 0;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#key\">key</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* check it's still accessible */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = -<a class=\"id\" href=\"#EKEYREVOKED\">EKEYREVOKED</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#test_bit\">test_bit</a>(<a class=\"id\" href=\"#KEY_FLAG_REVOKED\">KEY_FLAG_REVOKED</a>, &amp;<a class=\"id\" href=\"#key\">key</a>-><a class=\"id\" href=\"#flags\">flags</a>) ||", 
"<span class=\"ts\"/><span class=\"ts\"/>    <a class=\"id\" href=\"#test_bit\">test_bit</a>(<a class=\"id\" href=\"#KEY_FLAG_DEAD\">KEY_FLAG_DEAD</a>, &amp;<a class=\"id\" href=\"#key\">key</a>-><a class=\"id\" href=\"#flags\">flags</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#error\">error</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* check it hasn't expired */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = 0;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#key\">key</a>-><a class=\"id\" href=\"#expiry\">expiry</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#now\">now</a> = <a class=\"id\" href=\"#current_kernel_time\">current_kernel_time</a>();", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#now\">now</a>.<a class=\"id\" href=\"#tv_sec\">tv_sec</a> >= <a class=\"id\" href=\"#key\">key</a>-><a class=\"id\" href=\"#expiry\">expiry</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = -<a class=\"id\" href=\"#EKEYEXPIRED\">EKEYEXPIRED</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"", 
"<a class=\"id\" href=\"#error\">error</a>:", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ret\">ret</a>;", 
"", 
"} <span class=\"comment\">/* end key_validate() */</span>", 
"", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL\">EXPORT_SYMBOL</a>(<a class=\"id\" href=\"#key_validate\">key_validate</a>);", 
];
xr_frag_insert('l/27/40eae30393494d3fe4fff2a523f6eea0c32bfe.xr', __xr_tmp);
