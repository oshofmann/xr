var __xr_tmp = [
"<span class=\"comment\"> * @doi_def: the DOI definition</span>", 
"<span class=\"comment\"> * @secattr: the security attributes</span>", 
"<span class=\"comment\"> * @buffer: the option buffer</span>", 
"<span class=\"comment\"> * @buffer_len: length of buffer in bytes</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Description:</span>", 
"<span class=\"comment\"> * Generate a CIPSO option using the local tag.  Returns the size of the tag</span>", 
"<span class=\"comment\"> * on success, negative values on failure.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> */</span>", 
"static int <a class=\"id\" href=\"#cipso_v4_gentag_loc\">cipso_v4_gentag_loc</a>(const struct <a class=\"id\" href=\"#cipso_v4_doi\">cipso_v4_doi</a> *<a class=\"id\" href=\"#doi_def\">doi_def</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       const struct <a class=\"id\" href=\"#netlbl_lsm_secattr\">netlbl_lsm_secattr</a> *<a class=\"id\" href=\"#secattr\">secattr</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       unsigned char *<a class=\"id\" href=\"#buffer\">buffer</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       <a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#buffer_len\">buffer_len</a>)", 
"{", 
"<span class=\"ts\"/>if (!(<a class=\"id\" href=\"#secattr\">secattr</a>-><a class=\"id\" href=\"#flags\">flags</a> &amp; <a class=\"id\" href=\"#NETLBL_SECATTR_SECID\">NETLBL_SECATTR_SECID</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EPERM\">EPERM</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#buffer\">buffer</a>[0] = <a class=\"id\" href=\"#CIPSO_V4_TAG_LOCAL\">CIPSO_V4_TAG_LOCAL</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#buffer\">buffer</a>[1] = <a class=\"id\" href=\"#CIPSO_V4_TAG_LOC_BLEN\">CIPSO_V4_TAG_LOC_BLEN</a>;", 
"<span class=\"ts\"/>*(<a class=\"id\" href=\"#u32\">u32</a> *)&amp;<a class=\"id\" href=\"#buffer\">buffer</a>[2] = <a class=\"id\" href=\"#secattr\">secattr</a>-><a class=\"id\" href=\"#attr\">attr</a>.<a class=\"id\" href=\"#secid\">secid</a>;", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#CIPSO_V4_TAG_LOC_BLEN\">CIPSO_V4_TAG_LOC_BLEN</a>;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * cipso_v4_parsetag_loc - Parse a CIPSO local tag</span>", 
"<span class=\"comment\"> * @doi_def: the DOI definition</span>", 
"<span class=\"comment\"> * @tag: the CIPSO tag</span>", 
"<span class=\"comment\"> * @secattr: the security attributes</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Description:</span>", 
"<span class=\"comment\"> * Parse a CIPSO local tag and return the security attributes in @secattr.</span>", 
"<span class=\"comment\"> * Return zero on success, negatives values on failure.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> */</span>", 
"static int <a class=\"id\" href=\"#cipso_v4_parsetag_loc\">cipso_v4_parsetag_loc</a>(const struct <a class=\"id\" href=\"#cipso_v4_doi\">cipso_v4_doi</a> *<a class=\"id\" href=\"#doi_def\">doi_def</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> const unsigned char *<a class=\"id\" href=\"#tag\">tag</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> struct <a class=\"id\" href=\"#netlbl_lsm_secattr\">netlbl_lsm_secattr</a> *<a class=\"id\" href=\"#secattr\">secattr</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#secattr\">secattr</a>-><a class=\"id\" href=\"#attr\">attr</a>.<a class=\"id\" href=\"#secid\">secid</a> = *(<a class=\"id\" href=\"#u32\">u32</a> *)&amp;<a class=\"id\" href=\"#tag\">tag</a>[2];", 
"<span class=\"ts\"/><a class=\"id\" href=\"#secattr\">secattr</a>-><a class=\"id\" href=\"#flags\">flags</a> |= <a class=\"id\" href=\"#NETLBL_SECATTR_SECID\">NETLBL_SECATTR_SECID</a>;", 
"", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * cipso_v4_validate - Validate a CIPSO option</span>", 
"<span class=\"comment\"> * @option: the start of the option, on error it is set to point to the error</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Description:</span>", 
"<span class=\"comment\"> * This routine is called to validate a CIPSO option, it checks all of the</span>", 
"<span class=\"comment\"> * fields to ensure that they are at least valid, see the draft snippet below</span>", 
"<span class=\"comment\"> * for details.  If the option is valid then a zero value is returned and</span>", 
"<span class=\"comment\"> * the value of @option is unchanged.  If the option is invalid then a</span>", 
"<span class=\"comment\"> * non-zero value is returned and @option is adjusted to point to the</span>", 
"<span class=\"comment\"> * offending portion of the option.  From the IETF draft ...</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> *  \"If any field within the CIPSO options, such as the DOI identifier, is not</span>", 
"<span class=\"comment\"> *   recognized the IP datagram is discarded and an ICMP 'parameter problem'</span>", 
"<span class=\"comment\"> *   (type 12) is generated and returned.  The ICMP code field is set to 'bad</span>", 
"<span class=\"comment\"> *   parameter' (code 0) and the pointer is set to the start of the CIPSO field</span>", 
"<span class=\"comment\"> *   that is unrecognized.\"</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> */</span>", 
"int <a class=\"id\" href=\"#cipso_v4_validate\">cipso_v4_validate</a>(const struct <a class=\"id\" href=\"#sk_buff\">sk_buff</a> *<a class=\"id\" href=\"#skb\">skb</a>, unsigned char **<a class=\"id\" href=\"#option\">option</a>)", 
"{", 
"<span class=\"ts\"/>unsigned char *<a class=\"id\" href=\"#opt\">opt</a> = *<a class=\"id\" href=\"#option\">option</a>;", 
"<span class=\"ts\"/>unsigned char *<a class=\"id\" href=\"#tag\">tag</a>;", 
"<span class=\"ts\"/>unsigned char <a class=\"id\" href=\"#opt_iter\">opt_iter</a>;", 
"<span class=\"ts\"/>unsigned char <a class=\"id\" href=\"#err_offset\">err_offset</a> = 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u8\">u8</a> <a class=\"id\" href=\"#opt_len\">opt_len</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u8\">u8</a> <a class=\"id\" href=\"#tag_len\">tag_len</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#cipso_v4_doi\">cipso_v4_doi</a> *<a class=\"id\" href=\"#doi_def\">doi_def</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#tag_iter\">tag_iter</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* caller already checks for length values that are too large */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#opt_len\">opt_len</a> = <a class=\"id\" href=\"#opt\">opt</a>[1];", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#opt_len\">opt_len</a> &lt; 8) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err_offset\">err_offset</a> = 1;", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#validate_return\">validate_return</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rcu_read_lock\">rcu_read_lock</a>();", 
"<span class=\"ts\"/><a class=\"id\" href=\"#doi_def\">doi_def</a> = <a class=\"id\" href=\"#cipso_v4_doi_search\">cipso_v4_doi_search</a>(<a class=\"id\" href=\"#get_unaligned_be32\">get_unaligned_be32</a>(&amp;<a class=\"id\" href=\"#opt\">opt</a>[2]));", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#doi_def\">doi_def</a> == <a class=\"id\" href=\"#NULL\">NULL</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err_offset\">err_offset</a> = 2;", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#validate_return_locked\">validate_return_locked</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#opt_iter\">opt_iter</a> = <a class=\"id\" href=\"#CIPSO_V4_HDR_LEN\">CIPSO_V4_HDR_LEN</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tag\">tag</a> = <a class=\"id\" href=\"#opt\">opt</a> + <a class=\"id\" href=\"#opt_iter\">opt_iter</a>;", 
"<span class=\"ts\"/>while (<a class=\"id\" href=\"#opt_iter\">opt_iter</a> &lt; <a class=\"id\" href=\"#opt_len\">opt_len</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>for (<a class=\"id\" href=\"#tag_iter\">tag_iter</a> = 0; <a class=\"id\" href=\"#doi_def\">doi_def</a>-><a class=\"id\" href=\"#tags\">tags</a>[<a class=\"id\" href=\"#tag_iter\">tag_iter</a>] != <a class=\"id\" href=\"#tag\">tag</a>[0];)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#doi_def\">doi_def</a>-><a class=\"id\" href=\"#tags\">tags</a>[<a class=\"id\" href=\"#tag_iter\">tag_iter</a>] == <a class=\"id\" href=\"#CIPSO_V4_TAG_INVALID\">CIPSO_V4_TAG_INVALID</a> ||", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>    ++<a class=\"id\" href=\"#tag_iter\">tag_iter</a> == <a class=\"id\" href=\"#CIPSO_V4_TAG_MAXCNT\">CIPSO_V4_TAG_MAXCNT</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err_offset\">err_offset</a> = <a class=\"id\" href=\"#opt_iter\">opt_iter</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#validate_return_locked\">validate_return_locked</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tag_len\">tag_len</a> = <a class=\"id\" href=\"#tag\">tag</a>[1];", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#tag_len\">tag_len</a> &gt; (<a class=\"id\" href=\"#opt_len\">opt_len</a> - <a class=\"id\" href=\"#opt_iter\">opt_iter</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err_offset\">err_offset</a> = <a class=\"id\" href=\"#opt_iter\">opt_iter</a> + 1;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#validate_return_locked\">validate_return_locked</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>switch (<a class=\"id\" href=\"#tag\">tag</a>[0]) {", 
"<span class=\"ts\"/><span class=\"ts\"/>case <a class=\"id\" href=\"#CIPSO_V4_TAG_RBITMAP\">CIPSO_V4_TAG_RBITMAP</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#tag_len\">tag_len</a> &lt; <a class=\"id\" href=\"#CIPSO_V4_TAG_RBM_BLEN\">CIPSO_V4_TAG_RBM_BLEN</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err_offset\">err_offset</a> = <a class=\"id\" href=\"#opt_iter\">opt_iter</a> + 1;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#validate_return_locked\">validate_return_locked</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* We are already going to do all the verification</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> * necessary at the socket layer so from our point of</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> * view it is safe to turn these checks off (and less</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> * work), however, the CIPSO draft says we should do</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> * all the CIPSO validations here but it doesn't</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> * really specify _exactly_ what we need to validate</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> * ... so, just make it a sysctl tunable. */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#cipso_v4_rbm_strictvalid\">cipso_v4_rbm_strictvalid</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#cipso_v4_map_lvl_valid\">cipso_v4_map_lvl_valid</a>(<a class=\"id\" href=\"#doi_def\">doi_def</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>   <a class=\"id\" href=\"#tag\">tag</a>[3]) &lt; 0) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err_offset\">err_offset</a> = <a class=\"id\" href=\"#opt_iter\">opt_iter</a> + 3;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#validate_return_locked\">validate_return_locked</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#tag_len\">tag_len</a> &gt; <a class=\"id\" href=\"#CIPSO_V4_TAG_RBM_BLEN\">CIPSO_V4_TAG_RBM_BLEN</a> &&", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>    <a class=\"id\" href=\"#cipso_v4_map_cat_rbm_valid\">cipso_v4_map_cat_rbm_valid</a>(<a class=\"id\" href=\"#doi_def\">doi_def</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>    &amp;<a class=\"id\" href=\"#tag\">tag</a>[4],", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>    <a class=\"id\" href=\"#tag_len\">tag_len</a> - 4) &lt; 0) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err_offset\">err_offset</a> = <a class=\"id\" href=\"#opt_iter\">opt_iter</a> + 4;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#validate_return_locked\">validate_return_locked</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>case <a class=\"id\" href=\"#CIPSO_V4_TAG_ENUM\">CIPSO_V4_TAG_ENUM</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#tag_len\">tag_len</a> &lt; <a class=\"id\" href=\"#CIPSO_V4_TAG_ENUM_BLEN\">CIPSO_V4_TAG_ENUM_BLEN</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err_offset\">err_offset</a> = <a class=\"id\" href=\"#opt_iter\">opt_iter</a> + 1;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#validate_return_locked\">validate_return_locked</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#cipso_v4_map_lvl_valid\">cipso_v4_map_lvl_valid</a>(<a class=\"id\" href=\"#doi_def\">doi_def</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>   <a class=\"id\" href=\"#tag\">tag</a>[3]) &lt; 0) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err_offset\">err_offset</a> = <a class=\"id\" href=\"#opt_iter\">opt_iter</a> + 3;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#validate_return_locked\">validate_return_locked</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#tag_len\">tag_len</a> &gt; <a class=\"id\" href=\"#CIPSO_V4_TAG_ENUM_BLEN\">CIPSO_V4_TAG_ENUM_BLEN</a> &&", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>    <a class=\"id\" href=\"#cipso_v4_map_cat_enum_valid\">cipso_v4_map_cat_enum_valid</a>(<a class=\"id\" href=\"#doi_def\">doi_def</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>&amp;<a class=\"id\" href=\"#tag\">tag</a>[4],", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tag_len\">tag_len</a> - 4) &lt; 0) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err_offset\">err_offset</a> = <a class=\"id\" href=\"#opt_iter\">opt_iter</a> + 4;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#validate_return_locked\">validate_return_locked</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>case <a class=\"id\" href=\"#CIPSO_V4_TAG_RANGE\">CIPSO_V4_TAG_RANGE</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#tag_len\">tag_len</a> &lt; <a class=\"id\" href=\"#CIPSO_V4_TAG_RNG_BLEN\">CIPSO_V4_TAG_RNG_BLEN</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err_offset\">err_offset</a> = <a class=\"id\" href=\"#opt_iter\">opt_iter</a> + 1;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#validate_return_locked\">validate_return_locked</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#cipso_v4_map_lvl_valid\">cipso_v4_map_lvl_valid</a>(<a class=\"id\" href=\"#doi_def\">doi_def</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>   <a class=\"id\" href=\"#tag\">tag</a>[3]) &lt; 0) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err_offset\">err_offset</a> = <a class=\"id\" href=\"#opt_iter\">opt_iter</a> + 3;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#validate_return_locked\">validate_return_locked</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#tag_len\">tag_len</a> &gt; <a class=\"id\" href=\"#CIPSO_V4_TAG_RNG_BLEN\">CIPSO_V4_TAG_RNG_BLEN</a> &&", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>    <a class=\"id\" href=\"#cipso_v4_map_cat_rng_valid\">cipso_v4_map_cat_rng_valid</a>(<a class=\"id\" href=\"#doi_def\">doi_def</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       &amp;<a class=\"id\" href=\"#tag\">tag</a>[4],", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       <a class=\"id\" href=\"#tag_len\">tag_len</a> - 4) &lt; 0) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err_offset\">err_offset</a> = <a class=\"id\" href=\"#opt_iter\">opt_iter</a> + 4;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#validate_return_locked\">validate_return_locked</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>case <a class=\"id\" href=\"#CIPSO_V4_TAG_LOCAL\">CIPSO_V4_TAG_LOCAL</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* This is a non-standard tag that we only allow for</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> * local connections, so if the incoming interface is</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> * not the loopback device drop the packet. */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (!(<a class=\"id\" href=\"#skb\">skb</a>-><a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#flags\">flags</a> &amp; <a class=\"id\" href=\"#IFF_LOOPBACK\">IFF_LOOPBACK</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err_offset\">err_offset</a> = <a class=\"id\" href=\"#opt_iter\">opt_iter</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#validate_return_locked\">validate_return_locked</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#tag_len\">tag_len</a> != <a class=\"id\" href=\"#CIPSO_V4_TAG_LOC_BLEN\">CIPSO_V4_TAG_LOC_BLEN</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err_offset\">err_offset</a> = <a class=\"id\" href=\"#opt_iter\">opt_iter</a> + 1;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#validate_return_locked\">validate_return_locked</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>default:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err_offset\">err_offset</a> = <a class=\"id\" href=\"#opt_iter\">opt_iter</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#validate_return_locked\">validate_return_locked</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tag\">tag</a> += <a class=\"id\" href=\"#tag_len\">tag_len</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#opt_iter\">opt_iter</a> += <a class=\"id\" href=\"#tag_len\">tag_len</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<a class=\"id\" href=\"#validate_return_locked\">validate_return_locked</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rcu_read_unlock\">rcu_read_unlock</a>();", 
"<a class=\"id\" href=\"#validate_return\">validate_return</a>:", 
"<span class=\"ts\"/>*<a class=\"id\" href=\"#option\">option</a> = <a class=\"id\" href=\"#opt\">opt</a> + <a class=\"id\" href=\"#err_offset\">err_offset</a>;", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#err_offset\">err_offset</a>;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * cipso_v4_error - Send the correct reponse for a bad packet</span>", 
"<span class=\"comment\"> * @skb: the packet</span>", 
"<span class=\"comment\"> * @error: the error code</span>", 
"<span class=\"comment\"> * @gateway: CIPSO gateway flag</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Description:</span>", 
"<span class=\"comment\"> * Based on the error code given in @error, send an ICMP error message back to</span>", 
"<span class=\"comment\"> * the originating host.  From the IETF draft ...</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> *  \"If the contents of the CIPSO [option] are valid but the security label is</span>", 
"<span class=\"comment\"> *   outside of the configured host or port label range, the datagram is</span>", 
"<span class=\"comment\"> *   discarded and an ICMP 'destination unreachable' (type 3) is generated and</span>", 
"<span class=\"comment\"> *   returned.  The code field of the ICMP is set to 'communication with</span>", 
"<span class=\"comment\"> *   destination network administratively prohibited' (code 9) or to</span>", 
"<span class=\"comment\"> *   'communication with destination host administratively prohibited'</span>", 
"<span class=\"comment\"> *   (code 10).  The value of the code is dependent on whether the originator</span>", 
"<span class=\"comment\"> *   of the ICMP message is acting as a CIPSO host or a CIPSO gateway.  The</span>", 
"<span class=\"comment\"> *   recipient of the ICMP message MUST be able to handle either value.  The</span>", 
"<span class=\"comment\"> *   same procedure is performed if a CIPSO [option] can not be added to an</span>", 
"<span class=\"comment\"> *   IP packet because it is too large to fit in the IP options area.\"</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> *  \"If the error is triggered by receipt of an ICMP message, the message is</span>", 
"<span class=\"comment\"> *   discarded and no response is permitted (consistent with general ICMP</span>", 
"<span class=\"comment\"> *   processing rules).\"</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> */</span>", 
"void <a class=\"id\" href=\"#cipso_v4_error\">cipso_v4_error</a>(struct <a class=\"id\" href=\"#sk_buff\">sk_buff</a> *<a class=\"id\" href=\"#skb\">skb</a>, int <a class=\"id\" href=\"#error\">error</a>, <a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#gateway\">gateway</a>)", 
"{", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#ip_hdr\">ip_hdr</a>(<a class=\"id\" href=\"#skb\">skb</a>)-><a class=\"id\" href=\"#protocol\">protocol</a> == <a class=\"id\" href=\"#IPPROTO_ICMP\">IPPROTO_ICMP</a> || <a class=\"id\" href=\"#error\">error</a> != -<a class=\"id\" href=\"#EACCES\">EACCES</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#gateway\">gateway</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#icmp_send\">icmp_send</a>(<a class=\"id\" href=\"#skb\">skb</a>, <a class=\"id\" href=\"#ICMP_DEST_UNREACH\">ICMP_DEST_UNREACH</a>, <a class=\"id\" href=\"#ICMP_NET_ANO\">ICMP_NET_ANO</a>, 0);", 
"<span class=\"ts\"/>else", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#icmp_send\">icmp_send</a>(<a class=\"id\" href=\"#skb\">skb</a>, <a class=\"id\" href=\"#ICMP_DEST_UNREACH\">ICMP_DEST_UNREACH</a>, <a class=\"id\" href=\"#ICMP_HOST_ANO\">ICMP_HOST_ANO</a>, 0);", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * cipso_v4_genopt - Generate a CIPSO option</span>", 
"<span class=\"comment\"> * @buf: the option buffer</span>", 
"<span class=\"comment\"> * @buf_len: the size of opt_buf</span>", 
"<span class=\"comment\"> * @doi_def: the CIPSO DOI to use</span>", 
"<span class=\"comment\"> * @secattr: the security attributes</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Description:</span>", 
"<span class=\"comment\"> * Generate a CIPSO option using the DOI definition and security attributes</span>", 
"<span class=\"comment\"> * passed to the function.  Returns the length of the option on success and</span>", 
"<span class=\"comment\"> * negative values on failure.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> */</span>", 
"static int <a class=\"id\" href=\"#cipso_v4_genopt\">cipso_v4_genopt</a>(unsigned char *<a class=\"id\" href=\"#buf\">buf</a>, <a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#buf_len\">buf_len</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>   const struct <a class=\"id\" href=\"#cipso_v4_doi\">cipso_v4_doi</a> *<a class=\"id\" href=\"#doi_def\">doi_def</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>   const struct <a class=\"id\" href=\"#netlbl_lsm_secattr\">netlbl_lsm_secattr</a> *<a class=\"id\" href=\"#secattr\">secattr</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#ret_val\">ret_val</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#iter\">iter</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#buf_len\">buf_len</a> <= <a class=\"id\" href=\"#CIPSO_V4_HDR_LEN\">CIPSO_V4_HDR_LEN</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOSPC\">ENOSPC</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* XXX - This code assumes only one tag per CIPSO option which isn't</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * really a good assumption to make but since we only support the MAC</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * tags right now it is a safe assumption. */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#iter\">iter</a> = 0;", 
"<span class=\"ts\"/>do {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#memset\">memset</a>(<a class=\"id\" href=\"#buf\">buf</a>, 0, <a class=\"id\" href=\"#buf_len\">buf_len</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>switch (<a class=\"id\" href=\"#doi_def\">doi_def</a>-><a class=\"id\" href=\"#tags\">tags</a>[<a class=\"id\" href=\"#iter\">iter</a>]) {", 
"<span class=\"ts\"/><span class=\"ts\"/>case <a class=\"id\" href=\"#CIPSO_V4_TAG_RBITMAP\">CIPSO_V4_TAG_RBITMAP</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret_val\">ret_val</a> = <a class=\"id\" href=\"#cipso_v4_gentag_rbm\">cipso_v4_gentag_rbm</a>(<a class=\"id\" href=\"#doi_def\">doi_def</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>   <a class=\"id\" href=\"#secattr\">secattr</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>   &amp;<a class=\"id\" href=\"#buf\">buf</a>[<a class=\"id\" href=\"#CIPSO_V4_HDR_LEN\">CIPSO_V4_HDR_LEN</a>],", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>   <a class=\"id\" href=\"#buf_len\">buf_len</a> - <a class=\"id\" href=\"#CIPSO_V4_HDR_LEN\">CIPSO_V4_HDR_LEN</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>case <a class=\"id\" href=\"#CIPSO_V4_TAG_ENUM\">CIPSO_V4_TAG_ENUM</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret_val\">ret_val</a> = <a class=\"id\" href=\"#cipso_v4_gentag_enum\">cipso_v4_gentag_enum</a>(<a class=\"id\" href=\"#doi_def\">doi_def</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>   <a class=\"id\" href=\"#secattr\">secattr</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>   &amp;<a class=\"id\" href=\"#buf\">buf</a>[<a class=\"id\" href=\"#CIPSO_V4_HDR_LEN\">CIPSO_V4_HDR_LEN</a>],", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>   <a class=\"id\" href=\"#buf_len\">buf_len</a> - <a class=\"id\" href=\"#CIPSO_V4_HDR_LEN\">CIPSO_V4_HDR_LEN</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>case <a class=\"id\" href=\"#CIPSO_V4_TAG_RANGE\">CIPSO_V4_TAG_RANGE</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret_val\">ret_val</a> = <a class=\"id\" href=\"#cipso_v4_gentag_rng\">cipso_v4_gentag_rng</a>(<a class=\"id\" href=\"#doi_def\">doi_def</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>   <a class=\"id\" href=\"#secattr\">secattr</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>   &amp;<a class=\"id\" href=\"#buf\">buf</a>[<a class=\"id\" href=\"#CIPSO_V4_HDR_LEN\">CIPSO_V4_HDR_LEN</a>],", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>   <a class=\"id\" href=\"#buf_len\">buf_len</a> - <a class=\"id\" href=\"#CIPSO_V4_HDR_LEN\">CIPSO_V4_HDR_LEN</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>case <a class=\"id\" href=\"#CIPSO_V4_TAG_LOCAL\">CIPSO_V4_TAG_LOCAL</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret_val\">ret_val</a> = <a class=\"id\" href=\"#cipso_v4_gentag_loc\">cipso_v4_gentag_loc</a>(<a class=\"id\" href=\"#doi_def\">doi_def</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>   <a class=\"id\" href=\"#secattr\">secattr</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>   &amp;<a class=\"id\" href=\"#buf\">buf</a>[<a class=\"id\" href=\"#CIPSO_V4_HDR_LEN\">CIPSO_V4_HDR_LEN</a>],", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>   <a class=\"id\" href=\"#buf_len\">buf_len</a> - <a class=\"id\" href=\"#CIPSO_V4_HDR_LEN\">CIPSO_V4_HDR_LEN</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>default:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EPERM\">EPERM</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#iter\">iter</a>++;", 
"<span class=\"ts\"/>} while (<a class=\"id\" href=\"#ret_val\">ret_val</a> &lt; 0 &&", 
"<span class=\"ts\"/><span class=\"ts\"/> <a class=\"id\" href=\"#iter\">iter</a> &lt; <a class=\"id\" href=\"#CIPSO_V4_TAG_MAXCNT\">CIPSO_V4_TAG_MAXCNT</a> &&", 
"<span class=\"ts\"/><span class=\"ts\"/> <a class=\"id\" href=\"#doi_def\">doi_def</a>-><a class=\"id\" href=\"#tags\">tags</a>[<a class=\"id\" href=\"#iter\">iter</a>] != <a class=\"id\" href=\"#CIPSO_V4_TAG_INVALID\">CIPSO_V4_TAG_INVALID</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#ret_val\">ret_val</a> &lt; 0)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#ret_val\">ret_val</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#cipso_v4_gentag_hdr\">cipso_v4_gentag_hdr</a>(<a class=\"id\" href=\"#doi_def\">doi_def</a>, <a class=\"id\" href=\"#buf\">buf</a>, <a class=\"id\" href=\"#ret_val\">ret_val</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#CIPSO_V4_HDR_LEN\">CIPSO_V4_HDR_LEN</a> + <a class=\"id\" href=\"#ret_val\">ret_val</a>;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * cipso_v4_sock_setattr - Add a CIPSO option to a socket</span>", 
"<span class=\"comment\"> * @sk: the socket</span>", 
"<span class=\"comment\"> * @doi_def: the CIPSO DOI to use</span>", 
"<span class=\"comment\"> * @secattr: the specific security attributes of the socket</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Description:</span>", 
"<span class=\"comment\"> * Set the CIPSO option on the given socket using the DOI definition and</span>", 
"<span class=\"comment\"> * security attributes passed to the function.  This function requires</span>", 
"<span class=\"comment\"> * exclusive access to @sk, which means it either needs to be in the</span>", 
"<span class=\"comment\"> * process of being created or locked.  Returns zero on success and negative</span>", 
"<span class=\"comment\"> * values on failure.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> */</span>", 
"int <a class=\"id\" href=\"#cipso_v4_sock_setattr\">cipso_v4_sock_setattr</a>(struct <a class=\"id\" href=\"#sock\">sock</a> *<a class=\"id\" href=\"#sk\">sk</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>  const struct <a class=\"id\" href=\"#cipso_v4_doi\">cipso_v4_doi</a> *<a class=\"id\" href=\"#doi_def\">doi_def</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>  const struct <a class=\"id\" href=\"#netlbl_lsm_secattr\">netlbl_lsm_secattr</a> *<a class=\"id\" href=\"#secattr\">secattr</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#ret_val\">ret_val</a> = -<a class=\"id\" href=\"#EPERM\">EPERM</a>;", 
"<span class=\"ts\"/>unsigned char *<a class=\"id\" href=\"#buf\">buf</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#buf_len\">buf_len</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#opt_len\">opt_len</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ip_options\">ip_options</a> *<a class=\"id\" href=\"#opt\">opt</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#inet_sock\">inet_sock</a> *<a class=\"id\" href=\"#sk_inet\">sk_inet</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#inet_connection_sock\">inet_connection_sock</a> *<a class=\"id\" href=\"#sk_conn\">sk_conn</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* In the case of sock_create_lite(), the sock-&gt;sk field is not</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * defined yet but it is not a problem as the only users of these</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * \"lite\" PF_INET sockets are functions which do an accept() call</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * afterwards so we will label the socket as part of the accept(). */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#sk\">sk</a> == <a class=\"id\" href=\"#NULL\">NULL</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* We allocate the maximum CIPSO option size here so we are probably</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * being a little wasteful, but it makes our life _much_ easier later</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * on and after all we are only talking about 40 bytes. */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#buf_len\">buf_len</a> = <a class=\"id\" href=\"#CIPSO_V4_OPT_LEN_MAX\">CIPSO_V4_OPT_LEN_MAX</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#buf\">buf</a> = <a class=\"id\" href=\"#kmalloc\">kmalloc</a>(<a class=\"id\" href=\"#buf_len\">buf_len</a>, <a class=\"id\" href=\"#GFP_ATOMIC\">GFP_ATOMIC</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#buf\">buf</a> == <a class=\"id\" href=\"#NULL\">NULL</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret_val\">ret_val</a> = -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#socket_setattr_failure\">socket_setattr_failure</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ret_val\">ret_val</a> = <a class=\"id\" href=\"#cipso_v4_genopt\">cipso_v4_genopt</a>(<a class=\"id\" href=\"#buf\">buf</a>, <a class=\"id\" href=\"#buf_len\">buf_len</a>, <a class=\"id\" href=\"#doi_def\">doi_def</a>, <a class=\"id\" href=\"#secattr\">secattr</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#ret_val\">ret_val</a> &lt; 0)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#socket_setattr_failure\">socket_setattr_failure</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#buf_len\">buf_len</a> = <a class=\"id\" href=\"#ret_val\">ret_val</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* We can't use ip_options_get() directly because it makes a call to</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * ip_options_get_alloc() which allocates memory with GFP_KERNEL and</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * we won't always have CAP_NET_RAW even though we _always_ want to</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * set the IPOPT_CIPSO option. */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#opt_len\">opt_len</a> = (<a class=\"id\" href=\"#buf_len\">buf_len</a> + 3) &amp; ~3;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#opt\">opt</a> = <a class=\"id\" href=\"#kzalloc\">kzalloc</a>(sizeof(*<a class=\"id\" href=\"#opt\">opt</a>) + <a class=\"id\" href=\"#opt_len\">opt_len</a>, <a class=\"id\" href=\"#GFP_ATOMIC\">GFP_ATOMIC</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#opt\">opt</a> == <a class=\"id\" href=\"#NULL\">NULL</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret_val\">ret_val</a> = -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#socket_setattr_failure\">socket_setattr_failure</a>;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#memcpy\">memcpy</a>(<a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#__data\">__data</a>, <a class=\"id\" href=\"#buf\">buf</a>, <a class=\"id\" href=\"#buf_len\">buf_len</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#optlen\">optlen</a> = <a class=\"id\" href=\"#opt_len\">opt_len</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#cipso\">cipso</a> = sizeof(struct <a class=\"id\" href=\"#iphdr\">iphdr</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#buf\">buf</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#buf\">buf</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#sk_inet\">sk_inet</a> = <a class=\"id\" href=\"#inet_sk\">inet_sk</a>(<a class=\"id\" href=\"#sk\">sk</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#sk_inet\">sk_inet</a>-><a class=\"id\" href=\"#is_icsk\">is_icsk</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#sk_conn\">sk_conn</a> = <a class=\"id\" href=\"#inet_csk\">inet_csk</a>(<a class=\"id\" href=\"#sk\">sk</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#sk_inet\">sk_inet</a>-><a class=\"id\" href=\"#opt\">opt</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#sk_conn\">sk_conn</a>-><a class=\"id\" href=\"#icsk_ext_hdr_len\">icsk_ext_hdr_len</a> -= <a class=\"id\" href=\"#sk_inet\">sk_inet</a>-><a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#optlen\">optlen</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#sk_conn\">sk_conn</a>-><a class=\"id\" href=\"#icsk_ext_hdr_len\">icsk_ext_hdr_len</a> += <a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#optlen\">optlen</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#sk_conn\">sk_conn</a>-><a class=\"id\" href=\"#icsk_sync_mss\">icsk_sync_mss</a>(<a class=\"id\" href=\"#sk\">sk</a>, <a class=\"id\" href=\"#sk_conn\">sk_conn</a>-><a class=\"id\" href=\"#icsk_pmtu_cookie\">icsk_pmtu_cookie</a>);", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#opt\">opt</a> = <a class=\"id\" href=\"#xchg\">xchg</a>(&amp;<a class=\"id\" href=\"#sk_inet\">sk_inet</a>-><a class=\"id\" href=\"#opt\">opt</a>, <a class=\"id\" href=\"#opt\">opt</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#opt\">opt</a>);", 
"", 
"<span class=\"ts\"/>return 0;", 
"", 
"<a class=\"id\" href=\"#socket_setattr_failure\">socket_setattr_failure</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#buf\">buf</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#opt\">opt</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ret_val\">ret_val</a>;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * cipso_v4_req_setattr - Add a CIPSO option to a connection request socket</span>", 
"<span class=\"comment\"> * @req: the connection request socket</span>", 
"<span class=\"comment\"> * @doi_def: the CIPSO DOI to use</span>", 
"<span class=\"comment\"> * @secattr: the specific security attributes of the socket</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Description:</span>", 
"<span class=\"comment\"> * Set the CIPSO option on the given socket using the DOI definition and</span>", 
"<span class=\"comment\"> * security attributes passed to the function.  Returns zero on success and</span>", 
"<span class=\"comment\"> * negative values on failure.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> */</span>", 
"int <a class=\"id\" href=\"#cipso_v4_req_setattr\">cipso_v4_req_setattr</a>(struct <a class=\"id\" href=\"#request_sock\">request_sock</a> *<a class=\"id\" href=\"#req\">req</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> const struct <a class=\"id\" href=\"#cipso_v4_doi\">cipso_v4_doi</a> *<a class=\"id\" href=\"#doi_def\">doi_def</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> const struct <a class=\"id\" href=\"#netlbl_lsm_secattr\">netlbl_lsm_secattr</a> *<a class=\"id\" href=\"#secattr\">secattr</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#ret_val\">ret_val</a> = -<a class=\"id\" href=\"#EPERM\">EPERM</a>;", 
"<span class=\"ts\"/>unsigned char *<a class=\"id\" href=\"#buf\">buf</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#buf_len\">buf_len</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#opt_len\">opt_len</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ip_options\">ip_options</a> *<a class=\"id\" href=\"#opt\">opt</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#inet_request_sock\">inet_request_sock</a> *<a class=\"id\" href=\"#req_inet\">req_inet</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* We allocate the maximum CIPSO option size here so we are probably</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * being a little wasteful, but it makes our life _much_ easier later</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * on and after all we are only talking about 40 bytes. */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#buf_len\">buf_len</a> = <a class=\"id\" href=\"#CIPSO_V4_OPT_LEN_MAX\">CIPSO_V4_OPT_LEN_MAX</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#buf\">buf</a> = <a class=\"id\" href=\"#kmalloc\">kmalloc</a>(<a class=\"id\" href=\"#buf_len\">buf_len</a>, <a class=\"id\" href=\"#GFP_ATOMIC\">GFP_ATOMIC</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#buf\">buf</a> == <a class=\"id\" href=\"#NULL\">NULL</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret_val\">ret_val</a> = -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#req_setattr_failure\">req_setattr_failure</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ret_val\">ret_val</a> = <a class=\"id\" href=\"#cipso_v4_genopt\">cipso_v4_genopt</a>(<a class=\"id\" href=\"#buf\">buf</a>, <a class=\"id\" href=\"#buf_len\">buf_len</a>, <a class=\"id\" href=\"#doi_def\">doi_def</a>, <a class=\"id\" href=\"#secattr\">secattr</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#ret_val\">ret_val</a> &lt; 0)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#req_setattr_failure\">req_setattr_failure</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#buf_len\">buf_len</a> = <a class=\"id\" href=\"#ret_val\">ret_val</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* We can't use ip_options_get() directly because it makes a call to</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * ip_options_get_alloc() which allocates memory with GFP_KERNEL and</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * we won't always have CAP_NET_RAW even though we _always_ want to</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * set the IPOPT_CIPSO option. */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#opt_len\">opt_len</a> = (<a class=\"id\" href=\"#buf_len\">buf_len</a> + 3) &amp; ~3;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#opt\">opt</a> = <a class=\"id\" href=\"#kzalloc\">kzalloc</a>(sizeof(*<a class=\"id\" href=\"#opt\">opt</a>) + <a class=\"id\" href=\"#opt_len\">opt_len</a>, <a class=\"id\" href=\"#GFP_ATOMIC\">GFP_ATOMIC</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#opt\">opt</a> == <a class=\"id\" href=\"#NULL\">NULL</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret_val\">ret_val</a> = -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#req_setattr_failure\">req_setattr_failure</a>;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#memcpy\">memcpy</a>(<a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#__data\">__data</a>, <a class=\"id\" href=\"#buf\">buf</a>, <a class=\"id\" href=\"#buf_len\">buf_len</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#optlen\">optlen</a> = <a class=\"id\" href=\"#opt_len\">opt_len</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#cipso\">cipso</a> = sizeof(struct <a class=\"id\" href=\"#iphdr\">iphdr</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#buf\">buf</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#buf\">buf</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#req_inet\">req_inet</a> = <a class=\"id\" href=\"#inet_rsk\">inet_rsk</a>(<a class=\"id\" href=\"#req\">req</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#opt\">opt</a> = <a class=\"id\" href=\"#xchg\">xchg</a>(&amp;<a class=\"id\" href=\"#req_inet\">req_inet</a>-><a class=\"id\" href=\"#opt\">opt</a>, <a class=\"id\" href=\"#opt\">opt</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#opt\">opt</a>);", 
"", 
"<span class=\"ts\"/>return 0;", 
"", 
"<a class=\"id\" href=\"#req_setattr_failure\">req_setattr_failure</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#buf\">buf</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#opt\">opt</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ret_val\">ret_val</a>;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * cipso_v4_delopt - Delete the CIPSO option from a set of IP options</span>", 
"<span class=\"comment\"> * @opt_ptr: IP option pointer</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Description:</span>", 
"<span class=\"comment\"> * Deletes the CIPSO IP option from a set of IP options and makes the necessary</span>", 
"<span class=\"comment\"> * adjustments to the IP option structure.  Returns zero on success, negative</span>", 
"<span class=\"comment\"> * values on failure.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> */</span>", 
"static int <a class=\"id\" href=\"#cipso_v4_delopt\">cipso_v4_delopt</a>(struct <a class=\"id\" href=\"#ip_options\">ip_options</a> **<a class=\"id\" href=\"#opt_ptr\">opt_ptr</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#hdr_delta\">hdr_delta</a> = 0;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ip_options\">ip_options</a> *<a class=\"id\" href=\"#opt\">opt</a> = *<a class=\"id\" href=\"#opt_ptr\">opt_ptr</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#srr\">srr</a> || <a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#rr\">rr</a> || <a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#ts\">ts</a> || <a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#router_alert\">router_alert</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#u8\">u8</a> <a class=\"id\" href=\"#cipso_len\">cipso_len</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#u8\">u8</a> <a class=\"id\" href=\"#cipso_off\">cipso_off</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>unsigned char *<a class=\"id\" href=\"#cipso_ptr\">cipso_ptr</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>int <a class=\"id\" href=\"#iter\">iter</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>int <a class=\"id\" href=\"#optlen_new\">optlen_new</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#cipso_off\">cipso_off</a> = <a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#cipso\">cipso</a> - sizeof(struct <a class=\"id\" href=\"#iphdr\">iphdr</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#cipso_ptr\">cipso_ptr</a> = &amp;<a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#__data\">__data</a>[<a class=\"id\" href=\"#cipso_off\">cipso_off</a>];", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#cipso_len\">cipso_len</a> = <a class=\"id\" href=\"#cipso_ptr\">cipso_ptr</a>[1];", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#srr\">srr</a> &gt; <a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#cipso\">cipso</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#srr\">srr</a> -= <a class=\"id\" href=\"#cipso_len\">cipso_len</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#rr\">rr</a> &gt; <a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#cipso\">cipso</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#rr\">rr</a> -= <a class=\"id\" href=\"#cipso_len\">cipso_len</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#ts\">ts</a> &gt; <a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#cipso\">cipso</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#ts\">ts</a> -= <a class=\"id\" href=\"#cipso_len\">cipso_len</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#router_alert\">router_alert</a> &gt; <a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#cipso\">cipso</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#router_alert\">router_alert</a> -= <a class=\"id\" href=\"#cipso_len\">cipso_len</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#cipso\">cipso</a> = 0;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#memmove\">memmove</a>(<a class=\"id\" href=\"#cipso_ptr\">cipso_ptr</a>, <a class=\"id\" href=\"#cipso_ptr\">cipso_ptr</a> + <a class=\"id\" href=\"#cipso_len\">cipso_len</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#optlen\">optlen</a> - <a class=\"id\" href=\"#cipso_off\">cipso_off</a> - <a class=\"id\" href=\"#cipso_len\">cipso_len</a>);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* determining the new total option length is tricky because of</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * the padding necessary, the only thing i can think to do at</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * this point is walk the options one-by-one, skipping the</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * padding at the end to determine the actual option size and</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * from there we can determine the new total option length */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#iter\">iter</a> = 0;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#optlen_new\">optlen_new</a> = 0;", 
"<span class=\"ts\"/><span class=\"ts\"/>while (<a class=\"id\" href=\"#iter\">iter</a> &lt; <a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#optlen\">optlen</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#__data\">__data</a>[<a class=\"id\" href=\"#iter\">iter</a>] != <a class=\"id\" href=\"#IPOPT_NOP\">IPOPT_NOP</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#iter\">iter</a> += <a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#__data\">__data</a>[<a class=\"id\" href=\"#iter\">iter</a> + 1];", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#optlen_new\">optlen_new</a> = <a class=\"id\" href=\"#iter\">iter</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>} else", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#iter\">iter</a>++;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#hdr_delta\">hdr_delta</a> = <a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#optlen\">optlen</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#optlen\">optlen</a> = (<a class=\"id\" href=\"#optlen_new\">optlen_new</a> + 3) &amp; ~3;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#hdr_delta\">hdr_delta</a> -= <a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#optlen\">optlen</a>;", 
"<span class=\"ts\"/>} else {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* only the cipso option was present on the socket so we can</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * remove the entire option struct */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>*<a class=\"id\" href=\"#opt_ptr\">opt_ptr</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#hdr_delta\">hdr_delta</a> = <a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#optlen\">optlen</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#opt\">opt</a>);", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#hdr_delta\">hdr_delta</a>;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * cipso_v4_sock_delattr - Delete the CIPSO option from a socket</span>", 
"<span class=\"comment\"> * @sk: the socket</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Description:</span>", 
"<span class=\"comment\"> * Removes the CIPSO option from a socket, if present.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> */</span>", 
"void <a class=\"id\" href=\"#cipso_v4_sock_delattr\">cipso_v4_sock_delattr</a>(struct <a class=\"id\" href=\"#sock\">sock</a> *<a class=\"id\" href=\"#sk\">sk</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#hdr_delta\">hdr_delta</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ip_options\">ip_options</a> *<a class=\"id\" href=\"#opt\">opt</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#inet_sock\">inet_sock</a> *<a class=\"id\" href=\"#sk_inet\">sk_inet</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#sk_inet\">sk_inet</a> = <a class=\"id\" href=\"#inet_sk\">inet_sk</a>(<a class=\"id\" href=\"#sk\">sk</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#opt\">opt</a> = <a class=\"id\" href=\"#sk_inet\">sk_inet</a>-><a class=\"id\" href=\"#opt\">opt</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#opt\">opt</a> == <a class=\"id\" href=\"#NULL\">NULL</a> || <a class=\"id\" href=\"#opt\">opt</a>-><a class=\"id\" href=\"#cipso\">cipso</a> == 0)", 
];
xr_frag_insert('l/2a/4581edc12a85ff4a8c39316e14cd7ac6de1122.xr', __xr_tmp);
