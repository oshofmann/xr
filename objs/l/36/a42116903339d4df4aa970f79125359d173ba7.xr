var __xr_tmp = [
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * linux/ipc/shm.c</span>", 
"<span class=\"comment\"> * Copyright (C) 1992, 1993 Krishna Balasubramanian</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/> Many improvements/fixes by Bruno Haible.</span>", 
"<span class=\"comment\"> * Replaced `struct shm_desc' by `struct vm_area_struct', July 1994.</span>", 
"<span class=\"comment\"> * Fixed the shm swap deallocation (shm_unuse()), August 1998 Andrea Arcangeli.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * /proc/sysvipc/shm support (c) 1999 Dragos Acostachioaie &lt;dragos@iname.com&gt;</span>", 
"<span class=\"comment\"> * BIGMEM support, Andrea Arcangeli &lt;andrea@suse.de&gt;</span>", 
"<span class=\"comment\"> * SMP thread shm, Jean-Luc Boyard &lt;jean-luc.boyard@siemens.fr&gt;</span>", 
"<span class=\"comment\"> * HIGHMEM support, Ingo Molnar &lt;mingo@redhat.com&gt;</span>", 
"<span class=\"comment\"> * Make shmmax, shmall, shmmni sysctl'able, Christoph Rohland &lt;cr@sap.com&gt;</span>", 
"<span class=\"comment\"> * Shared /dev/zero support, Kanoj Sarcar &lt;kanoj@sgi.com&gt;</span>", 
"<span class=\"comment\"> * Move the mm functionality over to mm/shmem.c, Christoph Rohland &lt;cr@sap.com&gt;</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * support for audit of ipc object properties and permission changes</span>", 
"<span class=\"comment\"> * Dustin Kirkland &lt;dustin.kirkland@us.ibm.com&gt;</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * namespaces support</span>", 
"<span class=\"comment\"> * OpenVZ, SWsoft Inc.</span>", 
"<span class=\"comment\"> * Pavel Emelianov &lt;xemul@openvz.org&gt;</span>", 
"<span class=\"comment\"> */</span>", 
"", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#slab\">slab</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#mm\">mm</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#hugetlb\">hugetlb</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#shm\">shm</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#init\">init</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#file\">file</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#mman\">mman</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#shmem_fs\">shmem_fs</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#security\">security</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#syscalls\">syscalls</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#audit\">audit</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#capability\">capability</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#ptrace\">ptrace</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#seq_file\">seq_file</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#rwsem\">rwsem</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#nsproxy\">nsproxy</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#mount\">mount</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#ipc_namespace\">ipc_namespace</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#asm\">asm</a>/<a class=\"id\" href=\"#uaccess\">uaccess</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"", 
"#<a class=\"id\" href=\"#include\">include</a> \"util.h\"", 
"", 
"struct <a class=\"id\" href=\"#shm_file_data\">shm_file_data</a> {", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#id\">id</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ipc_namespace\">ipc_namespace</a> *<a class=\"id\" href=\"#ns\">ns</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#file\">file</a>;", 
"<span class=\"ts\"/>const struct <a class=\"id\" href=\"#vm_operations_struct\">vm_operations_struct</a> *<a class=\"id\" href=\"#vm_ops\">vm_ops</a>;", 
"};", 
"", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#shm_file_data\">shm_file_data</a>(<a class=\"id\" href=\"#file\">file</a>) (*((struct <a class=\"id\" href=\"#shm_file_data\">shm_file_data</a> **)&amp;(<a class=\"id\" href=\"#file\">file</a>)-><a class=\"id\" href=\"#private_data\">private_data</a>))", 
"", 
"static const struct <a class=\"id\" href=\"#file_operations\">file_operations</a> <a class=\"id\" href=\"#shm_file_operations\">shm_file_operations</a>;", 
"static const struct <a class=\"id\" href=\"#vm_operations_struct\">vm_operations_struct</a> <a class=\"id\" href=\"#shm_vm_ops\">shm_vm_ops</a>;", 
"", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#shm_ids\">shm_ids</a>(<a class=\"id\" href=\"#ns\">ns</a>)<span class=\"ts\"/>((<a class=\"id\" href=\"#ns\">ns</a>)-><a class=\"id\" href=\"#ids\">ids</a>[<a class=\"id\" href=\"#IPC_SHM_IDS\">IPC_SHM_IDS</a>])", 
"", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#shm_unlock\">shm_unlock</a>(<a class=\"id\" href=\"#shp\">shp</a>)<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>\\", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ipc_unlock\">ipc_unlock</a>(&amp;(<a class=\"id\" href=\"#shp\">shp</a>)-><a class=\"id\" href=\"#shm_perm\">shm_perm</a>)", 
"", 
"static int <a class=\"id\" href=\"#newseg\">newseg</a>(struct <a class=\"id\" href=\"#ipc_namespace\">ipc_namespace</a> *, struct <a class=\"id\" href=\"#ipc_params\">ipc_params</a> *);", 
"static void <a class=\"id\" href=\"#shm_open\">shm_open</a>(struct <a class=\"id\" href=\"#vm_area_struct\">vm_area_struct</a> *<a class=\"id\" href=\"#vma\">vma</a>);", 
"static void <a class=\"id\" href=\"#shm_close\">shm_close</a>(struct <a class=\"id\" href=\"#vm_area_struct\">vm_area_struct</a> *<a class=\"id\" href=\"#vma\">vma</a>);", 
"static void <a class=\"id\" href=\"#shm_destroy\">shm_destroy</a> (struct <a class=\"id\" href=\"#ipc_namespace\">ipc_namespace</a> *<a class=\"id\" href=\"#ns\">ns</a>, struct <a class=\"id\" href=\"#shmid_kernel\">shmid_kernel</a> *<a class=\"id\" href=\"#shp\">shp</a>);", 
"#<a class=\"id\" href=\"#ifdef\">ifdef</a> <a class=\"id\" href=\"#CONFIG_PROC_FS\">CONFIG_PROC_FS</a>", 
"static int <a class=\"id\" href=\"#sysvipc_shm_proc_show\">sysvipc_shm_proc_show</a>(struct <a class=\"id\" href=\"#seq_file\">seq_file</a> *<a class=\"id\" href=\"#s\">s</a>, void *<a class=\"id\" href=\"#it\">it</a>);", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
"", 
"void <a class=\"id\" href=\"#shm_init_ns\">shm_init_ns</a>(struct <a class=\"id\" href=\"#ipc_namespace\">ipc_namespace</a> *<a class=\"id\" href=\"#ns\">ns</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ns\">ns</a>-><a class=\"id\" href=\"#shm_ctlmax\">shm_ctlmax</a> = <a class=\"id\" href=\"#SHMMAX\">SHMMAX</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ns\">ns</a>-><a class=\"id\" href=\"#shm_ctlall\">shm_ctlall</a> = <a class=\"id\" href=\"#SHMALL\">SHMALL</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ns\">ns</a>-><a class=\"id\" href=\"#shm_ctlmni\">shm_ctlmni</a> = <a class=\"id\" href=\"#SHMMNI\">SHMMNI</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ns\">ns</a>-><a class=\"id\" href=\"#shm_tot\">shm_tot</a> = 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ipc_init_ids\">ipc_init_ids</a>(&amp;<a class=\"id\" href=\"#shm_ids\">shm_ids</a>(<a class=\"id\" href=\"#ns\">ns</a>));", 
"}", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Called with shm_ids.rw_mutex (writer) and the shp structure locked.</span>", 
"<span class=\"comment\"> * Only shm_ids.rw_mutex remains locked on exit.</span>", 
"<span class=\"comment\"> */</span>", 
"static void <a class=\"id\" href=\"#do_shm_rmid\">do_shm_rmid</a>(struct <a class=\"id\" href=\"#ipc_namespace\">ipc_namespace</a> *<a class=\"id\" href=\"#ns\">ns</a>, struct <a class=\"id\" href=\"#kern_ipc_perm\">kern_ipc_perm</a> *<a class=\"id\" href=\"#ipcp\">ipcp</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#shmid_kernel\">shmid_kernel</a> *<a class=\"id\" href=\"#shp\">shp</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shp\">shp</a> = <a class=\"id\" href=\"#container_of\">container_of</a>(<a class=\"id\" href=\"#ipcp\">ipcp</a>, struct <a class=\"id\" href=\"#shmid_kernel\">shmid_kernel</a>, <a class=\"id\" href=\"#shm_perm\">shm_perm</a>);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_nattch\">shm_nattch</a>){", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_perm\">shm_perm</a>.<a class=\"id\" href=\"#mode\">mode</a> |= <a class=\"id\" href=\"#SHM_DEST\">SHM_DEST</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Do not find it any more */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_perm\">shm_perm</a>.<a class=\"id\" href=\"#key\">key</a> = <a class=\"id\" href=\"#IPC_PRIVATE\">IPC_PRIVATE</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#shm_unlock\">shm_unlock</a>(<a class=\"id\" href=\"#shp\">shp</a>);", 
"<span class=\"ts\"/>} else", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#shm_destroy\">shm_destroy</a>(<a class=\"id\" href=\"#ns\">ns</a>, <a class=\"id\" href=\"#shp\">shp</a>);", 
"}", 
"", 
"#<a class=\"id\" href=\"#ifdef\">ifdef</a> <a class=\"id\" href=\"#CONFIG_IPC_NS\">CONFIG_IPC_NS</a>", 
"void <a class=\"id\" href=\"#shm_exit_ns\">shm_exit_ns</a>(struct <a class=\"id\" href=\"#ipc_namespace\">ipc_namespace</a> *<a class=\"id\" href=\"#ns\">ns</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#free_ipcs\">free_ipcs</a>(<a class=\"id\" href=\"#ns\">ns</a>, &amp;<a class=\"id\" href=\"#shm_ids\">shm_ids</a>(<a class=\"id\" href=\"#ns\">ns</a>), <a class=\"id\" href=\"#do_shm_rmid\">do_shm_rmid</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#idr_destroy\">idr_destroy</a>(&amp;<a class=\"id\" href=\"#ns\">ns</a>-><a class=\"id\" href=\"#ids\">ids</a>[<a class=\"id\" href=\"#IPC_SHM_IDS\">IPC_SHM_IDS</a>].<a class=\"id\" href=\"#ipcs_idr\">ipcs_idr</a>);", 
"}", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
"", 
"void <a class=\"id\" href=\"#__init\">__init</a> <a class=\"id\" href=\"#shm_init\">shm_init</a> (void)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shm_init_ns\">shm_init_ns</a>(&amp;<a class=\"id\" href=\"#init_ipc_ns\">init_ipc_ns</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ipc_init_proc_interface\">ipc_init_proc_interface</a>(\"sysvipc/shm\",", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>\"       key      shmid perms       size  cpid  lpid nattch   uid   gid  cuid  cgid      atime      dtime      ctime\\n\",", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#IPC_SHM_IDS\">IPC_SHM_IDS</a>, <a class=\"id\" href=\"#sysvipc_shm_proc_show\">sysvipc_shm_proc_show</a>);", 
"}", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * shm_lock_(check_) routines are called in the paths where the rw_mutex</span>", 
"<span class=\"comment\"> * is not necessarily held.</span>", 
"<span class=\"comment\"> */</span>", 
"static <a class=\"id\" href=\"#inline\">inline</a> struct <a class=\"id\" href=\"#shmid_kernel\">shmid_kernel</a> *<a class=\"id\" href=\"#shm_lock\">shm_lock</a>(struct <a class=\"id\" href=\"#ipc_namespace\">ipc_namespace</a> *<a class=\"id\" href=\"#ns\">ns</a>, int <a class=\"id\" href=\"#id\">id</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#kern_ipc_perm\">kern_ipc_perm</a> *<a class=\"id\" href=\"#ipcp\">ipcp</a> = <a class=\"id\" href=\"#ipc_lock\">ipc_lock</a>(&amp;<a class=\"id\" href=\"#shm_ids\">shm_ids</a>(<a class=\"id\" href=\"#ns\">ns</a>), <a class=\"id\" href=\"#id\">id</a>);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#IS_ERR\">IS_ERR</a>(<a class=\"id\" href=\"#ipcp\">ipcp</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return (struct <a class=\"id\" href=\"#shmid_kernel\">shmid_kernel</a> *)<a class=\"id\" href=\"#ipcp\">ipcp</a>;", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#container_of\">container_of</a>(<a class=\"id\" href=\"#ipcp\">ipcp</a>, struct <a class=\"id\" href=\"#shmid_kernel\">shmid_kernel</a>, <a class=\"id\" href=\"#shm_perm\">shm_perm</a>);", 
"}", 
"", 
"static <a class=\"id\" href=\"#inline\">inline</a> struct <a class=\"id\" href=\"#shmid_kernel\">shmid_kernel</a> *<a class=\"id\" href=\"#shm_lock_check\">shm_lock_check</a>(struct <a class=\"id\" href=\"#ipc_namespace\">ipc_namespace</a> *<a class=\"id\" href=\"#ns\">ns</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>int <a class=\"id\" href=\"#id\">id</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#kern_ipc_perm\">kern_ipc_perm</a> *<a class=\"id\" href=\"#ipcp\">ipcp</a> = <a class=\"id\" href=\"#ipc_lock_check\">ipc_lock_check</a>(&amp;<a class=\"id\" href=\"#shm_ids\">shm_ids</a>(<a class=\"id\" href=\"#ns\">ns</a>), <a class=\"id\" href=\"#id\">id</a>);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#IS_ERR\">IS_ERR</a>(<a class=\"id\" href=\"#ipcp\">ipcp</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return (struct <a class=\"id\" href=\"#shmid_kernel\">shmid_kernel</a> *)<a class=\"id\" href=\"#ipcp\">ipcp</a>;", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#container_of\">container_of</a>(<a class=\"id\" href=\"#ipcp\">ipcp</a>, struct <a class=\"id\" href=\"#shmid_kernel\">shmid_kernel</a>, <a class=\"id\" href=\"#shm_perm\">shm_perm</a>);", 
"}", 
"", 
"static <a class=\"id\" href=\"#inline\">inline</a> void <a class=\"id\" href=\"#shm_rmid\">shm_rmid</a>(struct <a class=\"id\" href=\"#ipc_namespace\">ipc_namespace</a> *<a class=\"id\" href=\"#ns\">ns</a>, struct <a class=\"id\" href=\"#shmid_kernel\">shmid_kernel</a> *<a class=\"id\" href=\"#s\">s</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ipc_rmid\">ipc_rmid</a>(&amp;<a class=\"id\" href=\"#shm_ids\">shm_ids</a>(<a class=\"id\" href=\"#ns\">ns</a>), &amp;<a class=\"id\" href=\"#s\">s</a>-><a class=\"id\" href=\"#shm_perm\">shm_perm</a>);", 
"}", 
"", 
"", 
"<span class=\"comment\">/* This is called by fork, once for every shm attach. */</span>", 
"static void <a class=\"id\" href=\"#shm_open\">shm_open</a>(struct <a class=\"id\" href=\"#vm_area_struct\">vm_area_struct</a> *<a class=\"id\" href=\"#vma\">vma</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#file\">file</a> = <a class=\"id\" href=\"#vma\">vma</a>-><a class=\"id\" href=\"#vm_file\">vm_file</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#shm_file_data\">shm_file_data</a> *<a class=\"id\" href=\"#sfd\">sfd</a> = <a class=\"id\" href=\"#shm_file_data\">shm_file_data</a>(<a class=\"id\" href=\"#file\">file</a>);", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#shmid_kernel\">shmid_kernel</a> *<a class=\"id\" href=\"#shp\">shp</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shp\">shp</a> = <a class=\"id\" href=\"#shm_lock\">shm_lock</a>(<a class=\"id\" href=\"#sfd\">sfd</a>-><a class=\"id\" href=\"#ns\">ns</a>, <a class=\"id\" href=\"#sfd\">sfd</a>-><a class=\"id\" href=\"#id\">id</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#BUG_ON\">BUG_ON</a>(<a class=\"id\" href=\"#IS_ERR\">IS_ERR</a>(<a class=\"id\" href=\"#shp\">shp</a>));", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_atim\">shm_atim</a> = <a class=\"id\" href=\"#get_seconds\">get_seconds</a>();", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_lprid\">shm_lprid</a> = <a class=\"id\" href=\"#task_tgid_vnr\">task_tgid_vnr</a>(<a class=\"id\" href=\"#current\">current</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_nattch\">shm_nattch</a>++;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shm_unlock\">shm_unlock</a>(<a class=\"id\" href=\"#shp\">shp</a>);", 
"}", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * shm_destroy - free the struct shmid_kernel</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * @ns: namespace</span>", 
"<span class=\"comment\"> * @shp: struct to free</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * It has to be called with shp and shm_ids.rw_mutex (writer) locked,</span>", 
"<span class=\"comment\"> * but returns with shp unlocked and freed.</span>", 
"<span class=\"comment\"> */</span>", 
"static void <a class=\"id\" href=\"#shm_destroy\">shm_destroy</a>(struct <a class=\"id\" href=\"#ipc_namespace\">ipc_namespace</a> *<a class=\"id\" href=\"#ns\">ns</a>, struct <a class=\"id\" href=\"#shmid_kernel\">shmid_kernel</a> *<a class=\"id\" href=\"#shp\">shp</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ns\">ns</a>-><a class=\"id\" href=\"#shm_tot\">shm_tot</a> -= (<a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_segsz\">shm_segsz</a> + <a class=\"id\" href=\"#PAGE_SIZE\">PAGE_SIZE</a> - 1) >> <a class=\"id\" href=\"#PAGE_SHIFT\">PAGE_SHIFT</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shm_rmid\">shm_rmid</a>(<a class=\"id\" href=\"#ns\">ns</a>, <a class=\"id\" href=\"#shp\">shp</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shm_unlock\">shm_unlock</a>(<a class=\"id\" href=\"#shp\">shp</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#is_file_hugepages\">is_file_hugepages</a>(<a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_file\">shm_file</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#shmem_lock\">shmem_lock</a>(<a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_file\">shm_file</a>, 0, <a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#mlock_user\">mlock_user</a>);", 
"<span class=\"ts\"/>else if (<a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#mlock_user\">mlock_user</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#user_shm_unlock\">user_shm_unlock</a>(<a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_file\">shm_file</a>-><a class=\"id\" href=\"#f_path\">f_path</a>.<a class=\"id\" href=\"#dentry\">dentry</a>-><a class=\"id\" href=\"#d_inode\">d_inode</a>-><a class=\"id\" href=\"#i_size\">i_size</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#mlock_user\">mlock_user</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#fput\">fput</a> (<a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_file\">shm_file</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#security_shm_free\">security_shm_free</a>(<a class=\"id\" href=\"#shp\">shp</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ipc_rcu_putref\">ipc_rcu_putref</a>(<a class=\"id\" href=\"#shp\">shp</a>);", 
"}", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * remove the attach descriptor vma.</span>", 
"<span class=\"comment\"> * free memory for segment if it is marked destroyed.</span>", 
"<span class=\"comment\"> * The descriptor has already been removed from the current-&gt;mm-&gt;mmap list</span>", 
"<span class=\"comment\"> * and will later be kfree()d.</span>", 
"<span class=\"comment\"> */</span>", 
"static void <a class=\"id\" href=\"#shm_close\">shm_close</a>(struct <a class=\"id\" href=\"#vm_area_struct\">vm_area_struct</a> *<a class=\"id\" href=\"#vma\">vma</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#file\">file</a> * <a class=\"id\" href=\"#file\">file</a> = <a class=\"id\" href=\"#vma\">vma</a>-><a class=\"id\" href=\"#vm_file\">vm_file</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#shm_file_data\">shm_file_data</a> *<a class=\"id\" href=\"#sfd\">sfd</a> = <a class=\"id\" href=\"#shm_file_data\">shm_file_data</a>(<a class=\"id\" href=\"#file\">file</a>);", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#shmid_kernel\">shmid_kernel</a> *<a class=\"id\" href=\"#shp\">shp</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ipc_namespace\">ipc_namespace</a> *<a class=\"id\" href=\"#ns\">ns</a> = <a class=\"id\" href=\"#sfd\">sfd</a>-><a class=\"id\" href=\"#ns\">ns</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#down_write\">down_write</a>(&amp;<a class=\"id\" href=\"#shm_ids\">shm_ids</a>(<a class=\"id\" href=\"#ns\">ns</a>).<a class=\"id\" href=\"#rw_mutex\">rw_mutex</a>);", 
"<span class=\"ts\"/><span class=\"comment\">/* remove from the list of attaches of the shm segment */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shp\">shp</a> = <a class=\"id\" href=\"#shm_lock\">shm_lock</a>(<a class=\"id\" href=\"#ns\">ns</a>, <a class=\"id\" href=\"#sfd\">sfd</a>-><a class=\"id\" href=\"#id\">id</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#BUG_ON\">BUG_ON</a>(<a class=\"id\" href=\"#IS_ERR\">IS_ERR</a>(<a class=\"id\" href=\"#shp\">shp</a>));", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_lprid\">shm_lprid</a> = <a class=\"id\" href=\"#task_tgid_vnr\">task_tgid_vnr</a>(<a class=\"id\" href=\"#current\">current</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_dtim\">shm_dtim</a> = <a class=\"id\" href=\"#get_seconds\">get_seconds</a>();", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_nattch\">shm_nattch</a>--;", 
"<span class=\"ts\"/>if(<a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_nattch\">shm_nattch</a> == 0 &&", 
"<span class=\"ts\"/>   <a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_perm\">shm_perm</a>.<a class=\"id\" href=\"#mode\">mode</a> &amp; <a class=\"id\" href=\"#SHM_DEST\">SHM_DEST</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#shm_destroy\">shm_destroy</a>(<a class=\"id\" href=\"#ns\">ns</a>, <a class=\"id\" href=\"#shp\">shp</a>);", 
"<span class=\"ts\"/>else", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#shm_unlock\">shm_unlock</a>(<a class=\"id\" href=\"#shp\">shp</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#up_write\">up_write</a>(&amp;<a class=\"id\" href=\"#shm_ids\">shm_ids</a>(<a class=\"id\" href=\"#ns\">ns</a>).<a class=\"id\" href=\"#rw_mutex\">rw_mutex</a>);", 
"}", 
"", 
"static int <a class=\"id\" href=\"#shm_fault\">shm_fault</a>(struct <a class=\"id\" href=\"#vm_area_struct\">vm_area_struct</a> *<a class=\"id\" href=\"#vma\">vma</a>, struct <a class=\"id\" href=\"#vm_fault\">vm_fault</a> *<a class=\"id\" href=\"#vmf\">vmf</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#file\">file</a> = <a class=\"id\" href=\"#vma\">vma</a>-><a class=\"id\" href=\"#vm_file\">vm_file</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#shm_file_data\">shm_file_data</a> *<a class=\"id\" href=\"#sfd\">sfd</a> = <a class=\"id\" href=\"#shm_file_data\">shm_file_data</a>(<a class=\"id\" href=\"#file\">file</a>);", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#sfd\">sfd</a>-><a class=\"id\" href=\"#vm_ops\">vm_ops</a>-><a class=\"id\" href=\"#fault\">fault</a>(<a class=\"id\" href=\"#vma\">vma</a>, <a class=\"id\" href=\"#vmf\">vmf</a>);", 
"}", 
"", 
"#<a class=\"id\" href=\"#ifdef\">ifdef</a> <a class=\"id\" href=\"#CONFIG_NUMA\">CONFIG_NUMA</a>", 
"static int <a class=\"id\" href=\"#shm_set_policy\">shm_set_policy</a>(struct <a class=\"id\" href=\"#vm_area_struct\">vm_area_struct</a> *<a class=\"id\" href=\"#vma\">vma</a>, struct <a class=\"id\" href=\"#mempolicy\">mempolicy</a> *<a class=\"id\" href=\"#new\">new</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#file\">file</a> = <a class=\"id\" href=\"#vma\">vma</a>-><a class=\"id\" href=\"#vm_file\">vm_file</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#shm_file_data\">shm_file_data</a> *<a class=\"id\" href=\"#sfd\">sfd</a> = <a class=\"id\" href=\"#shm_file_data\">shm_file_data</a>(<a class=\"id\" href=\"#file\">file</a>);", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#err\">err</a> = 0;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#sfd\">sfd</a>-><a class=\"id\" href=\"#vm_ops\">vm_ops</a>-><a class=\"id\" href=\"#set_policy\">set_policy</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = <a class=\"id\" href=\"#sfd\">sfd</a>-><a class=\"id\" href=\"#vm_ops\">vm_ops</a>-><a class=\"id\" href=\"#set_policy\">set_policy</a>(<a class=\"id\" href=\"#vma\">vma</a>, <a class=\"id\" href=\"#new\">new</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#err\">err</a>;", 
"}", 
"", 
"static struct <a class=\"id\" href=\"#mempolicy\">mempolicy</a> *<a class=\"id\" href=\"#shm_get_policy\">shm_get_policy</a>(struct <a class=\"id\" href=\"#vm_area_struct\">vm_area_struct</a> *<a class=\"id\" href=\"#vma\">vma</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#addr\">addr</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#file\">file</a> = <a class=\"id\" href=\"#vma\">vma</a>-><a class=\"id\" href=\"#vm_file\">vm_file</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#shm_file_data\">shm_file_data</a> *<a class=\"id\" href=\"#sfd\">sfd</a> = <a class=\"id\" href=\"#shm_file_data\">shm_file_data</a>(<a class=\"id\" href=\"#file\">file</a>);", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#mempolicy\">mempolicy</a> *<a class=\"id\" href=\"#pol\">pol</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#sfd\">sfd</a>-><a class=\"id\" href=\"#vm_ops\">vm_ops</a>-><a class=\"id\" href=\"#get_policy\">get_policy</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pol\">pol</a> = <a class=\"id\" href=\"#sfd\">sfd</a>-><a class=\"id\" href=\"#vm_ops\">vm_ops</a>-><a class=\"id\" href=\"#get_policy\">get_policy</a>(<a class=\"id\" href=\"#vma\">vma</a>, <a class=\"id\" href=\"#addr\">addr</a>);", 
"<span class=\"ts\"/>else if (<a class=\"id\" href=\"#vma\">vma</a>-><a class=\"id\" href=\"#vm_policy\">vm_policy</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pol\">pol</a> = <a class=\"id\" href=\"#vma\">vma</a>-><a class=\"id\" href=\"#vm_policy\">vm_policy</a>;", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#pol\">pol</a>;", 
"}", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
"", 
"static int <a class=\"id\" href=\"#shm_mmap\">shm_mmap</a>(struct <a class=\"id\" href=\"#file\">file</a> * <a class=\"id\" href=\"#file\">file</a>, struct <a class=\"id\" href=\"#vm_area_struct\">vm_area_struct</a> * <a class=\"id\" href=\"#vma\">vma</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#shm_file_data\">shm_file_data</a> *<a class=\"id\" href=\"#sfd\">sfd</a> = <a class=\"id\" href=\"#shm_file_data\">shm_file_data</a>(<a class=\"id\" href=\"#file\">file</a>);", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#ret\">ret</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#sfd\">sfd</a>-><a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#f_op\">f_op</a>-><a class=\"id\" href=\"#mmap\">mmap</a>(<a class=\"id\" href=\"#sfd\">sfd</a>-><a class=\"id\" href=\"#file\">file</a>, <a class=\"id\" href=\"#vma\">vma</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#ret\">ret</a> != 0)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#ret\">ret</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#sfd\">sfd</a>-><a class=\"id\" href=\"#vm_ops\">vm_ops</a> = <a class=\"id\" href=\"#vma\">vma</a>-><a class=\"id\" href=\"#vm_ops\">vm_ops</a>;", 
"#<a class=\"id\" href=\"#ifdef\">ifdef</a> <a class=\"id\" href=\"#CONFIG_MMU\">CONFIG_MMU</a>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#BUG_ON\">BUG_ON</a>(!<a class=\"id\" href=\"#sfd\">sfd</a>-><a class=\"id\" href=\"#vm_ops\">vm_ops</a>-><a class=\"id\" href=\"#fault\">fault</a>);", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#vma\">vma</a>-><a class=\"id\" href=\"#vm_ops\">vm_ops</a> = &amp;<a class=\"id\" href=\"#shm_vm_ops\">shm_vm_ops</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shm_open\">shm_open</a>(<a class=\"id\" href=\"#vma\">vma</a>);", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ret\">ret</a>;", 
"}", 
"", 
"static int <a class=\"id\" href=\"#shm_release\">shm_release</a>(struct <a class=\"id\" href=\"#inode\">inode</a> *<a class=\"id\" href=\"#ino\">ino</a>, struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#file\">file</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#shm_file_data\">shm_file_data</a> *<a class=\"id\" href=\"#sfd\">sfd</a> = <a class=\"id\" href=\"#shm_file_data\">shm_file_data</a>(<a class=\"id\" href=\"#file\">file</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#put_ipc_ns\">put_ipc_ns</a>(<a class=\"id\" href=\"#sfd\">sfd</a>-><a class=\"id\" href=\"#ns\">ns</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shm_file_data\">shm_file_data</a>(<a class=\"id\" href=\"#file\">file</a>) = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#sfd\">sfd</a>);", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"static int <a class=\"id\" href=\"#shm_fsync\">shm_fsync</a>(struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#file\">file</a>, int <a class=\"id\" href=\"#datasync\">datasync</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#shm_file_data\">shm_file_data</a> *<a class=\"id\" href=\"#sfd\">sfd</a> = <a class=\"id\" href=\"#shm_file_data\">shm_file_data</a>(<a class=\"id\" href=\"#file\">file</a>);", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#sfd\">sfd</a>-><a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#f_op\">f_op</a>-><a class=\"id\" href=\"#fsync\">fsync</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#sfd\">sfd</a>-><a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#f_op\">f_op</a>-><a class=\"id\" href=\"#fsync\">fsync</a>(<a class=\"id\" href=\"#sfd\">sfd</a>-><a class=\"id\" href=\"#file\">file</a>, <a class=\"id\" href=\"#datasync\">datasync</a>);", 
"}", 
"", 
"static unsigned long <a class=\"id\" href=\"#shm_get_unmapped_area\">shm_get_unmapped_area</a>(struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#file\">file</a>,", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#addr\">addr</a>, unsigned long <a class=\"id\" href=\"#len\">len</a>, unsigned long <a class=\"id\" href=\"#pgoff\">pgoff</a>,", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#flags\">flags</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#shm_file_data\">shm_file_data</a> *<a class=\"id\" href=\"#sfd\">sfd</a> = <a class=\"id\" href=\"#shm_file_data\">shm_file_data</a>(<a class=\"id\" href=\"#file\">file</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#sfd\">sfd</a>-><a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#f_op\">f_op</a>-><a class=\"id\" href=\"#get_unmapped_area\">get_unmapped_area</a>(<a class=\"id\" href=\"#sfd\">sfd</a>-><a class=\"id\" href=\"#file\">file</a>, <a class=\"id\" href=\"#addr\">addr</a>, <a class=\"id\" href=\"#len\">len</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pgoff\">pgoff</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"}", 
"", 
"static const struct <a class=\"id\" href=\"#file_operations\">file_operations</a> <a class=\"id\" href=\"#shm_file_operations\">shm_file_operations</a> = {", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#mmap\">mmap</a><span class=\"ts\"/><span class=\"ts\"/>= <a class=\"id\" href=\"#shm_mmap\">shm_mmap</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#fsync\">fsync</a><span class=\"ts\"/><span class=\"ts\"/>= <a class=\"id\" href=\"#shm_fsync\">shm_fsync</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#release\">release</a><span class=\"ts\"/>= <a class=\"id\" href=\"#shm_release\">shm_release</a>,", 
"#<a class=\"id\" href=\"#ifndef\">ifndef</a> <a class=\"id\" href=\"#CONFIG_MMU\">CONFIG_MMU</a>", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#get_unmapped_area\">get_unmapped_area</a><span class=\"ts\"/>= <a class=\"id\" href=\"#shm_get_unmapped_area\">shm_get_unmapped_area</a>,", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
"};", 
"", 
"static const struct <a class=\"id\" href=\"#file_operations\">file_operations</a> <a class=\"id\" href=\"#shm_file_operations_huge\">shm_file_operations_huge</a> = {", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#mmap\">mmap</a><span class=\"ts\"/><span class=\"ts\"/>= <a class=\"id\" href=\"#shm_mmap\">shm_mmap</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#fsync\">fsync</a><span class=\"ts\"/><span class=\"ts\"/>= <a class=\"id\" href=\"#shm_fsync\">shm_fsync</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#release\">release</a><span class=\"ts\"/>= <a class=\"id\" href=\"#shm_release\">shm_release</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#get_unmapped_area\">get_unmapped_area</a><span class=\"ts\"/>= <a class=\"id\" href=\"#shm_get_unmapped_area\">shm_get_unmapped_area</a>,", 
"};", 
"", 
"int <a class=\"id\" href=\"#is_file_shm_hugepages\">is_file_shm_hugepages</a>(struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#file\">file</a>)", 
"{", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#f_op\">f_op</a> == &amp;<a class=\"id\" href=\"#shm_file_operations_huge\">shm_file_operations_huge</a>;", 
"}", 
"", 
"static const struct <a class=\"id\" href=\"#vm_operations_struct\">vm_operations_struct</a> <a class=\"id\" href=\"#shm_vm_ops\">shm_vm_ops</a> = {", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#open\">open</a><span class=\"ts\"/>= <a class=\"id\" href=\"#shm_open\">shm_open</a>,<span class=\"ts\"/><span class=\"comment\">/* callback for a new vm-area open */</span>", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#close\">close</a><span class=\"ts\"/>= <a class=\"id\" href=\"#shm_close\">shm_close</a>,<span class=\"ts\"/><span class=\"comment\">/* callback for when the vm-area is released */</span>", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#fault\">fault</a><span class=\"ts\"/>= <a class=\"id\" href=\"#shm_fault\">shm_fault</a>,", 
"#if <a class=\"id\" href=\"#defined\">defined</a>(<a class=\"id\" href=\"#CONFIG_NUMA\">CONFIG_NUMA</a>)", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#set_policy\">set_policy</a> = <a class=\"id\" href=\"#shm_set_policy\">shm_set_policy</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#get_policy\">get_policy</a> = <a class=\"id\" href=\"#shm_get_policy\">shm_get_policy</a>,", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
"};", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * newseg - Create a new shared memory segment</span>", 
"<span class=\"comment\"> * @ns: namespace</span>", 
"<span class=\"comment\"> * @params: ptr to the structure that contains key, size and shmflg</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Called with shm_ids.rw_mutex held as a writer.</span>", 
"<span class=\"comment\"> */</span>", 
"", 
"static int <a class=\"id\" href=\"#newseg\">newseg</a>(struct <a class=\"id\" href=\"#ipc_namespace\">ipc_namespace</a> *<a class=\"id\" href=\"#ns\">ns</a>, struct <a class=\"id\" href=\"#ipc_params\">ipc_params</a> *<a class=\"id\" href=\"#params\">params</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#key_t\">key_t</a> <a class=\"id\" href=\"#key\">key</a> = <a class=\"id\" href=\"#params\">params</a>-><a class=\"id\" href=\"#key\">key</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#shmflg\">shmflg</a> = <a class=\"id\" href=\"#params\">params</a>-><a class=\"id\" href=\"#flg\">flg</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#size_t\">size_t</a> <a class=\"id\" href=\"#size\">size</a> = <a class=\"id\" href=\"#params\">params</a>-><a class=\"id\" href=\"#u\">u</a>.<a class=\"id\" href=\"#size\">size</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#error\">error</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#shmid_kernel\">shmid_kernel</a> *<a class=\"id\" href=\"#shp\">shp</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#numpages\">numpages</a> = (<a class=\"id\" href=\"#size\">size</a> + <a class=\"id\" href=\"#PAGE_SIZE\">PAGE_SIZE</a> -1) >> <a class=\"id\" href=\"#PAGE_SHIFT\">PAGE_SHIFT</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#file\">file</a> * <a class=\"id\" href=\"#file\">file</a>;", 
"<span class=\"ts\"/>char <a class=\"id\" href=\"#name\">name</a>[13];", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#id\">id</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#acctflag\">acctflag</a> = 0;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#size\">size</a> &lt; <a class=\"id\" href=\"#SHMMIN\">SHMMIN</a> || <a class=\"id\" href=\"#size\">size</a> &gt; <a class=\"id\" href=\"#ns\">ns</a>-><a class=\"id\" href=\"#shm_ctlmax\">shm_ctlmax</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#ns\">ns</a>-><a class=\"id\" href=\"#shm_tot\">shm_tot</a> + <a class=\"id\" href=\"#numpages\">numpages</a> &gt; <a class=\"id\" href=\"#ns\">ns</a>-><a class=\"id\" href=\"#shm_ctlall\">shm_ctlall</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOSPC\">ENOSPC</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shp\">shp</a> = <a class=\"id\" href=\"#ipc_rcu_alloc\">ipc_rcu_alloc</a>(sizeof(*<a class=\"id\" href=\"#shp\">shp</a>));", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#shp\">shp</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_perm\">shm_perm</a>.<a class=\"id\" href=\"#key\">key</a> = <a class=\"id\" href=\"#key\">key</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_perm\">shm_perm</a>.<a class=\"id\" href=\"#mode\">mode</a> = (<a class=\"id\" href=\"#shmflg\">shmflg</a> &amp; <a class=\"id\" href=\"#S_IRWXUGO\">S_IRWXUGO</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#mlock_user\">mlock_user</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_perm\">shm_perm</a>.<a class=\"id\" href=\"#security\">security</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#error\">error</a> = <a class=\"id\" href=\"#security_shm_alloc\">security_shm_alloc</a>(<a class=\"id\" href=\"#shp\">shp</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#error\">error</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ipc_rcu_putref\">ipc_rcu_putref</a>(<a class=\"id\" href=\"#shp\">shp</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#error\">error</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#sprintf\">sprintf</a> (<a class=\"id\" href=\"#name\">name</a>, \"SYSV%08x\", <a class=\"id\" href=\"#key\">key</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#shmflg\">shmflg</a> &amp; <a class=\"id\" href=\"#SHM_HUGETLB\">SHM_HUGETLB</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* hugetlb_file_setup applies strict accounting */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#shmflg\">shmflg</a> &amp; <a class=\"id\" href=\"#SHM_NORESERVE\">SHM_NORESERVE</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#acctflag\">acctflag</a> = <a class=\"id\" href=\"#VM_NORESERVE\">VM_NORESERVE</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#file\">file</a> = <a class=\"id\" href=\"#hugetlb_file_setup\">hugetlb_file_setup</a>(<a class=\"id\" href=\"#name\">name</a>, <a class=\"id\" href=\"#size\">size</a>, <a class=\"id\" href=\"#acctflag\">acctflag</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>&amp;<a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#mlock_user\">mlock_user</a>, <a class=\"id\" href=\"#HUGETLB_SHMFS_INODE\">HUGETLB_SHMFS_INODE</a>);", 
"<span class=\"ts\"/>} else {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * Do not allow no accounting for OVERCOMMIT_NEVER, even</span>", 
"<span class=\"comment\"><span class=\"ts\"/> <span class=\"ts\"/> * if it's asked for.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>if  ((<a class=\"id\" href=\"#shmflg\">shmflg</a> &amp; <a class=\"id\" href=\"#SHM_NORESERVE\">SHM_NORESERVE</a>) &&", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#sysctl_overcommit_memory\">sysctl_overcommit_memory</a> != <a class=\"id\" href=\"#OVERCOMMIT_NEVER\">OVERCOMMIT_NEVER</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#acctflag\">acctflag</a> = <a class=\"id\" href=\"#VM_NORESERVE\">VM_NORESERVE</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#file\">file</a> = <a class=\"id\" href=\"#shmem_file_setup\">shmem_file_setup</a>(<a class=\"id\" href=\"#name\">name</a>, <a class=\"id\" href=\"#size\">size</a>, <a class=\"id\" href=\"#acctflag\">acctflag</a>);", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#error\">error</a> = <a class=\"id\" href=\"#PTR_ERR\">PTR_ERR</a>(<a class=\"id\" href=\"#file\">file</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#IS_ERR\">IS_ERR</a>(<a class=\"id\" href=\"#file\">file</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#no_file\">no_file</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#id\">id</a> = <a class=\"id\" href=\"#ipc_addid\">ipc_addid</a>(&amp;<a class=\"id\" href=\"#shm_ids\">shm_ids</a>(<a class=\"id\" href=\"#ns\">ns</a>), &amp;<a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_perm\">shm_perm</a>, <a class=\"id\" href=\"#ns\">ns</a>-><a class=\"id\" href=\"#shm_ctlmni\">shm_ctlmni</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#id\">id</a> &lt; 0) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#error\">error</a> = <a class=\"id\" href=\"#id\">id</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#no_id\">no_id</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_cprid\">shm_cprid</a> = <a class=\"id\" href=\"#task_tgid_vnr\">task_tgid_vnr</a>(<a class=\"id\" href=\"#current\">current</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_lprid\">shm_lprid</a> = 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_atim\">shm_atim</a> = <a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_dtim\">shm_dtim</a> = 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_ctim\">shm_ctim</a> = <a class=\"id\" href=\"#get_seconds\">get_seconds</a>();", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_segsz\">shm_segsz</a> = <a class=\"id\" href=\"#size\">size</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_nattch\">shm_nattch</a> = 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_file\">shm_file</a> = <a class=\"id\" href=\"#file\">file</a>;", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * shmid gets reported as \"inode#\" in /proc/pid/maps.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * proc-ps tools use this. Changing this will break them.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#f_dentry\">f_dentry</a>-><a class=\"id\" href=\"#d_inode\">d_inode</a>-><a class=\"id\" href=\"#i_ino\">i_ino</a> = <a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_perm\">shm_perm</a>.<a class=\"id\" href=\"#id\">id</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ns\">ns</a>-><a class=\"id\" href=\"#shm_tot\">shm_tot</a> += <a class=\"id\" href=\"#numpages\">numpages</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#error\">error</a> = <a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_perm\">shm_perm</a>.<a class=\"id\" href=\"#id\">id</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shm_unlock\">shm_unlock</a>(<a class=\"id\" href=\"#shp\">shp</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#error\">error</a>;", 
"", 
"<a class=\"id\" href=\"#no_id\">no_id</a>:", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#is_file_hugepages\">is_file_hugepages</a>(<a class=\"id\" href=\"#file\">file</a>) && <a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#mlock_user\">mlock_user</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#user_shm_unlock\">user_shm_unlock</a>(<a class=\"id\" href=\"#size\">size</a>, <a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#mlock_user\">mlock_user</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#fput\">fput</a>(<a class=\"id\" href=\"#file\">file</a>);", 
"<a class=\"id\" href=\"#no_file\">no_file</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#security_shm_free\">security_shm_free</a>(<a class=\"id\" href=\"#shp\">shp</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ipc_rcu_putref\">ipc_rcu_putref</a>(<a class=\"id\" href=\"#shp\">shp</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#error\">error</a>;", 
"}", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Called with shm_ids.rw_mutex and ipcp locked.</span>", 
"<span class=\"comment\"> */</span>", 
"static <a class=\"id\" href=\"#inline\">inline</a> int <a class=\"id\" href=\"#shm_security\">shm_security</a>(struct <a class=\"id\" href=\"#kern_ipc_perm\">kern_ipc_perm</a> *<a class=\"id\" href=\"#ipcp\">ipcp</a>, int <a class=\"id\" href=\"#shmflg\">shmflg</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#shmid_kernel\">shmid_kernel</a> *<a class=\"id\" href=\"#shp\">shp</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shp\">shp</a> = <a class=\"id\" href=\"#container_of\">container_of</a>(<a class=\"id\" href=\"#ipcp\">ipcp</a>, struct <a class=\"id\" href=\"#shmid_kernel\">shmid_kernel</a>, <a class=\"id\" href=\"#shm_perm\">shm_perm</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#security_shm_associate\">security_shm_associate</a>(<a class=\"id\" href=\"#shp\">shp</a>, <a class=\"id\" href=\"#shmflg\">shmflg</a>);", 
"}", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Called with shm_ids.rw_mutex and ipcp locked.</span>", 
"<span class=\"comment\"> */</span>", 
"static <a class=\"id\" href=\"#inline\">inline</a> int <a class=\"id\" href=\"#shm_more_checks\">shm_more_checks</a>(struct <a class=\"id\" href=\"#kern_ipc_perm\">kern_ipc_perm</a> *<a class=\"id\" href=\"#ipcp\">ipcp</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#ipc_params\">ipc_params</a> *<a class=\"id\" href=\"#params\">params</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#shmid_kernel\">shmid_kernel</a> *<a class=\"id\" href=\"#shp\">shp</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shp\">shp</a> = <a class=\"id\" href=\"#container_of\">container_of</a>(<a class=\"id\" href=\"#ipcp\">ipcp</a>, struct <a class=\"id\" href=\"#shmid_kernel\">shmid_kernel</a>, <a class=\"id\" href=\"#shm_perm\">shm_perm</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_segsz\">shm_segsz</a> &lt; <a class=\"id\" href=\"#params\">params</a>-><a class=\"id\" href=\"#u\">u</a>.<a class=\"id\" href=\"#size\">size</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"<a class=\"id\" href=\"#SYSCALL_DEFINE3\">SYSCALL_DEFINE3</a>(<a class=\"id\" href=\"#shmget\">shmget</a>, <a class=\"id\" href=\"#key_t\">key_t</a>, <a class=\"id\" href=\"#key\">key</a>, <a class=\"id\" href=\"#size_t\">size_t</a>, <a class=\"id\" href=\"#size\">size</a>, int, <a class=\"id\" href=\"#shmflg\">shmflg</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ipc_namespace\">ipc_namespace</a> *<a class=\"id\" href=\"#ns\">ns</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ipc_ops\">ipc_ops</a> <a class=\"id\" href=\"#shm_ops\">shm_ops</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ipc_params\">ipc_params</a> <a class=\"id\" href=\"#shm_params\">shm_params</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ns\">ns</a> = <a class=\"id\" href=\"#current\">current</a>-><a class=\"id\" href=\"#nsproxy\">nsproxy</a>-><a class=\"id\" href=\"#ipc_ns\">ipc_ns</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shm_ops\">shm_ops</a>.<a class=\"id\" href=\"#getnew\">getnew</a> = <a class=\"id\" href=\"#newseg\">newseg</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shm_ops\">shm_ops</a>.<a class=\"id\" href=\"#associate\">associate</a> = <a class=\"id\" href=\"#shm_security\">shm_security</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shm_ops\">shm_ops</a>.<a class=\"id\" href=\"#more_checks\">more_checks</a> = <a class=\"id\" href=\"#shm_more_checks\">shm_more_checks</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shm_params\">shm_params</a>.<a class=\"id\" href=\"#key\">key</a> = <a class=\"id\" href=\"#key\">key</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shm_params\">shm_params</a>.<a class=\"id\" href=\"#flg\">flg</a> = <a class=\"id\" href=\"#shmflg\">shmflg</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shm_params\">shm_params</a>.<a class=\"id\" href=\"#u\">u</a>.<a class=\"id\" href=\"#size\">size</a> = <a class=\"id\" href=\"#size\">size</a>;", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ipcget\">ipcget</a>(<a class=\"id\" href=\"#ns\">ns</a>, &amp;<a class=\"id\" href=\"#shm_ids\">shm_ids</a>(<a class=\"id\" href=\"#ns\">ns</a>), &amp;<a class=\"id\" href=\"#shm_ops\">shm_ops</a>, &amp;<a class=\"id\" href=\"#shm_params\">shm_params</a>);", 
"}", 
"", 
"static <a class=\"id\" href=\"#inline\">inline</a> unsigned long <a class=\"id\" href=\"#copy_shmid_to_user\">copy_shmid_to_user</a>(void <a class=\"id\" href=\"#__user\">__user</a> *<a class=\"id\" href=\"#buf\">buf</a>, struct <a class=\"id\" href=\"#shmid64_ds\">shmid64_ds</a> *<a class=\"id\" href=\"#in\">in</a>, int <a class=\"id\" href=\"#version\">version</a>)", 
"{", 
"<span class=\"ts\"/>switch(<a class=\"id\" href=\"#version\">version</a>) {", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#IPC_64\">IPC_64</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#copy_to_user\">copy_to_user</a>(<a class=\"id\" href=\"#buf\">buf</a>, <a class=\"id\" href=\"#in\">in</a>, sizeof(*<a class=\"id\" href=\"#in\">in</a>));", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#IPC_OLD\">IPC_OLD</a>:", 
"<span class=\"ts\"/>    {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#shmid_ds\">shmid_ds</a> <a class=\"id\" href=\"#out\">out</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ipc64_perm_to_ipc_perm\">ipc64_perm_to_ipc_perm</a>(&amp;<a class=\"id\" href=\"#in\">in</a>-><a class=\"id\" href=\"#shm_perm\">shm_perm</a>, &amp;<a class=\"id\" href=\"#out\">out</a>.<a class=\"id\" href=\"#shm_perm\">shm_perm</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#out\">out</a>.<a class=\"id\" href=\"#shm_segsz\">shm_segsz</a><span class=\"ts\"/>= <a class=\"id\" href=\"#in\">in</a>-><a class=\"id\" href=\"#shm_segsz\">shm_segsz</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#out\">out</a>.<a class=\"id\" href=\"#shm_atime\">shm_atime</a><span class=\"ts\"/>= <a class=\"id\" href=\"#in\">in</a>-><a class=\"id\" href=\"#shm_atime\">shm_atime</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#out\">out</a>.<a class=\"id\" href=\"#shm_dtime\">shm_dtime</a><span class=\"ts\"/>= <a class=\"id\" href=\"#in\">in</a>-><a class=\"id\" href=\"#shm_dtime\">shm_dtime</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#out\">out</a>.<a class=\"id\" href=\"#shm_ctime\">shm_ctime</a><span class=\"ts\"/>= <a class=\"id\" href=\"#in\">in</a>-><a class=\"id\" href=\"#shm_ctime\">shm_ctime</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#out\">out</a>.<a class=\"id\" href=\"#shm_cpid\">shm_cpid</a><span class=\"ts\"/>= <a class=\"id\" href=\"#in\">in</a>-><a class=\"id\" href=\"#shm_cpid\">shm_cpid</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#out\">out</a>.<a class=\"id\" href=\"#shm_lpid\">shm_lpid</a><span class=\"ts\"/>= <a class=\"id\" href=\"#in\">in</a>-><a class=\"id\" href=\"#shm_lpid\">shm_lpid</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#out\">out</a>.<a class=\"id\" href=\"#shm_nattch\">shm_nattch</a><span class=\"ts\"/>= <a class=\"id\" href=\"#in\">in</a>-><a class=\"id\" href=\"#shm_nattch\">shm_nattch</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#copy_to_user\">copy_to_user</a>(<a class=\"id\" href=\"#buf\">buf</a>, &amp;<a class=\"id\" href=\"#out\">out</a>, sizeof(<a class=\"id\" href=\"#out\">out</a>));", 
"<span class=\"ts\"/>    }", 
"<span class=\"ts\"/>default:", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"<span class=\"ts\"/>}", 
"}", 
"", 
"static <a class=\"id\" href=\"#inline\">inline</a> unsigned long", 
"<a class=\"id\" href=\"#copy_shmid_from_user\">copy_shmid_from_user</a>(struct <a class=\"id\" href=\"#shmid64_ds\">shmid64_ds</a> *<a class=\"id\" href=\"#out\">out</a>, void <a class=\"id\" href=\"#__user\">__user</a> *<a class=\"id\" href=\"#buf\">buf</a>, int <a class=\"id\" href=\"#version\">version</a>)", 
"{", 
"<span class=\"ts\"/>switch(<a class=\"id\" href=\"#version\">version</a>) {", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#IPC_64\">IPC_64</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#copy_from_user\">copy_from_user</a>(<a class=\"id\" href=\"#out\">out</a>, <a class=\"id\" href=\"#buf\">buf</a>, sizeof(*<a class=\"id\" href=\"#out\">out</a>)))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EFAULT\">EFAULT</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#IPC_OLD\">IPC_OLD</a>:", 
"<span class=\"ts\"/>    {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#shmid_ds\">shmid_ds</a> <a class=\"id\" href=\"#tbuf_old\">tbuf_old</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#copy_from_user\">copy_from_user</a>(&amp;<a class=\"id\" href=\"#tbuf_old\">tbuf_old</a>, <a class=\"id\" href=\"#buf\">buf</a>, sizeof(<a class=\"id\" href=\"#tbuf_old\">tbuf_old</a>)))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EFAULT\">EFAULT</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#out\">out</a>-><a class=\"id\" href=\"#shm_perm\">shm_perm</a>.<a class=\"id\" href=\"#uid\">uid</a><span class=\"ts\"/>= <a class=\"id\" href=\"#tbuf_old\">tbuf_old</a>.<a class=\"id\" href=\"#shm_perm\">shm_perm</a>.<a class=\"id\" href=\"#uid\">uid</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#out\">out</a>-><a class=\"id\" href=\"#shm_perm\">shm_perm</a>.<a class=\"id\" href=\"#gid\">gid</a><span class=\"ts\"/>= <a class=\"id\" href=\"#tbuf_old\">tbuf_old</a>.<a class=\"id\" href=\"#shm_perm\">shm_perm</a>.<a class=\"id\" href=\"#gid\">gid</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#out\">out</a>-><a class=\"id\" href=\"#shm_perm\">shm_perm</a>.<a class=\"id\" href=\"#mode\">mode</a><span class=\"ts\"/>= <a class=\"id\" href=\"#tbuf_old\">tbuf_old</a>.<a class=\"id\" href=\"#shm_perm\">shm_perm</a>.<a class=\"id\" href=\"#mode\">mode</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"<span class=\"ts\"/>    }", 
"<span class=\"ts\"/>default:", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"<span class=\"ts\"/>}", 
"}", 
"", 
"static <a class=\"id\" href=\"#inline\">inline</a> unsigned long <a class=\"id\" href=\"#copy_shminfo_to_user\">copy_shminfo_to_user</a>(void <a class=\"id\" href=\"#__user\">__user</a> *<a class=\"id\" href=\"#buf\">buf</a>, struct <a class=\"id\" href=\"#shminfo64\">shminfo64</a> *<a class=\"id\" href=\"#in\">in</a>, int <a class=\"id\" href=\"#version\">version</a>)", 
"{", 
"<span class=\"ts\"/>switch(<a class=\"id\" href=\"#version\">version</a>) {", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#IPC_64\">IPC_64</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#copy_to_user\">copy_to_user</a>(<a class=\"id\" href=\"#buf\">buf</a>, <a class=\"id\" href=\"#in\">in</a>, sizeof(*<a class=\"id\" href=\"#in\">in</a>));", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#IPC_OLD\">IPC_OLD</a>:", 
"<span class=\"ts\"/>    {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#shminfo\">shminfo</a> <a class=\"id\" href=\"#out\">out</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if(<a class=\"id\" href=\"#in\">in</a>-><a class=\"id\" href=\"#shmmax\">shmmax</a> &gt; <a class=\"id\" href=\"#INT_MAX\">INT_MAX</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#out\">out</a>.<a class=\"id\" href=\"#shmmax\">shmmax</a> = <a class=\"id\" href=\"#INT_MAX\">INT_MAX</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>else", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#out\">out</a>.<a class=\"id\" href=\"#shmmax\">shmmax</a> = (int)<a class=\"id\" href=\"#in\">in</a>-><a class=\"id\" href=\"#shmmax\">shmmax</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#out\">out</a>.<a class=\"id\" href=\"#shmmin\">shmmin</a><span class=\"ts\"/>= <a class=\"id\" href=\"#in\">in</a>-><a class=\"id\" href=\"#shmmin\">shmmin</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#out\">out</a>.<a class=\"id\" href=\"#shmmni\">shmmni</a><span class=\"ts\"/>= <a class=\"id\" href=\"#in\">in</a>-><a class=\"id\" href=\"#shmmni\">shmmni</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#out\">out</a>.<a class=\"id\" href=\"#shmseg\">shmseg</a><span class=\"ts\"/>= <a class=\"id\" href=\"#in\">in</a>-><a class=\"id\" href=\"#shmseg\">shmseg</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#out\">out</a>.<a class=\"id\" href=\"#shmall\">shmall</a><span class=\"ts\"/>= <a class=\"id\" href=\"#in\">in</a>-><a class=\"id\" href=\"#shmall\">shmall</a>; ", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#copy_to_user\">copy_to_user</a>(<a class=\"id\" href=\"#buf\">buf</a>, &amp;<a class=\"id\" href=\"#out\">out</a>, sizeof(<a class=\"id\" href=\"#out\">out</a>));", 
"<span class=\"ts\"/>    }", 
"<span class=\"ts\"/>default:", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"<span class=\"ts\"/>}", 
"}", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Called with shm_ids.rw_mutex held as a reader</span>", 
"<span class=\"comment\"> */</span>", 
"static void <a class=\"id\" href=\"#shm_get_stat\">shm_get_stat</a>(struct <a class=\"id\" href=\"#ipc_namespace\">ipc_namespace</a> *<a class=\"id\" href=\"#ns\">ns</a>, unsigned long *<a class=\"id\" href=\"#rss\">rss</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/>unsigned long *<a class=\"id\" href=\"#swp\">swp</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#next_id\">next_id</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#total\">total</a>, <a class=\"id\" href=\"#in_use\">in_use</a>;", 
"", 
"<span class=\"ts\"/>*<a class=\"id\" href=\"#rss\">rss</a> = 0;", 
"<span class=\"ts\"/>*<a class=\"id\" href=\"#swp\">swp</a> = 0;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#in_use\">in_use</a> = <a class=\"id\" href=\"#shm_ids\">shm_ids</a>(<a class=\"id\" href=\"#ns\">ns</a>).<a class=\"id\" href=\"#in_use\">in_use</a>;", 
"", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#total\">total</a> = 0, <a class=\"id\" href=\"#next_id\">next_id</a> = 0; <a class=\"id\" href=\"#total\">total</a> &lt; <a class=\"id\" href=\"#in_use\">in_use</a>; <a class=\"id\" href=\"#next_id\">next_id</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#kern_ipc_perm\">kern_ipc_perm</a> *<a class=\"id\" href=\"#ipc\">ipc</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#shmid_kernel\">shmid_kernel</a> *<a class=\"id\" href=\"#shp\">shp</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#inode\">inode</a> *<a class=\"id\" href=\"#inode\">inode</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ipc\">ipc</a> = <a class=\"id\" href=\"#idr_find\">idr_find</a>(&amp;<a class=\"id\" href=\"#shm_ids\">shm_ids</a>(<a class=\"id\" href=\"#ns\">ns</a>).<a class=\"id\" href=\"#ipcs_idr\">ipcs_idr</a>, <a class=\"id\" href=\"#next_id\">next_id</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#ipc\">ipc</a> == <a class=\"id\" href=\"#NULL\">NULL</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#shp\">shp</a> = <a class=\"id\" href=\"#container_of\">container_of</a>(<a class=\"id\" href=\"#ipc\">ipc</a>, struct <a class=\"id\" href=\"#shmid_kernel\">shmid_kernel</a>, <a class=\"id\" href=\"#shm_perm\">shm_perm</a>);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#inode\">inode</a> = <a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_file\">shm_file</a>-><a class=\"id\" href=\"#f_path\">f_path</a>.<a class=\"id\" href=\"#dentry\">dentry</a>-><a class=\"id\" href=\"#d_inode\">d_inode</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#is_file_hugepages\">is_file_hugepages</a>(<a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_file\">shm_file</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#address_space\">address_space</a> *<a class=\"id\" href=\"#mapping\">mapping</a> = <a class=\"id\" href=\"#inode\">inode</a>-><a class=\"id\" href=\"#i_mapping\">i_mapping</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#hstate\">hstate</a> *<a class=\"id\" href=\"#h\">h</a> = <a class=\"id\" href=\"#hstate_file\">hstate_file</a>(<a class=\"id\" href=\"#shp\">shp</a>-><a class=\"id\" href=\"#shm_file\">shm_file</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>*<a class=\"id\" href=\"#rss\">rss</a> += <a class=\"id\" href=\"#pages_per_huge_page\">pages_per_huge_page</a>(<a class=\"id\" href=\"#h\">h</a>) * <a class=\"id\" href=\"#mapping\">mapping</a>-><a class=\"id\" href=\"#nrpages\">nrpages</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>} else {", 
"#<a class=\"id\" href=\"#ifdef\">ifdef</a> <a class=\"id\" href=\"#CONFIG_SHMEM\">CONFIG_SHMEM</a>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#shmem_inode_info\">shmem_inode_info</a> *<a class=\"id\" href=\"#info\">info</a> = <a class=\"id\" href=\"#SHMEM_I\">SHMEM_I</a>(<a class=\"id\" href=\"#inode\">inode</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_lock\">spin_lock</a>(&amp;<a class=\"id\" href=\"#info\">info</a>-><a class=\"id\" href=\"#lock\">lock</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>*<a class=\"id\" href=\"#rss\">rss</a> += <a class=\"id\" href=\"#inode\">inode</a>-><a class=\"id\" href=\"#i_mapping\">i_mapping</a>-><a class=\"id\" href=\"#nrpages\">nrpages</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>*<a class=\"id\" href=\"#swp\">swp</a> += <a class=\"id\" href=\"#info\">info</a>-><a class=\"id\" href=\"#swapped\">swapped</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock\">spin_unlock</a>(&amp;<a class=\"id\" href=\"#info\">info</a>-><a class=\"id\" href=\"#lock\">lock</a>);", 
"#else", 
];
xr_frag_insert('l/36/a42116903339d4df4aa970f79125359d173ba7.xr', __xr_tmp);
