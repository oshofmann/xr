var __xr_tmp = [
"", 
"<a class=\"id\" href=\"#failed2\">failed2</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#sysfs_remove_link\">sysfs_remove_link</a>(&amp;<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#dev\">dev</a>.<a class=\"id\" href=\"#kobj\">kobj</a>, <a class=\"id\" href=\"#buf\">buf</a>);", 
"<a class=\"id\" href=\"#failed1\">failed1</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_dev_put\">pci_dev_put</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_lock\">mutex_lock</a>(&amp;<a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#sriov\">sriov</a>-><a class=\"id\" href=\"#lock\">lock</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_remove_bus_device\">pci_remove_bus_device</a>(<a class=\"id\" href=\"#virtfn\">virtfn</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#virtfn_remove_bus\">virtfn_remove_bus</a>(<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#bus\">bus</a>, <a class=\"id\" href=\"#virtfn_bus\">virtfn_bus</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#id\">id</a>));", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_unlock\">mutex_unlock</a>(&amp;<a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#sriov\">sriov</a>-><a class=\"id\" href=\"#lock\">lock</a>);", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#rc\">rc</a>;", 
"}", 
"", 
"static void <a class=\"id\" href=\"#virtfn_remove\">virtfn_remove</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>, int <a class=\"id\" href=\"#id\">id</a>, int <a class=\"id\" href=\"#reset\">reset</a>)", 
"{", 
"<span class=\"ts\"/>char <a class=\"id\" href=\"#buf\">buf</a>[<a class=\"id\" href=\"#VIRTFN_ID_LEN\">VIRTFN_ID_LEN</a>];", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#pci_bus\">pci_bus</a> *<a class=\"id\" href=\"#bus\">bus</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#virtfn\">virtfn</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#pci_sriov\">pci_sriov</a> *<a class=\"id\" href=\"#iov\">iov</a> = <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#sriov\">sriov</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bus\">bus</a> = <a class=\"id\" href=\"#pci_find_bus\">pci_find_bus</a>(<a class=\"id\" href=\"#pci_domain_nr\">pci_domain_nr</a>(<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#bus\">bus</a>), <a class=\"id\" href=\"#virtfn_bus\">virtfn_bus</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#id\">id</a>));", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#bus\">bus</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#virtfn\">virtfn</a> = <a class=\"id\" href=\"#pci_get_slot\">pci_get_slot</a>(<a class=\"id\" href=\"#bus\">bus</a>, <a class=\"id\" href=\"#virtfn_devfn\">virtfn_devfn</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#id\">id</a>));", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#virtfn\">virtfn</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_dev_put\">pci_dev_put</a>(<a class=\"id\" href=\"#virtfn\">virtfn</a>);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#reset\">reset</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#device_release_driver\">device_release_driver</a>(&amp;<a class=\"id\" href=\"#virtfn\">virtfn</a>-><a class=\"id\" href=\"#dev\">dev</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#__pci_reset_function\">__pci_reset_function</a>(<a class=\"id\" href=\"#virtfn\">virtfn</a>);", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#sprintf\">sprintf</a>(<a class=\"id\" href=\"#buf\">buf</a>, \"virtfn%u\", <a class=\"id\" href=\"#id\">id</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#sysfs_remove_link\">sysfs_remove_link</a>(&amp;<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#dev\">dev</a>.<a class=\"id\" href=\"#kobj\">kobj</a>, <a class=\"id\" href=\"#buf\">buf</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#sysfs_remove_link\">sysfs_remove_link</a>(&amp;<a class=\"id\" href=\"#virtfn\">virtfn</a>-><a class=\"id\" href=\"#dev\">dev</a>.<a class=\"id\" href=\"#kobj\">kobj</a>, \"physfn\");", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_lock\">mutex_lock</a>(&amp;<a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#sriov\">sriov</a>-><a class=\"id\" href=\"#lock\">lock</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_remove_bus_device\">pci_remove_bus_device</a>(<a class=\"id\" href=\"#virtfn\">virtfn</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#virtfn_remove_bus\">virtfn_remove_bus</a>(<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#bus\">bus</a>, <a class=\"id\" href=\"#virtfn_bus\">virtfn_bus</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#id\">id</a>));", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_unlock\">mutex_unlock</a>(&amp;<a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#sriov\">sriov</a>-><a class=\"id\" href=\"#lock\">lock</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_dev_put\">pci_dev_put</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"}", 
"", 
"static int <a class=\"id\" href=\"#sriov_migration\">sriov_migration</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#status\">status</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#pci_sriov\">pci_sriov</a> *<a class=\"id\" href=\"#iov\">iov</a> = <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#sriov\">sriov</a>;", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#nr_virtfn\">nr_virtfn</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"", 
"<span class=\"ts\"/>if (!(<a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#cap\">cap</a> &amp; <a class=\"id\" href=\"#PCI_SRIOV_CAP_VFM\">PCI_SRIOV_CAP_VFM</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_word\">pci_read_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_SRIOV_STATUS\">PCI_SRIOV_STATUS</a>, &amp;<a class=\"id\" href=\"#status\">status</a>);", 
"<span class=\"ts\"/>if (!(<a class=\"id\" href=\"#status\">status</a> &amp; <a class=\"id\" href=\"#PCI_SRIOV_STATUS_VFM\">PCI_SRIOV_STATUS_VFM</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#schedule_work\">schedule_work</a>(&amp;<a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#mtask\">mtask</a>);", 
"", 
"<span class=\"ts\"/>return 1;", 
"}", 
"", 
"static void <a class=\"id\" href=\"#sriov_migration_task\">sriov_migration_task</a>(struct <a class=\"id\" href=\"#work_struct\">work_struct</a> *<a class=\"id\" href=\"#work\">work</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#i\">i</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u8\">u8</a> <a class=\"id\" href=\"#state\">state</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#status\">status</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#pci_sriov\">pci_sriov</a> *<a class=\"id\" href=\"#iov\">iov</a> = <a class=\"id\" href=\"#container_of\">container_of</a>(<a class=\"id\" href=\"#work\">work</a>, struct <a class=\"id\" href=\"#pci_sriov\">pci_sriov</a>, <a class=\"id\" href=\"#mtask\">mtask</a>);", 
"", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#initial\">initial</a>; <a class=\"id\" href=\"#i\">i</a> &lt; <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#nr_virtfn\">nr_virtfn</a>; <a class=\"id\" href=\"#i\">i</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#state\">state</a> = <a class=\"id\" href=\"#readb\">readb</a>(<a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#mstate\">mstate</a> + <a class=\"id\" href=\"#i\">i</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#state\">state</a> == <a class=\"id\" href=\"#PCI_SRIOV_VFM_MI\">PCI_SRIOV_VFM_MI</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#writeb\">writeb</a>(<a class=\"id\" href=\"#PCI_SRIOV_VFM_AV\">PCI_SRIOV_VFM_AV</a>, <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#mstate\">mstate</a> + <a class=\"id\" href=\"#i\">i</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#state\">state</a> = <a class=\"id\" href=\"#readb\">readb</a>(<a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#mstate\">mstate</a> + <a class=\"id\" href=\"#i\">i</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#state\">state</a> == <a class=\"id\" href=\"#PCI_SRIOV_VFM_AV\">PCI_SRIOV_VFM_AV</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#virtfn_add\">virtfn_add</a>(<a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#self\">self</a>, <a class=\"id\" href=\"#i\">i</a>, 1);", 
"<span class=\"ts\"/><span class=\"ts\"/>} else if (<a class=\"id\" href=\"#state\">state</a> == <a class=\"id\" href=\"#PCI_SRIOV_VFM_MO\">PCI_SRIOV_VFM_MO</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#virtfn_remove\">virtfn_remove</a>(<a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#self\">self</a>, <a class=\"id\" href=\"#i\">i</a>, 1);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#writeb\">writeb</a>(<a class=\"id\" href=\"#PCI_SRIOV_VFM_UA\">PCI_SRIOV_VFM_UA</a>, <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#mstate\">mstate</a> + <a class=\"id\" href=\"#i\">i</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#state\">state</a> = <a class=\"id\" href=\"#readb\">readb</a>(<a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#mstate\">mstate</a> + <a class=\"id\" href=\"#i\">i</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#state\">state</a> == <a class=\"id\" href=\"#PCI_SRIOV_VFM_AV\">PCI_SRIOV_VFM_AV</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#virtfn_add\">virtfn_add</a>(<a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#self\">self</a>, <a class=\"id\" href=\"#i\">i</a>, 0);", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_word\">pci_read_config_word</a>(<a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#self\">self</a>, <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_SRIOV_STATUS\">PCI_SRIOV_STATUS</a>, &amp;<a class=\"id\" href=\"#status\">status</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#status\">status</a> &= ~<a class=\"id\" href=\"#PCI_SRIOV_STATUS_VFM\">PCI_SRIOV_STATUS_VFM</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_word\">pci_write_config_word</a>(<a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#self\">self</a>, <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_SRIOV_STATUS\">PCI_SRIOV_STATUS</a>, <a class=\"id\" href=\"#status\">status</a>);", 
"}", 
"", 
"static int <a class=\"id\" href=\"#sriov_enable_migration\">sriov_enable_migration</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>, int <a class=\"id\" href=\"#nr_virtfn\">nr_virtfn</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#bir\">bir</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#table\">table</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#resource_size_t\">resource_size_t</a> <a class=\"id\" href=\"#pa\">pa</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#pci_sriov\">pci_sriov</a> *<a class=\"id\" href=\"#iov\">iov</a> = <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#sriov\">sriov</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#nr_virtfn\">nr_virtfn</a> <= <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#initial\">initial</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_dword\">pci_read_config_dword</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_SRIOV_VFM\">PCI_SRIOV_VFM</a>, &amp;<a class=\"id\" href=\"#table\">table</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bir\">bir</a> = <a class=\"id\" href=\"#PCI_SRIOV_VFM_BIR\">PCI_SRIOV_VFM_BIR</a>(<a class=\"id\" href=\"#table\">table</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#bir\">bir</a> &gt; <a class=\"id\" href=\"#PCI_STD_RESOURCE_END\">PCI_STD_RESOURCE_END</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EIO\">EIO</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#table\">table</a> = <a class=\"id\" href=\"#PCI_SRIOV_VFM_OFFSET\">PCI_SRIOV_VFM_OFFSET</a>(<a class=\"id\" href=\"#table\">table</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#table\">table</a> + <a class=\"id\" href=\"#nr_virtfn\">nr_virtfn</a> &gt; <a class=\"id\" href=\"#pci_resource_len\">pci_resource_len</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#bir\">bir</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EIO\">EIO</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pa\">pa</a> = <a class=\"id\" href=\"#pci_resource_start\">pci_resource_start</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#bir\">bir</a>) + <a class=\"id\" href=\"#table\">table</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#mstate\">mstate</a> = <a class=\"id\" href=\"#ioremap\">ioremap</a>(<a class=\"id\" href=\"#pa\">pa</a>, <a class=\"id\" href=\"#nr_virtfn\">nr_virtfn</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#mstate\">mstate</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#INIT_WORK\">INIT_WORK</a>(&amp;<a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#mtask\">mtask</a>, <a class=\"id\" href=\"#sriov_migration_task\">sriov_migration_task</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#ctrl\">ctrl</a> |= <a class=\"id\" href=\"#PCI_SRIOV_CTRL_VFM\">PCI_SRIOV_CTRL_VFM</a> | <a class=\"id\" href=\"#PCI_SRIOV_CTRL_INTR\">PCI_SRIOV_CTRL_INTR</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_word\">pci_write_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_SRIOV_CTRL\">PCI_SRIOV_CTRL</a>, <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#ctrl\">ctrl</a>);", 
"", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"static void <a class=\"id\" href=\"#sriov_disable_migration\">sriov_disable_migration</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#pci_sriov\">pci_sriov</a> *<a class=\"id\" href=\"#iov\">iov</a> = <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#sriov\">sriov</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#ctrl\">ctrl</a> &= ~(<a class=\"id\" href=\"#PCI_SRIOV_CTRL_VFM\">PCI_SRIOV_CTRL_VFM</a> | <a class=\"id\" href=\"#PCI_SRIOV_CTRL_INTR\">PCI_SRIOV_CTRL_INTR</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_word\">pci_write_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_SRIOV_CTRL\">PCI_SRIOV_CTRL</a>, <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#ctrl\">ctrl</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#cancel_work_sync\">cancel_work_sync</a>(&amp;<a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#mtask\">mtask</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#iounmap\">iounmap</a>(<a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#mstate\">mstate</a>);", 
"}", 
"", 
"static int <a class=\"id\" href=\"#sriov_enable\">sriov_enable</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>, int <a class=\"id\" href=\"#nr_virtfn\">nr_virtfn</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#rc\">rc</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#i\">i</a>, <a class=\"id\" href=\"#j\">j</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#nres\">nres</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#offset\">offset</a>, <a class=\"id\" href=\"#stride\">stride</a>, <a class=\"id\" href=\"#initial\">initial</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#resource\">resource</a> *<a class=\"id\" href=\"#res\">res</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#pdev\">pdev</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#pci_sriov\">pci_sriov</a> *<a class=\"id\" href=\"#iov\">iov</a> = <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#sriov\">sriov</a>;", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#nr_virtfn\">nr_virtfn</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#nr_virtfn\">nr_virtfn</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_word\">pci_read_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_SRIOV_INITIAL_VF\">PCI_SRIOV_INITIAL_VF</a>, &amp;<a class=\"id\" href=\"#initial\">initial</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#initial\">initial</a> &gt; <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#total\">total</a> ||", 
"<span class=\"ts\"/>    (!(<a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#cap\">cap</a> &amp; <a class=\"id\" href=\"#PCI_SRIOV_CAP_VFM\">PCI_SRIOV_CAP_VFM</a>) && (<a class=\"id\" href=\"#initial\">initial</a> != <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#total\">total</a>)))", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EIO\">EIO</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#nr_virtfn\">nr_virtfn</a> &lt; 0 || <a class=\"id\" href=\"#nr_virtfn\">nr_virtfn</a> &gt; <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#total\">total</a> ||", 
"<span class=\"ts\"/>    (!(<a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#cap\">cap</a> &amp; <a class=\"id\" href=\"#PCI_SRIOV_CAP_VFM\">PCI_SRIOV_CAP_VFM</a>) && (<a class=\"id\" href=\"#nr_virtfn\">nr_virtfn</a> &gt; <a class=\"id\" href=\"#initial\">initial</a>)))", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_word\">pci_write_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_SRIOV_NUM_VF\">PCI_SRIOV_NUM_VF</a>, <a class=\"id\" href=\"#nr_virtfn\">nr_virtfn</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_word\">pci_read_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_SRIOV_VF_OFFSET\">PCI_SRIOV_VF_OFFSET</a>, &amp;<a class=\"id\" href=\"#offset\">offset</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_word\">pci_read_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_SRIOV_VF_STRIDE\">PCI_SRIOV_VF_STRIDE</a>, &amp;<a class=\"id\" href=\"#stride\">stride</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#offset\">offset</a> || (<a class=\"id\" href=\"#nr_virtfn\">nr_virtfn</a> &gt; 1 && !<a class=\"id\" href=\"#stride\">stride</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EIO\">EIO</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#nres\">nres</a> = 0;", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = 0; <a class=\"id\" href=\"#i\">i</a> &lt; <a class=\"id\" href=\"#PCI_SRIOV_NUM_BARS\">PCI_SRIOV_NUM_BARS</a>; <a class=\"id\" href=\"#i\">i</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#res\">res</a> = <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#resource\">resource</a> + <a class=\"id\" href=\"#PCI_IOV_RESOURCES\">PCI_IOV_RESOURCES</a> + <a class=\"id\" href=\"#i\">i</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#res\">res</a>-><a class=\"id\" href=\"#parent\">parent</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#nres\">nres</a>++;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#nres\">nres</a> != <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#nres\">nres</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#dev_err\">dev_err</a>(&amp;<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#dev\">dev</a>, \"not enough MMIO resources for SR-IOV\\n\");", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#offset\">offset</a> = <a class=\"id\" href=\"#offset\">offset</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#stride\">stride</a> = <a class=\"id\" href=\"#stride\">stride</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#virtfn_bus\">virtfn_bus</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#nr_virtfn\">nr_virtfn</a> - 1) &gt; <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#bus\">bus</a>-><a class=\"id\" href=\"#subordinate\">subordinate</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#dev_err\">dev_err</a>(&amp;<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#dev\">dev</a>, \"SR-IOV: bus number out of range\\n\");", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#link\">link</a> != <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#devfn\">devfn</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pdev\">pdev</a> = <a class=\"id\" href=\"#pci_get_slot\">pci_get_slot</a>(<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#bus\">bus</a>, <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#link\">link</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#pdev\">pdev</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENODEV\">ENODEV</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pci_dev_put\">pci_dev_put</a>(<a class=\"id\" href=\"#pdev\">pdev</a>);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#pdev\">pdev</a>-><a class=\"id\" href=\"#is_physfn\">is_physfn</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENODEV\">ENODEV</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rc\">rc</a> = <a class=\"id\" href=\"#sysfs_create_link\">sysfs_create_link</a>(&amp;<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#dev\">dev</a>.<a class=\"id\" href=\"#kobj\">kobj</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>&amp;<a class=\"id\" href=\"#pdev\">pdev</a>-><a class=\"id\" href=\"#dev\">dev</a>.<a class=\"id\" href=\"#kobj\">kobj</a>, \"dep_link\");", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#rc\">rc</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#rc\">rc</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#ctrl\">ctrl</a> |= <a class=\"id\" href=\"#PCI_SRIOV_CTRL_VFE\">PCI_SRIOV_CTRL_VFE</a> | <a class=\"id\" href=\"#PCI_SRIOV_CTRL_MSE\">PCI_SRIOV_CTRL_MSE</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_block_user_cfg_access\">pci_block_user_cfg_access</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_word\">pci_write_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_SRIOV_CTRL\">PCI_SRIOV_CTRL</a>, <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#ctrl\">ctrl</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#msleep\">msleep</a>(100);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_unblock_user_cfg_access\">pci_unblock_user_cfg_access</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#initial\">initial</a> = <a class=\"id\" href=\"#initial\">initial</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#nr_virtfn\">nr_virtfn</a> &lt; <a class=\"id\" href=\"#initial\">initial</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#initial\">initial</a> = <a class=\"id\" href=\"#nr_virtfn\">nr_virtfn</a>;", 
"", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = 0; <a class=\"id\" href=\"#i\">i</a> &lt; <a class=\"id\" href=\"#initial\">initial</a>; <a class=\"id\" href=\"#i\">i</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rc\">rc</a> = <a class=\"id\" href=\"#virtfn_add\">virtfn_add</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#i\">i</a>, 0);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#rc\">rc</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#failed\">failed</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#cap\">cap</a> &amp; <a class=\"id\" href=\"#PCI_SRIOV_CAP_VFM\">PCI_SRIOV_CAP_VFM</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rc\">rc</a> = <a class=\"id\" href=\"#sriov_enable_migration\">sriov_enable_migration</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#nr_virtfn\">nr_virtfn</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#rc\">rc</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#failed\">failed</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kobject_uevent\">kobject_uevent</a>(&amp;<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#dev\">dev</a>.<a class=\"id\" href=\"#kobj\">kobj</a>, <a class=\"id\" href=\"#KOBJ_CHANGE\">KOBJ_CHANGE</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#nr_virtfn\">nr_virtfn</a> = <a class=\"id\" href=\"#nr_virtfn\">nr_virtfn</a>;", 
"", 
"<span class=\"ts\"/>return 0;", 
"", 
"<a class=\"id\" href=\"#failed\">failed</a>:", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#j\">j</a> = 0; <a class=\"id\" href=\"#j\">j</a> &lt; <a class=\"id\" href=\"#i\">i</a>; <a class=\"id\" href=\"#j\">j</a>++)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#virtfn_remove\">virtfn_remove</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#j\">j</a>, 0);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#ctrl\">ctrl</a> &= ~(<a class=\"id\" href=\"#PCI_SRIOV_CTRL_VFE\">PCI_SRIOV_CTRL_VFE</a> | <a class=\"id\" href=\"#PCI_SRIOV_CTRL_MSE\">PCI_SRIOV_CTRL_MSE</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_block_user_cfg_access\">pci_block_user_cfg_access</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_word\">pci_write_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_SRIOV_CTRL\">PCI_SRIOV_CTRL</a>, <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#ctrl\">ctrl</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ssleep\">ssleep</a>(1);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_unblock_user_cfg_access\">pci_unblock_user_cfg_access</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#link\">link</a> != <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#devfn\">devfn</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#sysfs_remove_link\">sysfs_remove_link</a>(&amp;<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#dev\">dev</a>.<a class=\"id\" href=\"#kobj\">kobj</a>, \"dep_link\");", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#rc\">rc</a>;", 
"}", 
"", 
"static void <a class=\"id\" href=\"#sriov_disable\">sriov_disable</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#i\">i</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#pci_sriov\">pci_sriov</a> *<a class=\"id\" href=\"#iov\">iov</a> = <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#sriov\">sriov</a>;", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#nr_virtfn\">nr_virtfn</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#cap\">cap</a> &amp; <a class=\"id\" href=\"#PCI_SRIOV_CAP_VFM\">PCI_SRIOV_CAP_VFM</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#sriov_disable_migration\">sriov_disable_migration</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = 0; <a class=\"id\" href=\"#i\">i</a> &lt; <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#nr_virtfn\">nr_virtfn</a>; <a class=\"id\" href=\"#i\">i</a>++)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#virtfn_remove\">virtfn_remove</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#i\">i</a>, 0);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#ctrl\">ctrl</a> &= ~(<a class=\"id\" href=\"#PCI_SRIOV_CTRL_VFE\">PCI_SRIOV_CTRL_VFE</a> | <a class=\"id\" href=\"#PCI_SRIOV_CTRL_MSE\">PCI_SRIOV_CTRL_MSE</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_block_user_cfg_access\">pci_block_user_cfg_access</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_word\">pci_write_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_SRIOV_CTRL\">PCI_SRIOV_CTRL</a>, <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#ctrl\">ctrl</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ssleep\">ssleep</a>(1);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_unblock_user_cfg_access\">pci_unblock_user_cfg_access</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#link\">link</a> != <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#devfn\">devfn</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#sysfs_remove_link\">sysfs_remove_link</a>(&amp;<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#dev\">dev</a>.<a class=\"id\" href=\"#kobj\">kobj</a>, \"dep_link\");", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#nr_virtfn\">nr_virtfn</a> = 0;", 
"}", 
"", 
"static int <a class=\"id\" href=\"#sriov_init\">sriov_init</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>, int <a class=\"id\" href=\"#pos\">pos</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#i\">i</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#rc\">rc</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#nres\">nres</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#pgsz\">pgsz</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#ctrl\">ctrl</a>, <a class=\"id\" href=\"#total\">total</a>, <a class=\"id\" href=\"#offset\">offset</a>, <a class=\"id\" href=\"#stride\">stride</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#pci_sriov\">pci_sriov</a> *<a class=\"id\" href=\"#iov\">iov</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#resource\">resource</a> *<a class=\"id\" href=\"#res\">res</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#pdev\">pdev</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#pcie_type\">pcie_type</a> != <a class=\"id\" href=\"#PCI_EXP_TYPE_RC_END\">PCI_EXP_TYPE_RC_END</a> &&", 
"<span class=\"ts\"/>    <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#pcie_type\">pcie_type</a> != <a class=\"id\" href=\"#PCI_EXP_TYPE_ENDPOINT\">PCI_EXP_TYPE_ENDPOINT</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENODEV\">ENODEV</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_word\">pci_read_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_SRIOV_CTRL\">PCI_SRIOV_CTRL</a>, &amp;<a class=\"id\" href=\"#ctrl\">ctrl</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#ctrl\">ctrl</a> &amp; <a class=\"id\" href=\"#PCI_SRIOV_CTRL_VFE\">PCI_SRIOV_CTRL_VFE</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_word\">pci_write_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_SRIOV_CTRL\">PCI_SRIOV_CTRL</a>, 0);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ssleep\">ssleep</a>(1);", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_word\">pci_read_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_SRIOV_TOTAL_VF\">PCI_SRIOV_TOTAL_VF</a>, &amp;<a class=\"id\" href=\"#total\">total</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#total\">total</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ctrl\">ctrl</a> = 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_for_each_entry\">list_for_each_entry</a>(<a class=\"id\" href=\"#pdev\">pdev</a>, &amp;<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#bus\">bus</a>-><a class=\"id\" href=\"#devices\">devices</a>, <a class=\"id\" href=\"#bus_list\">bus_list</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#pdev\">pdev</a>-><a class=\"id\" href=\"#is_physfn\">is_physfn</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#found\">found</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pdev\">pdev</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#pci_ari_enabled\">pci_ari_enabled</a>(<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#bus\">bus</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ctrl\">ctrl</a> |= <a class=\"id\" href=\"#PCI_SRIOV_CTRL_ARI\">PCI_SRIOV_CTRL_ARI</a>;", 
"", 
"<a class=\"id\" href=\"#found\">found</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_word\">pci_write_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_SRIOV_CTRL\">PCI_SRIOV_CTRL</a>, <a class=\"id\" href=\"#ctrl\">ctrl</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_word\">pci_write_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_SRIOV_NUM_VF\">PCI_SRIOV_NUM_VF</a>, <a class=\"id\" href=\"#total\">total</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_word\">pci_read_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_SRIOV_VF_OFFSET\">PCI_SRIOV_VF_OFFSET</a>, &amp;<a class=\"id\" href=\"#offset\">offset</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_word\">pci_read_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_SRIOV_VF_STRIDE\">PCI_SRIOV_VF_STRIDE</a>, &amp;<a class=\"id\" href=\"#stride\">stride</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#offset\">offset</a> || (<a class=\"id\" href=\"#total\">total</a> &gt; 1 && !<a class=\"id\" href=\"#stride\">stride</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EIO\">EIO</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_dword\">pci_read_config_dword</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_SRIOV_SUP_PGSIZE\">PCI_SRIOV_SUP_PGSIZE</a>, &amp;<a class=\"id\" href=\"#pgsz\">pgsz</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#i\">i</a> = <a class=\"id\" href=\"#PAGE_SHIFT\">PAGE_SHIFT</a> &gt; 12 ? <a class=\"id\" href=\"#PAGE_SHIFT\">PAGE_SHIFT</a> - 12 : 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pgsz\">pgsz</a> &= ~((1 << <a class=\"id\" href=\"#i\">i</a>) - 1);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#pgsz\">pgsz</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EIO\">EIO</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pgsz\">pgsz</a> &= ~(<a class=\"id\" href=\"#pgsz\">pgsz</a> - 1);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_dword\">pci_write_config_dword</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_SRIOV_SYS_PGSIZE\">PCI_SRIOV_SYS_PGSIZE</a>, <a class=\"id\" href=\"#pgsz\">pgsz</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#nres\">nres</a> = 0;", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = 0; <a class=\"id\" href=\"#i\">i</a> &lt; <a class=\"id\" href=\"#PCI_SRIOV_NUM_BARS\">PCI_SRIOV_NUM_BARS</a>; <a class=\"id\" href=\"#i\">i</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#res\">res</a> = <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#resource\">resource</a> + <a class=\"id\" href=\"#PCI_IOV_RESOURCES\">PCI_IOV_RESOURCES</a> + <a class=\"id\" href=\"#i\">i</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#i\">i</a> += <a class=\"id\" href=\"#__pci_read_base\">__pci_read_base</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pci_bar_unknown\">pci_bar_unknown</a>, <a class=\"id\" href=\"#res\">res</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>     <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_SRIOV_BAR\">PCI_SRIOV_BAR</a> + <a class=\"id\" href=\"#i\">i</a> * 4);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#res\">res</a>-><a class=\"id\" href=\"#flags\">flags</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#resource_size\">resource_size</a>(<a class=\"id\" href=\"#res\">res</a>) &amp; (<a class=\"id\" href=\"#PAGE_SIZE\">PAGE_SIZE</a> - 1)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rc\">rc</a> = -<a class=\"id\" href=\"#EIO\">EIO</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#failed\">failed</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#res\">res</a>-><a class=\"id\" href=\"#end\">end</a> = <a class=\"id\" href=\"#res\">res</a>-><a class=\"id\" href=\"#start\">start</a> + <a class=\"id\" href=\"#resource_size\">resource_size</a>(<a class=\"id\" href=\"#res\">res</a>) * <a class=\"id\" href=\"#total\">total</a> - 1;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#nres\">nres</a>++;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#iov\">iov</a> = <a class=\"id\" href=\"#kzalloc\">kzalloc</a>(sizeof(*<a class=\"id\" href=\"#iov\">iov</a>), <a class=\"id\" href=\"#GFP_KERNEL\">GFP_KERNEL</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#iov\">iov</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rc\">rc</a> = -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#failed\">failed</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#pos\">pos</a> = <a class=\"id\" href=\"#pos\">pos</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#nres\">nres</a> = <a class=\"id\" href=\"#nres\">nres</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#ctrl\">ctrl</a> = <a class=\"id\" href=\"#ctrl\">ctrl</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#total\">total</a> = <a class=\"id\" href=\"#total\">total</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#offset\">offset</a> = <a class=\"id\" href=\"#offset\">offset</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#stride\">stride</a> = <a class=\"id\" href=\"#stride\">stride</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#pgsz\">pgsz</a> = <a class=\"id\" href=\"#pgsz\">pgsz</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#self\">self</a> = <a class=\"id\" href=\"#dev\">dev</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_dword\">pci_read_config_dword</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_SRIOV_CAP\">PCI_SRIOV_CAP</a>, &amp;<a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#cap\">cap</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_byte\">pci_read_config_byte</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_SRIOV_FUNC_LINK\">PCI_SRIOV_FUNC_LINK</a>, &amp;<a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#link\">link</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#pcie_type\">pcie_type</a> == <a class=\"id\" href=\"#PCI_EXP_TYPE_RC_END\">PCI_EXP_TYPE_RC_END</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#link\">link</a> = <a class=\"id\" href=\"#PCI_DEVFN\">PCI_DEVFN</a>(<a class=\"id\" href=\"#PCI_SLOT\">PCI_SLOT</a>(<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#devfn\">devfn</a>), <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#link\">link</a>);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#pdev\">pdev</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#dev\">dev</a> = <a class=\"id\" href=\"#pci_dev_get\">pci_dev_get</a>(<a class=\"id\" href=\"#pdev\">pdev</a>);", 
"<span class=\"ts\"/>else", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#dev\">dev</a> = <a class=\"id\" href=\"#dev\">dev</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_init\">mutex_init</a>(&amp;<a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#lock\">lock</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#sriov\">sriov</a> = <a class=\"id\" href=\"#iov\">iov</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#is_physfn\">is_physfn</a> = 1;", 
"", 
"<span class=\"ts\"/>return 0;", 
"", 
"<a class=\"id\" href=\"#failed\">failed</a>:", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = 0; <a class=\"id\" href=\"#i\">i</a> &lt; <a class=\"id\" href=\"#PCI_SRIOV_NUM_BARS\">PCI_SRIOV_NUM_BARS</a>; <a class=\"id\" href=\"#i\">i</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#res\">res</a> = <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#resource\">resource</a> + <a class=\"id\" href=\"#PCI_IOV_RESOURCES\">PCI_IOV_RESOURCES</a> + <a class=\"id\" href=\"#i\">i</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#res\">res</a>-><a class=\"id\" href=\"#flags\">flags</a> = 0;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#rc\">rc</a>;", 
"}", 
"", 
"static void <a class=\"id\" href=\"#sriov_release\">sriov_release</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#BUG_ON\">BUG_ON</a>(<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#sriov\">sriov</a>-><a class=\"id\" href=\"#nr_virtfn\">nr_virtfn</a>);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#dev\">dev</a> != <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#sriov\">sriov</a>-><a class=\"id\" href=\"#dev\">dev</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pci_dev_put\">pci_dev_put</a>(<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#sriov\">sriov</a>-><a class=\"id\" href=\"#dev\">dev</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_destroy\">mutex_destroy</a>(&amp;<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#sriov\">sriov</a>-><a class=\"id\" href=\"#lock\">lock</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#sriov\">sriov</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#sriov\">sriov</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"}", 
"", 
"static void <a class=\"id\" href=\"#sriov_restore_state\">sriov_restore_state</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#i\">i</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#ctrl\">ctrl</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#pci_sriov\">pci_sriov</a> *<a class=\"id\" href=\"#iov\">iov</a> = <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#sriov\">sriov</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_word\">pci_read_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_SRIOV_CTRL\">PCI_SRIOV_CTRL</a>, &amp;<a class=\"id\" href=\"#ctrl\">ctrl</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#ctrl\">ctrl</a> &amp; <a class=\"id\" href=\"#PCI_SRIOV_CTRL_VFE\">PCI_SRIOV_CTRL_VFE</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = <a class=\"id\" href=\"#PCI_IOV_RESOURCES\">PCI_IOV_RESOURCES</a>; <a class=\"id\" href=\"#i\">i</a> <= <a class=\"id\" href=\"#PCI_IOV_RESOURCE_END\">PCI_IOV_RESOURCE_END</a>; <a class=\"id\" href=\"#i\">i</a>++)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pci_update_resource\">pci_update_resource</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#i\">i</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_dword\">pci_write_config_dword</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_SRIOV_SYS_PGSIZE\">PCI_SRIOV_SYS_PGSIZE</a>, <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#pgsz\">pgsz</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_word\">pci_write_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_SRIOV_NUM_VF\">PCI_SRIOV_NUM_VF</a>, <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#nr_virtfn\">nr_virtfn</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_word\">pci_write_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_SRIOV_CTRL\">PCI_SRIOV_CTRL</a>, <a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#ctrl\">ctrl</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#iov\">iov</a>-><a class=\"id\" href=\"#ctrl\">ctrl</a> &amp; <a class=\"id\" href=\"#PCI_SRIOV_CTRL_VFE\">PCI_SRIOV_CTRL_VFE</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msleep\">msleep</a>(100);", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * pci_iov_init - initialize the IOV capability</span>", 
"<span class=\"comment\"> * @dev: the PCI device</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Returns 0 on success, or negative on failure.</span>", 
"<span class=\"comment\"> */</span>", 
"int <a class=\"id\" href=\"#pci_iov_init\">pci_iov_init</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#pos\">pos</a>;", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#pci_is_pcie\">pci_is_pcie</a>(<a class=\"id\" href=\"#dev\">dev</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENODEV\">ENODEV</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pos\">pos</a> = <a class=\"id\" href=\"#pci_find_ext_capability\">pci_find_ext_capability</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#PCI_EXT_CAP_ID_SRIOV\">PCI_EXT_CAP_ID_SRIOV</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#pos\">pos</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#sriov_init\">sriov_init</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a>);", 
"", 
"<span class=\"ts\"/>return -<a class=\"id\" href=\"#ENODEV\">ENODEV</a>;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * pci_iov_release - release resources used by the IOV capability</span>", 
"<span class=\"comment\"> * @dev: the PCI device</span>", 
"<span class=\"comment\"> */</span>", 
"void <a class=\"id\" href=\"#pci_iov_release\">pci_iov_release</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#is_physfn\">is_physfn</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#sriov_release\">sriov_release</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * pci_iov_resource_bar - get position of the SR-IOV BAR</span>", 
"<span class=\"comment\"> * @dev: the PCI device</span>", 
"<span class=\"comment\"> * @resno: the resource number</span>", 
"<span class=\"comment\"> * @type: the BAR type to be filled in</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Returns position of the BAR encapsulated in the SR-IOV capability.</span>", 
"<span class=\"comment\"> */</span>", 
"int <a class=\"id\" href=\"#pci_iov_resource_bar\">pci_iov_resource_bar</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>, int <a class=\"id\" href=\"#resno\">resno</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> enum <a class=\"id\" href=\"#pci_bar_type\">pci_bar_type</a> *<a class=\"id\" href=\"#type\">type</a>)", 
"{", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#resno\">resno</a> &lt; <a class=\"id\" href=\"#PCI_IOV_RESOURCES\">PCI_IOV_RESOURCES</a> || <a class=\"id\" href=\"#resno\">resno</a> &gt; <a class=\"id\" href=\"#PCI_IOV_RESOURCE_END\">PCI_IOV_RESOURCE_END</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#BUG_ON\">BUG_ON</a>(!<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#is_physfn\">is_physfn</a>);", 
"", 
"<span class=\"ts\"/>*<a class=\"id\" href=\"#type\">type</a> = <a class=\"id\" href=\"#pci_bar_unknown\">pci_bar_unknown</a>;", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#sriov\">sriov</a>-><a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_SRIOV_BAR\">PCI_SRIOV_BAR</a> +", 
"<span class=\"ts\"/><span class=\"ts\"/>4 * (<a class=\"id\" href=\"#resno\">resno</a> - <a class=\"id\" href=\"#PCI_IOV_RESOURCES\">PCI_IOV_RESOURCES</a>);", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * pci_sriov_resource_alignment - get resource alignment for VF BAR</span>", 
"<span class=\"comment\"> * @dev: the PCI device</span>", 
"<span class=\"comment\"> * @resno: the resource number</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Returns the alignment of the VF BAR found in the SR-IOV capability.</span>", 
"<span class=\"comment\"> * This is not the same as the resource size which is defined as</span>", 
"<span class=\"comment\"> * the VF BAR size multiplied by the number of VFs.  The alignment</span>", 
"<span class=\"comment\"> * is just the VF BAR size.</span>", 
"<span class=\"comment\"> */</span>", 
"<a class=\"id\" href=\"#resource_size_t\">resource_size_t</a> <a class=\"id\" href=\"#pci_sriov_resource_alignment\">pci_sriov_resource_alignment</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>, int <a class=\"id\" href=\"#resno\">resno</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#resource\">resource</a> <a class=\"id\" href=\"#tmp\">tmp</a>;", 
"<span class=\"ts\"/>enum <a class=\"id\" href=\"#pci_bar_type\">pci_bar_type</a> <a class=\"id\" href=\"#type\">type</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#reg\">reg</a> = <a class=\"id\" href=\"#pci_iov_resource_bar\">pci_iov_resource_bar</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#resno\">resno</a>, &amp;<a class=\"id\" href=\"#type\">type</a>);", 
"<span class=\"ts\"/>", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#reg\">reg</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"", 
"<span class=\"ts\"/> <a class=\"id\" href=\"#__pci_read_base\">__pci_read_base</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#type\">type</a>, &amp;<a class=\"id\" href=\"#tmp\">tmp</a>, <a class=\"id\" href=\"#reg\">reg</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#resource_alignment\">resource_alignment</a>(&amp;<a class=\"id\" href=\"#tmp\">tmp</a>);", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * pci_restore_iov_state - restore the state of the IOV capability</span>", 
"<span class=\"comment\"> * @dev: the PCI device</span>", 
"<span class=\"comment\"> */</span>", 
"void <a class=\"id\" href=\"#pci_restore_iov_state\">pci_restore_iov_state</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#is_physfn\">is_physfn</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#sriov_restore_state\">sriov_restore_state</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * pci_iov_bus_range - find bus range used by Virtual Function</span>", 
"<span class=\"comment\"> * @bus: the PCI bus</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Returns max number of buses (exclude current one) used by Virtual</span>", 
"<span class=\"comment\"> * Functions.</span>", 
"<span class=\"comment\"> */</span>", 
"int <a class=\"id\" href=\"#pci_iov_bus_range\">pci_iov_bus_range</a>(struct <a class=\"id\" href=\"#pci_bus\">pci_bus</a> *<a class=\"id\" href=\"#bus\">bus</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#max\">max</a> = 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u8\">u8</a> <a class=\"id\" href=\"#busnr\">busnr</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_for_each_entry\">list_for_each_entry</a>(<a class=\"id\" href=\"#dev\">dev</a>, &amp;<a class=\"id\" href=\"#bus\">bus</a>-><a class=\"id\" href=\"#devices\">devices</a>, <a class=\"id\" href=\"#bus_list\">bus_list</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#is_physfn\">is_physfn</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#busnr\">busnr</a> = <a class=\"id\" href=\"#virtfn_bus\">virtfn_bus</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#sriov\">sriov</a>-><a class=\"id\" href=\"#total\">total</a> - 1);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#busnr\">busnr</a> &gt; <a class=\"id\" href=\"#max\">max</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#max\">max</a> = <a class=\"id\" href=\"#busnr\">busnr</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#max\">max</a> ? <a class=\"id\" href=\"#max\">max</a> - <a class=\"id\" href=\"#bus\">bus</a>-><a class=\"id\" href=\"#number\">number</a> : 0;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * pci_enable_sriov - enable the SR-IOV capability</span>", 
"<span class=\"comment\"> * @dev: the PCI device</span>", 
"<span class=\"comment\"> * @nr_virtfn: number of virtual functions to enable</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Returns 0 on success, or negative on failure.</span>", 
"<span class=\"comment\"> */</span>", 
"int <a class=\"id\" href=\"#pci_enable_sriov\">pci_enable_sriov</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>, int <a class=\"id\" href=\"#nr_virtfn\">nr_virtfn</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#might_sleep\">might_sleep</a>();", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#is_physfn\">is_physfn</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENODEV\">ENODEV</a>;", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#sriov_enable\">sriov_enable</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#nr_virtfn\">nr_virtfn</a>);", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#pci_enable_sriov\">pci_enable_sriov</a>);", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * pci_disable_sriov - disable the SR-IOV capability</span>", 
"<span class=\"comment\"> * @dev: the PCI device</span>", 
"<span class=\"comment\"> */</span>", 
"void <a class=\"id\" href=\"#pci_disable_sriov\">pci_disable_sriov</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#might_sleep\">might_sleep</a>();", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#is_physfn\">is_physfn</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#sriov_disable\">sriov_disable</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#pci_disable_sriov\">pci_disable_sriov</a>);", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * pci_sriov_migration - notify SR-IOV core of Virtual Function Migration</span>", 
"<span class=\"comment\"> * @dev: the PCI device</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Returns IRQ_HANDLED if the IRQ is handled, or IRQ_NONE if not.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Physical Function driver is responsible to register IRQ handler using</span>", 
"<span class=\"comment\"> * VF Migration Interrupt Message Number, and call this function when the</span>", 
"<span class=\"comment\"> * interrupt is generated by the hardware.</span>", 
"<span class=\"comment\"> */</span>", 
"<a class=\"id\" href=\"#irqreturn_t\">irqreturn_t</a> <a class=\"id\" href=\"#pci_sriov_migration\">pci_sriov_migration</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#is_physfn\">is_physfn</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#IRQ_NONE\">IRQ_NONE</a>;", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#sriov_migration\">sriov_migration</a>(<a class=\"id\" href=\"#dev\">dev</a>) ? <a class=\"id\" href=\"#IRQ_HANDLED\">IRQ_HANDLED</a> : <a class=\"id\" href=\"#IRQ_NONE\">IRQ_NONE</a>;", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#pci_sriov_migration\">pci_sriov_migration</a>);", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * pci_num_vf - return number of VFs associated with a PF device_release_driver</span>", 
"<span class=\"comment\"> * @dev: the PCI device</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Returns number of VFs, or 0 if SR-IOV is not enabled.</span>", 
"<span class=\"comment\"> */</span>", 
"int <a class=\"id\" href=\"#pci_num_vf\">pci_num_vf</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#dev\">dev</a> || !<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#is_physfn\">is_physfn</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"<span class=\"ts\"/>else", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#sriov\">sriov</a>-><a class=\"id\" href=\"#nr_virtfn\">nr_virtfn</a>;", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#pci_num_vf\">pci_num_vf</a>);", 
"", 
"static int <a class=\"id\" href=\"#ats_alloc_one\">ats_alloc_one</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>, int <a class=\"id\" href=\"#ps\">ps</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#pos\">pos</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#cap\">cap</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#pci_ats\">pci_ats</a> *<a class=\"id\" href=\"#ats\">ats</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pos\">pos</a> = <a class=\"id\" href=\"#pci_find_ext_capability\">pci_find_ext_capability</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#PCI_EXT_CAP_ID_ATS\">PCI_EXT_CAP_ID_ATS</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#pos\">pos</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENODEV\">ENODEV</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ats\">ats</a> = <a class=\"id\" href=\"#kzalloc\">kzalloc</a>(sizeof(*<a class=\"id\" href=\"#ats\">ats</a>), <a class=\"id\" href=\"#GFP_KERNEL\">GFP_KERNEL</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#ats\">ats</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ats\">ats</a>-><a class=\"id\" href=\"#pos\">pos</a> = <a class=\"id\" href=\"#pos\">pos</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ats\">ats</a>-><a class=\"id\" href=\"#stu\">stu</a> = <a class=\"id\" href=\"#ps\">ps</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_word\">pci_read_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_ATS_CAP\">PCI_ATS_CAP</a>, &amp;<a class=\"id\" href=\"#cap\">cap</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ats\">ats</a>-><a class=\"id\" href=\"#qdep\">qdep</a> = <a class=\"id\" href=\"#PCI_ATS_CAP_QDEP\">PCI_ATS_CAP_QDEP</a>(<a class=\"id\" href=\"#cap\">cap</a>) ? <a class=\"id\" href=\"#PCI_ATS_CAP_QDEP\">PCI_ATS_CAP_QDEP</a>(<a class=\"id\" href=\"#cap\">cap</a>) :", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>    <a class=\"id\" href=\"#PCI_ATS_MAX_QDEP\">PCI_ATS_MAX_QDEP</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#ats\">ats</a> = <a class=\"id\" href=\"#ats\">ats</a>;", 
"", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"static void <a class=\"id\" href=\"#ats_free_one\">ats_free_one</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#ats\">ats</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#ats\">ats</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * pci_enable_ats - enable the ATS capability</span>", 
"<span class=\"comment\"> * @dev: the PCI device</span>", 
"<span class=\"comment\"> * @ps: the IOMMU page shift</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Returns 0 on success, or negative on failure.</span>", 
"<span class=\"comment\"> */</span>", 
"int <a class=\"id\" href=\"#pci_enable_ats\">pci_enable_ats</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>, int <a class=\"id\" href=\"#ps\">ps</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#rc\">rc</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#ctrl\">ctrl</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#BUG_ON\">BUG_ON</a>(<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#ats\">ats</a> && <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#ats\">ats</a>-><a class=\"id\" href=\"#is_enabled\">is_enabled</a>);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#ps\">ps</a> &lt; <a class=\"id\" href=\"#PCI_ATS_MIN_STU\">PCI_ATS_MIN_STU</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#is_physfn\">is_physfn</a> || <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#is_virtfn\">is_virtfn</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#pdev\">pdev</a> = <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#is_physfn\">is_physfn</a> ? <a class=\"id\" href=\"#dev\">dev</a> : <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#physfn\">physfn</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#mutex_lock\">mutex_lock</a>(&amp;<a class=\"id\" href=\"#pdev\">pdev</a>-><a class=\"id\" href=\"#sriov\">sriov</a>-><a class=\"id\" href=\"#lock\">lock</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#pdev\">pdev</a>-><a class=\"id\" href=\"#ats\">ats</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rc\">rc</a> = <a class=\"id\" href=\"#pdev\">pdev</a>-><a class=\"id\" href=\"#ats\">ats</a>-><a class=\"id\" href=\"#stu\">stu</a> == <a class=\"id\" href=\"#ps\">ps</a> ? 0 : -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>else", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rc\">rc</a> = <a class=\"id\" href=\"#ats_alloc_one\">ats_alloc_one</a>(<a class=\"id\" href=\"#pdev\">pdev</a>, <a class=\"id\" href=\"#ps\">ps</a>);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#rc\">rc</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pdev\">pdev</a>-><a class=\"id\" href=\"#ats\">ats</a>-><a class=\"id\" href=\"#ref_cnt\">ref_cnt</a>++;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#mutex_unlock\">mutex_unlock</a>(&amp;<a class=\"id\" href=\"#pdev\">pdev</a>-><a class=\"id\" href=\"#sriov\">sriov</a>-><a class=\"id\" href=\"#lock\">lock</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#rc\">rc</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#rc\">rc</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#is_physfn\">is_physfn</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rc\">rc</a> = <a class=\"id\" href=\"#ats_alloc_one\">ats_alloc_one</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#ps\">ps</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#rc\">rc</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#rc\">rc</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ctrl\">ctrl</a> = <a class=\"id\" href=\"#PCI_ATS_CTRL_ENABLE\">PCI_ATS_CTRL_ENABLE</a>;", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#is_virtfn\">is_virtfn</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ctrl\">ctrl</a> |= <a class=\"id\" href=\"#PCI_ATS_CTRL_STU\">PCI_ATS_CTRL_STU</a>(<a class=\"id\" href=\"#ps\">ps</a> - <a class=\"id\" href=\"#PCI_ATS_MIN_STU\">PCI_ATS_MIN_STU</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_word\">pci_write_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#ats\">ats</a>-><a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_ATS_CTRL\">PCI_ATS_CTRL</a>, <a class=\"id\" href=\"#ctrl\">ctrl</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#ats\">ats</a>-><a class=\"id\" href=\"#is_enabled\">is_enabled</a> = 1;", 
"", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * pci_disable_ats - disable the ATS capability</span>", 
"<span class=\"comment\"> * @dev: the PCI device</span>", 
"<span class=\"comment\"> */</span>", 
"void <a class=\"id\" href=\"#pci_disable_ats\">pci_disable_ats</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#ctrl\">ctrl</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#BUG_ON\">BUG_ON</a>(!<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#ats\">ats</a> || !<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#ats\">ats</a>-><a class=\"id\" href=\"#is_enabled\">is_enabled</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_word\">pci_read_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#ats\">ats</a>-><a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_ATS_CTRL\">PCI_ATS_CTRL</a>, &amp;<a class=\"id\" href=\"#ctrl\">ctrl</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ctrl\">ctrl</a> &= ~<a class=\"id\" href=\"#PCI_ATS_CTRL_ENABLE\">PCI_ATS_CTRL_ENABLE</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_word\">pci_write_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#ats\">ats</a>-><a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_ATS_CTRL\">PCI_ATS_CTRL</a>, <a class=\"id\" href=\"#ctrl\">ctrl</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#ats\">ats</a>-><a class=\"id\" href=\"#is_enabled\">is_enabled</a> = 0;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#is_physfn\">is_physfn</a> || <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#is_virtfn\">is_virtfn</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#pdev\">pdev</a> = <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#is_physfn\">is_physfn</a> ? <a class=\"id\" href=\"#dev\">dev</a> : <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#physfn\">physfn</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#mutex_lock\">mutex_lock</a>(&amp;<a class=\"id\" href=\"#pdev\">pdev</a>-><a class=\"id\" href=\"#sriov\">sriov</a>-><a class=\"id\" href=\"#lock\">lock</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pdev\">pdev</a>-><a class=\"id\" href=\"#ats\">ats</a>-><a class=\"id\" href=\"#ref_cnt\">ref_cnt</a>--;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#pdev\">pdev</a>-><a class=\"id\" href=\"#ats\">ats</a>-><a class=\"id\" href=\"#ref_cnt\">ref_cnt</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ats_free_one\">ats_free_one</a>(<a class=\"id\" href=\"#pdev\">pdev</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#mutex_unlock\">mutex_unlock</a>(&amp;<a class=\"id\" href=\"#pdev\">pdev</a>-><a class=\"id\" href=\"#sriov\">sriov</a>-><a class=\"id\" href=\"#lock\">lock</a>);", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#is_physfn\">is_physfn</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ats_free_one\">ats_free_one</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * pci_ats_queue_depth - query the ATS Invalidate Queue Depth</span>", 
"<span class=\"comment\"> * @dev: the PCI device</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Returns the queue depth on success, or negative on failure.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * The ATS spec uses 0 in the Invalidate Queue Depth field to</span>", 
"<span class=\"comment\"> * indicate that the function can accept 32 Invalidate Request.</span>", 
"<span class=\"comment\"> * But here we use the `real' values (i.e. 1~32) for the Queue</span>", 
"<span class=\"comment\"> * Depth; and 0 indicates the function shares the Queue with</span>", 
"<span class=\"comment\"> * other functions (doesn't exclusively own a Queue).</span>", 
"<span class=\"comment\"> */</span>", 
"int <a class=\"id\" href=\"#pci_ats_queue_depth\">pci_ats_queue_depth</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#pos\">pos</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#cap\">cap</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#is_virtfn\">is_virtfn</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#ats\">ats</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#ats\">ats</a>-><a class=\"id\" href=\"#qdep\">qdep</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pos\">pos</a> = <a class=\"id\" href=\"#pci_find_ext_capability\">pci_find_ext_capability</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#PCI_EXT_CAP_ID_ATS\">PCI_EXT_CAP_ID_ATS</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#pos\">pos</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENODEV\">ENODEV</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_word\">pci_read_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_ATS_CAP\">PCI_ATS_CAP</a>, &amp;<a class=\"id\" href=\"#cap\">cap</a>);", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#PCI_ATS_CAP_QDEP\">PCI_ATS_CAP_QDEP</a>(<a class=\"id\" href=\"#cap\">cap</a>) ? <a class=\"id\" href=\"#PCI_ATS_CAP_QDEP\">PCI_ATS_CAP_QDEP</a>(<a class=\"id\" href=\"#cap\">cap</a>) :", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       <a class=\"id\" href=\"#PCI_ATS_MAX_QDEP\">PCI_ATS_MAX_QDEP</a>;", 
"}", 
];
xr_frag_insert('l/3e/e57320aa033b54ec3f6a230242763f5ac2cf96.xr', __xr_tmp);
