var __xr_tmp = [
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * vSMPowered(tm) systems specific initialization</span>", 
"<span class=\"comment\"> * Copyright (C) 2005 ScaleMP Inc.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Use of this code is subject to the terms and conditions of the</span>", 
"<span class=\"comment\"> * GNU general public license version 2. See \"COPYING\" or</span>", 
"<span class=\"comment\"> * http://www.gnu.org/licenses/gpl.html</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Ravikiran Thirumalai &lt;kiran@scalemp.com&gt;,</span>", 
"<span class=\"comment\"> * Shai Fultheim &lt;shai@scalemp.com&gt;</span>", 
"<span class=\"comment\"> * Paravirt ops integration: Glauber de Oliveira Costa &lt;gcosta@redhat.com&gt;,</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>     Ravikiran Thirumalai &lt;kiran@scalemp.com&gt;</span>", 
"<span class=\"comment\"> */</span>", 
"", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#init\">init</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#pci_ids\">pci_ids</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#pci_regs\">pci_regs</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#asm\">asm</a>/<a class=\"id\" href=\"#apic\">apic</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#asm\">asm</a>/<a class=\"id\" href=\"#pci\">pci</a>-<a class=\"id\" href=\"#direct\">direct</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#asm\">asm</a>/<a class=\"id\" href=\"#io\">io</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#asm\">asm</a>/<a class=\"id\" href=\"#paravirt\">paravirt</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#asm\">asm</a>/<a class=\"id\" href=\"#setup\">setup</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"", 
"#if <a class=\"id\" href=\"#defined\">defined</a> <a class=\"id\" href=\"#CONFIG_PCI\">CONFIG_PCI</a> && <a class=\"id\" href=\"#defined\">defined</a> <a class=\"id\" href=\"#CONFIG_PARAVIRT\">CONFIG_PARAVIRT</a>", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Interrupt control on vSMPowered systems:</span>", 
"<span class=\"comment\"> * ~AC is a shadow of IF.  If IF is 'on' AC should be 'off'</span>", 
"<span class=\"comment\"> * and vice versa.</span>", 
"<span class=\"comment\"> */</span>", 
"", 
"static unsigned long <a class=\"id\" href=\"#vsmp_save_fl\">vsmp_save_fl</a>(void)", 
"{", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#flags\">flags</a> = <a class=\"id\" href=\"#native_save_fl\">native_save_fl</a>();", 
"", 
"<span class=\"ts\"/>if (!(<a class=\"id\" href=\"#flags\">flags</a> &amp; <a class=\"id\" href=\"#X86_EFLAGS_IF\">X86_EFLAGS_IF</a>) || (<a class=\"id\" href=\"#flags\">flags</a> &amp; <a class=\"id\" href=\"#X86_EFLAGS_AC\">X86_EFLAGS_AC</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#flags\">flags</a> &= ~<a class=\"id\" href=\"#X86_EFLAGS_IF\">X86_EFLAGS_IF</a>;", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#flags\">flags</a>;", 
"}", 
"<a class=\"id\" href=\"#PV_CALLEE_SAVE_REGS_THUNK\">PV_CALLEE_SAVE_REGS_THUNK</a>(<a class=\"id\" href=\"#vsmp_save_fl\">vsmp_save_fl</a>);", 
"", 
"static void <a class=\"id\" href=\"#vsmp_restore_fl\">vsmp_restore_fl</a>(unsigned long <a class=\"id\" href=\"#flags\">flags</a>)", 
"{", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#flags\">flags</a> &amp; <a class=\"id\" href=\"#X86_EFLAGS_IF\">X86_EFLAGS_IF</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#flags\">flags</a> &= ~<a class=\"id\" href=\"#X86_EFLAGS_AC\">X86_EFLAGS_AC</a>;", 
"<span class=\"ts\"/>else", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#flags\">flags</a> |= <a class=\"id\" href=\"#X86_EFLAGS_AC\">X86_EFLAGS_AC</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#native_restore_fl\">native_restore_fl</a>(<a class=\"id\" href=\"#flags\">flags</a>);", 
"}", 
"<a class=\"id\" href=\"#PV_CALLEE_SAVE_REGS_THUNK\">PV_CALLEE_SAVE_REGS_THUNK</a>(<a class=\"id\" href=\"#vsmp_restore_fl\">vsmp_restore_fl</a>);", 
"", 
"static void <a class=\"id\" href=\"#vsmp_irq_disable\">vsmp_irq_disable</a>(void)", 
"{", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#flags\">flags</a> = <a class=\"id\" href=\"#native_save_fl\">native_save_fl</a>();", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#native_restore_fl\">native_restore_fl</a>((<a class=\"id\" href=\"#flags\">flags</a> &amp; ~<a class=\"id\" href=\"#X86_EFLAGS_IF\">X86_EFLAGS_IF</a>) | <a class=\"id\" href=\"#X86_EFLAGS_AC\">X86_EFLAGS_AC</a>);", 
"}", 
"<a class=\"id\" href=\"#PV_CALLEE_SAVE_REGS_THUNK\">PV_CALLEE_SAVE_REGS_THUNK</a>(<a class=\"id\" href=\"#vsmp_irq_disable\">vsmp_irq_disable</a>);", 
"", 
"static void <a class=\"id\" href=\"#vsmp_irq_enable\">vsmp_irq_enable</a>(void)", 
"{", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#flags\">flags</a> = <a class=\"id\" href=\"#native_save_fl\">native_save_fl</a>();", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#native_restore_fl\">native_restore_fl</a>((<a class=\"id\" href=\"#flags\">flags</a> | <a class=\"id\" href=\"#X86_EFLAGS_IF\">X86_EFLAGS_IF</a>) &amp; (~<a class=\"id\" href=\"#X86_EFLAGS_AC\">X86_EFLAGS_AC</a>));", 
"}", 
"<a class=\"id\" href=\"#PV_CALLEE_SAVE_REGS_THUNK\">PV_CALLEE_SAVE_REGS_THUNK</a>(<a class=\"id\" href=\"#vsmp_irq_enable\">vsmp_irq_enable</a>);", 
"", 
"static unsigned <a class=\"id\" href=\"#__init_or_module\">__init_or_module</a> <a class=\"id\" href=\"#vsmp_patch\">vsmp_patch</a>(<a class=\"id\" href=\"#u8\">u8</a> <a class=\"id\" href=\"#type\">type</a>, <a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#clobbers\">clobbers</a>, void *<a class=\"id\" href=\"#ibuf\">ibuf</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>  unsigned long <a class=\"id\" href=\"#addr\">addr</a>, unsigned <a class=\"id\" href=\"#len\">len</a>)", 
"{", 
"<span class=\"ts\"/>switch (<a class=\"id\" href=\"#type\">type</a>) {", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#PARAVIRT_PATCH\">PARAVIRT_PATCH</a>(<a class=\"id\" href=\"#pv_irq_ops\">pv_irq_ops</a>.<a class=\"id\" href=\"#irq_enable\">irq_enable</a>):", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#PARAVIRT_PATCH\">PARAVIRT_PATCH</a>(<a class=\"id\" href=\"#pv_irq_ops\">pv_irq_ops</a>.<a class=\"id\" href=\"#irq_disable\">irq_disable</a>):", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#PARAVIRT_PATCH\">PARAVIRT_PATCH</a>(<a class=\"id\" href=\"#pv_irq_ops\">pv_irq_ops</a>.<a class=\"id\" href=\"#save_fl\">save_fl</a>):", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#PARAVIRT_PATCH\">PARAVIRT_PATCH</a>(<a class=\"id\" href=\"#pv_irq_ops\">pv_irq_ops</a>.<a class=\"id\" href=\"#restore_fl\">restore_fl</a>):", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#paravirt_patch_default\">paravirt_patch_default</a>(<a class=\"id\" href=\"#type\">type</a>, <a class=\"id\" href=\"#clobbers\">clobbers</a>, <a class=\"id\" href=\"#ibuf\">ibuf</a>, <a class=\"id\" href=\"#addr\">addr</a>, <a class=\"id\" href=\"#len\">len</a>);", 
"<span class=\"ts\"/>default:", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#native_patch\">native_patch</a>(<a class=\"id\" href=\"#type\">type</a>, <a class=\"id\" href=\"#clobbers\">clobbers</a>, <a class=\"id\" href=\"#ibuf\">ibuf</a>, <a class=\"id\" href=\"#addr\">addr</a>, <a class=\"id\" href=\"#len\">len</a>);", 
"<span class=\"ts\"/>}", 
"", 
"}", 
"", 
"static void <a class=\"id\" href=\"#__init\">__init</a> <a class=\"id\" href=\"#set_vsmp_pv_ops\">set_vsmp_pv_ops</a>(void)", 
"{", 
"<span class=\"ts\"/>void <a class=\"id\" href=\"#__iomem\">__iomem</a> *<a class=\"id\" href=\"#address\">address</a>;", 
"<span class=\"ts\"/>unsigned int <a class=\"id\" href=\"#cap\">cap</a>, <a class=\"id\" href=\"#ctl\">ctl</a>, <a class=\"id\" href=\"#cfg\">cfg</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* set vSMP magic bits to indicate vSMP capable kernel */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#cfg\">cfg</a> = <a class=\"id\" href=\"#read_pci_config\">read_pci_config</a>(0, 0x1f, 0, <a class=\"id\" href=\"#PCI_BASE_ADDRESS_0\">PCI_BASE_ADDRESS_0</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#address\">address</a> = <a class=\"id\" href=\"#early_ioremap\">early_ioremap</a>(<a class=\"id\" href=\"#cfg\">cfg</a>, 8);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#cap\">cap</a> = <a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#address\">address</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ctl\">ctl</a> = <a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#address\">address</a> + 4);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_INFO\">KERN_INFO</a> \"vSMP CTL: capabilities:0x%08x  control:0x%08x\\n\",", 
"<span class=\"ts\"/>       <a class=\"id\" href=\"#cap\">cap</a>, <a class=\"id\" href=\"#ctl\">ctl</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#cap\">cap</a> &amp; <a class=\"id\" href=\"#ctl\">ctl</a> &amp; (1 << 4)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Setup irq ops and turn on vSMP  IRQ fastpath handling */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pv_irq_ops\">pv_irq_ops</a>.<a class=\"id\" href=\"#irq_disable\">irq_disable</a> = <a class=\"id\" href=\"#PV_CALLEE_SAVE\">PV_CALLEE_SAVE</a>(<a class=\"id\" href=\"#vsmp_irq_disable\">vsmp_irq_disable</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pv_irq_ops\">pv_irq_ops</a>.<a class=\"id\" href=\"#irq_enable\">irq_enable</a>  = <a class=\"id\" href=\"#PV_CALLEE_SAVE\">PV_CALLEE_SAVE</a>(<a class=\"id\" href=\"#vsmp_irq_enable\">vsmp_irq_enable</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pv_irq_ops\">pv_irq_ops</a>.<a class=\"id\" href=\"#save_fl\">save_fl</a>  = <a class=\"id\" href=\"#PV_CALLEE_SAVE\">PV_CALLEE_SAVE</a>(<a class=\"id\" href=\"#vsmp_save_fl\">vsmp_save_fl</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pv_irq_ops\">pv_irq_ops</a>.<a class=\"id\" href=\"#restore_fl\">restore_fl</a>  = <a class=\"id\" href=\"#PV_CALLEE_SAVE\">PV_CALLEE_SAVE</a>(<a class=\"id\" href=\"#vsmp_restore_fl\">vsmp_restore_fl</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pv_init_ops\">pv_init_ops</a>.<a class=\"id\" href=\"#patch\">patch</a> = <a class=\"id\" href=\"#vsmp_patch\">vsmp_patch</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ctl\">ctl</a> &= ~(1 << 4);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#ctl\">ctl</a>, <a class=\"id\" href=\"#address\">address</a> + 4);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ctl\">ctl</a> = <a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#address\">address</a> + 4);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_INFO\">KERN_INFO</a> \"vSMP CTL: control set to:0x%08x\\n\", <a class=\"id\" href=\"#ctl\">ctl</a>);", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#early_iounmap\">early_iounmap</a>(<a class=\"id\" href=\"#address\">address</a>, 8);", 
"}", 
"#else", 
"static void <a class=\"id\" href=\"#__init\">__init</a> <a class=\"id\" href=\"#set_vsmp_pv_ops\">set_vsmp_pv_ops</a>(void)", 
"{", 
"}", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
"", 
"#<a class=\"id\" href=\"#ifdef\">ifdef</a> <a class=\"id\" href=\"#CONFIG_PCI\">CONFIG_PCI</a>", 
"static int <a class=\"id\" href=\"#is_vsmp\">is_vsmp</a> = -1;", 
"", 
"static void <a class=\"id\" href=\"#__init\">__init</a> <a class=\"id\" href=\"#detect_vsmp_box\">detect_vsmp_box</a>(void)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#is_vsmp\">is_vsmp</a> = 0;", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#early_pci_allowed\">early_pci_allowed</a>())", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Check if we are running on a ScaleMP vSMPowered box */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#read_pci_config\">read_pci_config</a>(0, 0x1f, 0, <a class=\"id\" href=\"#PCI_VENDOR_ID\">PCI_VENDOR_ID</a>) ==", 
"<span class=\"ts\"/>     (<a class=\"id\" href=\"#PCI_VENDOR_ID_SCALEMP\">PCI_VENDOR_ID_SCALEMP</a> | (<a class=\"id\" href=\"#PCI_DEVICE_ID_SCALEMP_VSMP_CTL\">PCI_DEVICE_ID_SCALEMP_VSMP_CTL</a> << 16)))", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#is_vsmp\">is_vsmp</a> = 1;", 
"}", 
"", 
"int <a class=\"id\" href=\"#is_vsmp_box\">is_vsmp_box</a>(void)", 
"{", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#is_vsmp\">is_vsmp</a> != -1)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#is_vsmp\">is_vsmp</a>;", 
"<span class=\"ts\"/>else {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#WARN_ON_ONCE\">WARN_ON_ONCE</a>(1);", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"<span class=\"ts\"/>}", 
"}", 
"", 
"#else", 
"static void <a class=\"id\" href=\"#__init\">__init</a> <a class=\"id\" href=\"#detect_vsmp_box\">detect_vsmp_box</a>(void)", 
"{", 
"}", 
"int <a class=\"id\" href=\"#is_vsmp_box\">is_vsmp_box</a>(void)", 
"{", 
"<span class=\"ts\"/>return 0;", 
"}", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
"void <a class=\"id\" href=\"#__init\">__init</a> <a class=\"id\" href=\"#vsmp_init\">vsmp_init</a>(void)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#detect_vsmp_box\">detect_vsmp_box</a>();", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#is_vsmp_box\">is_vsmp_box</a>())", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#set_vsmp_pv_ops\">set_vsmp_pv_ops</a>();", 
"<span class=\"ts\"/>return;", 
"}", 
];
xr_frag_insert('l/3f/f9c56d8f0be410d2ac367b49f3d7ef1e1fc43c.xr', __xr_tmp);
