var __xr_tmp = [
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * bsg.c - block layer implementation of the sg v4 interface</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Copyright (C) 2004 Jens Axboe &lt;axboe@suse.de&gt; SUSE Labs</span>", 
"<span class=\"comment\"> * Copyright (C) 2004 Peter M. Jones &lt;pjones@redhat.com&gt;</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> *  This file is subject to the terms and conditions of the GNU General Public</span>", 
"<span class=\"comment\"> *  License version 2.  See the file \"COPYING\" in the main directory of this</span>", 
"<span class=\"comment\"> *  archive for more details.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> */</span>", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#module\">module</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#init\">init</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#file\">file</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#blkdev\">blkdev</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#poll\">poll</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#cdev\">cdev</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#jiffies\">jiffies</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#percpu\">percpu</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#uio\">uio</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#idr\">idr</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#bsg\">bsg</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#smp_lock\">smp_lock</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#slab\">slab</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#scsi\">scsi</a>/<a class=\"id\" href=\"#scsi\">scsi</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#scsi\">scsi</a>/<a class=\"id\" href=\"#scsi_ioctl\">scsi_ioctl</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#scsi\">scsi</a>/<a class=\"id\" href=\"#scsi_cmnd\">scsi_cmnd</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#scsi\">scsi</a>/<a class=\"id\" href=\"#scsi_device\">scsi_device</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#scsi\">scsi</a>/<a class=\"id\" href=\"#scsi_driver\">scsi_driver</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#scsi\">scsi</a>/<a class=\"id\" href=\"#sg\">sg</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#BSG_DESCRIPTION\">BSG_DESCRIPTION</a><span class=\"ts\"/>\"Block layer SCSI generic (bsg) driver\"", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#BSG_VERSION\">BSG_VERSION</a><span class=\"ts\"/>\"0.4\"", 
"", 
"struct <a class=\"id\" href=\"#bsg_device\">bsg_device</a> {", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#request_queue\">request_queue</a> *<a class=\"id\" href=\"#queue\">queue</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spinlock_t\">spinlock_t</a> <a class=\"id\" href=\"#lock\">lock</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#list_head\">list_head</a> <a class=\"id\" href=\"#busy_list\">busy_list</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#list_head\">list_head</a> <a class=\"id\" href=\"#done_list\">done_list</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#hlist_node\">hlist_node</a> <a class=\"id\" href=\"#dev_list\">dev_list</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#atomic_t\">atomic_t</a> <a class=\"id\" href=\"#ref_count\">ref_count</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#queued_cmds\">queued_cmds</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#done_cmds\">done_cmds</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#wait_queue_head_t\">wait_queue_head_t</a> <a class=\"id\" href=\"#wq_done\">wq_done</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#wait_queue_head_t\">wait_queue_head_t</a> <a class=\"id\" href=\"#wq_free\">wq_free</a>;", 
"<span class=\"ts\"/>char <a class=\"id\" href=\"#name\">name</a>[20];", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#max_queue\">max_queue</a>;", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#flags\">flags</a>;", 
"};", 
"", 
"enum {", 
"<span class=\"ts\"/><a class=\"id\" href=\"#BSG_F_BLOCK\">BSG_F_BLOCK</a><span class=\"ts\"/><span class=\"ts\"/>= 1,", 
"};", 
"", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#BSG_DEFAULT_CMDS\">BSG_DEFAULT_CMDS</a><span class=\"ts\"/>64", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#BSG_MAX_DEVS\">BSG_MAX_DEVS</a><span class=\"ts\"/><span class=\"ts\"/>32768", 
"", 
"#<a class=\"id\" href=\"#undef\">undef</a> <a class=\"id\" href=\"#BSG_DEBUG\">BSG_DEBUG</a>", 
"", 
"#<a class=\"id\" href=\"#ifdef\">ifdef</a> <a class=\"id\" href=\"#BSG_DEBUG\">BSG_DEBUG</a>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#dprintk\">dprintk</a>(<a class=\"id\" href=\"#fmt\">fmt</a>, <a class=\"id\" href=\"#args\">args</a>...) <a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_ERR\">KERN_ERR</a> \"%s: \" <a class=\"id\" href=\"#fmt\">fmt</a>, <a class=\"id\" href=\"#__func__\">__func__</a>, ##<a class=\"id\" href=\"#args\">args</a>)", 
"#else", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#dprintk\">dprintk</a>(<a class=\"id\" href=\"#fmt\">fmt</a>, <a class=\"id\" href=\"#args\">args</a>...)", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
"", 
"static <a class=\"id\" href=\"#DEFINE_MUTEX\">DEFINE_MUTEX</a>(<a class=\"id\" href=\"#bsg_mutex\">bsg_mutex</a>);", 
"static <a class=\"id\" href=\"#DEFINE_IDR\">DEFINE_IDR</a>(<a class=\"id\" href=\"#bsg_minor_idr\">bsg_minor_idr</a>);", 
"", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#BSG_LIST_ARRAY_SIZE\">BSG_LIST_ARRAY_SIZE</a><span class=\"ts\"/>8", 
"static struct <a class=\"id\" href=\"#hlist_head\">hlist_head</a> <a class=\"id\" href=\"#bsg_device_list\">bsg_device_list</a>[<a class=\"id\" href=\"#BSG_LIST_ARRAY_SIZE\">BSG_LIST_ARRAY_SIZE</a>];", 
"", 
"static struct <a class=\"id\" href=\"#class\">class</a> *<a class=\"id\" href=\"#bsg_class\">bsg_class</a>;", 
"static int <a class=\"id\" href=\"#bsg_major\">bsg_major</a>;", 
"", 
"static struct <a class=\"id\" href=\"#kmem_cache\">kmem_cache</a> *<a class=\"id\" href=\"#bsg_cmd_cachep\">bsg_cmd_cachep</a>;", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * our internal command type</span>", 
"<span class=\"comment\"> */</span>", 
"struct <a class=\"id\" href=\"#bsg_command\">bsg_command</a> {", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#bsg_device\">bsg_device</a> *<a class=\"id\" href=\"#bd\">bd</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#list_head\">list_head</a> <a class=\"id\" href=\"#list\">list</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#request\">request</a> *<a class=\"id\" href=\"#rq\">rq</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#bio\">bio</a> *<a class=\"id\" href=\"#bio\">bio</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#bio\">bio</a> *<a class=\"id\" href=\"#bidi_bio\">bidi_bio</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#err\">err</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#sg_io_v4\">sg_io_v4</a> <a class=\"id\" href=\"#hdr\">hdr</a>;", 
"<span class=\"ts\"/>char <a class=\"id\" href=\"#sense\">sense</a>[<a class=\"id\" href=\"#SCSI_SENSE_BUFFERSIZE\">SCSI_SENSE_BUFFERSIZE</a>];", 
"};", 
"", 
"static void <a class=\"id\" href=\"#bsg_free_command\">bsg_free_command</a>(struct <a class=\"id\" href=\"#bsg_command\">bsg_command</a> *<a class=\"id\" href=\"#bc\">bc</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#bsg_device\">bsg_device</a> *<a class=\"id\" href=\"#bd\">bd</a> = <a class=\"id\" href=\"#bc\">bc</a>-><a class=\"id\" href=\"#bd\">bd</a>;", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#flags\">flags</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kmem_cache_free\">kmem_cache_free</a>(<a class=\"id\" href=\"#bsg_cmd_cachep\">bsg_cmd_cachep</a>, <a class=\"id\" href=\"#bc\">bc</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irqsave\">spin_lock_irqsave</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#lock\">lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#queued_cmds\">queued_cmds</a>--;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#lock\">lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#wake_up\">wake_up</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#wq_free\">wq_free</a>);", 
"}", 
"", 
"static struct <a class=\"id\" href=\"#bsg_command\">bsg_command</a> *<a class=\"id\" href=\"#bsg_alloc_command\">bsg_alloc_command</a>(struct <a class=\"id\" href=\"#bsg_device\">bsg_device</a> *<a class=\"id\" href=\"#bd\">bd</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#bsg_command\">bsg_command</a> *<a class=\"id\" href=\"#bc\">bc</a> = <a class=\"id\" href=\"#ERR_PTR\">ERR_PTR</a>(-<a class=\"id\" href=\"#EINVAL\">EINVAL</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irq\">spin_lock_irq</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#lock\">lock</a>);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#queued_cmds\">queued_cmds</a> >= <a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#max_queue\">max_queue</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#queued_cmds\">queued_cmds</a>++;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irq\">spin_unlock_irq</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#lock\">lock</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bc\">bc</a> = <a class=\"id\" href=\"#kmem_cache_zalloc\">kmem_cache_zalloc</a>(<a class=\"id\" href=\"#bsg_cmd_cachep\">bsg_cmd_cachep</a>, <a class=\"id\" href=\"#GFP_KERNEL\">GFP_KERNEL</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#unlikely\">unlikely</a>(!<a class=\"id\" href=\"#bc\">bc</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irq\">spin_lock_irq</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#lock\">lock</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#queued_cmds\">queued_cmds</a>--;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bc\">bc</a> = <a class=\"id\" href=\"#ERR_PTR\">ERR_PTR</a>(-<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bc\">bc</a>-><a class=\"id\" href=\"#bd\">bd</a> = <a class=\"id\" href=\"#bd\">bd</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#INIT_LIST_HEAD\">INIT_LIST_HEAD</a>(&amp;<a class=\"id\" href=\"#bc\">bc</a>-><a class=\"id\" href=\"#list\">list</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dprintk\">dprintk</a>(\"%s: returning free cmd %p\\n\", <a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#name\">name</a>, <a class=\"id\" href=\"#bc\">bc</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#bc\">bc</a>;", 
"<a class=\"id\" href=\"#out\">out</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irq\">spin_unlock_irq</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#lock\">lock</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#bc\">bc</a>;", 
"}", 
"", 
"static <a class=\"id\" href=\"#inline\">inline</a> struct <a class=\"id\" href=\"#hlist_head\">hlist_head</a> *<a class=\"id\" href=\"#bsg_dev_idx_hash\">bsg_dev_idx_hash</a>(int <a class=\"id\" href=\"#index\">index</a>)", 
"{", 
"<span class=\"ts\"/>return &amp;<a class=\"id\" href=\"#bsg_device_list\">bsg_device_list</a>[<a class=\"id\" href=\"#index\">index</a> &amp; (<a class=\"id\" href=\"#BSG_LIST_ARRAY_SIZE\">BSG_LIST_ARRAY_SIZE</a> - 1)];", 
"}", 
"", 
"static int <a class=\"id\" href=\"#bsg_io_schedule\">bsg_io_schedule</a>(struct <a class=\"id\" href=\"#bsg_device\">bsg_device</a> *<a class=\"id\" href=\"#bd\">bd</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#DEFINE_WAIT\">DEFINE_WAIT</a>(<a class=\"id\" href=\"#wait\">wait</a>);", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#ret\">ret</a> = 0;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irq\">spin_lock_irq</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#lock\">lock</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#BUG_ON\">BUG_ON</a>(<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#done_cmds\">done_cmds</a> &gt; <a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#queued_cmds\">queued_cmds</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * -ENOSPC or -ENODATA?  I'm going for -ENODATA, meaning \"I have no</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * work to do\", even though we return -ENOSPC after this same test</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * during bsg_write() -- there, it means our buffer can't have more</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * bsg_commands added to it, thus has no space left.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#done_cmds\">done_cmds</a> == <a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#queued_cmds\">queued_cmds</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = -<a class=\"id\" href=\"#ENODATA\">ENODATA</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#unlock\">unlock</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#test_bit\">test_bit</a>(<a class=\"id\" href=\"#BSG_F_BLOCK\">BSG_F_BLOCK</a>, &amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#flags\">flags</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = -<a class=\"id\" href=\"#EAGAIN\">EAGAIN</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#unlock\">unlock</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#prepare_to_wait\">prepare_to_wait</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#wq_done\">wq_done</a>, &amp;<a class=\"id\" href=\"#wait\">wait</a>, <a class=\"id\" href=\"#TASK_UNINTERRUPTIBLE\">TASK_UNINTERRUPTIBLE</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irq\">spin_unlock_irq</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#lock\">lock</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#io_schedule\">io_schedule</a>();", 
"<span class=\"ts\"/><a class=\"id\" href=\"#finish_wait\">finish_wait</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#wq_done\">wq_done</a>, &amp;<a class=\"id\" href=\"#wait\">wait</a>);", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ret\">ret</a>;", 
"<a class=\"id\" href=\"#unlock\">unlock</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irq\">spin_unlock_irq</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#lock\">lock</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ret\">ret</a>;", 
"}", 
"", 
"static int <a class=\"id\" href=\"#blk_fill_sgv4_hdr_rq\">blk_fill_sgv4_hdr_rq</a>(struct <a class=\"id\" href=\"#request_queue\">request_queue</a> *<a class=\"id\" href=\"#q\">q</a>, struct <a class=\"id\" href=\"#request\">request</a> *<a class=\"id\" href=\"#rq\">rq</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#sg_io_v4\">sg_io_v4</a> *<a class=\"id\" href=\"#hdr\">hdr</a>, struct <a class=\"id\" href=\"#bsg_device\">bsg_device</a> *<a class=\"id\" href=\"#bd\">bd</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#fmode_t\">fmode_t</a> <a class=\"id\" href=\"#has_write_perm\">has_write_perm</a>)", 
"{", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#request_len\">request_len</a> &gt; <a class=\"id\" href=\"#BLK_MAX_CDB\">BLK_MAX_CDB</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#cmd\">cmd</a> = <a class=\"id\" href=\"#kzalloc\">kzalloc</a>(<a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#request_len\">request_len</a>, <a class=\"id\" href=\"#GFP_KERNEL\">GFP_KERNEL</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#cmd\">cmd</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#copy_from_user\">copy_from_user</a>(<a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#cmd\">cmd</a>, (void *)(unsigned long)<a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#request\">request</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>   <a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#request_len\">request_len</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EFAULT\">EFAULT</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#subprotocol\">subprotocol</a> == <a class=\"id\" href=\"#BSG_SUB_PROTOCOL_SCSI_CMD\">BSG_SUB_PROTOCOL_SCSI_CMD</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#blk_verify_command\">blk_verify_command</a>(<a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#cmd\">cmd</a>, <a class=\"id\" href=\"#has_write_perm\">has_write_perm</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EPERM\">EPERM</a>;", 
"<span class=\"ts\"/>} else if (!<a class=\"id\" href=\"#capable\">capable</a>(<a class=\"id\" href=\"#CAP_SYS_RAWIO\">CAP_SYS_RAWIO</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EPERM\">EPERM</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * fill in request structure</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#cmd_len\">cmd_len</a> = <a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#request_len\">request_len</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#cmd_type\">cmd_type</a> = <a class=\"id\" href=\"#REQ_TYPE_BLOCK_PC\">REQ_TYPE_BLOCK_PC</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#timeout\">timeout</a> = <a class=\"id\" href=\"#msecs_to_jiffies\">msecs_to_jiffies</a>(<a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#timeout\">timeout</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#timeout\">timeout</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#timeout\">timeout</a> = <a class=\"id\" href=\"#q\">q</a>-><a class=\"id\" href=\"#sg_timeout\">sg_timeout</a>;", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#timeout\">timeout</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#timeout\">timeout</a> = <a class=\"id\" href=\"#BLK_DEFAULT_SG_TIMEOUT\">BLK_DEFAULT_SG_TIMEOUT</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#timeout\">timeout</a> &lt; <a class=\"id\" href=\"#BLK_MIN_SG_TIMEOUT\">BLK_MIN_SG_TIMEOUT</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#timeout\">timeout</a> = <a class=\"id\" href=\"#BLK_MIN_SG_TIMEOUT\">BLK_MIN_SG_TIMEOUT</a>;", 
"", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Check if sg_io_v4 from user is allowed and valid</span>", 
"<span class=\"comment\"> */</span>", 
"static int", 
"<a class=\"id\" href=\"#bsg_validate_sgv4_hdr\">bsg_validate_sgv4_hdr</a>(struct <a class=\"id\" href=\"#request_queue\">request_queue</a> *<a class=\"id\" href=\"#q\">q</a>, struct <a class=\"id\" href=\"#sg_io_v4\">sg_io_v4</a> *<a class=\"id\" href=\"#hdr\">hdr</a>, int *<a class=\"id\" href=\"#rw\">rw</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#ret\">ret</a> = 0;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#guard\">guard</a> != 'Q')", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"", 
"<span class=\"ts\"/>switch (<a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#protocol\">protocol</a>) {", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#BSG_PROTOCOL_SCSI\">BSG_PROTOCOL_SCSI</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/>switch (<a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#subprotocol\">subprotocol</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>case <a class=\"id\" href=\"#BSG_SUB_PROTOCOL_SCSI_CMD\">BSG_SUB_PROTOCOL_SCSI_CMD</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/>case <a class=\"id\" href=\"#BSG_SUB_PROTOCOL_SCSI_TRANSPORT\">BSG_SUB_PROTOCOL_SCSI_TRANSPORT</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>default:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>default:", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>*<a class=\"id\" href=\"#rw\">rw</a> = <a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#dout_xfer_len\">dout_xfer_len</a> ? <a class=\"id\" href=\"#WRITE\">WRITE</a> : <a class=\"id\" href=\"#READ\">READ</a>;", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ret\">ret</a>;", 
"}", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * map sg_io_v4 to a request.</span>", 
"<span class=\"comment\"> */</span>", 
"static struct <a class=\"id\" href=\"#request\">request</a> *", 
"<a class=\"id\" href=\"#bsg_map_hdr\">bsg_map_hdr</a>(struct <a class=\"id\" href=\"#bsg_device\">bsg_device</a> *<a class=\"id\" href=\"#bd\">bd</a>, struct <a class=\"id\" href=\"#sg_io_v4\">sg_io_v4</a> *<a class=\"id\" href=\"#hdr\">hdr</a>, <a class=\"id\" href=\"#fmode_t\">fmode_t</a> <a class=\"id\" href=\"#has_write_perm\">has_write_perm</a>,", 
"<span class=\"ts\"/>    <a class=\"id\" href=\"#u8\">u8</a> *<a class=\"id\" href=\"#sense\">sense</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#request_queue\">request_queue</a> *<a class=\"id\" href=\"#q\">q</a> = <a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#queue\">queue</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#request\">request</a> *<a class=\"id\" href=\"#rq\">rq</a>, *<a class=\"id\" href=\"#next_rq\">next_rq</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#ret\">ret</a>, <a class=\"id\" href=\"#rw\">rw</a>;", 
"<span class=\"ts\"/>unsigned int <a class=\"id\" href=\"#dxfer_len\">dxfer_len</a>;", 
"<span class=\"ts\"/>void *<a class=\"id\" href=\"#dxferp\">dxferp</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dprintk\">dprintk</a>(\"map hdr %llx/%u %llx/%u\\n\", (unsigned long long) <a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#dout_xferp\">dout_xferp</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#dout_xfer_len\">dout_xfer_len</a>, (unsigned long long) <a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#din_xferp\">din_xferp</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#din_xfer_len\">din_xfer_len</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#bsg_validate_sgv4_hdr\">bsg_validate_sgv4_hdr</a>(<a class=\"id\" href=\"#q\">q</a>, <a class=\"id\" href=\"#hdr\">hdr</a>, &amp;<a class=\"id\" href=\"#rw\">rw</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#ret\">ret</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#ERR_PTR\">ERR_PTR</a>(<a class=\"id\" href=\"#ret\">ret</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * map scatter-gather elements separately and string them to request</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rq\">rq</a> = <a class=\"id\" href=\"#blk_get_request\">blk_get_request</a>(<a class=\"id\" href=\"#q\">q</a>, <a class=\"id\" href=\"#rw\">rw</a>, <a class=\"id\" href=\"#GFP_KERNEL\">GFP_KERNEL</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#rq\">rq</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#ERR_PTR\">ERR_PTR</a>(-<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#blk_fill_sgv4_hdr_rq\">blk_fill_sgv4_hdr_rq</a>(<a class=\"id\" href=\"#q\">q</a>, <a class=\"id\" href=\"#rq\">rq</a>, <a class=\"id\" href=\"#hdr\">hdr</a>, <a class=\"id\" href=\"#bd\">bd</a>, <a class=\"id\" href=\"#has_write_perm\">has_write_perm</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#ret\">ret</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#rw\">rw</a> == <a class=\"id\" href=\"#WRITE\">WRITE</a> && <a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#din_xfer_len\">din_xfer_len</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#test_bit\">test_bit</a>(<a class=\"id\" href=\"#QUEUE_FLAG_BIDI\">QUEUE_FLAG_BIDI</a>, &amp;<a class=\"id\" href=\"#q\">q</a>-><a class=\"id\" href=\"#queue_flags\">queue_flags</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = -<a class=\"id\" href=\"#EOPNOTSUPP\">EOPNOTSUPP</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#next_rq\">next_rq</a> = <a class=\"id\" href=\"#blk_get_request\">blk_get_request</a>(<a class=\"id\" href=\"#q\">q</a>, <a class=\"id\" href=\"#READ\">READ</a>, <a class=\"id\" href=\"#GFP_KERNEL\">GFP_KERNEL</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#next_rq\">next_rq</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#next_rq\">next_rq</a> = <a class=\"id\" href=\"#next_rq\">next_rq</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#next_rq\">next_rq</a>-><a class=\"id\" href=\"#cmd_type\">cmd_type</a> = <a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#cmd_type\">cmd_type</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#dxferp\">dxferp</a> = (void*)(unsigned long)<a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#din_xferp\">din_xferp</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> =  <a class=\"id\" href=\"#blk_rq_map_user\">blk_rq_map_user</a>(<a class=\"id\" href=\"#q\">q</a>, <a class=\"id\" href=\"#next_rq\">next_rq</a>, <a class=\"id\" href=\"#NULL\">NULL</a>, <a class=\"id\" href=\"#dxferp\">dxferp</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       <a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#din_xfer_len\">din_xfer_len</a>, <a class=\"id\" href=\"#GFP_KERNEL\">GFP_KERNEL</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#ret\">ret</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#dout_xfer_len\">dout_xfer_len</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#dxfer_len\">dxfer_len</a> = <a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#dout_xfer_len\">dout_xfer_len</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#dxferp\">dxferp</a> = (void*)(unsigned long)<a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#dout_xferp\">dout_xferp</a>;", 
"<span class=\"ts\"/>} else if (<a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#din_xfer_len\">din_xfer_len</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#dxfer_len\">dxfer_len</a> = <a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#din_xfer_len\">din_xfer_len</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#dxferp\">dxferp</a> = (void*)(unsigned long)<a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#din_xferp\">din_xferp</a>;", 
"<span class=\"ts\"/>} else", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#dxfer_len\">dxfer_len</a> = 0;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#dxfer_len\">dxfer_len</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#blk_rq_map_user\">blk_rq_map_user</a>(<a class=\"id\" href=\"#q\">q</a>, <a class=\"id\" href=\"#rq\">rq</a>, <a class=\"id\" href=\"#NULL\">NULL</a>, <a class=\"id\" href=\"#dxferp\">dxferp</a>, <a class=\"id\" href=\"#dxfer_len\">dxfer_len</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>      <a class=\"id\" href=\"#GFP_KERNEL\">GFP_KERNEL</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#ret\">ret</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#sense\">sense</a> = <a class=\"id\" href=\"#sense\">sense</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#sense_len\">sense_len</a> = 0;", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#rq\">rq</a>;", 
"<a class=\"id\" href=\"#out\">out</a>:", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#cmd\">cmd</a> != <a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#__cmd\">__cmd</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#cmd\">cmd</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#blk_put_request\">blk_put_request</a>(<a class=\"id\" href=\"#rq\">rq</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#next_rq\">next_rq</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#blk_rq_unmap_user\">blk_rq_unmap_user</a>(<a class=\"id\" href=\"#next_rq\">next_rq</a>-><a class=\"id\" href=\"#bio\">bio</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#blk_put_request\">blk_put_request</a>(<a class=\"id\" href=\"#next_rq\">next_rq</a>);", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ERR_PTR\">ERR_PTR</a>(<a class=\"id\" href=\"#ret\">ret</a>);", 
"}", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * async completion call-back from the block layer, when scsi/ide/whatever</span>", 
"<span class=\"comment\"> * calls end_that_request_last() on a request</span>", 
"<span class=\"comment\"> */</span>", 
"static void <a class=\"id\" href=\"#bsg_rq_end_io\">bsg_rq_end_io</a>(struct <a class=\"id\" href=\"#request\">request</a> *<a class=\"id\" href=\"#rq\">rq</a>, int <a class=\"id\" href=\"#uptodate\">uptodate</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#bsg_command\">bsg_command</a> *<a class=\"id\" href=\"#bc\">bc</a> = <a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#end_io_data\">end_io_data</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#bsg_device\">bsg_device</a> *<a class=\"id\" href=\"#bd\">bd</a> = <a class=\"id\" href=\"#bc\">bc</a>-><a class=\"id\" href=\"#bd\">bd</a>;", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#flags\">flags</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dprintk\">dprintk</a>(\"%s: finished rq %p bc %p, bio %p stat %d\\n\",", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#name\">name</a>, <a class=\"id\" href=\"#rq\">rq</a>, <a class=\"id\" href=\"#bc\">bc</a>, <a class=\"id\" href=\"#bc\">bc</a>-><a class=\"id\" href=\"#bio\">bio</a>, <a class=\"id\" href=\"#uptodate\">uptodate</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bc\">bc</a>-><a class=\"id\" href=\"#hdr\">hdr</a>.<a class=\"id\" href=\"#duration\">duration</a> = <a class=\"id\" href=\"#jiffies_to_msecs\">jiffies_to_msecs</a>(<a class=\"id\" href=\"#jiffies\">jiffies</a> - <a class=\"id\" href=\"#bc\">bc</a>-><a class=\"id\" href=\"#hdr\">hdr</a>.<a class=\"id\" href=\"#duration\">duration</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irqsave\">spin_lock_irqsave</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#lock\">lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_move_tail\">list_move_tail</a>(&amp;<a class=\"id\" href=\"#bc\">bc</a>-><a class=\"id\" href=\"#list\">list</a>, &amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#done_list\">done_list</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#done_cmds\">done_cmds</a>++;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#lock\">lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#wake_up\">wake_up</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#wq_done\">wq_done</a>);", 
"}", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * do final setup of a 'bc' and submit the matching 'rq' to the block</span>", 
"<span class=\"comment\"> * layer for io</span>", 
"<span class=\"comment\"> */</span>", 
"static void <a class=\"id\" href=\"#bsg_add_command\">bsg_add_command</a>(struct <a class=\"id\" href=\"#bsg_device\">bsg_device</a> *<a class=\"id\" href=\"#bd\">bd</a>, struct <a class=\"id\" href=\"#request_queue\">request_queue</a> *<a class=\"id\" href=\"#q\">q</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>    struct <a class=\"id\" href=\"#bsg_command\">bsg_command</a> *<a class=\"id\" href=\"#bc\">bc</a>, struct <a class=\"id\" href=\"#request\">request</a> *<a class=\"id\" href=\"#rq\">rq</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#at_head\">at_head</a> = (0 == (<a class=\"id\" href=\"#bc\">bc</a>-><a class=\"id\" href=\"#hdr\">hdr</a>.<a class=\"id\" href=\"#flags\">flags</a> &amp; <a class=\"id\" href=\"#BSG_FLAG_Q_AT_TAIL\">BSG_FLAG_Q_AT_TAIL</a>));", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * add bc command to busy queue and submit rq for io</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bc\">bc</a>-><a class=\"id\" href=\"#rq\">rq</a> = <a class=\"id\" href=\"#rq\">rq</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bc\">bc</a>-><a class=\"id\" href=\"#bio\">bio</a> = <a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#bio\">bio</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#next_rq\">next_rq</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bc\">bc</a>-><a class=\"id\" href=\"#bidi_bio\">bidi_bio</a> = <a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#next_rq\">next_rq</a>-><a class=\"id\" href=\"#bio\">bio</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bc\">bc</a>-><a class=\"id\" href=\"#hdr\">hdr</a>.<a class=\"id\" href=\"#duration\">duration</a> = <a class=\"id\" href=\"#jiffies\">jiffies</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irq\">spin_lock_irq</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#lock\">lock</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_add_tail\">list_add_tail</a>(&amp;<a class=\"id\" href=\"#bc\">bc</a>-><a class=\"id\" href=\"#list\">list</a>, &amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#busy_list\">busy_list</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irq\">spin_unlock_irq</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#lock\">lock</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dprintk\">dprintk</a>(\"%s: queueing rq %p, bc %p\\n\", <a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#name\">name</a>, <a class=\"id\" href=\"#rq\">rq</a>, <a class=\"id\" href=\"#bc\">bc</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#end_io_data\">end_io_data</a> = <a class=\"id\" href=\"#bc\">bc</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#blk_execute_rq_nowait\">blk_execute_rq_nowait</a>(<a class=\"id\" href=\"#q\">q</a>, <a class=\"id\" href=\"#NULL\">NULL</a>, <a class=\"id\" href=\"#rq\">rq</a>, <a class=\"id\" href=\"#at_head\">at_head</a>, <a class=\"id\" href=\"#bsg_rq_end_io\">bsg_rq_end_io</a>);", 
"}", 
"", 
"static struct <a class=\"id\" href=\"#bsg_command\">bsg_command</a> *<a class=\"id\" href=\"#bsg_next_done_cmd\">bsg_next_done_cmd</a>(struct <a class=\"id\" href=\"#bsg_device\">bsg_device</a> *<a class=\"id\" href=\"#bd\">bd</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#bsg_command\">bsg_command</a> *<a class=\"id\" href=\"#bc\">bc</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irq\">spin_lock_irq</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#lock\">lock</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#done_cmds\">done_cmds</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bc\">bc</a> = <a class=\"id\" href=\"#list_first_entry\">list_first_entry</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#done_list\">done_list</a>, struct <a class=\"id\" href=\"#bsg_command\">bsg_command</a>, <a class=\"id\" href=\"#list\">list</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#list_del\">list_del</a>(&amp;<a class=\"id\" href=\"#bc\">bc</a>-><a class=\"id\" href=\"#list\">list</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#done_cmds\">done_cmds</a>--;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irq\">spin_unlock_irq</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#lock\">lock</a>);", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#bc\">bc</a>;", 
"}", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Get a finished command from the done list</span>", 
"<span class=\"comment\"> */</span>", 
"static struct <a class=\"id\" href=\"#bsg_command\">bsg_command</a> *<a class=\"id\" href=\"#bsg_get_done_cmd\">bsg_get_done_cmd</a>(struct <a class=\"id\" href=\"#bsg_device\">bsg_device</a> *<a class=\"id\" href=\"#bd\">bd</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#bsg_command\">bsg_command</a> *<a class=\"id\" href=\"#bc\">bc</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#ret\">ret</a>;", 
"", 
"<span class=\"ts\"/>do {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bc\">bc</a> = <a class=\"id\" href=\"#bsg_next_done_cmd\">bsg_next_done_cmd</a>(<a class=\"id\" href=\"#bd\">bd</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#bc\">bc</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#test_bit\">test_bit</a>(<a class=\"id\" href=\"#BSG_F_BLOCK\">BSG_F_BLOCK</a>, &amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#flags\">flags</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bc\">bc</a> = <a class=\"id\" href=\"#ERR_PTR\">ERR_PTR</a>(-<a class=\"id\" href=\"#EAGAIN\">EAGAIN</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#wait_event_interruptible\">wait_event_interruptible</a>(<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#wq_done\">wq_done</a>, <a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#done_cmds\">done_cmds</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#ret\">ret</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bc\">bc</a> = <a class=\"id\" href=\"#ERR_PTR\">ERR_PTR</a>(-<a class=\"id\" href=\"#ERESTARTSYS\">ERESTARTSYS</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>} while (1);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dprintk\">dprintk</a>(\"%s: returning done %p\\n\", <a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#name\">name</a>, <a class=\"id\" href=\"#bc\">bc</a>);", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#bc\">bc</a>;", 
"}", 
"", 
"static int <a class=\"id\" href=\"#blk_complete_sgv4_hdr_rq\">blk_complete_sgv4_hdr_rq</a>(struct <a class=\"id\" href=\"#request\">request</a> *<a class=\"id\" href=\"#rq\">rq</a>, struct <a class=\"id\" href=\"#sg_io_v4\">sg_io_v4</a> *<a class=\"id\" href=\"#hdr\">hdr</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>    struct <a class=\"id\" href=\"#bio\">bio</a> *<a class=\"id\" href=\"#bio\">bio</a>, struct <a class=\"id\" href=\"#bio\">bio</a> *<a class=\"id\" href=\"#bidi_bio\">bidi_bio</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#ret\">ret</a> = 0;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dprintk\">dprintk</a>(\"rq %p bio %p 0x%x\\n\", <a class=\"id\" href=\"#rq\">rq</a>, <a class=\"id\" href=\"#bio\">bio</a>, <a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#errors\">errors</a>);", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * fill in all the output members</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#device_status\">device_status</a> = <a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#errors\">errors</a> &amp; 0xff;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#transport_status\">transport_status</a> = <a class=\"id\" href=\"#host_byte\">host_byte</a>(<a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#errors\">errors</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#driver_status\">driver_status</a> = <a class=\"id\" href=\"#driver_byte\">driver_byte</a>(<a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#errors\">errors</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#info\">info</a> = 0;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#device_status\">device_status</a> || <a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#transport_status\">transport_status</a> || <a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#driver_status\">driver_status</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#info\">info</a> |= <a class=\"id\" href=\"#SG_INFO_CHECK\">SG_INFO_CHECK</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#response_len\">response_len</a> = 0;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#sense_len\">sense_len</a> && <a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#response\">response</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>int <a class=\"id\" href=\"#len\">len</a> = <a class=\"id\" href=\"#min_t\">min_t</a>(unsigned int, <a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#max_response_len\">max_response_len</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#sense_len\">sense_len</a>);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#copy_to_user\">copy_to_user</a>((void*)(unsigned long)<a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#response\">response</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>   <a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#sense\">sense</a>, <a class=\"id\" href=\"#len\">len</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#ret\">ret</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#response_len\">response_len</a> = <a class=\"id\" href=\"#len\">len</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>else", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = -<a class=\"id\" href=\"#EFAULT\">EFAULT</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#next_rq\">next_rq</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#dout_resid\">dout_resid</a> = <a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#resid_len\">resid_len</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#din_resid\">din_resid</a> = <a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#next_rq\">next_rq</a>-><a class=\"id\" href=\"#resid_len\">resid_len</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#blk_rq_unmap_user\">blk_rq_unmap_user</a>(<a class=\"id\" href=\"#bidi_bio\">bidi_bio</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#blk_put_request\">blk_put_request</a>(<a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#next_rq\">next_rq</a>);", 
"<span class=\"ts\"/>} else if (<a class=\"id\" href=\"#rq_data_dir\">rq_data_dir</a>(<a class=\"id\" href=\"#rq\">rq</a>) == <a class=\"id\" href=\"#READ\">READ</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#din_resid\">din_resid</a> = <a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#resid_len\">resid_len</a>;", 
"<span class=\"ts\"/>else", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#dout_resid\">dout_resid</a> = <a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#resid_len\">resid_len</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * If the request generated a negative error number, return it</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * (providing we aren't already returning an error); if it's</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * just a protocol response (i.e. non negative), that gets</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * processed above.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#ret\">ret</a> && <a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#errors\">errors</a> &lt; 0)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#errors\">errors</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#blk_rq_unmap_user\">blk_rq_unmap_user</a>(<a class=\"id\" href=\"#bio\">bio</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#cmd\">cmd</a> != <a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#__cmd\">__cmd</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#cmd\">cmd</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#blk_put_request\">blk_put_request</a>(<a class=\"id\" href=\"#rq\">rq</a>);", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ret\">ret</a>;", 
"}", 
"", 
"static int <a class=\"id\" href=\"#bsg_complete_all_commands\">bsg_complete_all_commands</a>(struct <a class=\"id\" href=\"#bsg_device\">bsg_device</a> *<a class=\"id\" href=\"#bd\">bd</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#bsg_command\">bsg_command</a> *<a class=\"id\" href=\"#bc\">bc</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#ret\">ret</a>, <a class=\"id\" href=\"#tret\">tret</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dprintk\">dprintk</a>(\"%s: entered\\n\", <a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#name\">name</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * wait for all commands to complete</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = 0;", 
"<span class=\"ts\"/>do {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#bsg_io_schedule\">bsg_io_schedule</a>(<a class=\"id\" href=\"#bd\">bd</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * look for -ENODATA specifically -- we'll sometimes get</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * -ERESTARTSYS when we've taken a signal, but we can't</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * return until we're done freeing the queue, so ignore</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * it.  The signal will get handled when we're done freeing</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * the bsg_device.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/>} while (<a class=\"id\" href=\"#ret\">ret</a> != -<a class=\"id\" href=\"#ENODATA\">ENODATA</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * discard done commands</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = 0;", 
"<span class=\"ts\"/>do {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irq\">spin_lock_irq</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#lock\">lock</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#queued_cmds\">queued_cmds</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irq\">spin_unlock_irq</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#lock\">lock</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irq\">spin_unlock_irq</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#lock\">lock</a>);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bc\">bc</a> = <a class=\"id\" href=\"#bsg_get_done_cmd\">bsg_get_done_cmd</a>(<a class=\"id\" href=\"#bd\">bd</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#IS_ERR\">IS_ERR</a>(<a class=\"id\" href=\"#bc\">bc</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tret\">tret</a> = <a class=\"id\" href=\"#blk_complete_sgv4_hdr_rq\">blk_complete_sgv4_hdr_rq</a>(<a class=\"id\" href=\"#bc\">bc</a>-><a class=\"id\" href=\"#rq\">rq</a>, &amp;<a class=\"id\" href=\"#bc\">bc</a>-><a class=\"id\" href=\"#hdr\">hdr</a>, <a class=\"id\" href=\"#bc\">bc</a>-><a class=\"id\" href=\"#bio\">bio</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bc\">bc</a>-><a class=\"id\" href=\"#bidi_bio\">bidi_bio</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#ret\">ret</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#tret\">tret</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bsg_free_command\">bsg_free_command</a>(<a class=\"id\" href=\"#bc\">bc</a>);", 
"<span class=\"ts\"/>} while (1);", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ret\">ret</a>;", 
"}", 
"", 
"static int", 
"<a class=\"id\" href=\"#__bsg_read\">__bsg_read</a>(char <a class=\"id\" href=\"#__user\">__user</a> *<a class=\"id\" href=\"#buf\">buf</a>, <a class=\"id\" href=\"#size_t\">size_t</a> <a class=\"id\" href=\"#count\">count</a>, struct <a class=\"id\" href=\"#bsg_device\">bsg_device</a> *<a class=\"id\" href=\"#bd\">bd</a>,", 
"<span class=\"ts\"/>   const struct <a class=\"id\" href=\"#iovec\">iovec</a> *<a class=\"id\" href=\"#iov\">iov</a>, <a class=\"id\" href=\"#ssize_t\">ssize_t</a> *<a class=\"id\" href=\"#bytes_read\">bytes_read</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#bsg_command\">bsg_command</a> *<a class=\"id\" href=\"#bc\">bc</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#nr_commands\">nr_commands</a>, <a class=\"id\" href=\"#ret\">ret</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#count\">count</a> % sizeof(struct <a class=\"id\" href=\"#sg_io_v4\">sg_io_v4</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#nr_commands\">nr_commands</a> = <a class=\"id\" href=\"#count\">count</a> / sizeof(struct <a class=\"id\" href=\"#sg_io_v4\">sg_io_v4</a>);", 
"<span class=\"ts\"/>while (<a class=\"id\" href=\"#nr_commands\">nr_commands</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bc\">bc</a> = <a class=\"id\" href=\"#bsg_get_done_cmd\">bsg_get_done_cmd</a>(<a class=\"id\" href=\"#bd\">bd</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#IS_ERR\">IS_ERR</a>(<a class=\"id\" href=\"#bc\">bc</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#PTR_ERR\">PTR_ERR</a>(<a class=\"id\" href=\"#bc\">bc</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * this is the only case where we need to copy data back</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * after completing the request. so do that here,</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * bsg_complete_work() cannot do that for us</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#blk_complete_sgv4_hdr_rq\">blk_complete_sgv4_hdr_rq</a>(<a class=\"id\" href=\"#bc\">bc</a>-><a class=\"id\" href=\"#rq\">rq</a>, &amp;<a class=\"id\" href=\"#bc\">bc</a>-><a class=\"id\" href=\"#hdr\">hdr</a>, <a class=\"id\" href=\"#bc\">bc</a>-><a class=\"id\" href=\"#bio\">bio</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       <a class=\"id\" href=\"#bc\">bc</a>-><a class=\"id\" href=\"#bidi_bio\">bidi_bio</a>);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#copy_to_user\">copy_to_user</a>(<a class=\"id\" href=\"#buf\">buf</a>, &amp;<a class=\"id\" href=\"#bc\">bc</a>-><a class=\"id\" href=\"#hdr\">hdr</a>, sizeof(<a class=\"id\" href=\"#bc\">bc</a>-><a class=\"id\" href=\"#hdr\">hdr</a>)))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = -<a class=\"id\" href=\"#EFAULT\">EFAULT</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bsg_free_command\">bsg_free_command</a>(<a class=\"id\" href=\"#bc\">bc</a>);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#ret\">ret</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#buf\">buf</a> += sizeof(struct <a class=\"id\" href=\"#sg_io_v4\">sg_io_v4</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>*<a class=\"id\" href=\"#bytes_read\">bytes_read</a> += sizeof(struct <a class=\"id\" href=\"#sg_io_v4\">sg_io_v4</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#nr_commands\">nr_commands</a>--;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ret\">ret</a>;", 
"}", 
"", 
"static <a class=\"id\" href=\"#inline\">inline</a> void <a class=\"id\" href=\"#bsg_set_block\">bsg_set_block</a>(struct <a class=\"id\" href=\"#bsg_device\">bsg_device</a> *<a class=\"id\" href=\"#bd\">bd</a>, struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#file\">file</a>)", 
"{", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#f_flags\">f_flags</a> &amp; <a class=\"id\" href=\"#O_NONBLOCK\">O_NONBLOCK</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#clear_bit\">clear_bit</a>(<a class=\"id\" href=\"#BSG_F_BLOCK\">BSG_F_BLOCK</a>, &amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/>else", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#set_bit\">set_bit</a>(<a class=\"id\" href=\"#BSG_F_BLOCK\">BSG_F_BLOCK</a>, &amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#flags\">flags</a>);", 
"}", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Check if the error is a \"real\" error that we should return.</span>", 
"<span class=\"comment\"> */</span>", 
"static <a class=\"id\" href=\"#inline\">inline</a> int <a class=\"id\" href=\"#err_block_err\">err_block_err</a>(int <a class=\"id\" href=\"#ret\">ret</a>)", 
"{", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#ret\">ret</a> && <a class=\"id\" href=\"#ret\">ret</a> != -<a class=\"id\" href=\"#ENOSPC\">ENOSPC</a> && <a class=\"id\" href=\"#ret\">ret</a> != -<a class=\"id\" href=\"#ENODATA\">ENODATA</a> && <a class=\"id\" href=\"#ret\">ret</a> != -<a class=\"id\" href=\"#EAGAIN\">EAGAIN</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return 1;", 
"", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"static <a class=\"id\" href=\"#ssize_t\">ssize_t</a>", 
"<a class=\"id\" href=\"#bsg_read\">bsg_read</a>(struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#file\">file</a>, char <a class=\"id\" href=\"#__user\">__user</a> *<a class=\"id\" href=\"#buf\">buf</a>, <a class=\"id\" href=\"#size_t\">size_t</a> <a class=\"id\" href=\"#count\">count</a>, <a class=\"id\" href=\"#loff_t\">loff_t</a> *<a class=\"id\" href=\"#ppos\">ppos</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#bsg_device\">bsg_device</a> *<a class=\"id\" href=\"#bd\">bd</a> = <a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#ret\">ret</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ssize_t\">ssize_t</a> <a class=\"id\" href=\"#bytes_read\">bytes_read</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dprintk\">dprintk</a>(\"%s: read %Zd bytes\\n\", <a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#name\">name</a>, <a class=\"id\" href=\"#count\">count</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bsg_set_block\">bsg_set_block</a>(<a class=\"id\" href=\"#bd\">bd</a>, <a class=\"id\" href=\"#file\">file</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bytes_read\">bytes_read</a> = 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#__bsg_read\">__bsg_read</a>(<a class=\"id\" href=\"#buf\">buf</a>, <a class=\"id\" href=\"#count\">count</a>, <a class=\"id\" href=\"#bd\">bd</a>, <a class=\"id\" href=\"#NULL\">NULL</a>, &amp;<a class=\"id\" href=\"#bytes_read\">bytes_read</a>);", 
"<span class=\"ts\"/>*<a class=\"id\" href=\"#ppos\">ppos</a> = <a class=\"id\" href=\"#bytes_read\">bytes_read</a>;", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#bytes_read\">bytes_read</a> || (<a class=\"id\" href=\"#bytes_read\">bytes_read</a> && <a class=\"id\" href=\"#err_block_err\">err_block_err</a>(<a class=\"id\" href=\"#ret\">ret</a>)))", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bytes_read\">bytes_read</a> = <a class=\"id\" href=\"#ret\">ret</a>;", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#bytes_read\">bytes_read</a>;", 
"}", 
"", 
"static int <a class=\"id\" href=\"#__bsg_write\">__bsg_write</a>(struct <a class=\"id\" href=\"#bsg_device\">bsg_device</a> *<a class=\"id\" href=\"#bd\">bd</a>, const char <a class=\"id\" href=\"#__user\">__user</a> *<a class=\"id\" href=\"#buf\">buf</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/>       <a class=\"id\" href=\"#size_t\">size_t</a> <a class=\"id\" href=\"#count\">count</a>, <a class=\"id\" href=\"#ssize_t\">ssize_t</a> *<a class=\"id\" href=\"#bytes_written\">bytes_written</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/>       <a class=\"id\" href=\"#fmode_t\">fmode_t</a> <a class=\"id\" href=\"#has_write_perm\">has_write_perm</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#bsg_command\">bsg_command</a> *<a class=\"id\" href=\"#bc\">bc</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#request\">request</a> *<a class=\"id\" href=\"#rq\">rq</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#ret\">ret</a>, <a class=\"id\" href=\"#nr_commands\">nr_commands</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#count\">count</a> % sizeof(struct <a class=\"id\" href=\"#sg_io_v4\">sg_io_v4</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#nr_commands\">nr_commands</a> = <a class=\"id\" href=\"#count\">count</a> / sizeof(struct <a class=\"id\" href=\"#sg_io_v4\">sg_io_v4</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rq\">rq</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bc\">bc</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = 0;", 
"<span class=\"ts\"/>while (<a class=\"id\" href=\"#nr_commands\">nr_commands</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#request_queue\">request_queue</a> *<a class=\"id\" href=\"#q\">q</a> = <a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#queue\">queue</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bc\">bc</a> = <a class=\"id\" href=\"#bsg_alloc_command\">bsg_alloc_command</a>(<a class=\"id\" href=\"#bd\">bd</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#IS_ERR\">IS_ERR</a>(<a class=\"id\" href=\"#bc\">bc</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#PTR_ERR\">PTR_ERR</a>(<a class=\"id\" href=\"#bc\">bc</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bc\">bc</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#copy_from_user\">copy_from_user</a>(&amp;<a class=\"id\" href=\"#bc\">bc</a>-><a class=\"id\" href=\"#hdr\">hdr</a>, <a class=\"id\" href=\"#buf\">buf</a>, sizeof(<a class=\"id\" href=\"#bc\">bc</a>-><a class=\"id\" href=\"#hdr\">hdr</a>))) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = -<a class=\"id\" href=\"#EFAULT\">EFAULT</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * get a request, fill in the blanks, and add to request queue</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rq\">rq</a> = <a class=\"id\" href=\"#bsg_map_hdr\">bsg_map_hdr</a>(<a class=\"id\" href=\"#bd\">bd</a>, &amp;<a class=\"id\" href=\"#bc\">bc</a>-><a class=\"id\" href=\"#hdr\">hdr</a>, <a class=\"id\" href=\"#has_write_perm\">has_write_perm</a>, <a class=\"id\" href=\"#bc\">bc</a>-><a class=\"id\" href=\"#sense\">sense</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#IS_ERR\">IS_ERR</a>(<a class=\"id\" href=\"#rq\">rq</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#PTR_ERR\">PTR_ERR</a>(<a class=\"id\" href=\"#rq\">rq</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rq\">rq</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bsg_add_command\">bsg_add_command</a>(<a class=\"id\" href=\"#bd\">bd</a>, <a class=\"id\" href=\"#q\">q</a>, <a class=\"id\" href=\"#bc\">bc</a>, <a class=\"id\" href=\"#rq\">rq</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bc\">bc</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rq\">rq</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#nr_commands\">nr_commands</a>--;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#buf\">buf</a> += sizeof(struct <a class=\"id\" href=\"#sg_io_v4\">sg_io_v4</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>*<a class=\"id\" href=\"#bytes_written\">bytes_written</a> += sizeof(struct <a class=\"id\" href=\"#sg_io_v4\">sg_io_v4</a>);", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#bc\">bc</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bsg_free_command\">bsg_free_command</a>(<a class=\"id\" href=\"#bc\">bc</a>);", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ret\">ret</a>;", 
"}", 
"", 
"static <a class=\"id\" href=\"#ssize_t\">ssize_t</a>", 
"<a class=\"id\" href=\"#bsg_write\">bsg_write</a>(struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#file\">file</a>, const char <a class=\"id\" href=\"#__user\">__user</a> *<a class=\"id\" href=\"#buf\">buf</a>, <a class=\"id\" href=\"#size_t\">size_t</a> <a class=\"id\" href=\"#count\">count</a>, <a class=\"id\" href=\"#loff_t\">loff_t</a> *<a class=\"id\" href=\"#ppos\">ppos</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#bsg_device\">bsg_device</a> *<a class=\"id\" href=\"#bd\">bd</a> = <a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ssize_t\">ssize_t</a> <a class=\"id\" href=\"#bytes_written\">bytes_written</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#ret\">ret</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dprintk\">dprintk</a>(\"%s: write %Zd bytes\\n\", <a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#name\">name</a>, <a class=\"id\" href=\"#count\">count</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bsg_set_block\">bsg_set_block</a>(<a class=\"id\" href=\"#bd\">bd</a>, <a class=\"id\" href=\"#file\">file</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bytes_written\">bytes_written</a> = 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#__bsg_write\">__bsg_write</a>(<a class=\"id\" href=\"#bd\">bd</a>, <a class=\"id\" href=\"#buf\">buf</a>, <a class=\"id\" href=\"#count\">count</a>, &amp;<a class=\"id\" href=\"#bytes_written\">bytes_written</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>  <a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#f_mode\">f_mode</a> &amp; <a class=\"id\" href=\"#FMODE_WRITE\">FMODE_WRITE</a>);", 
"", 
"<span class=\"ts\"/>*<a class=\"id\" href=\"#ppos\">ppos</a> = <a class=\"id\" href=\"#bytes_written\">bytes_written</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * return bytes written on non-fatal errors</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#bytes_written\">bytes_written</a> || (<a class=\"id\" href=\"#bytes_written\">bytes_written</a> && <a class=\"id\" href=\"#err_block_err\">err_block_err</a>(<a class=\"id\" href=\"#ret\">ret</a>)))", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bytes_written\">bytes_written</a> = <a class=\"id\" href=\"#ret\">ret</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dprintk\">dprintk</a>(\"%s: returning %Zd\\n\", <a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#name\">name</a>, <a class=\"id\" href=\"#bytes_written\">bytes_written</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#bytes_written\">bytes_written</a>;", 
"}", 
"", 
"static struct <a class=\"id\" href=\"#bsg_device\">bsg_device</a> *<a class=\"id\" href=\"#bsg_alloc_device\">bsg_alloc_device</a>(void)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#bsg_device\">bsg_device</a> *<a class=\"id\" href=\"#bd\">bd</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bd\">bd</a> = <a class=\"id\" href=\"#kzalloc\">kzalloc</a>(sizeof(struct <a class=\"id\" href=\"#bsg_device\">bsg_device</a>), <a class=\"id\" href=\"#GFP_KERNEL\">GFP_KERNEL</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#unlikely\">unlikely</a>(!<a class=\"id\" href=\"#bd\">bd</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_init\">spin_lock_init</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#lock\">lock</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#max_queue\">max_queue</a> = <a class=\"id\" href=\"#BSG_DEFAULT_CMDS\">BSG_DEFAULT_CMDS</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#INIT_LIST_HEAD\">INIT_LIST_HEAD</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#busy_list\">busy_list</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#INIT_LIST_HEAD\">INIT_LIST_HEAD</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#done_list\">done_list</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#INIT_HLIST_NODE\">INIT_HLIST_NODE</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#dev_list\">dev_list</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#init_waitqueue_head\">init_waitqueue_head</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#wq_free\">wq_free</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#init_waitqueue_head\">init_waitqueue_head</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#wq_done\">wq_done</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#bd\">bd</a>;", 
"}", 
"", 
"static void <a class=\"id\" href=\"#bsg_kref_release_function\">bsg_kref_release_function</a>(struct <a class=\"id\" href=\"#kref\">kref</a> *<a class=\"id\" href=\"#kref\">kref</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#bsg_class_device\">bsg_class_device</a> *<a class=\"id\" href=\"#bcd\">bcd</a> =", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#container_of\">container_of</a>(<a class=\"id\" href=\"#kref\">kref</a>, struct <a class=\"id\" href=\"#bsg_class_device\">bsg_class_device</a>, <a class=\"id\" href=\"#ref\">ref</a>);", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#device\">device</a> *<a class=\"id\" href=\"#parent\">parent</a> = <a class=\"id\" href=\"#bcd\">bcd</a>-><a class=\"id\" href=\"#parent\">parent</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#bcd\">bcd</a>-><a class=\"id\" href=\"#release\">release</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bcd\">bcd</a>-><a class=\"id\" href=\"#release\">release</a>(<a class=\"id\" href=\"#bcd\">bcd</a>-><a class=\"id\" href=\"#parent\">parent</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#put_device\">put_device</a>(<a class=\"id\" href=\"#parent\">parent</a>);", 
"}", 
"", 
"static int <a class=\"id\" href=\"#bsg_put_device\">bsg_put_device</a>(struct <a class=\"id\" href=\"#bsg_device\">bsg_device</a> *<a class=\"id\" href=\"#bd\">bd</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#ret\">ret</a> = 0, <a class=\"id\" href=\"#do_free\">do_free</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#request_queue\">request_queue</a> *<a class=\"id\" href=\"#q\">q</a> = <a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#queue\">queue</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_lock\">mutex_lock</a>(&amp;<a class=\"id\" href=\"#bsg_mutex\">bsg_mutex</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#do_free\">do_free</a> = <a class=\"id\" href=\"#atomic_dec_and_test\">atomic_dec_and_test</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#ref_count\">ref_count</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#do_free\">do_free</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#mutex_unlock\">mutex_unlock</a>(&amp;<a class=\"id\" href=\"#bsg_mutex\">bsg_mutex</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#hlist_del\">hlist_del</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#dev_list\">dev_list</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_unlock\">mutex_unlock</a>(&amp;<a class=\"id\" href=\"#bsg_mutex\">bsg_mutex</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dprintk\">dprintk</a>(\"%s: tearing down\\n\", <a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#name\">name</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * close can always block</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#set_bit\">set_bit</a>(<a class=\"id\" href=\"#BSG_F_BLOCK\">BSG_F_BLOCK</a>, &amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#flags\">flags</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * correct error detection baddies here again. it's the responsibility</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * of the app to properly reap commands before close() if it wants</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * fool-proof error detection</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#bsg_complete_all_commands\">bsg_complete_all_commands</a>(<a class=\"id\" href=\"#bd\">bd</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#bd\">bd</a>);", 
"<a class=\"id\" href=\"#out\">out</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kref_put\">kref_put</a>(&amp;<a class=\"id\" href=\"#q\">q</a>-><a class=\"id\" href=\"#bsg_dev\">bsg_dev</a>.<a class=\"id\" href=\"#ref\">ref</a>, <a class=\"id\" href=\"#bsg_kref_release_function\">bsg_kref_release_function</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#do_free\">do_free</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#blk_put_queue\">blk_put_queue</a>(<a class=\"id\" href=\"#q\">q</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ret\">ret</a>;", 
"}", 
"", 
"static struct <a class=\"id\" href=\"#bsg_device\">bsg_device</a> *<a class=\"id\" href=\"#bsg_add_device\">bsg_add_device</a>(struct <a class=\"id\" href=\"#inode\">inode</a> *<a class=\"id\" href=\"#inode\">inode</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> struct <a class=\"id\" href=\"#request_queue\">request_queue</a> *<a class=\"id\" href=\"#rq\">rq</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#file\">file</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#bsg_device\">bsg_device</a> *<a class=\"id\" href=\"#bd\">bd</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#ret\">ret</a>;", 
"#<a class=\"id\" href=\"#ifdef\">ifdef</a> <a class=\"id\" href=\"#BSG_DEBUG\">BSG_DEBUG</a>", 
"<span class=\"ts\"/>unsigned char <a class=\"id\" href=\"#buf\">buf</a>[32];", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#blk_get_queue\">blk_get_queue</a>(<a class=\"id\" href=\"#rq\">rq</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#ret\">ret</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#ERR_PTR\">ERR_PTR</a>(-<a class=\"id\" href=\"#ENXIO\">ENXIO</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bd\">bd</a> = <a class=\"id\" href=\"#bsg_alloc_device\">bsg_alloc_device</a>();", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#bd\">bd</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#blk_put_queue\">blk_put_queue</a>(<a class=\"id\" href=\"#rq\">rq</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#ERR_PTR\">ERR_PTR</a>(-<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>);", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#queue\">queue</a> = <a class=\"id\" href=\"#rq\">rq</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bsg_set_block\">bsg_set_block</a>(<a class=\"id\" href=\"#bd\">bd</a>, <a class=\"id\" href=\"#file\">file</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#atomic_set\">atomic_set</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#ref_count\">ref_count</a>, 1);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_lock\">mutex_lock</a>(&amp;<a class=\"id\" href=\"#bsg_mutex\">bsg_mutex</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#hlist_add_head\">hlist_add_head</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#dev_list\">dev_list</a>, <a class=\"id\" href=\"#bsg_dev_idx_hash\">bsg_dev_idx_hash</a>(<a class=\"id\" href=\"#iminor\">iminor</a>(<a class=\"id\" href=\"#inode\">inode</a>)));", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#strncpy\">strncpy</a>(<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#name\">name</a>, <a class=\"id\" href=\"#dev_name\">dev_name</a>(<a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#bsg_dev\">bsg_dev</a>.<a class=\"id\" href=\"#class_dev\">class_dev</a>), sizeof(<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#name\">name</a>) - 1);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dprintk\">dprintk</a>(\"bound to <%s>, max queue %d\\n\",", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#format_dev_t\">format_dev_t</a>(<a class=\"id\" href=\"#buf\">buf</a>, <a class=\"id\" href=\"#inode\">inode</a>-><a class=\"id\" href=\"#i_rdev\">i_rdev</a>), <a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#max_queue\">max_queue</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_unlock\">mutex_unlock</a>(&amp;<a class=\"id\" href=\"#bsg_mutex\">bsg_mutex</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#bd\">bd</a>;", 
"}", 
"", 
"static struct <a class=\"id\" href=\"#bsg_device\">bsg_device</a> *<a class=\"id\" href=\"#__bsg_get_device\">__bsg_get_device</a>(int <a class=\"id\" href=\"#minor\">minor</a>, struct <a class=\"id\" href=\"#request_queue\">request_queue</a> *<a class=\"id\" href=\"#q\">q</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#bsg_device\">bsg_device</a> *<a class=\"id\" href=\"#bd\">bd</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#hlist_node\">hlist_node</a> *<a class=\"id\" href=\"#entry\">entry</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_lock\">mutex_lock</a>(&amp;<a class=\"id\" href=\"#bsg_mutex\">bsg_mutex</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#hlist_for_each_entry\">hlist_for_each_entry</a>(<a class=\"id\" href=\"#bd\">bd</a>, <a class=\"id\" href=\"#entry\">entry</a>, <a class=\"id\" href=\"#bsg_dev_idx_hash\">bsg_dev_idx_hash</a>(<a class=\"id\" href=\"#minor\">minor</a>), <a class=\"id\" href=\"#dev_list\">dev_list</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#queue\">queue</a> == <a class=\"id\" href=\"#q\">q</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#atomic_inc\">atomic_inc</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#ref_count\">ref_count</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#found\">found</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bd\">bd</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<a class=\"id\" href=\"#found\">found</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_unlock\">mutex_unlock</a>(&amp;<a class=\"id\" href=\"#bsg_mutex\">bsg_mutex</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#bd\">bd</a>;", 
"}", 
"", 
"static struct <a class=\"id\" href=\"#bsg_device\">bsg_device</a> *<a class=\"id\" href=\"#bsg_get_device\">bsg_get_device</a>(struct <a class=\"id\" href=\"#inode\">inode</a> *<a class=\"id\" href=\"#inode\">inode</a>, struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#file\">file</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#bsg_device\">bsg_device</a> *<a class=\"id\" href=\"#bd\">bd</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#bsg_class_device\">bsg_class_device</a> *<a class=\"id\" href=\"#bcd\">bcd</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * find the class device</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_lock\">mutex_lock</a>(&amp;<a class=\"id\" href=\"#bsg_mutex\">bsg_mutex</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bcd\">bcd</a> = <a class=\"id\" href=\"#idr_find\">idr_find</a>(&amp;<a class=\"id\" href=\"#bsg_minor_idr\">bsg_minor_idr</a>, <a class=\"id\" href=\"#iminor\">iminor</a>(<a class=\"id\" href=\"#inode\">inode</a>));", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#bcd\">bcd</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#kref_get\">kref_get</a>(&amp;<a class=\"id\" href=\"#bcd\">bcd</a>-><a class=\"id\" href=\"#ref\">ref</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_unlock\">mutex_unlock</a>(&amp;<a class=\"id\" href=\"#bsg_mutex\">bsg_mutex</a>);", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#bcd\">bcd</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#ERR_PTR\">ERR_PTR</a>(-<a class=\"id\" href=\"#ENODEV\">ENODEV</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bd\">bd</a> = <a class=\"id\" href=\"#__bsg_get_device\">__bsg_get_device</a>(<a class=\"id\" href=\"#iminor\">iminor</a>(<a class=\"id\" href=\"#inode\">inode</a>), <a class=\"id\" href=\"#bcd\">bcd</a>-><a class=\"id\" href=\"#queue\">queue</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#bd\">bd</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#bd\">bd</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bd\">bd</a> = <a class=\"id\" href=\"#bsg_add_device\">bsg_add_device</a>(<a class=\"id\" href=\"#inode\">inode</a>, <a class=\"id\" href=\"#bcd\">bcd</a>-><a class=\"id\" href=\"#queue\">queue</a>, <a class=\"id\" href=\"#file\">file</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#IS_ERR\">IS_ERR</a>(<a class=\"id\" href=\"#bd\">bd</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#kref_put\">kref_put</a>(&amp;<a class=\"id\" href=\"#bcd\">bcd</a>-><a class=\"id\" href=\"#ref\">ref</a>, <a class=\"id\" href=\"#bsg_kref_release_function\">bsg_kref_release_function</a>);", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#bd\">bd</a>;", 
"}", 
"", 
"static int <a class=\"id\" href=\"#bsg_open\">bsg_open</a>(struct <a class=\"id\" href=\"#inode\">inode</a> *<a class=\"id\" href=\"#inode\">inode</a>, struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#file\">file</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#bsg_device\">bsg_device</a> *<a class=\"id\" href=\"#bd\">bd</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#lock_kernel\">lock_kernel</a>();", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bd\">bd</a> = <a class=\"id\" href=\"#bsg_get_device\">bsg_get_device</a>(<a class=\"id\" href=\"#inode\">inode</a>, <a class=\"id\" href=\"#file\">file</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#unlock_kernel\">unlock_kernel</a>();", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#IS_ERR\">IS_ERR</a>(<a class=\"id\" href=\"#bd\">bd</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#PTR_ERR\">PTR_ERR</a>(<a class=\"id\" href=\"#bd\">bd</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#private_data\">private_data</a> = <a class=\"id\" href=\"#bd\">bd</a>;", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"static int <a class=\"id\" href=\"#bsg_release\">bsg_release</a>(struct <a class=\"id\" href=\"#inode\">inode</a> *<a class=\"id\" href=\"#inode\">inode</a>, struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#file\">file</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#bsg_device\">bsg_device</a> *<a class=\"id\" href=\"#bd\">bd</a> = <a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#private_data\">private_data</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#bsg_put_device\">bsg_put_device</a>(<a class=\"id\" href=\"#bd\">bd</a>);", 
"}", 
"", 
"static unsigned int <a class=\"id\" href=\"#bsg_poll\">bsg_poll</a>(struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#file\">file</a>, <a class=\"id\" href=\"#poll_table\">poll_table</a> *<a class=\"id\" href=\"#wait\">wait</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#bsg_device\">bsg_device</a> *<a class=\"id\" href=\"#bd\">bd</a> = <a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"<span class=\"ts\"/>unsigned int <a class=\"id\" href=\"#mask\">mask</a> = 0;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#poll_wait\">poll_wait</a>(<a class=\"id\" href=\"#file\">file</a>, &amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#wq_done\">wq_done</a>, <a class=\"id\" href=\"#wait\">wait</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#poll_wait\">poll_wait</a>(<a class=\"id\" href=\"#file\">file</a>, &amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#wq_free\">wq_free</a>, <a class=\"id\" href=\"#wait\">wait</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irq\">spin_lock_irq</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#lock\">lock</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#list_empty\">list_empty</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#done_list\">done_list</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#mask\">mask</a> |= <a class=\"id\" href=\"#POLLIN\">POLLIN</a> | <a class=\"id\" href=\"#POLLRDNORM\">POLLRDNORM</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#queued_cmds\">queued_cmds</a> >= <a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#max_queue\">max_queue</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#mask\">mask</a> |= <a class=\"id\" href=\"#POLLOUT\">POLLOUT</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irq\">spin_unlock_irq</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#lock\">lock</a>);", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#mask\">mask</a>;", 
"}", 
"", 
"static long <a class=\"id\" href=\"#bsg_ioctl\">bsg_ioctl</a>(struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#file\">file</a>, unsigned int <a class=\"id\" href=\"#cmd\">cmd</a>, unsigned long <a class=\"id\" href=\"#arg\">arg</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#bsg_device\">bsg_device</a> *<a class=\"id\" href=\"#bd\">bd</a> = <a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#__user\">__user</a> *<a class=\"id\" href=\"#uarg\">uarg</a> = (int <a class=\"id\" href=\"#__user\">__user</a> *) <a class=\"id\" href=\"#arg\">arg</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#ret\">ret</a>;", 
"", 
"<span class=\"ts\"/>switch (<a class=\"id\" href=\"#cmd\">cmd</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * our own ioctls</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#SG_GET_COMMAND_Q\">SG_GET_COMMAND_Q</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#put_user\">put_user</a>(<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#max_queue\">max_queue</a>, <a class=\"id\" href=\"#uarg\">uarg</a>);", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#SG_SET_COMMAND_Q\">SG_SET_COMMAND_Q</a>: {", 
"<span class=\"ts\"/><span class=\"ts\"/>int <a class=\"id\" href=\"#queue\">queue</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#get_user\">get_user</a>(<a class=\"id\" href=\"#queue\">queue</a>, <a class=\"id\" href=\"#uarg\">uarg</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EFAULT\">EFAULT</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#queue\">queue</a> &lt; 1)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irq\">spin_lock_irq</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#lock\">lock</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#max_queue\">max_queue</a> = <a class=\"id\" href=\"#queue\">queue</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irq\">spin_unlock_irq</a>(&amp;<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#lock\">lock</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * SCSI/sg ioctls</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#SG_GET_VERSION_NUM\">SG_GET_VERSION_NUM</a>:", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#SCSI_IOCTL_GET_IDLUN\">SCSI_IOCTL_GET_IDLUN</a>:", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#SCSI_IOCTL_GET_BUS_NUMBER\">SCSI_IOCTL_GET_BUS_NUMBER</a>:", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#SG_SET_TIMEOUT\">SG_SET_TIMEOUT</a>:", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#SG_GET_TIMEOUT\">SG_GET_TIMEOUT</a>:", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#SG_GET_RESERVED_SIZE\">SG_GET_RESERVED_SIZE</a>:", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#SG_SET_RESERVED_SIZE\">SG_SET_RESERVED_SIZE</a>:", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#SG_EMULATED_HOST\">SG_EMULATED_HOST</a>:", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#SCSI_IOCTL_SEND_COMMAND\">SCSI_IOCTL_SEND_COMMAND</a>: {", 
"<span class=\"ts\"/><span class=\"ts\"/>void <a class=\"id\" href=\"#__user\">__user</a> *<a class=\"id\" href=\"#uarg\">uarg</a> = (void <a class=\"id\" href=\"#__user\">__user</a> *) <a class=\"id\" href=\"#arg\">arg</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#scsi_cmd_ioctl\">scsi_cmd_ioctl</a>(<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#queue\">queue</a>, <a class=\"id\" href=\"#NULL\">NULL</a>, <a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#f_mode\">f_mode</a>, <a class=\"id\" href=\"#cmd\">cmd</a>, <a class=\"id\" href=\"#uarg\">uarg</a>);", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#SG_IO\">SG_IO</a>: {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#request\">request</a> *<a class=\"id\" href=\"#rq\">rq</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#bio\">bio</a> *<a class=\"id\" href=\"#bio\">bio</a>, *<a class=\"id\" href=\"#bidi_bio\">bidi_bio</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#sg_io_v4\">sg_io_v4</a> <a class=\"id\" href=\"#hdr\">hdr</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>int <a class=\"id\" href=\"#at_head\">at_head</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#u8\">u8</a> <a class=\"id\" href=\"#sense\">sense</a>[<a class=\"id\" href=\"#SCSI_SENSE_BUFFERSIZE\">SCSI_SENSE_BUFFERSIZE</a>];", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#copy_from_user\">copy_from_user</a>(&amp;<a class=\"id\" href=\"#hdr\">hdr</a>, <a class=\"id\" href=\"#uarg\">uarg</a>, sizeof(<a class=\"id\" href=\"#hdr\">hdr</a>)))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EFAULT\">EFAULT</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rq\">rq</a> = <a class=\"id\" href=\"#bsg_map_hdr\">bsg_map_hdr</a>(<a class=\"id\" href=\"#bd\">bd</a>, &amp;<a class=\"id\" href=\"#hdr\">hdr</a>, <a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#f_mode\">f_mode</a> &amp; <a class=\"id\" href=\"#FMODE_WRITE\">FMODE_WRITE</a>, <a class=\"id\" href=\"#sense\">sense</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#IS_ERR\">IS_ERR</a>(<a class=\"id\" href=\"#rq\">rq</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#PTR_ERR\">PTR_ERR</a>(<a class=\"id\" href=\"#rq\">rq</a>);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bio\">bio</a> = <a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#bio\">bio</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#next_rq\">next_rq</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bidi_bio\">bidi_bio</a> = <a class=\"id\" href=\"#rq\">rq</a>-><a class=\"id\" href=\"#next_rq\">next_rq</a>-><a class=\"id\" href=\"#bio\">bio</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#at_head\">at_head</a> = (0 == (<a class=\"id\" href=\"#hdr\">hdr</a>.<a class=\"id\" href=\"#flags\">flags</a> &amp; <a class=\"id\" href=\"#BSG_FLAG_Q_AT_TAIL\">BSG_FLAG_Q_AT_TAIL</a>));", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#blk_execute_rq\">blk_execute_rq</a>(<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#queue\">queue</a>, <a class=\"id\" href=\"#NULL\">NULL</a>, <a class=\"id\" href=\"#rq\">rq</a>, <a class=\"id\" href=\"#at_head\">at_head</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#blk_complete_sgv4_hdr_rq\">blk_complete_sgv4_hdr_rq</a>(<a class=\"id\" href=\"#rq\">rq</a>, &amp;<a class=\"id\" href=\"#hdr\">hdr</a>, <a class=\"id\" href=\"#bio\">bio</a>, <a class=\"id\" href=\"#bidi_bio\">bidi_bio</a>);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#copy_to_user\">copy_to_user</a>(<a class=\"id\" href=\"#uarg\">uarg</a>, &amp;<a class=\"id\" href=\"#hdr\">hdr</a>, sizeof(<a class=\"id\" href=\"#hdr\">hdr</a>)))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EFAULT\">EFAULT</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#ret\">ret</a>;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * block device ioctls</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/>default:", 
"#if 0", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#ioctl_by_bdev\">ioctl_by_bdev</a>(<a class=\"id\" href=\"#bd\">bd</a>-><a class=\"id\" href=\"#bdev\">bdev</a>, <a class=\"id\" href=\"#cmd\">cmd</a>, <a class=\"id\" href=\"#arg\">arg</a>);", 
"#else", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOTTY\">ENOTTY</a>;", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
"<span class=\"ts\"/>}", 
"}", 
"", 
"static const struct <a class=\"id\" href=\"#file_operations\">file_operations</a> <a class=\"id\" href=\"#bsg_fops\">bsg_fops</a> = {", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#read\">read</a><span class=\"ts\"/><span class=\"ts\"/>=<span class=\"ts\"/><a class=\"id\" href=\"#bsg_read\">bsg_read</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#write\">write</a><span class=\"ts\"/><span class=\"ts\"/>=<span class=\"ts\"/><a class=\"id\" href=\"#bsg_write\">bsg_write</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#poll\">poll</a><span class=\"ts\"/><span class=\"ts\"/>=<span class=\"ts\"/><a class=\"id\" href=\"#bsg_poll\">bsg_poll</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#open\">open</a><span class=\"ts\"/><span class=\"ts\"/>=<span class=\"ts\"/><a class=\"id\" href=\"#bsg_open\">bsg_open</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#release\">release</a><span class=\"ts\"/>=<span class=\"ts\"/><a class=\"id\" href=\"#bsg_release\">bsg_release</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#unlocked_ioctl\">unlocked_ioctl</a><span class=\"ts\"/>=<span class=\"ts\"/><a class=\"id\" href=\"#bsg_ioctl\">bsg_ioctl</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#owner\">owner</a><span class=\"ts\"/><span class=\"ts\"/>=<span class=\"ts\"/><a class=\"id\" href=\"#THIS_MODULE\">THIS_MODULE</a>,", 
"};", 
"", 
"void <a class=\"id\" href=\"#bsg_unregister_queue\">bsg_unregister_queue</a>(struct <a class=\"id\" href=\"#request_queue\">request_queue</a> *<a class=\"id\" href=\"#q\">q</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#bsg_class_device\">bsg_class_device</a> *<a class=\"id\" href=\"#bcd\">bcd</a> = &amp;<a class=\"id\" href=\"#q\">q</a>-><a class=\"id\" href=\"#bsg_dev\">bsg_dev</a>;", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#bcd\">bcd</a>-><a class=\"id\" href=\"#class_dev\">class_dev</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_lock\">mutex_lock</a>(&amp;<a class=\"id\" href=\"#bsg_mutex\">bsg_mutex</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#idr_remove\">idr_remove</a>(&amp;<a class=\"id\" href=\"#bsg_minor_idr\">bsg_minor_idr</a>, <a class=\"id\" href=\"#bcd\">bcd</a>-><a class=\"id\" href=\"#minor\">minor</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#sysfs_remove_link\">sysfs_remove_link</a>(&amp;<a class=\"id\" href=\"#q\">q</a>-><a class=\"id\" href=\"#kobj\">kobj</a>, \"bsg\");", 
"<span class=\"ts\"/><a class=\"id\" href=\"#device_unregister\">device_unregister</a>(<a class=\"id\" href=\"#bcd\">bcd</a>-><a class=\"id\" href=\"#class_dev\">class_dev</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bcd\">bcd</a>-><a class=\"id\" href=\"#class_dev\">class_dev</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kref_put\">kref_put</a>(&amp;<a class=\"id\" href=\"#bcd\">bcd</a>-><a class=\"id\" href=\"#ref\">ref</a>, <a class=\"id\" href=\"#bsg_kref_release_function\">bsg_kref_release_function</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_unlock\">mutex_unlock</a>(&amp;<a class=\"id\" href=\"#bsg_mutex\">bsg_mutex</a>);", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#bsg_unregister_queue\">bsg_unregister_queue</a>);", 
"", 
"int <a class=\"id\" href=\"#bsg_register_queue\">bsg_register_queue</a>(struct <a class=\"id\" href=\"#request_queue\">request_queue</a> *<a class=\"id\" href=\"#q\">q</a>, struct <a class=\"id\" href=\"#device\">device</a> *<a class=\"id\" href=\"#parent\">parent</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/>       const char *<a class=\"id\" href=\"#name\">name</a>, void (*<a class=\"id\" href=\"#release\">release</a>)(struct <a class=\"id\" href=\"#device\">device</a> *))", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#bsg_class_device\">bsg_class_device</a> *<a class=\"id\" href=\"#bcd\">bcd</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dev_t\">dev_t</a> <a class=\"id\" href=\"#dev\">dev</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#ret\">ret</a>, <a class=\"id\" href=\"#minor\">minor</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#device\">device</a> *<a class=\"id\" href=\"#class_dev\">class_dev</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/>const char *<a class=\"id\" href=\"#devname\">devname</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#name\">name</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#devname\">devname</a> = <a class=\"id\" href=\"#name\">name</a>;", 
"<span class=\"ts\"/>else", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#devname\">devname</a> = <a class=\"id\" href=\"#dev_name\">dev_name</a>(<a class=\"id\" href=\"#parent\">parent</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * we need a proper transport to send commands, not a stacked device</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#q\">q</a>-><a class=\"id\" href=\"#request_fn\">request_fn</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bcd\">bcd</a> = &amp;<a class=\"id\" href=\"#q\">q</a>-><a class=\"id\" href=\"#bsg_dev\">bsg_dev</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#memset\">memset</a>(<a class=\"id\" href=\"#bcd\">bcd</a>, 0, sizeof(*<a class=\"id\" href=\"#bcd\">bcd</a>));", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_lock\">mutex_lock</a>(&amp;<a class=\"id\" href=\"#bsg_mutex\">bsg_mutex</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#idr_pre_get\">idr_pre_get</a>(&amp;<a class=\"id\" href=\"#bsg_minor_idr\">bsg_minor_idr</a>, <a class=\"id\" href=\"#GFP_KERNEL\">GFP_KERNEL</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#ret\">ret</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#unlock\">unlock</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#idr_get_new\">idr_get_new</a>(&amp;<a class=\"id\" href=\"#bsg_minor_idr\">bsg_minor_idr</a>, <a class=\"id\" href=\"#bcd\">bcd</a>, &amp;<a class=\"id\" href=\"#minor\">minor</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#ret\">ret</a> &lt; 0)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#unlock\">unlock</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#minor\">minor</a> >= <a class=\"id\" href=\"#BSG_MAX_DEVS\">BSG_MAX_DEVS</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_ERR\">KERN_ERR</a> \"bsg: too many bsg devices\\n\");", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#remove_idr\">remove_idr</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bcd\">bcd</a>-><a class=\"id\" href=\"#minor\">minor</a> = <a class=\"id\" href=\"#minor\">minor</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bcd\">bcd</a>-><a class=\"id\" href=\"#queue\">queue</a> = <a class=\"id\" href=\"#q\">q</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bcd\">bcd</a>-><a class=\"id\" href=\"#parent\">parent</a> = <a class=\"id\" href=\"#get_device\">get_device</a>(<a class=\"id\" href=\"#parent\">parent</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bcd\">bcd</a>-><a class=\"id\" href=\"#release\">release</a> = <a class=\"id\" href=\"#release\">release</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kref_init\">kref_init</a>(&amp;<a class=\"id\" href=\"#bcd\">bcd</a>-><a class=\"id\" href=\"#ref\">ref</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dev\">dev</a> = <a class=\"id\" href=\"#MKDEV\">MKDEV</a>(<a class=\"id\" href=\"#bsg_major\">bsg_major</a>, <a class=\"id\" href=\"#bcd\">bcd</a>-><a class=\"id\" href=\"#minor\">minor</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#class_dev\">class_dev</a> = <a class=\"id\" href=\"#device_create\">device_create</a>(<a class=\"id\" href=\"#bsg_class\">bsg_class</a>, <a class=\"id\" href=\"#parent\">parent</a>, <a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#NULL\">NULL</a>, \"%s\", <a class=\"id\" href=\"#devname\">devname</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#IS_ERR\">IS_ERR</a>(<a class=\"id\" href=\"#class_dev\">class_dev</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#PTR_ERR\">PTR_ERR</a>(<a class=\"id\" href=\"#class_dev\">class_dev</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#put_dev\">put_dev</a>;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bcd\">bcd</a>-><a class=\"id\" href=\"#class_dev\">class_dev</a> = <a class=\"id\" href=\"#class_dev\">class_dev</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#q\">q</a>-><a class=\"id\" href=\"#kobj\">kobj</a>.<a class=\"id\" href=\"#sd\">sd</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#sysfs_create_link\">sysfs_create_link</a>(&amp;<a class=\"id\" href=\"#q\">q</a>-><a class=\"id\" href=\"#kobj\">kobj</a>, &amp;<a class=\"id\" href=\"#bcd\">bcd</a>-><a class=\"id\" href=\"#class_dev\">class_dev</a>-><a class=\"id\" href=\"#kobj\">kobj</a>, \"bsg\");", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#ret\">ret</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#unregister_class_dev\">unregister_class_dev</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_unlock\">mutex_unlock</a>(&amp;<a class=\"id\" href=\"#bsg_mutex\">bsg_mutex</a>);", 
"<span class=\"ts\"/>return 0;", 
"", 
"<a class=\"id\" href=\"#unregister_class_dev\">unregister_class_dev</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#device_unregister\">device_unregister</a>(<a class=\"id\" href=\"#class_dev\">class_dev</a>);", 
"<a class=\"id\" href=\"#put_dev\">put_dev</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#put_device\">put_device</a>(<a class=\"id\" href=\"#parent\">parent</a>);", 
"<a class=\"id\" href=\"#remove_idr\">remove_idr</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#idr_remove\">idr_remove</a>(&amp;<a class=\"id\" href=\"#bsg_minor_idr\">bsg_minor_idr</a>, <a class=\"id\" href=\"#minor\">minor</a>);", 
"<a class=\"id\" href=\"#unlock\">unlock</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_unlock\">mutex_unlock</a>(&amp;<a class=\"id\" href=\"#bsg_mutex\">bsg_mutex</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ret\">ret</a>;", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#bsg_register_queue\">bsg_register_queue</a>);", 
"", 
"static struct <a class=\"id\" href=\"#cdev\">cdev</a> <a class=\"id\" href=\"#bsg_cdev\">bsg_cdev</a>;", 
"", 
"static char *<a class=\"id\" href=\"#bsg_devnode\">bsg_devnode</a>(struct <a class=\"id\" href=\"#device\">device</a> *<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#mode_t\">mode_t</a> *<a class=\"id\" href=\"#mode\">mode</a>)", 
"{", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#kasprintf\">kasprintf</a>(<a class=\"id\" href=\"#GFP_KERNEL\">GFP_KERNEL</a>, \"bsg/%s\", <a class=\"id\" href=\"#dev_name\">dev_name</a>(<a class=\"id\" href=\"#dev\">dev</a>));", 
"}", 
"", 
"static int <a class=\"id\" href=\"#__init\">__init</a> <a class=\"id\" href=\"#bsg_init\">bsg_init</a>(void)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#ret\">ret</a>, <a class=\"id\" href=\"#i\">i</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dev_t\">dev_t</a> <a class=\"id\" href=\"#devid\">devid</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bsg_cmd_cachep\">bsg_cmd_cachep</a> = <a class=\"id\" href=\"#kmem_cache_create\">kmem_cache_create</a>(\"bsg_cmd\",", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>sizeof(struct <a class=\"id\" href=\"#bsg_command\">bsg_command</a>), 0, 0, <a class=\"id\" href=\"#NULL\">NULL</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#bsg_cmd_cachep\">bsg_cmd_cachep</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_ERR\">KERN_ERR</a> \"bsg: failed creating slab cache\\n\");", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = 0; <a class=\"id\" href=\"#i\">i</a> &lt; <a class=\"id\" href=\"#BSG_LIST_ARRAY_SIZE\">BSG_LIST_ARRAY_SIZE</a>; <a class=\"id\" href=\"#i\">i</a>++)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#INIT_HLIST_HEAD\">INIT_HLIST_HEAD</a>(&amp;<a class=\"id\" href=\"#bsg_device_list\">bsg_device_list</a>[<a class=\"id\" href=\"#i\">i</a>]);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bsg_class\">bsg_class</a> = <a class=\"id\" href=\"#class_create\">class_create</a>(<a class=\"id\" href=\"#THIS_MODULE\">THIS_MODULE</a>, \"bsg\");", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#IS_ERR\">IS_ERR</a>(<a class=\"id\" href=\"#bsg_class\">bsg_class</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#PTR_ERR\">PTR_ERR</a>(<a class=\"id\" href=\"#bsg_class\">bsg_class</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#destroy_kmemcache\">destroy_kmemcache</a>;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bsg_class\">bsg_class</a>-><a class=\"id\" href=\"#devnode\">devnode</a> = <a class=\"id\" href=\"#bsg_devnode\">bsg_devnode</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#alloc_chrdev_region\">alloc_chrdev_region</a>(&amp;<a class=\"id\" href=\"#devid\">devid</a>, 0, <a class=\"id\" href=\"#BSG_MAX_DEVS\">BSG_MAX_DEVS</a>, \"bsg\");", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#ret\">ret</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#destroy_bsg_class\">destroy_bsg_class</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bsg_major\">bsg_major</a> = <a class=\"id\" href=\"#MAJOR\">MAJOR</a>(<a class=\"id\" href=\"#devid\">devid</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#cdev_init\">cdev_init</a>(&amp;<a class=\"id\" href=\"#bsg_cdev\">bsg_cdev</a>, &amp;<a class=\"id\" href=\"#bsg_fops\">bsg_fops</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#cdev_add\">cdev_add</a>(&amp;<a class=\"id\" href=\"#bsg_cdev\">bsg_cdev</a>, <a class=\"id\" href=\"#MKDEV\">MKDEV</a>(<a class=\"id\" href=\"#bsg_major\">bsg_major</a>, 0), <a class=\"id\" href=\"#BSG_MAX_DEVS\">BSG_MAX_DEVS</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#ret\">ret</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#unregister_chrdev\">unregister_chrdev</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_INFO\">KERN_INFO</a> <a class=\"id\" href=\"#BSG_DESCRIPTION\">BSG_DESCRIPTION</a> \" version \" <a class=\"id\" href=\"#BSG_VERSION\">BSG_VERSION</a>", 
"<span class=\"ts\"/>       \" loaded (major %d)\\n\", <a class=\"id\" href=\"#bsg_major\">bsg_major</a>);", 
"<span class=\"ts\"/>return 0;", 
"<a class=\"id\" href=\"#unregister_chrdev\">unregister_chrdev</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#unregister_chrdev_region\">unregister_chrdev_region</a>(<a class=\"id\" href=\"#MKDEV\">MKDEV</a>(<a class=\"id\" href=\"#bsg_major\">bsg_major</a>, 0), <a class=\"id\" href=\"#BSG_MAX_DEVS\">BSG_MAX_DEVS</a>);", 
"<a class=\"id\" href=\"#destroy_bsg_class\">destroy_bsg_class</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#class_destroy\">class_destroy</a>(<a class=\"id\" href=\"#bsg_class\">bsg_class</a>);", 
"<a class=\"id\" href=\"#destroy_kmemcache\">destroy_kmemcache</a>:", 
];
xr_frag_insert('l/43/0306d03dc2c69471591443a82f0e553b21589f.xr', __xr_tmp);
