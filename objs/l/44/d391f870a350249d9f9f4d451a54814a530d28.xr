var __xr_tmp = [
"<span class=\"ts\"/><span class=\"comment\">/* Give virtio_ring a chance to accept features. */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#vring_transport_features\">vring_transport_features</a>(<a class=\"id\" href=\"#vdev\">vdev</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* We only support 32 feature bits. */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#BUILD_BUG_ON\">BUILD_BUG_ON</a>(<a class=\"id\" href=\"#ARRAY_SIZE\">ARRAY_SIZE</a>(<a class=\"id\" href=\"#vdev\">vdev</a>-><a class=\"id\" href=\"#features\">features</a>) != 1);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#iowrite32\">iowrite32</a>(<a class=\"id\" href=\"#vdev\">vdev</a>-><a class=\"id\" href=\"#features\">features</a>[0], <a class=\"id\" href=\"#vp_dev\">vp_dev</a>-><a class=\"id\" href=\"#ioaddr\">ioaddr</a>+<a class=\"id\" href=\"#VIRTIO_PCI_GUEST_FEATURES\">VIRTIO_PCI_GUEST_FEATURES</a>);", 
"}", 
"", 
"<span class=\"comment\">/* virtio config-&gt;get() implementation */</span>", 
"static void <a class=\"id\" href=\"#vp_get\">vp_get</a>(struct <a class=\"id\" href=\"#virtio_device\">virtio_device</a> *<a class=\"id\" href=\"#vdev\">vdev</a>, unsigned <a class=\"id\" href=\"#offset\">offset</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/>   void *<a class=\"id\" href=\"#buf\">buf</a>, unsigned <a class=\"id\" href=\"#len\">len</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#virtio_pci_device\">virtio_pci_device</a> *<a class=\"id\" href=\"#vp_dev\">vp_dev</a> = <a class=\"id\" href=\"#to_vp_device\">to_vp_device</a>(<a class=\"id\" href=\"#vdev\">vdev</a>);", 
"<span class=\"ts\"/>void <a class=\"id\" href=\"#__iomem\">__iomem</a> *<a class=\"id\" href=\"#ioaddr\">ioaddr</a> = <a class=\"id\" href=\"#vp_dev\">vp_dev</a>-><a class=\"id\" href=\"#ioaddr\">ioaddr</a> +", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#VIRTIO_PCI_CONFIG\">VIRTIO_PCI_CONFIG</a>(<a class=\"id\" href=\"#vp_dev\">vp_dev</a>) + <a class=\"id\" href=\"#offset\">offset</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u8\">u8</a> *<a class=\"id\" href=\"#ptr\">ptr</a> = <a class=\"id\" href=\"#buf\">buf</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#i\">i</a>;", 
"", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = 0; <a class=\"id\" href=\"#i\">i</a> &lt; <a class=\"id\" href=\"#len\">len</a>; <a class=\"id\" href=\"#i\">i</a>++)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ptr\">ptr</a>[<a class=\"id\" href=\"#i\">i</a>] = <a class=\"id\" href=\"#ioread8\">ioread8</a>(<a class=\"id\" href=\"#ioaddr\">ioaddr</a> + <a class=\"id\" href=\"#i\">i</a>);", 
"}", 
"", 
"<span class=\"comment\">/* the config-&gt;set() implementation.  it's symmetric to the config-&gt;get()</span>", 
"<span class=\"comment\"> * implementation */</span>", 
"static void <a class=\"id\" href=\"#vp_set\">vp_set</a>(struct <a class=\"id\" href=\"#virtio_device\">virtio_device</a> *<a class=\"id\" href=\"#vdev\">vdev</a>, unsigned <a class=\"id\" href=\"#offset\">offset</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/>   const void *<a class=\"id\" href=\"#buf\">buf</a>, unsigned <a class=\"id\" href=\"#len\">len</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#virtio_pci_device\">virtio_pci_device</a> *<a class=\"id\" href=\"#vp_dev\">vp_dev</a> = <a class=\"id\" href=\"#to_vp_device\">to_vp_device</a>(<a class=\"id\" href=\"#vdev\">vdev</a>);", 
"<span class=\"ts\"/>void <a class=\"id\" href=\"#__iomem\">__iomem</a> *<a class=\"id\" href=\"#ioaddr\">ioaddr</a> = <a class=\"id\" href=\"#vp_dev\">vp_dev</a>-><a class=\"id\" href=\"#ioaddr\">ioaddr</a> +", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#VIRTIO_PCI_CONFIG\">VIRTIO_PCI_CONFIG</a>(<a class=\"id\" href=\"#vp_dev\">vp_dev</a>) + <a class=\"id\" href=\"#offset\">offset</a>;", 
"<span class=\"ts\"/>const <a class=\"id\" href=\"#u8\">u8</a> *<a class=\"id\" href=\"#ptr\">ptr</a> = <a class=\"id\" href=\"#buf\">buf</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#i\">i</a>;", 
"", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = 0; <a class=\"id\" href=\"#i\">i</a> &lt; <a class=\"id\" href=\"#len\">len</a>; <a class=\"id\" href=\"#i\">i</a>++)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#iowrite8\">iowrite8</a>(<a class=\"id\" href=\"#ptr\">ptr</a>[<a class=\"id\" href=\"#i\">i</a>], <a class=\"id\" href=\"#ioaddr\">ioaddr</a> + <a class=\"id\" href=\"#i\">i</a>);", 
"}", 
"", 
"<span class=\"comment\">/* config-&gt;{get,set}_status() implementations */</span>", 
"static <a class=\"id\" href=\"#u8\">u8</a> <a class=\"id\" href=\"#vp_get_status\">vp_get_status</a>(struct <a class=\"id\" href=\"#virtio_device\">virtio_device</a> *<a class=\"id\" href=\"#vdev\">vdev</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#virtio_pci_device\">virtio_pci_device</a> *<a class=\"id\" href=\"#vp_dev\">vp_dev</a> = <a class=\"id\" href=\"#to_vp_device\">to_vp_device</a>(<a class=\"id\" href=\"#vdev\">vdev</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ioread8\">ioread8</a>(<a class=\"id\" href=\"#vp_dev\">vp_dev</a>-><a class=\"id\" href=\"#ioaddr\">ioaddr</a> + <a class=\"id\" href=\"#VIRTIO_PCI_STATUS\">VIRTIO_PCI_STATUS</a>);", 
"}", 
"", 
"static void <a class=\"id\" href=\"#vp_set_status\">vp_set_status</a>(struct <a class=\"id\" href=\"#virtio_device\">virtio_device</a> *<a class=\"id\" href=\"#vdev\">vdev</a>, <a class=\"id\" href=\"#u8\">u8</a> <a class=\"id\" href=\"#status\">status</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#virtio_pci_device\">virtio_pci_device</a> *<a class=\"id\" href=\"#vp_dev\">vp_dev</a> = <a class=\"id\" href=\"#to_vp_device\">to_vp_device</a>(<a class=\"id\" href=\"#vdev\">vdev</a>);", 
"<span class=\"ts\"/><span class=\"comment\">/* We should never be setting status to 0. */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#BUG_ON\">BUG_ON</a>(<a class=\"id\" href=\"#status\">status</a> == 0);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#iowrite8\">iowrite8</a>(<a class=\"id\" href=\"#status\">status</a>, <a class=\"id\" href=\"#vp_dev\">vp_dev</a>-><a class=\"id\" href=\"#ioaddr\">ioaddr</a> + <a class=\"id\" href=\"#VIRTIO_PCI_STATUS\">VIRTIO_PCI_STATUS</a>);", 
"}", 
"", 
"static void <a class=\"id\" href=\"#vp_reset\">vp_reset</a>(struct <a class=\"id\" href=\"#virtio_device\">virtio_device</a> *<a class=\"id\" href=\"#vdev\">vdev</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#virtio_pci_device\">virtio_pci_device</a> *<a class=\"id\" href=\"#vp_dev\">vp_dev</a> = <a class=\"id\" href=\"#to_vp_device\">to_vp_device</a>(<a class=\"id\" href=\"#vdev\">vdev</a>);", 
"<span class=\"ts\"/><span class=\"comment\">/* 0 status means a reset. */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#iowrite8\">iowrite8</a>(0, <a class=\"id\" href=\"#vp_dev\">vp_dev</a>-><a class=\"id\" href=\"#ioaddr\">ioaddr</a> + <a class=\"id\" href=\"#VIRTIO_PCI_STATUS\">VIRTIO_PCI_STATUS</a>);", 
"}", 
"", 
"<span class=\"comment\">/* the notify function used when creating a virt queue */</span>", 
"static void <a class=\"id\" href=\"#vp_notify\">vp_notify</a>(struct <a class=\"id\" href=\"#virtqueue\">virtqueue</a> *<a class=\"id\" href=\"#vq\">vq</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#virtio_pci_device\">virtio_pci_device</a> *<a class=\"id\" href=\"#vp_dev\">vp_dev</a> = <a class=\"id\" href=\"#to_vp_device\">to_vp_device</a>(<a class=\"id\" href=\"#vq\">vq</a>-><a class=\"id\" href=\"#vdev\">vdev</a>);", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#virtio_pci_vq_info\">virtio_pci_vq_info</a> *<a class=\"id\" href=\"#info\">info</a> = <a class=\"id\" href=\"#vq\">vq</a>-><a class=\"id\" href=\"#priv\">priv</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* we write the queue's selector into the notification register to</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * signal the other end */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#iowrite16\">iowrite16</a>(<a class=\"id\" href=\"#info\">info</a>-><a class=\"id\" href=\"#queue_index\">queue_index</a>, <a class=\"id\" href=\"#vp_dev\">vp_dev</a>-><a class=\"id\" href=\"#ioaddr\">ioaddr</a> + <a class=\"id\" href=\"#VIRTIO_PCI_QUEUE_NOTIFY\">VIRTIO_PCI_QUEUE_NOTIFY</a>);", 
"}", 
"", 
"<span class=\"comment\">/* Handle a configuration change: Tell driver if it wants to know. */</span>", 
"static <a class=\"id\" href=\"#irqreturn_t\">irqreturn_t</a> <a class=\"id\" href=\"#vp_config_changed\">vp_config_changed</a>(int <a class=\"id\" href=\"#irq\">irq</a>, void *<a class=\"id\" href=\"#opaque\">opaque</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#virtio_pci_device\">virtio_pci_device</a> *<a class=\"id\" href=\"#vp_dev\">vp_dev</a> = <a class=\"id\" href=\"#opaque\">opaque</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#virtio_driver\">virtio_driver</a> *<a class=\"id\" href=\"#drv\">drv</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#drv\">drv</a> = <a class=\"id\" href=\"#container_of\">container_of</a>(<a class=\"id\" href=\"#vp_dev\">vp_dev</a>-><a class=\"id\" href=\"#vdev\">vdev</a>.<a class=\"id\" href=\"#dev\">dev</a>.<a class=\"id\" href=\"#driver\">driver</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>   struct <a class=\"id\" href=\"#virtio_driver\">virtio_driver</a>, <a class=\"id\" href=\"#driver\">driver</a>);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#drv\">drv</a> && <a class=\"id\" href=\"#drv\">drv</a>-><a class=\"id\" href=\"#config_changed\">config_changed</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#drv\">drv</a>-><a class=\"id\" href=\"#config_changed\">config_changed</a>(&amp;<a class=\"id\" href=\"#vp_dev\">vp_dev</a>-><a class=\"id\" href=\"#vdev\">vdev</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#IRQ_HANDLED\">IRQ_HANDLED</a>;", 
"}", 
"", 
"<span class=\"comment\">/* Notify all virtqueues on an interrupt. */</span>", 
"static <a class=\"id\" href=\"#irqreturn_t\">irqreturn_t</a> <a class=\"id\" href=\"#vp_vring_interrupt\">vp_vring_interrupt</a>(int <a class=\"id\" href=\"#irq\">irq</a>, void *<a class=\"id\" href=\"#opaque\">opaque</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#virtio_pci_device\">virtio_pci_device</a> *<a class=\"id\" href=\"#vp_dev\">vp_dev</a> = <a class=\"id\" href=\"#opaque\">opaque</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#virtio_pci_vq_info\">virtio_pci_vq_info</a> *<a class=\"id\" href=\"#info\">info</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#irqreturn_t\">irqreturn_t</a> <a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#IRQ_NONE\">IRQ_NONE</a>;", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#flags\">flags</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irqsave\">spin_lock_irqsave</a>(&amp;<a class=\"id\" href=\"#vp_dev\">vp_dev</a>-><a class=\"id\" href=\"#lock\">lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_for_each_entry\">list_for_each_entry</a>(<a class=\"id\" href=\"#info\">info</a>, &amp;<a class=\"id\" href=\"#vp_dev\">vp_dev</a>-><a class=\"id\" href=\"#virtqueues\">virtqueues</a>, <a class=\"id\" href=\"#node\">node</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#vring_interrupt\">vring_interrupt</a>(<a class=\"id\" href=\"#irq\">irq</a>, <a class=\"id\" href=\"#info\">info</a>-><a class=\"id\" href=\"#vq\">vq</a>) == <a class=\"id\" href=\"#IRQ_HANDLED\">IRQ_HANDLED</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#IRQ_HANDLED\">IRQ_HANDLED</a>;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#vp_dev\">vp_dev</a>-><a class=\"id\" href=\"#lock\">lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ret\">ret</a>;", 
"}", 
"", 
];
xr_frag_insert('l/44/d391f870a350249d9f9f4d451a54814a530d28.xr', __xr_tmp);
