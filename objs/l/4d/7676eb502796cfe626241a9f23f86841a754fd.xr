var __xr_tmp = [
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * linux/kernel/seccomp.c</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Copyright 2004-2005  Andrea Arcangeli &lt;andrea@cpushare.com&gt;</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * This defines a simple but solid secure-computing mode.</span>", 
"<span class=\"comment\"> */</span>", 
"", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#seccomp\">seccomp</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#sched\">sched</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#compat\">compat</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"", 
"<span class=\"comment\">/* #define SECCOMP_DEBUG 1 */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#NR_SECCOMP_MODES\">NR_SECCOMP_MODES</a> 1", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Secure computing mode 1 allows only read/write/exit/sigreturn.</span>", 
"<span class=\"comment\"> * To be fully secure this must be combined with rlimit</span>", 
"<span class=\"comment\"> * to limit the stack allocations too.</span>", 
"<span class=\"comment\"> */</span>", 
"static int <a class=\"id\" href=\"#mode1_syscalls\">mode1_syscalls</a>[] = {", 
"<span class=\"ts\"/><a class=\"id\" href=\"#__NR_seccomp_read\">__NR_seccomp_read</a>, <a class=\"id\" href=\"#__NR_seccomp_write\">__NR_seccomp_write</a>, <a class=\"id\" href=\"#__NR_seccomp_exit\">__NR_seccomp_exit</a>, <a class=\"id\" href=\"#__NR_seccomp_sigreturn\">__NR_seccomp_sigreturn</a>,", 
"<span class=\"ts\"/>0, <span class=\"comment\">/* null terminated */</span>", 
"};", 
"", 
"#<a class=\"id\" href=\"#ifdef\">ifdef</a> <a class=\"id\" href=\"#CONFIG_COMPAT\">CONFIG_COMPAT</a>", 
"static int <a class=\"id\" href=\"#mode1_syscalls_32\">mode1_syscalls_32</a>[] = {", 
"<span class=\"ts\"/><a class=\"id\" href=\"#__NR_seccomp_read_32\">__NR_seccomp_read_32</a>, <a class=\"id\" href=\"#__NR_seccomp_write_32\">__NR_seccomp_write_32</a>, <a class=\"id\" href=\"#__NR_seccomp_exit_32\">__NR_seccomp_exit_32</a>, <a class=\"id\" href=\"#__NR_seccomp_sigreturn_32\">__NR_seccomp_sigreturn_32</a>,", 
"<span class=\"ts\"/>0, <span class=\"comment\">/* null terminated */</span>", 
"};", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
"", 
"void <a class=\"id\" href=\"#__secure_computing\">__secure_computing</a>(int <a class=\"id\" href=\"#this_syscall\">this_syscall</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#mode\">mode</a> = <a class=\"id\" href=\"#current\">current</a>-><a class=\"id\" href=\"#seccomp\">seccomp</a>.<a class=\"id\" href=\"#mode\">mode</a>;", 
"<span class=\"ts\"/>int * <a class=\"id\" href=\"#syscall\">syscall</a>;", 
"", 
"<span class=\"ts\"/>switch (<a class=\"id\" href=\"#mode\">mode</a>) {", 
"<span class=\"ts\"/>case 1:", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#syscall\">syscall</a> = <a class=\"id\" href=\"#mode1_syscalls\">mode1_syscalls</a>;", 
"#<a class=\"id\" href=\"#ifdef\">ifdef</a> <a class=\"id\" href=\"#CONFIG_COMPAT\">CONFIG_COMPAT</a>", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#is_compat_task\">is_compat_task</a>())", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#syscall\">syscall</a> = <a class=\"id\" href=\"#mode1_syscalls_32\">mode1_syscalls_32</a>;", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
"<span class=\"ts\"/><span class=\"ts\"/>do {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (*<a class=\"id\" href=\"#syscall\">syscall</a> == <a class=\"id\" href=\"#this_syscall\">this_syscall</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return;", 
"<span class=\"ts\"/><span class=\"ts\"/>} while (*++<a class=\"id\" href=\"#syscall\">syscall</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>default:", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#BUG\">BUG</a>();", 
"<span class=\"ts\"/>}", 
"", 
"#<a class=\"id\" href=\"#ifdef\">ifdef</a> <a class=\"id\" href=\"#SECCOMP_DEBUG\">SECCOMP_DEBUG</a>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dump_stack\">dump_stack</a>();", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#do_exit\">do_exit</a>(<a class=\"id\" href=\"#SIGKILL\">SIGKILL</a>);", 
"}", 
"", 
"long <a class=\"id\" href=\"#prctl_get_seccomp\">prctl_get_seccomp</a>(void)", 
"{", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#current\">current</a>-><a class=\"id\" href=\"#seccomp\">seccomp</a>.<a class=\"id\" href=\"#mode\">mode</a>;", 
"}", 
"", 
"long <a class=\"id\" href=\"#prctl_set_seccomp\">prctl_set_seccomp</a>(unsigned long <a class=\"id\" href=\"#seccomp_mode\">seccomp_mode</a>)", 
"{", 
"<span class=\"ts\"/>long <a class=\"id\" href=\"#ret\">ret</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* can set it only once to be even more secure */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = -<a class=\"id\" href=\"#EPERM\">EPERM</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#unlikely\">unlikely</a>(<a class=\"id\" href=\"#current\">current</a>-><a class=\"id\" href=\"#seccomp\">seccomp</a>.<a class=\"id\" href=\"#mode\">mode</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#seccomp_mode\">seccomp_mode</a> && <a class=\"id\" href=\"#seccomp_mode\">seccomp_mode</a> <= <a class=\"id\" href=\"#NR_SECCOMP_MODES\">NR_SECCOMP_MODES</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#current\">current</a>-><a class=\"id\" href=\"#seccomp\">seccomp</a>.<a class=\"id\" href=\"#mode\">mode</a> = <a class=\"id\" href=\"#seccomp_mode\">seccomp_mode</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#set_thread_flag\">set_thread_flag</a>(<a class=\"id\" href=\"#TIF_SECCOMP\">TIF_SECCOMP</a>);", 
"#<a class=\"id\" href=\"#ifdef\">ifdef</a> <a class=\"id\" href=\"#TIF_NOTSC\">TIF_NOTSC</a>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#disable_TSC\">disable_TSC</a>();", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = 0;", 
"<span class=\"ts\"/>}", 
"", 
" <a class=\"id\" href=\"#out\">out</a>:", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ret\">ret</a>;", 
"}", 
];
xr_frag_insert('l/4d/7676eb502796cfe626241a9f23f86841a754fd.xr', __xr_tmp);
