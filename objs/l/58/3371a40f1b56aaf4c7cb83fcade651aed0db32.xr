var __xr_tmp = [
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#n\">n</a>++;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#pol\">pol</a>-><a class=\"id\" href=\"#xfrm_vec\">xfrm_vec</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#mode\">mode</a> != <a class=\"id\" href=\"#XFRM_MODE_TUNNEL\">XFRM_MODE_TUNNEL</a> &&", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>    <a class=\"id\" href=\"#pol\">pol</a>-><a class=\"id\" href=\"#xfrm_vec\">xfrm_vec</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#mode\">mode</a> != <a class=\"id\" href=\"#XFRM_MODE_BEET\">XFRM_MODE_BEET</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* update endpoints */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#memcpy\">memcpy</a>(&amp;<a class=\"id\" href=\"#pol\">pol</a>-><a class=\"id\" href=\"#xfrm_vec\">xfrm_vec</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#id\">id</a>.<a class=\"id\" href=\"#daddr\">daddr</a>, &amp;<a class=\"id\" href=\"#mp\">mp</a>-><a class=\"id\" href=\"#new_daddr\">new_daddr</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       sizeof(<a class=\"id\" href=\"#pol\">pol</a>-><a class=\"id\" href=\"#xfrm_vec\">xfrm_vec</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#id\">id</a>.<a class=\"id\" href=\"#daddr\">daddr</a>));", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#memcpy\">memcpy</a>(&amp;<a class=\"id\" href=\"#pol\">pol</a>-><a class=\"id\" href=\"#xfrm_vec\">xfrm_vec</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#saddr\">saddr</a>, &amp;<a class=\"id\" href=\"#mp\">mp</a>-><a class=\"id\" href=\"#new_saddr\">new_saddr</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       sizeof(<a class=\"id\" href=\"#pol\">pol</a>-><a class=\"id\" href=\"#xfrm_vec\">xfrm_vec</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#saddr\">saddr</a>));", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pol\">pol</a>-><a class=\"id\" href=\"#xfrm_vec\">xfrm_vec</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#encap_family\">encap_family</a> = <a class=\"id\" href=\"#mp\">mp</a>-><a class=\"id\" href=\"#new_family\">new_family</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* flush bundles */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#atomic_inc\">atomic_inc</a>(&amp;<a class=\"id\" href=\"#pol\">pol</a>-><a class=\"id\" href=\"#genid\">genid</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#write_unlock_bh\">write_unlock_bh</a>(&amp;<a class=\"id\" href=\"#pol\">pol</a>-><a class=\"id\" href=\"#lock\">lock</a>);", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#n\">n</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENODATA\">ENODATA</a>;", 
"", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"static int <a class=\"id\" href=\"#xfrm_migrate_check\">xfrm_migrate_check</a>(struct <a class=\"id\" href=\"#xfrm_migrate\">xfrm_migrate</a> *<a class=\"id\" href=\"#m\">m</a>, int <a class=\"id\" href=\"#num_migrate\">num_migrate</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#i\">i</a>, <a class=\"id\" href=\"#j\">j</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#num_migrate\">num_migrate</a> &lt; 1 || <a class=\"id\" href=\"#num_migrate\">num_migrate</a> &gt; <a class=\"id\" href=\"#XFRM_MAX_DEPTH\">XFRM_MAX_DEPTH</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = 0; <a class=\"id\" href=\"#i\">i</a> &lt; <a class=\"id\" href=\"#num_migrate\">num_migrate</a>; <a class=\"id\" href=\"#i\">i</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/>if ((<a class=\"id\" href=\"#xfrm_addr_cmp\">xfrm_addr_cmp</a>(&amp;<a class=\"id\" href=\"#m\">m</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#old_daddr\">old_daddr</a>, &amp;<a class=\"id\" href=\"#m\">m</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#new_daddr\">new_daddr</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>   <a class=\"id\" href=\"#m\">m</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#old_family\">old_family</a>) == 0) &&", 
"<span class=\"ts\"/><span class=\"ts\"/>    (<a class=\"id\" href=\"#xfrm_addr_cmp\">xfrm_addr_cmp</a>(&amp;<a class=\"id\" href=\"#m\">m</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#old_saddr\">old_saddr</a>, &amp;<a class=\"id\" href=\"#m\">m</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#new_saddr\">new_saddr</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>   <a class=\"id\" href=\"#m\">m</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#old_family\">old_family</a>) == 0))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#xfrm_addr_any\">xfrm_addr_any</a>(&amp;<a class=\"id\" href=\"#m\">m</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#new_daddr\">new_daddr</a>, <a class=\"id\" href=\"#m\">m</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#new_family\">new_family</a>) ||", 
"<span class=\"ts\"/><span class=\"ts\"/>    <a class=\"id\" href=\"#xfrm_addr_any\">xfrm_addr_any</a>(&amp;<a class=\"id\" href=\"#m\">m</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#new_saddr\">new_saddr</a>, <a class=\"id\" href=\"#m\">m</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#new_family\">new_family</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* check if there is any duplicated entry */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>for (<a class=\"id\" href=\"#j\">j</a> = <a class=\"id\" href=\"#i\">i</a> + 1; <a class=\"id\" href=\"#j\">j</a> &lt; <a class=\"id\" href=\"#num_migrate\">num_migrate</a>; <a class=\"id\" href=\"#j\">j</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#memcmp\">memcmp</a>(&amp;<a class=\"id\" href=\"#m\">m</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#old_daddr\">old_daddr</a>, &amp;<a class=\"id\" href=\"#m\">m</a>[<a class=\"id\" href=\"#j\">j</a>].<a class=\"id\" href=\"#old_daddr\">old_daddr</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>    sizeof(<a class=\"id\" href=\"#m\">m</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#old_daddr\">old_daddr</a>)) &&", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>    !<a class=\"id\" href=\"#memcmp\">memcmp</a>(&amp;<a class=\"id\" href=\"#m\">m</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#old_saddr\">old_saddr</a>, &amp;<a class=\"id\" href=\"#m\">m</a>[<a class=\"id\" href=\"#j\">j</a>].<a class=\"id\" href=\"#old_saddr\">old_saddr</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>    sizeof(<a class=\"id\" href=\"#m\">m</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#old_saddr\">old_saddr</a>)) &&", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>    <a class=\"id\" href=\"#m\">m</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#proto\">proto</a> == <a class=\"id\" href=\"#m\">m</a>[<a class=\"id\" href=\"#j\">j</a>].<a class=\"id\" href=\"#proto\">proto</a> &&", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>    <a class=\"id\" href=\"#m\">m</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#mode\">mode</a> == <a class=\"id\" href=\"#m\">m</a>[<a class=\"id\" href=\"#j\">j</a>].<a class=\"id\" href=\"#mode\">mode</a> &&", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>    <a class=\"id\" href=\"#m\">m</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#reqid\">reqid</a> == <a class=\"id\" href=\"#m\">m</a>[<a class=\"id\" href=\"#j\">j</a>].<a class=\"id\" href=\"#reqid\">reqid</a> &&", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>    <a class=\"id\" href=\"#m\">m</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#old_family\">old_family</a> == <a class=\"id\" href=\"#m\">m</a>[<a class=\"id\" href=\"#j\">j</a>].<a class=\"id\" href=\"#old_family\">old_family</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"int <a class=\"id\" href=\"#xfrm_migrate\">xfrm_migrate</a>(struct <a class=\"id\" href=\"#xfrm_selector\">xfrm_selector</a> *<a class=\"id\" href=\"#sel\">sel</a>, <a class=\"id\" href=\"#u8\">u8</a> <a class=\"id\" href=\"#dir\">dir</a>, <a class=\"id\" href=\"#u8\">u8</a> <a class=\"id\" href=\"#type\">type</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/> struct <a class=\"id\" href=\"#xfrm_migrate\">xfrm_migrate</a> *<a class=\"id\" href=\"#m\">m</a>, int <a class=\"id\" href=\"#num_migrate\">num_migrate</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/> struct <a class=\"id\" href=\"#xfrm_kmaddress\">xfrm_kmaddress</a> *<a class=\"id\" href=\"#k\">k</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#i\">i</a>, <a class=\"id\" href=\"#err\">err</a>, <a class=\"id\" href=\"#nx_cur\">nx_cur</a> = 0, <a class=\"id\" href=\"#nx_new\">nx_new</a> = 0;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#xfrm_policy\">xfrm_policy</a> *<a class=\"id\" href=\"#pol\">pol</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#xfrm_state\">xfrm_state</a> *<a class=\"id\" href=\"#x\">x</a>, *<a class=\"id\" href=\"#xc\">xc</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#xfrm_state\">xfrm_state</a> *<a class=\"id\" href=\"#x_cur\">x_cur</a>[<a class=\"id\" href=\"#XFRM_MAX_DEPTH\">XFRM_MAX_DEPTH</a>];", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#xfrm_state\">xfrm_state</a> *<a class=\"id\" href=\"#x_new\">x_new</a>[<a class=\"id\" href=\"#XFRM_MAX_DEPTH\">XFRM_MAX_DEPTH</a>];", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#xfrm_migrate\">xfrm_migrate</a> *<a class=\"id\" href=\"#mp\">mp</a>;", 
"", 
"<span class=\"ts\"/>if ((<a class=\"id\" href=\"#err\">err</a> = <a class=\"id\" href=\"#xfrm_migrate_check\">xfrm_migrate_check</a>(<a class=\"id\" href=\"#m\">m</a>, <a class=\"id\" href=\"#num_migrate\">num_migrate</a>)) &lt; 0)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Stage 1 - find policy */</span>", 
"<span class=\"ts\"/>if ((<a class=\"id\" href=\"#pol\">pol</a> = <a class=\"id\" href=\"#xfrm_migrate_policy_find\">xfrm_migrate_policy_find</a>(<a class=\"id\" href=\"#sel\">sel</a>, <a class=\"id\" href=\"#dir\">dir</a>, <a class=\"id\" href=\"#type\">type</a>)) == <a class=\"id\" href=\"#NULL\">NULL</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#ENOENT\">ENOENT</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Stage 2 - find and update state(s) */</span>", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = 0, <a class=\"id\" href=\"#mp\">mp</a> = <a class=\"id\" href=\"#m\">m</a>; <a class=\"id\" href=\"#i\">i</a> &lt; <a class=\"id\" href=\"#num_migrate\">num_migrate</a>; <a class=\"id\" href=\"#i\">i</a>++, <a class=\"id\" href=\"#mp\">mp</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/>if ((<a class=\"id\" href=\"#x\">x</a> = <a class=\"id\" href=\"#xfrm_migrate_state_find\">xfrm_migrate_state_find</a>(<a class=\"id\" href=\"#mp\">mp</a>))) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#x_cur\">x_cur</a>[<a class=\"id\" href=\"#nx_cur\">nx_cur</a>] = <a class=\"id\" href=\"#x\">x</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#nx_cur\">nx_cur</a>++;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if ((<a class=\"id\" href=\"#xc\">xc</a> = <a class=\"id\" href=\"#xfrm_state_migrate\">xfrm_state_migrate</a>(<a class=\"id\" href=\"#x\">x</a>, <a class=\"id\" href=\"#mp\">mp</a>))) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#x_new\">x_new</a>[<a class=\"id\" href=\"#nx_new\">nx_new</a>] = <a class=\"id\" href=\"#xc\">xc</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#nx_new\">nx_new</a>++;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>} else {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#ENODATA\">ENODATA</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#restore_state\">restore_state</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Stage 3 - update policy */</span>", 
"<span class=\"ts\"/>if ((<a class=\"id\" href=\"#err\">err</a> = <a class=\"id\" href=\"#xfrm_policy_migrate\">xfrm_policy_migrate</a>(<a class=\"id\" href=\"#pol\">pol</a>, <a class=\"id\" href=\"#m\">m</a>, <a class=\"id\" href=\"#num_migrate\">num_migrate</a>)) &lt; 0)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#restore_state\">restore_state</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Stage 4 - delete old state(s) */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#nx_cur\">nx_cur</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#xfrm_states_put\">xfrm_states_put</a>(<a class=\"id\" href=\"#x_cur\">x_cur</a>, <a class=\"id\" href=\"#nx_cur\">nx_cur</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#xfrm_states_delete\">xfrm_states_delete</a>(<a class=\"id\" href=\"#x_cur\">x_cur</a>, <a class=\"id\" href=\"#nx_cur\">nx_cur</a>);", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Stage 5 - announce */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#km_migrate\">km_migrate</a>(<a class=\"id\" href=\"#sel\">sel</a>, <a class=\"id\" href=\"#dir\">dir</a>, <a class=\"id\" href=\"#type\">type</a>, <a class=\"id\" href=\"#m\">m</a>, <a class=\"id\" href=\"#num_migrate\">num_migrate</a>, <a class=\"id\" href=\"#k\">k</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#xfrm_pol_put\">xfrm_pol_put</a>(<a class=\"id\" href=\"#pol\">pol</a>);", 
"", 
"<span class=\"ts\"/>return 0;", 
"<a class=\"id\" href=\"#out\">out</a>:", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#err\">err</a>;", 
"", 
"<a class=\"id\" href=\"#restore_state\">restore_state</a>:", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#pol\">pol</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#xfrm_pol_put\">xfrm_pol_put</a>(<a class=\"id\" href=\"#pol\">pol</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#nx_cur\">nx_cur</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#xfrm_states_put\">xfrm_states_put</a>(<a class=\"id\" href=\"#x_cur\">x_cur</a>, <a class=\"id\" href=\"#nx_cur\">nx_cur</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#nx_new\">nx_new</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#xfrm_states_delete\">xfrm_states_delete</a>(<a class=\"id\" href=\"#x_new\">x_new</a>, <a class=\"id\" href=\"#nx_new\">nx_new</a>);", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#err\">err</a>;", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL\">EXPORT_SYMBOL</a>(<a class=\"id\" href=\"#xfrm_migrate\">xfrm_migrate</a>);", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
];
xr_frag_insert('l/58/3371a40f1b56aaf4c7cb83fcade651aed0db32.xr', __xr_tmp);
