var __xr_tmp = [
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * security/tomoyo/tomoyo.c</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * LSM hooks for TOMOYO Linux.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Copyright (C) 2005-2010  NTT DATA CORPORATION</span>", 
"<span class=\"comment\"> */</span>", 
"", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#security\">security</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> \"common.h\"", 
"", 
"static int <a class=\"id\" href=\"#tomoyo_cred_alloc_blank\">tomoyo_cred_alloc_blank</a>(struct <a class=\"id\" href=\"#cred\">cred</a> *<a class=\"id\" href=\"#new\">new</a>, <a class=\"id\" href=\"#gfp_t\">gfp_t</a> <a class=\"id\" href=\"#gfp\">gfp</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#new\">new</a>-><a class=\"id\" href=\"#security\">security</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"static int <a class=\"id\" href=\"#tomoyo_cred_prepare\">tomoyo_cred_prepare</a>(struct <a class=\"id\" href=\"#cred\">cred</a> *<a class=\"id\" href=\"#new\">new</a>, const struct <a class=\"id\" href=\"#cred\">cred</a> *<a class=\"id\" href=\"#old\">old</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       <a class=\"id\" href=\"#gfp_t\">gfp_t</a> <a class=\"id\" href=\"#gfp\">gfp</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_domain_info\">tomoyo_domain_info</a> *<a class=\"id\" href=\"#domain\">domain</a> = <a class=\"id\" href=\"#old\">old</a>-><a class=\"id\" href=\"#security\">security</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#new\">new</a>-><a class=\"id\" href=\"#security\">security</a> = <a class=\"id\" href=\"#domain\">domain</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#domain\">domain</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#atomic_inc\">atomic_inc</a>(&amp;<a class=\"id\" href=\"#domain\">domain</a>-><a class=\"id\" href=\"#users\">users</a>);", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"static void <a class=\"id\" href=\"#tomoyo_cred_transfer\">tomoyo_cred_transfer</a>(struct <a class=\"id\" href=\"#cred\">cred</a> *<a class=\"id\" href=\"#new\">new</a>, const struct <a class=\"id\" href=\"#cred\">cred</a> *<a class=\"id\" href=\"#old\">old</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_cred_prepare\">tomoyo_cred_prepare</a>(<a class=\"id\" href=\"#new\">new</a>, <a class=\"id\" href=\"#old\">old</a>, 0);", 
"}", 
"", 
"static void <a class=\"id\" href=\"#tomoyo_cred_free\">tomoyo_cred_free</a>(struct <a class=\"id\" href=\"#cred\">cred</a> *<a class=\"id\" href=\"#cred\">cred</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_domain_info\">tomoyo_domain_info</a> *<a class=\"id\" href=\"#domain\">domain</a> = <a class=\"id\" href=\"#cred\">cred</a>-><a class=\"id\" href=\"#security\">security</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#domain\">domain</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#atomic_dec\">atomic_dec</a>(&amp;<a class=\"id\" href=\"#domain\">domain</a>-><a class=\"id\" href=\"#users\">users</a>);", 
"}", 
"", 
"static int <a class=\"id\" href=\"#tomoyo_bprm_set_creds\">tomoyo_bprm_set_creds</a>(struct <a class=\"id\" href=\"#linux_binprm\">linux_binprm</a> *<a class=\"id\" href=\"#bprm\">bprm</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#rc\">rc</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rc\">rc</a> = <a class=\"id\" href=\"#cap_bprm_set_creds\">cap_bprm_set_creds</a>(<a class=\"id\" href=\"#bprm\">bprm</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#rc\">rc</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#rc\">rc</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Do only if this function is called for the first time of an execve</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * operation.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#bprm\">bprm</a>-><a class=\"id\" href=\"#cred_prepared\">cred_prepared</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Load policy if /sbin/tomoyo-init exists and /sbin/init is requested</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * for the first time.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#tomoyo_policy_loaded\">tomoyo_policy_loaded</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_load_policy\">tomoyo_load_policy</a>(<a class=\"id\" href=\"#bprm\">bprm</a>-><a class=\"id\" href=\"#filename\">filename</a>);", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Release reference to \"struct tomoyo_domain_info\" stored inside</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * \"bprm-&gt;cred-&gt;security\". New reference to \"struct tomoyo_domain_info\"</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * stored inside \"bprm-&gt;cred-&gt;security\" will be acquired later inside</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * tomoyo_find_next_domain().</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#atomic_dec\">atomic_dec</a>(&amp;((struct <a class=\"id\" href=\"#tomoyo_domain_info\">tomoyo_domain_info</a> *)", 
"<span class=\"ts\"/><span class=\"ts\"/>     <a class=\"id\" href=\"#bprm\">bprm</a>-><a class=\"id\" href=\"#cred\">cred</a>-><a class=\"id\" href=\"#security\">security</a>)-><a class=\"id\" href=\"#users\">users</a>);", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Tell tomoyo_bprm_check_security() is called for the first time of an</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * execve operation.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bprm\">bprm</a>-><a class=\"id\" href=\"#cred\">cred</a>-><a class=\"id\" href=\"#security\">security</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"static int <a class=\"id\" href=\"#tomoyo_bprm_check_security\">tomoyo_bprm_check_security</a>(struct <a class=\"id\" href=\"#linux_binprm\">linux_binprm</a> *<a class=\"id\" href=\"#bprm\">bprm</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_domain_info\">tomoyo_domain_info</a> *<a class=\"id\" href=\"#domain\">domain</a> = <a class=\"id\" href=\"#bprm\">bprm</a>-><a class=\"id\" href=\"#cred\">cred</a>-><a class=\"id\" href=\"#security\">security</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Execute permission is checked against pathname passed to do_execve()</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * using current domain.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#domain\">domain</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>const int <a class=\"id\" href=\"#idx\">idx</a> = <a class=\"id\" href=\"#tomoyo_read_lock\">tomoyo_read_lock</a>();", 
"<span class=\"ts\"/><span class=\"ts\"/>const int <a class=\"id\" href=\"#err\">err</a> = <a class=\"id\" href=\"#tomoyo_find_next_domain\">tomoyo_find_next_domain</a>(<a class=\"id\" href=\"#bprm\">bprm</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_read_unlock\">tomoyo_read_unlock</a>(<a class=\"id\" href=\"#idx\">idx</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#err\">err</a>;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Read permission is checked against interpreters using next domain.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#tomoyo_check_open_permission\">tomoyo_check_open_permission</a>(<a class=\"id\" href=\"#domain\">domain</a>, &amp;<a class=\"id\" href=\"#bprm\">bprm</a>-><a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#f_path\">f_path</a>, <a class=\"id\" href=\"#O_RDONLY\">O_RDONLY</a>);", 
"}", 
"", 
"static int <a class=\"id\" href=\"#tomoyo_path_truncate\">tomoyo_path_truncate</a>(struct <a class=\"id\" href=\"#path\">path</a> *<a class=\"id\" href=\"#path\">path</a>)", 
"{", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#tomoyo_path_perm\">tomoyo_path_perm</a>(<a class=\"id\" href=\"#TOMOYO_TYPE_TRUNCATE\">TOMOYO_TYPE_TRUNCATE</a>, <a class=\"id\" href=\"#path\">path</a>);", 
"}", 
"", 
"static int <a class=\"id\" href=\"#tomoyo_path_unlink\">tomoyo_path_unlink</a>(struct <a class=\"id\" href=\"#path\">path</a> *<a class=\"id\" href=\"#parent\">parent</a>, struct <a class=\"id\" href=\"#dentry\">dentry</a> *<a class=\"id\" href=\"#dentry\">dentry</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#path\">path</a> <a class=\"id\" href=\"#path\">path</a> = { <a class=\"id\" href=\"#parent\">parent</a>-><a class=\"id\" href=\"#mnt\">mnt</a>, <a class=\"id\" href=\"#dentry\">dentry</a> };", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#tomoyo_path_perm\">tomoyo_path_perm</a>(<a class=\"id\" href=\"#TOMOYO_TYPE_UNLINK\">TOMOYO_TYPE_UNLINK</a>, &amp;<a class=\"id\" href=\"#path\">path</a>);", 
"}", 
"", 
"static int <a class=\"id\" href=\"#tomoyo_path_mkdir\">tomoyo_path_mkdir</a>(struct <a class=\"id\" href=\"#path\">path</a> *<a class=\"id\" href=\"#parent\">parent</a>, struct <a class=\"id\" href=\"#dentry\">dentry</a> *<a class=\"id\" href=\"#dentry\">dentry</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>     int <a class=\"id\" href=\"#mode\">mode</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#path\">path</a> <a class=\"id\" href=\"#path\">path</a> = { <a class=\"id\" href=\"#parent\">parent</a>-><a class=\"id\" href=\"#mnt\">mnt</a>, <a class=\"id\" href=\"#dentry\">dentry</a> };", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#tomoyo_path_number_perm\">tomoyo_path_number_perm</a>(<a class=\"id\" href=\"#TOMOYO_TYPE_MKDIR\">TOMOYO_TYPE_MKDIR</a>, &amp;<a class=\"id\" href=\"#path\">path</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       <a class=\"id\" href=\"#mode\">mode</a> &amp; <a class=\"id\" href=\"#S_IALLUGO\">S_IALLUGO</a>);", 
"}", 
"", 
"static int <a class=\"id\" href=\"#tomoyo_path_rmdir\">tomoyo_path_rmdir</a>(struct <a class=\"id\" href=\"#path\">path</a> *<a class=\"id\" href=\"#parent\">parent</a>, struct <a class=\"id\" href=\"#dentry\">dentry</a> *<a class=\"id\" href=\"#dentry\">dentry</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#path\">path</a> <a class=\"id\" href=\"#path\">path</a> = { <a class=\"id\" href=\"#parent\">parent</a>-><a class=\"id\" href=\"#mnt\">mnt</a>, <a class=\"id\" href=\"#dentry\">dentry</a> };", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#tomoyo_path_perm\">tomoyo_path_perm</a>(<a class=\"id\" href=\"#TOMOYO_TYPE_RMDIR\">TOMOYO_TYPE_RMDIR</a>, &amp;<a class=\"id\" href=\"#path\">path</a>);", 
"}", 
"", 
"static int <a class=\"id\" href=\"#tomoyo_path_symlink\">tomoyo_path_symlink</a>(struct <a class=\"id\" href=\"#path\">path</a> *<a class=\"id\" href=\"#parent\">parent</a>, struct <a class=\"id\" href=\"#dentry\">dentry</a> *<a class=\"id\" href=\"#dentry\">dentry</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       const char *<a class=\"id\" href=\"#old_name\">old_name</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#path\">path</a> <a class=\"id\" href=\"#path\">path</a> = { <a class=\"id\" href=\"#parent\">parent</a>-><a class=\"id\" href=\"#mnt\">mnt</a>, <a class=\"id\" href=\"#dentry\">dentry</a> };", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#tomoyo_path_perm\">tomoyo_path_perm</a>(<a class=\"id\" href=\"#TOMOYO_TYPE_SYMLINK\">TOMOYO_TYPE_SYMLINK</a>, &amp;<a class=\"id\" href=\"#path\">path</a>);", 
"}", 
"", 
"static int <a class=\"id\" href=\"#tomoyo_path_mknod\">tomoyo_path_mknod</a>(struct <a class=\"id\" href=\"#path\">path</a> *<a class=\"id\" href=\"#parent\">parent</a>, struct <a class=\"id\" href=\"#dentry\">dentry</a> *<a class=\"id\" href=\"#dentry\">dentry</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>     int <a class=\"id\" href=\"#mode\">mode</a>, unsigned int <a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#path\">path</a> <a class=\"id\" href=\"#path\">path</a> = { <a class=\"id\" href=\"#parent\">parent</a>-><a class=\"id\" href=\"#mnt\">mnt</a>, <a class=\"id\" href=\"#dentry\">dentry</a> };", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#type\">type</a> = <a class=\"id\" href=\"#TOMOYO_TYPE_CREATE\">TOMOYO_TYPE_CREATE</a>;", 
"<span class=\"ts\"/>const unsigned int <a class=\"id\" href=\"#perm\">perm</a> = <a class=\"id\" href=\"#mode\">mode</a> &amp; <a class=\"id\" href=\"#S_IALLUGO\">S_IALLUGO</a>;", 
"", 
"<span class=\"ts\"/>switch (<a class=\"id\" href=\"#mode\">mode</a> &amp; <a class=\"id\" href=\"#S_IFMT\">S_IFMT</a>) {", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#S_IFCHR\">S_IFCHR</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#type\">type</a> = <a class=\"id\" href=\"#TOMOYO_TYPE_MKCHAR\">TOMOYO_TYPE_MKCHAR</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#S_IFBLK\">S_IFBLK</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#type\">type</a> = <a class=\"id\" href=\"#TOMOYO_TYPE_MKBLOCK\">TOMOYO_TYPE_MKBLOCK</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>default:", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#no_dev\">no_dev</a>;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#tomoyo_mkdev_perm\">tomoyo_mkdev_perm</a>(<a class=\"id\" href=\"#type\">type</a>, &amp;<a class=\"id\" href=\"#path\">path</a>, <a class=\"id\" href=\"#perm\">perm</a>, <a class=\"id\" href=\"#dev\">dev</a>);", 
" <a class=\"id\" href=\"#no_dev\">no_dev</a>:", 
"<span class=\"ts\"/>switch (<a class=\"id\" href=\"#mode\">mode</a> &amp; <a class=\"id\" href=\"#S_IFMT\">S_IFMT</a>) {", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#S_IFIFO\">S_IFIFO</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#type\">type</a> = <a class=\"id\" href=\"#TOMOYO_TYPE_MKFIFO\">TOMOYO_TYPE_MKFIFO</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#S_IFSOCK\">S_IFSOCK</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#type\">type</a> = <a class=\"id\" href=\"#TOMOYO_TYPE_MKSOCK\">TOMOYO_TYPE_MKSOCK</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#tomoyo_path_number_perm\">tomoyo_path_number_perm</a>(<a class=\"id\" href=\"#type\">type</a>, &amp;<a class=\"id\" href=\"#path\">path</a>, <a class=\"id\" href=\"#perm\">perm</a>);", 
"}", 
"", 
"static int <a class=\"id\" href=\"#tomoyo_path_link\">tomoyo_path_link</a>(struct <a class=\"id\" href=\"#dentry\">dentry</a> *<a class=\"id\" href=\"#old_dentry\">old_dentry</a>, struct <a class=\"id\" href=\"#path\">path</a> *<a class=\"id\" href=\"#new_dir\">new_dir</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>    struct <a class=\"id\" href=\"#dentry\">dentry</a> *<a class=\"id\" href=\"#new_dentry\">new_dentry</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#path\">path</a> <a class=\"id\" href=\"#path1\">path1</a> = { <a class=\"id\" href=\"#new_dir\">new_dir</a>-><a class=\"id\" href=\"#mnt\">mnt</a>, <a class=\"id\" href=\"#old_dentry\">old_dentry</a> };", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#path\">path</a> <a class=\"id\" href=\"#path2\">path2</a> = { <a class=\"id\" href=\"#new_dir\">new_dir</a>-><a class=\"id\" href=\"#mnt\">mnt</a>, <a class=\"id\" href=\"#new_dentry\">new_dentry</a> };", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#tomoyo_path2_perm\">tomoyo_path2_perm</a>(<a class=\"id\" href=\"#TOMOYO_TYPE_LINK\">TOMOYO_TYPE_LINK</a>, &amp;<a class=\"id\" href=\"#path1\">path1</a>, &amp;<a class=\"id\" href=\"#path2\">path2</a>);", 
"}", 
"", 
"static int <a class=\"id\" href=\"#tomoyo_path_rename\">tomoyo_path_rename</a>(struct <a class=\"id\" href=\"#path\">path</a> *<a class=\"id\" href=\"#old_parent\">old_parent</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>      struct <a class=\"id\" href=\"#dentry\">dentry</a> *<a class=\"id\" href=\"#old_dentry\">old_dentry</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>      struct <a class=\"id\" href=\"#path\">path</a> *<a class=\"id\" href=\"#new_parent\">new_parent</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>      struct <a class=\"id\" href=\"#dentry\">dentry</a> *<a class=\"id\" href=\"#new_dentry\">new_dentry</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#path\">path</a> <a class=\"id\" href=\"#path1\">path1</a> = { <a class=\"id\" href=\"#old_parent\">old_parent</a>-><a class=\"id\" href=\"#mnt\">mnt</a>, <a class=\"id\" href=\"#old_dentry\">old_dentry</a> };", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#path\">path</a> <a class=\"id\" href=\"#path2\">path2</a> = { <a class=\"id\" href=\"#new_parent\">new_parent</a>-><a class=\"id\" href=\"#mnt\">mnt</a>, <a class=\"id\" href=\"#new_dentry\">new_dentry</a> };", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#tomoyo_path2_perm\">tomoyo_path2_perm</a>(<a class=\"id\" href=\"#TOMOYO_TYPE_RENAME\">TOMOYO_TYPE_RENAME</a>, &amp;<a class=\"id\" href=\"#path1\">path1</a>, &amp;<a class=\"id\" href=\"#path2\">path2</a>);", 
"}", 
"", 
"static int <a class=\"id\" href=\"#tomoyo_file_fcntl\">tomoyo_file_fcntl</a>(struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#file\">file</a>, unsigned int <a class=\"id\" href=\"#cmd\">cmd</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>     unsigned long <a class=\"id\" href=\"#arg\">arg</a>)", 
"{", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#cmd\">cmd</a> == <a class=\"id\" href=\"#F_SETFL\">F_SETFL</a> && ((<a class=\"id\" href=\"#arg\">arg</a> ^ <a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#f_flags\">f_flags</a>) &amp; <a class=\"id\" href=\"#O_APPEND\">O_APPEND</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#tomoyo_path_perm\">tomoyo_path_perm</a>(<a class=\"id\" href=\"#TOMOYO_TYPE_REWRITE\">TOMOYO_TYPE_REWRITE</a>, &amp;<a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#f_path\">f_path</a>);", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"static int <a class=\"id\" href=\"#tomoyo_dentry_open\">tomoyo_dentry_open</a>(struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#f\">f</a>, const struct <a class=\"id\" href=\"#cred\">cred</a> *<a class=\"id\" href=\"#cred\">cred</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#flags\">flags</a> = <a class=\"id\" href=\"#f\">f</a>-><a class=\"id\" href=\"#f_flags\">f_flags</a>;", 
"<span class=\"ts\"/><span class=\"comment\">/* Don't check read permission here if called from do_execve(). */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#current\">current</a>-><a class=\"id\" href=\"#in_execve\">in_execve</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#tomoyo_check_open_permission\">tomoyo_check_open_permission</a>(<a class=\"id\" href=\"#tomoyo_domain\">tomoyo_domain</a>(), &amp;<a class=\"id\" href=\"#f\">f</a>-><a class=\"id\" href=\"#f_path\">f_path</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"}", 
"", 
"static int <a class=\"id\" href=\"#tomoyo_file_ioctl\">tomoyo_file_ioctl</a>(struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#file\">file</a>, unsigned int <a class=\"id\" href=\"#cmd\">cmd</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>     unsigned long <a class=\"id\" href=\"#arg\">arg</a>)", 
"{", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#tomoyo_path_number_perm\">tomoyo_path_number_perm</a>(<a class=\"id\" href=\"#TOMOYO_TYPE_IOCTL\">TOMOYO_TYPE_IOCTL</a>, &amp;<a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#f_path\">f_path</a>, <a class=\"id\" href=\"#cmd\">cmd</a>);", 
"}", 
"", 
"static int <a class=\"id\" href=\"#tomoyo_path_chmod\">tomoyo_path_chmod</a>(struct <a class=\"id\" href=\"#dentry\">dentry</a> *<a class=\"id\" href=\"#dentry\">dentry</a>, struct <a class=\"id\" href=\"#vfsmount\">vfsmount</a> *<a class=\"id\" href=\"#mnt\">mnt</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>     <a class=\"id\" href=\"#mode_t\">mode_t</a> <a class=\"id\" href=\"#mode\">mode</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#path\">path</a> <a class=\"id\" href=\"#path\">path</a> = { <a class=\"id\" href=\"#mnt\">mnt</a>, <a class=\"id\" href=\"#dentry\">dentry</a> };", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#tomoyo_path_number_perm\">tomoyo_path_number_perm</a>(<a class=\"id\" href=\"#TOMOYO_TYPE_CHMOD\">TOMOYO_TYPE_CHMOD</a>, &amp;<a class=\"id\" href=\"#path\">path</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       <a class=\"id\" href=\"#mode\">mode</a> &amp; <a class=\"id\" href=\"#S_IALLUGO\">S_IALLUGO</a>);", 
"}", 
"", 
"static int <a class=\"id\" href=\"#tomoyo_path_chown\">tomoyo_path_chown</a>(struct <a class=\"id\" href=\"#path\">path</a> *<a class=\"id\" href=\"#path\">path</a>, <a class=\"id\" href=\"#uid_t\">uid_t</a> <a class=\"id\" href=\"#uid\">uid</a>, <a class=\"id\" href=\"#gid_t\">gid_t</a> <a class=\"id\" href=\"#gid\">gid</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#error\">error</a> = 0;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#uid\">uid</a> != (<a class=\"id\" href=\"#uid_t\">uid_t</a>) -1)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#error\">error</a> = <a class=\"id\" href=\"#tomoyo_path_number_perm\">tomoyo_path_number_perm</a>(<a class=\"id\" href=\"#TOMOYO_TYPE_CHOWN\">TOMOYO_TYPE_CHOWN</a>, <a class=\"id\" href=\"#path\">path</a>, <a class=\"id\" href=\"#uid\">uid</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#error\">error</a> && <a class=\"id\" href=\"#gid\">gid</a> != (<a class=\"id\" href=\"#gid_t\">gid_t</a>) -1)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#error\">error</a> = <a class=\"id\" href=\"#tomoyo_path_number_perm\">tomoyo_path_number_perm</a>(<a class=\"id\" href=\"#TOMOYO_TYPE_CHGRP\">TOMOYO_TYPE_CHGRP</a>, <a class=\"id\" href=\"#path\">path</a>, <a class=\"id\" href=\"#gid\">gid</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#error\">error</a>;", 
"}", 
"", 
"static int <a class=\"id\" href=\"#tomoyo_path_chroot\">tomoyo_path_chroot</a>(struct <a class=\"id\" href=\"#path\">path</a> *<a class=\"id\" href=\"#path\">path</a>)", 
"{", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#tomoyo_path_perm\">tomoyo_path_perm</a>(<a class=\"id\" href=\"#TOMOYO_TYPE_CHROOT\">TOMOYO_TYPE_CHROOT</a>, <a class=\"id\" href=\"#path\">path</a>);", 
"}", 
"", 
"static int <a class=\"id\" href=\"#tomoyo_sb_mount\">tomoyo_sb_mount</a>(char *<a class=\"id\" href=\"#dev_name\">dev_name</a>, struct <a class=\"id\" href=\"#path\">path</a> *<a class=\"id\" href=\"#path\">path</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>   char *<a class=\"id\" href=\"#type\">type</a>, unsigned long <a class=\"id\" href=\"#flags\">flags</a>, void *<a class=\"id\" href=\"#data\">data</a>)", 
"{", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#tomoyo_mount_permission\">tomoyo_mount_permission</a>(<a class=\"id\" href=\"#dev_name\">dev_name</a>, <a class=\"id\" href=\"#path\">path</a>, <a class=\"id\" href=\"#type\">type</a>, <a class=\"id\" href=\"#flags\">flags</a>, <a class=\"id\" href=\"#data\">data</a>);", 
"}", 
"", 
"static int <a class=\"id\" href=\"#tomoyo_sb_umount\">tomoyo_sb_umount</a>(struct <a class=\"id\" href=\"#vfsmount\">vfsmount</a> *<a class=\"id\" href=\"#mnt\">mnt</a>, int <a class=\"id\" href=\"#flags\">flags</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#path\">path</a> <a class=\"id\" href=\"#path\">path</a> = { <a class=\"id\" href=\"#mnt\">mnt</a>, <a class=\"id\" href=\"#mnt\">mnt</a>-><a class=\"id\" href=\"#mnt_root\">mnt_root</a> };", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#tomoyo_path_perm\">tomoyo_path_perm</a>(<a class=\"id\" href=\"#TOMOYO_TYPE_UMOUNT\">TOMOYO_TYPE_UMOUNT</a>, &amp;<a class=\"id\" href=\"#path\">path</a>);", 
"}", 
"", 
"static int <a class=\"id\" href=\"#tomoyo_sb_pivotroot\">tomoyo_sb_pivotroot</a>(struct <a class=\"id\" href=\"#path\">path</a> *<a class=\"id\" href=\"#old_path\">old_path</a>, struct <a class=\"id\" href=\"#path\">path</a> *<a class=\"id\" href=\"#new_path\">new_path</a>)", 
"{", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#tomoyo_path2_perm\">tomoyo_path2_perm</a>(<a class=\"id\" href=\"#TOMOYO_TYPE_PIVOT_ROOT\">TOMOYO_TYPE_PIVOT_ROOT</a>, <a class=\"id\" href=\"#new_path\">new_path</a>, <a class=\"id\" href=\"#old_path\">old_path</a>);", 
"}", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * tomoyo_security_ops is a \"struct security_operations\" which is used for</span>", 
"<span class=\"comment\"> * registering TOMOYO.</span>", 
"<span class=\"comment\"> */</span>", 
"static struct <a class=\"id\" href=\"#security_operations\">security_operations</a> <a class=\"id\" href=\"#tomoyo_security_ops\">tomoyo_security_ops</a> = {", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#name\">name</a>                = \"tomoyo\",", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#cred_alloc_blank\">cred_alloc_blank</a>    = <a class=\"id\" href=\"#tomoyo_cred_alloc_blank\">tomoyo_cred_alloc_blank</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#cred_prepare\">cred_prepare</a>        = <a class=\"id\" href=\"#tomoyo_cred_prepare\">tomoyo_cred_prepare</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#cred_transfer\">cred_transfer</a><span class=\"ts\"/>     = <a class=\"id\" href=\"#tomoyo_cred_transfer\">tomoyo_cred_transfer</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#cred_free\">cred_free</a>           = <a class=\"id\" href=\"#tomoyo_cred_free\">tomoyo_cred_free</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#bprm_set_creds\">bprm_set_creds</a>      = <a class=\"id\" href=\"#tomoyo_bprm_set_creds\">tomoyo_bprm_set_creds</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#bprm_check_security\">bprm_check_security</a> = <a class=\"id\" href=\"#tomoyo_bprm_check_security\">tomoyo_bprm_check_security</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#file_fcntl\">file_fcntl</a>          = <a class=\"id\" href=\"#tomoyo_file_fcntl\">tomoyo_file_fcntl</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#dentry_open\">dentry_open</a>         = <a class=\"id\" href=\"#tomoyo_dentry_open\">tomoyo_dentry_open</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#path_truncate\">path_truncate</a>       = <a class=\"id\" href=\"#tomoyo_path_truncate\">tomoyo_path_truncate</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#path_unlink\">path_unlink</a>         = <a class=\"id\" href=\"#tomoyo_path_unlink\">tomoyo_path_unlink</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#path_mkdir\">path_mkdir</a>          = <a class=\"id\" href=\"#tomoyo_path_mkdir\">tomoyo_path_mkdir</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#path_rmdir\">path_rmdir</a>          = <a class=\"id\" href=\"#tomoyo_path_rmdir\">tomoyo_path_rmdir</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#path_symlink\">path_symlink</a>        = <a class=\"id\" href=\"#tomoyo_path_symlink\">tomoyo_path_symlink</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#path_mknod\">path_mknod</a>          = <a class=\"id\" href=\"#tomoyo_path_mknod\">tomoyo_path_mknod</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#path_link\">path_link</a>           = <a class=\"id\" href=\"#tomoyo_path_link\">tomoyo_path_link</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#path_rename\">path_rename</a>         = <a class=\"id\" href=\"#tomoyo_path_rename\">tomoyo_path_rename</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#file_ioctl\">file_ioctl</a>          = <a class=\"id\" href=\"#tomoyo_file_ioctl\">tomoyo_file_ioctl</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#path_chmod\">path_chmod</a>          = <a class=\"id\" href=\"#tomoyo_path_chmod\">tomoyo_path_chmod</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#path_chown\">path_chown</a>          = <a class=\"id\" href=\"#tomoyo_path_chown\">tomoyo_path_chown</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#path_chroot\">path_chroot</a>         = <a class=\"id\" href=\"#tomoyo_path_chroot\">tomoyo_path_chroot</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#sb_mount\">sb_mount</a>            = <a class=\"id\" href=\"#tomoyo_sb_mount\">tomoyo_sb_mount</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#sb_umount\">sb_umount</a>           = <a class=\"id\" href=\"#tomoyo_sb_umount\">tomoyo_sb_umount</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#sb_pivotroot\">sb_pivotroot</a>        = <a class=\"id\" href=\"#tomoyo_sb_pivotroot\">tomoyo_sb_pivotroot</a>,", 
"};", 
"", 
"<span class=\"comment\">/* Lock for GC. */</span>", 
"struct <a class=\"id\" href=\"#srcu_struct\">srcu_struct</a> <a class=\"id\" href=\"#tomoyo_ss\">tomoyo_ss</a>;", 
"", 
"static int <a class=\"id\" href=\"#__init\">__init</a> <a class=\"id\" href=\"#tomoyo_init\">tomoyo_init</a>(void)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#cred\">cred</a> *<a class=\"id\" href=\"#cred\">cred</a> = (struct <a class=\"id\" href=\"#cred\">cred</a> *) <a class=\"id\" href=\"#current_cred\">current_cred</a>();", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#security_module_enable\">security_module_enable</a>(&amp;<a class=\"id\" href=\"#tomoyo_security_ops\">tomoyo_security_ops</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"<span class=\"ts\"/><span class=\"comment\">/* register ourselves with the security framework */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#register_security\">register_security</a>(&amp;<a class=\"id\" href=\"#tomoyo_security_ops\">tomoyo_security_ops</a>) ||", 
"<span class=\"ts\"/>    <a class=\"id\" href=\"#init_srcu_struct\">init_srcu_struct</a>(&amp;<a class=\"id\" href=\"#tomoyo_ss\">tomoyo_ss</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#panic\">panic</a>(\"Failure registering TOMOYO Linux\");", 
"<span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_INFO\">KERN_INFO</a> \"TOMOYO Linux initialized\\n\");", 
"<span class=\"ts\"/><a class=\"id\" href=\"#cred\">cred</a>-><a class=\"id\" href=\"#security\">security</a> = &amp;<a class=\"id\" href=\"#tomoyo_kernel_domain\">tomoyo_kernel_domain</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_mm_init\">tomoyo_mm_init</a>();", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"<a class=\"id\" href=\"#security_initcall\">security_initcall</a>(<a class=\"id\" href=\"#tomoyo_init\">tomoyo_init</a>);", 
];
xr_frag_insert('l/58/a1089cc60b10c14d92d271879a368a3d683694.xr', __xr_tmp);
