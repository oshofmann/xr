var __xr_tmp = [
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * Important: we are about to write the buffer, and</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * possibly block, while still holding the journal lock.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * We cannot afford to let the transaction logic start</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * messing around with this buffer before we write it to</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * disk, as that would break recoverability.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#BUFFER_TRACE\">BUFFER_TRACE</a>(<a class=\"id\" href=\"#bh\">bh</a>, \"queue\");", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#get_bh\">get_bh</a>(<a class=\"id\" href=\"#bh\">bh</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#J_ASSERT_BH\">J_ASSERT_BH</a>(<a class=\"id\" href=\"#bh\">bh</a>, !<a class=\"id\" href=\"#buffer_jwrite\">buffer_jwrite</a>(<a class=\"id\" href=\"#bh\">bh</a>));", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#set_buffer_jwrite\">set_buffer_jwrite</a>(<a class=\"id\" href=\"#bh\">bh</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_chkpt_bhs\">j_chkpt_bhs</a>[*<a class=\"id\" href=\"#batch_count\">batch_count</a>] = <a class=\"id\" href=\"#bh\">bh</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#__buffer_relink_io\">__buffer_relink_io</a>(<a class=\"id\" href=\"#jh\">jh</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jbd_unlock_bh_state\">jbd_unlock_bh_state</a>(<a class=\"id\" href=\"#bh\">bh</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_chp_stats\">t_chp_stats</a>.<a class=\"id\" href=\"#cs_written\">cs_written</a>++;", 
"<span class=\"ts\"/><span class=\"ts\"/>(*<a class=\"id\" href=\"#batch_count\">batch_count</a>)++;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (*<a class=\"id\" href=\"#batch_count\">batch_count</a> == <a class=\"id\" href=\"#JBD2_NR_BATCH\">JBD2_NR_BATCH</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock\">spin_unlock</a>(&amp;<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_list_lock\">j_list_lock</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#__flush_batch\">__flush_batch</a>(<a class=\"id\" href=\"#journal\">journal</a>, <a class=\"id\" href=\"#batch_count\">batch_count</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = 1;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ret\">ret</a>;", 
"}", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Perform an actual checkpoint. We take the first transaction on the</span>", 
"<span class=\"comment\"> * list of transactions to be checkpointed and send all its buffers</span>", 
"<span class=\"comment\"> * to disk. We submit larger chunks of data at once.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * The journal should be locked before calling this function.</span>", 
"<span class=\"comment\"> * Called with j_checkpoint_mutex held.</span>", 
"<span class=\"comment\"> */</span>", 
"int <a class=\"id\" href=\"#jbd2_log_do_checkpoint\">jbd2_log_do_checkpoint</a>(<a class=\"id\" href=\"#journal_t\">journal_t</a> *<a class=\"id\" href=\"#journal\">journal</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#transaction_t\">transaction_t</a> *<a class=\"id\" href=\"#transaction\">transaction</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tid_t\">tid_t</a> <a class=\"id\" href=\"#this_tid\">this_tid</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#result\">result</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#jbd_debug\">jbd_debug</a>(1, \"Start checkpoint\\n\");", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * First thing: if there are any transactions in the log which</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * don't need checkpointing, just eliminate them from the</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * journal straight away.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#result\">result</a> = <a class=\"id\" href=\"#jbd2_cleanup_journal_tail\">jbd2_cleanup_journal_tail</a>(<a class=\"id\" href=\"#journal\">journal</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#trace_jbd2_checkpoint\">trace_jbd2_checkpoint</a>(<a class=\"id\" href=\"#journal\">journal</a>, <a class=\"id\" href=\"#result\">result</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#jbd_debug\">jbd_debug</a>(1, \"cleanup_journal_tail returned %d\\n\", <a class=\"id\" href=\"#result\">result</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#result\">result</a> <= 0)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#result\">result</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * OK, we need to start writing disk blocks.  Take one transaction</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * and write it.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#result\">result</a> = 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock\">spin_lock</a>(&amp;<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_list_lock\">j_list_lock</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_checkpoint_transactions\">j_checkpoint_transactions</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#transaction\">transaction</a> = <a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_checkpoint_transactions\">j_checkpoint_transactions</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_chp_stats\">t_chp_stats</a>.<a class=\"id\" href=\"#cs_chp_time\">cs_chp_time</a> == 0)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_chp_stats\">t_chp_stats</a>.<a class=\"id\" href=\"#cs_chp_time\">cs_chp_time</a> = <a class=\"id\" href=\"#jiffies\">jiffies</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#this_tid\">this_tid</a> = <a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_tid\">t_tid</a>;", 
"<a class=\"id\" href=\"#restart\">restart</a>:", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * If someone cleaned up this transaction while we slept, we're</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * done (maybe it's a new transaction, but it fell at the same</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * address).</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_checkpoint_transactions\">j_checkpoint_transactions</a> == <a class=\"id\" href=\"#transaction\">transaction</a> &&", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_tid\">t_tid</a> == <a class=\"id\" href=\"#this_tid\">this_tid</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>int <a class=\"id\" href=\"#batch_count\">batch_count</a> = 0;", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#journal_head\">journal_head</a> *<a class=\"id\" href=\"#jh\">jh</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>int <a class=\"id\" href=\"#retry\">retry</a> = 0, <a class=\"id\" href=\"#err\">err</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>while (!<a class=\"id\" href=\"#retry\">retry</a> && <a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_checkpoint_list\">t_checkpoint_list</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#buffer_head\">buffer_head</a> *<a class=\"id\" href=\"#bh\">bh</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jh\">jh</a> = <a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_checkpoint_list\">t_checkpoint_list</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bh\">bh</a> = <a class=\"id\" href=\"#jh2bh\">jh2bh</a>(<a class=\"id\" href=\"#jh\">jh</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#jbd_trylock_bh_state\">jbd_trylock_bh_state</a>(<a class=\"id\" href=\"#bh\">bh</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jbd_sync_bh\">jbd_sync_bh</a>(<a class=\"id\" href=\"#journal\">journal</a>, <a class=\"id\" href=\"#bh\">bh</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#retry\">retry</a> = 1;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#retry\">retry</a> = <a class=\"id\" href=\"#__process_buffer\">__process_buffer</a>(<a class=\"id\" href=\"#journal\">journal</a>, <a class=\"id\" href=\"#jh\">jh</a>, &amp;<a class=\"id\" href=\"#batch_count\">batch_count</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> <a class=\"id\" href=\"#transaction\">transaction</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#retry\">retry</a> &lt; 0 && !<a class=\"id\" href=\"#result\">result</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#result\">result</a> = <a class=\"id\" href=\"#retry\">retry</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#retry\">retry</a> && (<a class=\"id\" href=\"#need_resched\">need_resched</a>() ||", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_needbreak\">spin_needbreak</a>(&amp;<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_list_lock\">j_list_lock</a>))) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock\">spin_unlock</a>(&amp;<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_list_lock\">j_list_lock</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#retry\">retry</a> = 1;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#batch_count\">batch_count</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#retry\">retry</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock\">spin_unlock</a>(&amp;<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_list_lock\">j_list_lock</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#retry\">retry</a> = 1;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#__flush_batch\">__flush_batch</a>(<a class=\"id\" href=\"#journal\">journal</a>, &amp;<a class=\"id\" href=\"#batch_count\">batch_count</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#retry\">retry</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_lock\">spin_lock</a>(&amp;<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_list_lock\">j_list_lock</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#restart\">restart</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * Now we have cleaned up the first transaction's checkpoint</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * list. Let's clean up the second one</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = <a class=\"id\" href=\"#__wait_cp_io\">__wait_cp_io</a>(<a class=\"id\" href=\"#journal\">journal</a>, <a class=\"id\" href=\"#transaction\">transaction</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#result\">result</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#result\">result</a> = <a class=\"id\" href=\"#err\">err</a>;", 
"<span class=\"ts\"/>}", 
"<a class=\"id\" href=\"#out\">out</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock\">spin_unlock</a>(&amp;<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_list_lock\">j_list_lock</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#result\">result</a> &lt; 0)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jbd2_journal_abort\">jbd2_journal_abort</a>(<a class=\"id\" href=\"#journal\">journal</a>, <a class=\"id\" href=\"#result\">result</a>);", 
"<span class=\"ts\"/>else", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#result\">result</a> = <a class=\"id\" href=\"#jbd2_cleanup_journal_tail\">jbd2_cleanup_journal_tail</a>(<a class=\"id\" href=\"#journal\">journal</a>);", 
"", 
"<span class=\"ts\"/>return (<a class=\"id\" href=\"#result\">result</a> &lt; 0) ? <a class=\"id\" href=\"#result\">result</a> : 0;", 
"}", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Check the list of checkpoint transactions for the journal to see if</span>", 
"<span class=\"comment\"> * we have already got rid of any since the last update of the log tail</span>", 
"<span class=\"comment\"> * in the journal superblock.  If so, we can instantly roll the</span>", 
"<span class=\"comment\"> * superblock forward to remove those transactions from the log.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Return &lt;0 on error, 0 on success, 1 if there was nothing to clean up.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Called with the journal lock held.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * This is the only part of the journaling code which really needs to be</span>", 
"<span class=\"comment\"> * aware of transaction aborts.  Checkpointing involves writing to the</span>", 
"<span class=\"comment\"> * main filesystem area rather than to the journal, so it can proceed</span>", 
"<span class=\"comment\"> * even in abort state, but we must not update the super block if</span>", 
"<span class=\"comment\"> * checkpointing may have failed.  Otherwise, we would lose some metadata</span>", 
"<span class=\"comment\"> * buffers which should be written-back to the filesystem.</span>", 
"<span class=\"comment\"> */</span>", 
"", 
"int <a class=\"id\" href=\"#jbd2_cleanup_journal_tail\">jbd2_cleanup_journal_tail</a>(<a class=\"id\" href=\"#journal_t\">journal_t</a> *<a class=\"id\" href=\"#journal\">journal</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#transaction_t\">transaction_t</a> * <a class=\"id\" href=\"#transaction\">transaction</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tid_t\">tid_t</a><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#first_tid\">first_tid</a>;", 
"<span class=\"ts\"/>unsigned long<span class=\"ts\"/><a class=\"id\" href=\"#blocknr\">blocknr</a>, <a class=\"id\" href=\"#freed\">freed</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#is_journal_aborted\">is_journal_aborted</a>(<a class=\"id\" href=\"#journal\">journal</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return 1;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* OK, work out the oldest transaction remaining in the log, and</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * the log block it starts at.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> *</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * If the log is now empty, we need to work out which is the</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * next transaction ID we will write, and where it will</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * start. */</span>", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#write_lock\">write_lock</a>(&amp;<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_state_lock\">j_state_lock</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock\">spin_lock</a>(&amp;<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_list_lock\">j_list_lock</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#transaction\">transaction</a> = <a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_checkpoint_transactions\">j_checkpoint_transactions</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#transaction\">transaction</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#first_tid\">first_tid</a> = <a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_tid\">t_tid</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#blocknr\">blocknr</a> = <a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_log_start\">t_log_start</a>;", 
"<span class=\"ts\"/>} else if ((<a class=\"id\" href=\"#transaction\">transaction</a> = <a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_committing_transaction\">j_committing_transaction</a>) != <a class=\"id\" href=\"#NULL\">NULL</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#first_tid\">first_tid</a> = <a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_tid\">t_tid</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#blocknr\">blocknr</a> = <a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_log_start\">t_log_start</a>;", 
"<span class=\"ts\"/>} else if ((<a class=\"id\" href=\"#transaction\">transaction</a> = <a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_running_transaction\">j_running_transaction</a>) != <a class=\"id\" href=\"#NULL\">NULL</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#first_tid\">first_tid</a> = <a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_tid\">t_tid</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#blocknr\">blocknr</a> = <a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_head\">j_head</a>;", 
"<span class=\"ts\"/>} else {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#first_tid\">first_tid</a> = <a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_transaction_sequence\">j_transaction_sequence</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#blocknr\">blocknr</a> = <a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_head\">j_head</a>;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock\">spin_unlock</a>(&amp;<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_list_lock\">j_list_lock</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#J_ASSERT\">J_ASSERT</a>(<a class=\"id\" href=\"#blocknr\">blocknr</a> != 0);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* If the oldest pinned transaction is at the tail of the log</span>", 
"<span class=\"comment\">           already then there's not much we can do right now. */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_tail_sequence\">j_tail_sequence</a> == <a class=\"id\" href=\"#first_tid\">first_tid</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#write_unlock\">write_unlock</a>(&amp;<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_state_lock\">j_state_lock</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>return 1;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* OK, update the superblock to recover the freed space.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Physical blocks come first: have we wrapped beyond the end of</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * the log?  */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#freed\">freed</a> = <a class=\"id\" href=\"#blocknr\">blocknr</a> - <a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_tail\">j_tail</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#blocknr\">blocknr</a> &lt; <a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_tail\">j_tail</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#freed\">freed</a> = <a class=\"id\" href=\"#freed\">freed</a> + <a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_last\">j_last</a> - <a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_first\">j_first</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#trace_jbd2_cleanup_journal_tail\">trace_jbd2_cleanup_journal_tail</a>(<a class=\"id\" href=\"#journal\">journal</a>, <a class=\"id\" href=\"#first_tid\">first_tid</a>, <a class=\"id\" href=\"#blocknr\">blocknr</a>, <a class=\"id\" href=\"#freed\">freed</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#jbd_debug\">jbd_debug</a>(1,", 
"<span class=\"ts\"/><span class=\"ts\"/>  \"Cleaning journal tail from %d to %d (offset %lu), \"", 
"<span class=\"ts\"/><span class=\"ts\"/>  \"freeing %lu\\n\",", 
"<span class=\"ts\"/><span class=\"ts\"/>  <a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_tail_sequence\">j_tail_sequence</a>, <a class=\"id\" href=\"#first_tid\">first_tid</a>, <a class=\"id\" href=\"#blocknr\">blocknr</a>, <a class=\"id\" href=\"#freed\">freed</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_free\">j_free</a> += <a class=\"id\" href=\"#freed\">freed</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_tail_sequence\">j_tail_sequence</a> = <a class=\"id\" href=\"#first_tid\">first_tid</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_tail\">j_tail</a> = <a class=\"id\" href=\"#blocknr\">blocknr</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#write_unlock\">write_unlock</a>(&amp;<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_state_lock\">j_state_lock</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * If there is an external journal, we need to make sure that</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * any data blocks that were recently written out --- perhaps</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * by jbd2_log_do_checkpoint() --- are flushed out before we</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * drop the transactions from the external journal.  It's</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * unlikely this will be necessary, especially with a</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * appropriately sized journal, but we need this to guarantee</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * correctness.  Fortunately jbd2_cleanup_journal_tail()</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * doesn't get called all that often.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/>if ((<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_fs_dev\">j_fs_dev</a> != <a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_dev\">j_dev</a>) &&", 
"<span class=\"ts\"/>    (<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_flags\">j_flags</a> &amp; <a class=\"id\" href=\"#JBD2_BARRIER\">JBD2_BARRIER</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#blkdev_issue_flush\">blkdev_issue_flush</a>(<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_fs_dev\">j_fs_dev</a>, <a class=\"id\" href=\"#GFP_KERNEL\">GFP_KERNEL</a>, <a class=\"id\" href=\"#NULL\">NULL</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#BLKDEV_IFL_WAIT\">BLKDEV_IFL_WAIT</a>);", 
"<span class=\"ts\"/>if (!(<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_flags\">j_flags</a> &amp; <a class=\"id\" href=\"#JBD2_ABORT\">JBD2_ABORT</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jbd2_journal_update_superblock\">jbd2_journal_update_superblock</a>(<a class=\"id\" href=\"#journal\">journal</a>, 1);", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"", 
"<span class=\"comment\">/* Checkpoint list management */</span>", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * journal_clean_one_cp_list</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Find all the written-back checkpoint buffers in the given list and release them.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Called with the journal locked.</span>", 
"<span class=\"comment\"> * Called with j_list_lock held.</span>", 
"<span class=\"comment\"> * Returns number of bufers reaped (for debug)</span>", 
"<span class=\"comment\"> */</span>", 
"", 
"static int <a class=\"id\" href=\"#journal_clean_one_cp_list\">journal_clean_one_cp_list</a>(struct <a class=\"id\" href=\"#journal_head\">journal_head</a> *<a class=\"id\" href=\"#jh\">jh</a>, int *<a class=\"id\" href=\"#released\">released</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#journal_head\">journal_head</a> *<a class=\"id\" href=\"#last_jh\">last_jh</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#journal_head\">journal_head</a> *<a class=\"id\" href=\"#next_jh\">next_jh</a> = <a class=\"id\" href=\"#jh\">jh</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#ret\">ret</a>, <a class=\"id\" href=\"#freed\">freed</a> = 0;", 
"", 
"<span class=\"ts\"/>*<a class=\"id\" href=\"#released\">released</a> = 0;", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#jh\">jh</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#last_jh\">last_jh</a> = <a class=\"id\" href=\"#jh\">jh</a>-><a class=\"id\" href=\"#b_cpprev\">b_cpprev</a>;", 
"<span class=\"ts\"/>do {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jh\">jh</a> = <a class=\"id\" href=\"#next_jh\">next_jh</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#next_jh\">next_jh</a> = <a class=\"id\" href=\"#jh\">jh</a>-><a class=\"id\" href=\"#b_cpnext\">b_cpnext</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Use trylock because of the ranking */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#jbd_trylock_bh_state\">jbd_trylock_bh_state</a>(<a class=\"id\" href=\"#jh2bh\">jh2bh</a>(<a class=\"id\" href=\"#jh\">jh</a>))) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#__try_to_free_cp_buf\">__try_to_free_cp_buf</a>(<a class=\"id\" href=\"#jh\">jh</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#ret\">ret</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#freed\">freed</a>++;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#ret\">ret</a> == 2) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>*<a class=\"id\" href=\"#released\">released</a> = 1;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#freed\">freed</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * This function only frees up some memory</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * if possible so we dont have an obligation</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * to finish processing. Bail out if preemption</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * requested:</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#need_resched\">need_resched</a>())", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#freed\">freed</a>;", 
"<span class=\"ts\"/>} while (<a class=\"id\" href=\"#jh\">jh</a> != <a class=\"id\" href=\"#last_jh\">last_jh</a>);", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#freed\">freed</a>;", 
"}", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * journal_clean_checkpoint_list</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Find all the written-back checkpoint buffers in the journal and release them.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Called with the journal locked.</span>", 
"<span class=\"comment\"> * Called with j_list_lock held.</span>", 
"<span class=\"comment\"> * Returns number of buffers reaped (for debug)</span>", 
"<span class=\"comment\"> */</span>", 
"", 
"int <a class=\"id\" href=\"#__jbd2_journal_clean_checkpoint_list\">__jbd2_journal_clean_checkpoint_list</a>(<a class=\"id\" href=\"#journal_t\">journal_t</a> *<a class=\"id\" href=\"#journal\">journal</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#transaction_t\">transaction_t</a> *<a class=\"id\" href=\"#transaction\">transaction</a>, *<a class=\"id\" href=\"#last_transaction\">last_transaction</a>, *<a class=\"id\" href=\"#next_transaction\">next_transaction</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#ret\">ret</a> = 0;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#released\">released</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#transaction\">transaction</a> = <a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_checkpoint_transactions\">j_checkpoint_transactions</a>;", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#transaction\">transaction</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#last_transaction\">last_transaction</a> = <a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_cpprev\">t_cpprev</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#next_transaction\">next_transaction</a> = <a class=\"id\" href=\"#transaction\">transaction</a>;", 
"<span class=\"ts\"/>do {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#transaction\">transaction</a> = <a class=\"id\" href=\"#next_transaction\">next_transaction</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#next_transaction\">next_transaction</a> = <a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_cpnext\">t_cpnext</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> += <a class=\"id\" href=\"#journal_clean_one_cp_list\">journal_clean_one_cp_list</a>(<a class=\"id\" href=\"#transaction\">transaction</a>->", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#t_checkpoint_list\">t_checkpoint_list</a>, &amp;<a class=\"id\" href=\"#released\">released</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * This function only frees up some memory if possible so we</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * dont have an obligation to finish processing. Bail out if</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * preemption requested:</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#need_resched\">need_resched</a>())", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#released\">released</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * It is essential that we are as careful as in the case of</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * t_checkpoint_list with removing the buffer from the list as</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * we can possibly see not yet submitted buffers on io_list</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> += <a class=\"id\" href=\"#journal_clean_one_cp_list\">journal_clean_one_cp_list</a>(<a class=\"id\" href=\"#transaction\">transaction</a>->", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#t_checkpoint_io_list\">t_checkpoint_io_list</a>, &amp;<a class=\"id\" href=\"#released\">released</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#need_resched\">need_resched</a>())", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"<span class=\"ts\"/>} while (<a class=\"id\" href=\"#transaction\">transaction</a> != <a class=\"id\" href=\"#last_transaction\">last_transaction</a>);", 
"<a class=\"id\" href=\"#out\">out</a>:", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ret\">ret</a>;", 
"}", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * journal_remove_checkpoint: called after a buffer has been committed</span>", 
"<span class=\"comment\"> * to disk (either by being write-back flushed to disk, or being</span>", 
"<span class=\"comment\"> * committed to the log).</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * We cannot safely clean a transaction out of the log until all of the</span>", 
"<span class=\"comment\"> * buffer updates committed in that transaction have safely been stored</span>", 
"<span class=\"comment\"> * elsewhere on disk.  To achieve this, all of the buffers in a</span>", 
"<span class=\"comment\"> * transaction need to be maintained on the transaction's checkpoint</span>", 
"<span class=\"comment\"> * lists until they have been rewritten, at which point this function is</span>", 
"<span class=\"comment\"> * called to remove the buffer from the existing transaction's</span>", 
"<span class=\"comment\"> * checkpoint lists.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * The function returns 1 if it frees the transaction, 0 otherwise.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * This function is called with the journal locked.</span>", 
"<span class=\"comment\"> * This function is called with j_list_lock held.</span>", 
"<span class=\"comment\"> * This function is called with jbd_lock_bh_state(jh2bh(jh))</span>", 
"<span class=\"comment\"> */</span>", 
"", 
"int <a class=\"id\" href=\"#__jbd2_journal_remove_checkpoint\">__jbd2_journal_remove_checkpoint</a>(struct <a class=\"id\" href=\"#journal_head\">journal_head</a> *<a class=\"id\" href=\"#jh\">jh</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#transaction_chp_stats_s\">transaction_chp_stats_s</a> *<a class=\"id\" href=\"#stats\">stats</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#transaction_t\">transaction_t</a> *<a class=\"id\" href=\"#transaction\">transaction</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#journal_t\">journal_t</a> *<a class=\"id\" href=\"#journal\">journal</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#ret\">ret</a> = 0;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#JBUFFER_TRACE\">JBUFFER_TRACE</a>(<a class=\"id\" href=\"#jh\">jh</a>, \"entry\");", 
"", 
"<span class=\"ts\"/>if ((<a class=\"id\" href=\"#transaction\">transaction</a> = <a class=\"id\" href=\"#jh\">jh</a>-><a class=\"id\" href=\"#b_cp_transaction\">b_cp_transaction</a>) == <a class=\"id\" href=\"#NULL\">NULL</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#JBUFFER_TRACE\">JBUFFER_TRACE</a>(<a class=\"id\" href=\"#jh\">jh</a>, \"not on transaction\");", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#journal\">journal</a> = <a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_journal\">t_journal</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#__buffer_unlink\">__buffer_unlink</a>(<a class=\"id\" href=\"#jh\">jh</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#jh\">jh</a>-><a class=\"id\" href=\"#b_cp_transaction\">b_cp_transaction</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_checkpoint_list\">t_checkpoint_list</a> != <a class=\"id\" href=\"#NULL\">NULL</a> ||", 
"<span class=\"ts\"/>    <a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_checkpoint_io_list\">t_checkpoint_io_list</a> != <a class=\"id\" href=\"#NULL\">NULL</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#JBUFFER_TRACE\">JBUFFER_TRACE</a>(<a class=\"id\" href=\"#jh\">jh</a>, \"transaction has no more buffers\");", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * There is one special case to worry about: if we have just pulled the</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * buffer off a running or committing transaction's checkpoing list,</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * then even if the checkpoint list is empty, the transaction obviously</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * cannot be dropped!</span>", 
"<span class=\"comment\"><span class=\"ts\"/> *</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * The locking here around t_state is a bit sleazy.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * See the comment at the end of jbd2_journal_commit_transaction().</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_state\">t_state</a> != <a class=\"id\" href=\"#T_FINISHED\">T_FINISHED</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#JBUFFER_TRACE\">JBUFFER_TRACE</a>(<a class=\"id\" href=\"#jh\">jh</a>, \"belongs to running/committing transaction\");", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* OK, that was the last buffer for the transaction: we can now</span>", 
"<span class=\"comment\"><span class=\"ts\"/>   safely remove this transaction from the log */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#stats\">stats</a> = &amp;<a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_chp_stats\">t_chp_stats</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#stats\">stats</a>-><a class=\"id\" href=\"#cs_chp_time\">cs_chp_time</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#stats\">stats</a>-><a class=\"id\" href=\"#cs_chp_time\">cs_chp_time</a> = <a class=\"id\" href=\"#jbd2_time_diff\">jbd2_time_diff</a>(<a class=\"id\" href=\"#stats\">stats</a>-><a class=\"id\" href=\"#cs_chp_time\">cs_chp_time</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>    <a class=\"id\" href=\"#jiffies\">jiffies</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#trace_jbd2_checkpoint_stats\">trace_jbd2_checkpoint_stats</a>(<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_fs_dev\">j_fs_dev</a>-><a class=\"id\" href=\"#bd_dev\">bd_dev</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>    <a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_tid\">t_tid</a>, <a class=\"id\" href=\"#stats\">stats</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#__jbd2_journal_drop_transaction\">__jbd2_journal_drop_transaction</a>(<a class=\"id\" href=\"#journal\">journal</a>, <a class=\"id\" href=\"#transaction\">transaction</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#transaction\">transaction</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Just in case anybody was waiting for more transactions to be</span>", 
"<span class=\"comment\">           checkpointed... */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#wake_up\">wake_up</a>(&amp;<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_wait_logspace\">j_wait_logspace</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = 1;", 
"<a class=\"id\" href=\"#out\">out</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#JBUFFER_TRACE\">JBUFFER_TRACE</a>(<a class=\"id\" href=\"#jh\">jh</a>, \"exit\");", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ret\">ret</a>;", 
"}", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * journal_insert_checkpoint: put a committed buffer onto a checkpoint</span>", 
"<span class=\"comment\"> * list so that we know when it is safe to clean the transaction out of</span>", 
"<span class=\"comment\"> * the log.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Called with the journal locked.</span>", 
"<span class=\"comment\"> * Called with j_list_lock held.</span>", 
"<span class=\"comment\"> */</span>", 
"void <a class=\"id\" href=\"#__jbd2_journal_insert_checkpoint\">__jbd2_journal_insert_checkpoint</a>(struct <a class=\"id\" href=\"#journal_head\">journal_head</a> *<a class=\"id\" href=\"#jh\">jh</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       <a class=\"id\" href=\"#transaction_t\">transaction_t</a> *<a class=\"id\" href=\"#transaction\">transaction</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#JBUFFER_TRACE\">JBUFFER_TRACE</a>(<a class=\"id\" href=\"#jh\">jh</a>, \"entry\");", 
"<span class=\"ts\"/><a class=\"id\" href=\"#J_ASSERT_JH\">J_ASSERT_JH</a>(<a class=\"id\" href=\"#jh\">jh</a>, <a class=\"id\" href=\"#buffer_dirty\">buffer_dirty</a>(<a class=\"id\" href=\"#jh2bh\">jh2bh</a>(<a class=\"id\" href=\"#jh\">jh</a>)) || <a class=\"id\" href=\"#buffer_jbddirty\">buffer_jbddirty</a>(<a class=\"id\" href=\"#jh2bh\">jh2bh</a>(<a class=\"id\" href=\"#jh\">jh</a>)));", 
"<span class=\"ts\"/><a class=\"id\" href=\"#J_ASSERT_JH\">J_ASSERT_JH</a>(<a class=\"id\" href=\"#jh\">jh</a>, <a class=\"id\" href=\"#jh\">jh</a>-><a class=\"id\" href=\"#b_cp_transaction\">b_cp_transaction</a> == <a class=\"id\" href=\"#NULL\">NULL</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#jh\">jh</a>-><a class=\"id\" href=\"#b_cp_transaction\">b_cp_transaction</a> = <a class=\"id\" href=\"#transaction\">transaction</a>;", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_checkpoint_list\">t_checkpoint_list</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jh\">jh</a>-><a class=\"id\" href=\"#b_cpnext\">b_cpnext</a> = <a class=\"id\" href=\"#jh\">jh</a>-><a class=\"id\" href=\"#b_cpprev\">b_cpprev</a> = <a class=\"id\" href=\"#jh\">jh</a>;", 
"<span class=\"ts\"/>} else {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jh\">jh</a>-><a class=\"id\" href=\"#b_cpnext\">b_cpnext</a> = <a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_checkpoint_list\">t_checkpoint_list</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jh\">jh</a>-><a class=\"id\" href=\"#b_cpprev\">b_cpprev</a> = <a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_checkpoint_list\">t_checkpoint_list</a>-><a class=\"id\" href=\"#b_cpprev\">b_cpprev</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jh\">jh</a>-><a class=\"id\" href=\"#b_cpprev\">b_cpprev</a>-><a class=\"id\" href=\"#b_cpnext\">b_cpnext</a> = <a class=\"id\" href=\"#jh\">jh</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jh\">jh</a>-><a class=\"id\" href=\"#b_cpnext\">b_cpnext</a>-><a class=\"id\" href=\"#b_cpprev\">b_cpprev</a> = <a class=\"id\" href=\"#jh\">jh</a>;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_checkpoint_list\">t_checkpoint_list</a> = <a class=\"id\" href=\"#jh\">jh</a>;", 
"}", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * We've finished with this transaction structure: adios...</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * The transaction must have no links except for the checkpoint by this</span>", 
"<span class=\"comment\"> * point.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Called with the journal locked.</span>", 
"<span class=\"comment\"> * Called with j_list_lock held.</span>", 
"<span class=\"comment\"> */</span>", 
"", 
"void <a class=\"id\" href=\"#__jbd2_journal_drop_transaction\">__jbd2_journal_drop_transaction</a>(<a class=\"id\" href=\"#journal_t\">journal_t</a> *<a class=\"id\" href=\"#journal\">journal</a>, <a class=\"id\" href=\"#transaction_t\">transaction_t</a> *<a class=\"id\" href=\"#transaction\">transaction</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#assert_spin_locked\">assert_spin_locked</a>(&amp;<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_list_lock\">j_list_lock</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_cpnext\">t_cpnext</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_cpnext\">t_cpnext</a>-><a class=\"id\" href=\"#t_cpprev\">t_cpprev</a> = <a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_cpprev\">t_cpprev</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_cpprev\">t_cpprev</a>-><a class=\"id\" href=\"#t_cpnext\">t_cpnext</a> = <a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_cpnext\">t_cpnext</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_checkpoint_transactions\">j_checkpoint_transactions</a> == <a class=\"id\" href=\"#transaction\">transaction</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_checkpoint_transactions\">j_checkpoint_transactions</a> =", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_cpnext\">t_cpnext</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_checkpoint_transactions\">j_checkpoint_transactions</a> == <a class=\"id\" href=\"#transaction\">transaction</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_checkpoint_transactions\">j_checkpoint_transactions</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#J_ASSERT\">J_ASSERT</a>(<a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_state\">t_state</a> == <a class=\"id\" href=\"#T_FINISHED\">T_FINISHED</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#J_ASSERT\">J_ASSERT</a>(<a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_buffers\">t_buffers</a> == <a class=\"id\" href=\"#NULL\">NULL</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#J_ASSERT\">J_ASSERT</a>(<a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_forget\">t_forget</a> == <a class=\"id\" href=\"#NULL\">NULL</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#J_ASSERT\">J_ASSERT</a>(<a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_iobuf_list\">t_iobuf_list</a> == <a class=\"id\" href=\"#NULL\">NULL</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#J_ASSERT\">J_ASSERT</a>(<a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_shadow_list\">t_shadow_list</a> == <a class=\"id\" href=\"#NULL\">NULL</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#J_ASSERT\">J_ASSERT</a>(<a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_log_list\">t_log_list</a> == <a class=\"id\" href=\"#NULL\">NULL</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#J_ASSERT\">J_ASSERT</a>(<a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_checkpoint_list\">t_checkpoint_list</a> == <a class=\"id\" href=\"#NULL\">NULL</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#J_ASSERT\">J_ASSERT</a>(<a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_checkpoint_io_list\">t_checkpoint_io_list</a> == <a class=\"id\" href=\"#NULL\">NULL</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#J_ASSERT\">J_ASSERT</a>(<a class=\"id\" href=\"#atomic_read\">atomic_read</a>(&amp;<a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_updates\">t_updates</a>) == 0);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#J_ASSERT\">J_ASSERT</a>(<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_committing_transaction\">j_committing_transaction</a> != <a class=\"id\" href=\"#transaction\">transaction</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#J_ASSERT\">J_ASSERT</a>(<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_running_transaction\">j_running_transaction</a> != <a class=\"id\" href=\"#transaction\">transaction</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#jbd_debug\">jbd_debug</a>(1, \"Dropping transaction %d, all done\\n\", <a class=\"id\" href=\"#transaction\">transaction</a>-><a class=\"id\" href=\"#t_tid\">t_tid</a>);", 
"}", 
];
xr_frag_insert('l/60/b946b2907d9ed4ce3dc5483e691b00a2c43a5d.xr', __xr_tmp);
