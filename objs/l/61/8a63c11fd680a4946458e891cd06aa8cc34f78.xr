var __xr_tmp = [
"<span class=\"comment\">/******************************************************************************</span>", 
"<span class=\"comment\"> * grant_table.c</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Granting foreign access to our memory reservation.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Copyright (c) 2005-2006, Christopher Clark</span>", 
"<span class=\"comment\"> * Copyright (c) 2004-2005, K A Fraser</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * This program is free software; you can redistribute it and/or</span>", 
"<span class=\"comment\"> * modify it under the terms of the GNU General Public License version 2</span>", 
"<span class=\"comment\"> * as published by the Free Software Foundation; or, when distributed</span>", 
"<span class=\"comment\"> * separately from the Linux kernel or incorporated into other</span>", 
"<span class=\"comment\"> * software packages, subject to the following license:</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Permission is hereby granted, free of charge, to any person obtaining a copy</span>", 
"<span class=\"comment\"> * of this source file (the \"Software\"), to deal in the Software without</span>", 
"<span class=\"comment\"> * restriction, including without limitation the rights to use, copy, modify,</span>", 
"<span class=\"comment\"> * merge, publish, distribute, sublicense, and/or sell copies of the Software,</span>", 
"<span class=\"comment\"> * and to permit persons to whom the Software is furnished to do so, subject to</span>", 
"<span class=\"comment\"> * the following conditions:</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * The above copyright notice and this permission notice shall be included in</span>", 
"<span class=\"comment\"> * all copies or substantial portions of the Software.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>", 
"<span class=\"comment\"> * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>", 
"<span class=\"comment\"> * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>", 
"<span class=\"comment\"> * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>", 
"<span class=\"comment\"> * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING</span>", 
"<span class=\"comment\"> * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS</span>", 
"<span class=\"comment\"> * IN THE SOFTWARE.</span>", 
"<span class=\"comment\"> */</span>", 
"", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#module\">module</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#sched\">sched</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#mm\">mm</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#slab\">slab</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#vmalloc\">vmalloc</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#uaccess\">uaccess</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#io\">io</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#xen\">xen</a>/<a class=\"id\" href=\"#xen\">xen</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#xen\">xen</a>/<a class=\"id\" href=\"#interface\">interface</a>/<a class=\"id\" href=\"#xen\">xen</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#xen\">xen</a>/<a class=\"id\" href=\"#page\">page</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#xen\">xen</a>/<a class=\"id\" href=\"#grant_table\">grant_table</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#xen\">xen</a>/<a class=\"id\" href=\"#interface\">interface</a>/<a class=\"id\" href=\"#memory\">memory</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#asm\">asm</a>/<a class=\"id\" href=\"#xen\">xen</a>/<a class=\"id\" href=\"#hypercall\">hypercall</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#asm\">asm</a>/<a class=\"id\" href=\"#pgtable\">pgtable</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#asm\">asm</a>/<a class=\"id\" href=\"#sync_bitops\">sync_bitops</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"", 
"", 
"<span class=\"comment\">/* External tools reserve first few grant table entries. */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#NR_RESERVED_ENTRIES\">NR_RESERVED_ENTRIES</a> 8", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#GNTTAB_LIST_END\">GNTTAB_LIST_END</a> 0xffffffff", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#GREFS_PER_GRANT_FRAME\">GREFS_PER_GRANT_FRAME</a> (<a class=\"id\" href=\"#PAGE_SIZE\">PAGE_SIZE</a> / sizeof(struct <a class=\"id\" href=\"#grant_entry\">grant_entry</a>))", 
"", 
"static <a class=\"id\" href=\"#grant_ref_t\">grant_ref_t</a> **<a class=\"id\" href=\"#gnttab_list\">gnttab_list</a>;", 
"static unsigned int <a class=\"id\" href=\"#nr_grant_frames\">nr_grant_frames</a>;", 
"static unsigned int <a class=\"id\" href=\"#boot_max_nr_grant_frames\">boot_max_nr_grant_frames</a>;", 
"static int <a class=\"id\" href=\"#gnttab_free_count\">gnttab_free_count</a>;", 
"static <a class=\"id\" href=\"#grant_ref_t\">grant_ref_t</a> <a class=\"id\" href=\"#gnttab_free_head\">gnttab_free_head</a>;", 
"static <a class=\"id\" href=\"#DEFINE_SPINLOCK\">DEFINE_SPINLOCK</a>(<a class=\"id\" href=\"#gnttab_list_lock\">gnttab_list_lock</a>);", 
"unsigned long <a class=\"id\" href=\"#xen_hvm_resume_frames\">xen_hvm_resume_frames</a>;", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#xen_hvm_resume_frames\">xen_hvm_resume_frames</a>);", 
"", 
"static struct <a class=\"id\" href=\"#grant_entry\">grant_entry</a> *<a class=\"id\" href=\"#shared\">shared</a>;", 
"", 
"static struct <a class=\"id\" href=\"#gnttab_free_callback\">gnttab_free_callback</a> *<a class=\"id\" href=\"#gnttab_free_callback_list\">gnttab_free_callback_list</a>;", 
"", 
"static int <a class=\"id\" href=\"#gnttab_expand\">gnttab_expand</a>(unsigned int <a class=\"id\" href=\"#req_entries\">req_entries</a>);", 
"", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#RPP\">RPP</a> (<a class=\"id\" href=\"#PAGE_SIZE\">PAGE_SIZE</a> / sizeof(<a class=\"id\" href=\"#grant_ref_t\">grant_ref_t</a>))", 
"", 
"static <a class=\"id\" href=\"#inline\">inline</a> <a class=\"id\" href=\"#grant_ref_t\">grant_ref_t</a> *<a class=\"id\" href=\"#__gnttab_entry\">__gnttab_entry</a>(<a class=\"id\" href=\"#grant_ref_t\">grant_ref_t</a> <a class=\"id\" href=\"#entry\">entry</a>)", 
"{", 
"<span class=\"ts\"/>return &amp;<a class=\"id\" href=\"#gnttab_list\">gnttab_list</a>[(<a class=\"id\" href=\"#entry\">entry</a>) / <a class=\"id\" href=\"#RPP\">RPP</a>][(<a class=\"id\" href=\"#entry\">entry</a>) % <a class=\"id\" href=\"#RPP\">RPP</a>];", 
"}", 
"<span class=\"comment\">/* This can be used as an l-value */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#gnttab_entry\">gnttab_entry</a>(<a class=\"id\" href=\"#entry\">entry</a>) (*<a class=\"id\" href=\"#__gnttab_entry\">__gnttab_entry</a>(<a class=\"id\" href=\"#entry\">entry</a>))", 
"", 
"static int <a class=\"id\" href=\"#get_free_entries\">get_free_entries</a>(unsigned <a class=\"id\" href=\"#count\">count</a>)", 
"{", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#flags\">flags</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#ref\">ref</a>, <a class=\"id\" href=\"#rc\">rc</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#grant_ref_t\">grant_ref_t</a> <a class=\"id\" href=\"#head\">head</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irqsave\">spin_lock_irqsave</a>(&amp;<a class=\"id\" href=\"#gnttab_list_lock\">gnttab_list_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"", 
"<span class=\"ts\"/>if ((<a class=\"id\" href=\"#gnttab_free_count\">gnttab_free_count</a> &lt; <a class=\"id\" href=\"#count\">count</a>) &&", 
"<span class=\"ts\"/>    ((<a class=\"id\" href=\"#rc\">rc</a> = <a class=\"id\" href=\"#gnttab_expand\">gnttab_expand</a>(<a class=\"id\" href=\"#count\">count</a> - <a class=\"id\" href=\"#gnttab_free_count\">gnttab_free_count</a>)) &lt; 0)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#gnttab_list_lock\">gnttab_list_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#rc\">rc</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ref\">ref</a> = <a class=\"id\" href=\"#head\">head</a> = <a class=\"id\" href=\"#gnttab_free_head\">gnttab_free_head</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#gnttab_free_count\">gnttab_free_count</a> -= <a class=\"id\" href=\"#count\">count</a>;", 
"<span class=\"ts\"/>while (<a class=\"id\" href=\"#count\">count</a>-- &gt; 1)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a> = <a class=\"id\" href=\"#gnttab_entry\">gnttab_entry</a>(<a class=\"id\" href=\"#head\">head</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#gnttab_free_head\">gnttab_free_head</a> = <a class=\"id\" href=\"#gnttab_entry\">gnttab_entry</a>(<a class=\"id\" href=\"#head\">head</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#gnttab_entry\">gnttab_entry</a>(<a class=\"id\" href=\"#head\">head</a>) = <a class=\"id\" href=\"#GNTTAB_LIST_END\">GNTTAB_LIST_END</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#gnttab_list_lock\">gnttab_list_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ref\">ref</a>;", 
"}", 
"", 
"static void <a class=\"id\" href=\"#do_free_callbacks\">do_free_callbacks</a>(void)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#gnttab_free_callback\">gnttab_free_callback</a> *<a class=\"id\" href=\"#callback\">callback</a>, *<a class=\"id\" href=\"#next\">next</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#callback\">callback</a> = <a class=\"id\" href=\"#gnttab_free_callback_list\">gnttab_free_callback_list</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#gnttab_free_callback_list\">gnttab_free_callback_list</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"", 
"<span class=\"ts\"/>while (<a class=\"id\" href=\"#callback\">callback</a> != <a class=\"id\" href=\"#NULL\">NULL</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#next\">next</a> = <a class=\"id\" href=\"#callback\">callback</a>-><a class=\"id\" href=\"#next\">next</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#gnttab_free_count\">gnttab_free_count</a> >= <a class=\"id\" href=\"#callback\">callback</a>-><a class=\"id\" href=\"#count\">count</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#callback\">callback</a>-><a class=\"id\" href=\"#next\">next</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#callback\">callback</a>-><a class=\"id\" href=\"#fn\">fn</a>(<a class=\"id\" href=\"#callback\">callback</a>-><a class=\"id\" href=\"#arg\">arg</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>} else {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#callback\">callback</a>-><a class=\"id\" href=\"#next\">next</a> = <a class=\"id\" href=\"#gnttab_free_callback_list\">gnttab_free_callback_list</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#gnttab_free_callback_list\">gnttab_free_callback_list</a> = <a class=\"id\" href=\"#callback\">callback</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#callback\">callback</a> = <a class=\"id\" href=\"#next\">next</a>;", 
"<span class=\"ts\"/>}", 
"}", 
"", 
"static <a class=\"id\" href=\"#inline\">inline</a> void <a class=\"id\" href=\"#check_free_callbacks\">check_free_callbacks</a>(void)", 
"{", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#unlikely\">unlikely</a>(<a class=\"id\" href=\"#gnttab_free_callback_list\">gnttab_free_callback_list</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#do_free_callbacks\">do_free_callbacks</a>();", 
"}", 
"", 
"static void <a class=\"id\" href=\"#put_free_entry\">put_free_entry</a>(<a class=\"id\" href=\"#grant_ref_t\">grant_ref_t</a> <a class=\"id\" href=\"#ref\">ref</a>)", 
"{", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#flags\">flags</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irqsave\">spin_lock_irqsave</a>(&amp;<a class=\"id\" href=\"#gnttab_list_lock\">gnttab_list_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#gnttab_entry\">gnttab_entry</a>(<a class=\"id\" href=\"#ref\">ref</a>) = <a class=\"id\" href=\"#gnttab_free_head\">gnttab_free_head</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#gnttab_free_head\">gnttab_free_head</a> = <a class=\"id\" href=\"#ref\">ref</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#gnttab_free_count\">gnttab_free_count</a>++;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#check_free_callbacks\">check_free_callbacks</a>();", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#gnttab_list_lock\">gnttab_list_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"}", 
"", 
"static void <a class=\"id\" href=\"#update_grant_entry\">update_grant_entry</a>(<a class=\"id\" href=\"#grant_ref_t\">grant_ref_t</a> <a class=\"id\" href=\"#ref\">ref</a>, <a class=\"id\" href=\"#domid_t\">domid_t</a> <a class=\"id\" href=\"#domid\">domid</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       unsigned long <a class=\"id\" href=\"#frame\">frame</a>, unsigned <a class=\"id\" href=\"#flags\">flags</a>)", 
"{", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Introducing a valid entry into the grant table:</span>", 
"<span class=\"comment\"><span class=\"ts\"/> *  1. Write ent-&gt;domid.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> *  2. Write ent-&gt;frame:</span>", 
"<span class=\"comment\"><span class=\"ts\"/> *      GTF_permit_access:   Frame to which access is permitted.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> *      GTF_accept_transfer: Pseudo-phys frame slot being filled by new</span>", 
"<span class=\"comment\"><span class=\"ts\"/> *                           frame, or zero if none.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> *  3. Write memory barrier (WMB).</span>", 
"<span class=\"comment\"><span class=\"ts\"/> *  4. Write ent-&gt;flags, inc. valid type.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shared\">shared</a>[<a class=\"id\" href=\"#ref\">ref</a>].<a class=\"id\" href=\"#frame\">frame</a> = <a class=\"id\" href=\"#frame\">frame</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shared\">shared</a>[<a class=\"id\" href=\"#ref\">ref</a>].<a class=\"id\" href=\"#domid\">domid</a> = <a class=\"id\" href=\"#domid\">domid</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#wmb\">wmb</a>();", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shared\">shared</a>[<a class=\"id\" href=\"#ref\">ref</a>].<a class=\"id\" href=\"#flags\">flags</a> = <a class=\"id\" href=\"#flags\">flags</a>;", 
"}", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Public grant-issuing interface functions</span>", 
"<span class=\"comment\"> */</span>", 
"void <a class=\"id\" href=\"#gnttab_grant_foreign_access_ref\">gnttab_grant_foreign_access_ref</a>(<a class=\"id\" href=\"#grant_ref_t\">grant_ref_t</a> <a class=\"id\" href=\"#ref\">ref</a>, <a class=\"id\" href=\"#domid_t\">domid_t</a> <a class=\"id\" href=\"#domid\">domid</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>     unsigned long <a class=\"id\" href=\"#frame\">frame</a>, int <a class=\"id\" href=\"#readonly\">readonly</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#update_grant_entry\">update_grant_entry</a>(<a class=\"id\" href=\"#ref\">ref</a>, <a class=\"id\" href=\"#domid\">domid</a>, <a class=\"id\" href=\"#frame\">frame</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>   <a class=\"id\" href=\"#GTF_permit_access\">GTF_permit_access</a> | (<a class=\"id\" href=\"#readonly\">readonly</a> ? <a class=\"id\" href=\"#GTF_readonly\">GTF_readonly</a> : 0));", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#gnttab_grant_foreign_access_ref\">gnttab_grant_foreign_access_ref</a>);", 
"", 
"int <a class=\"id\" href=\"#gnttab_grant_foreign_access\">gnttab_grant_foreign_access</a>(<a class=\"id\" href=\"#domid_t\">domid_t</a> <a class=\"id\" href=\"#domid\">domid</a>, unsigned long <a class=\"id\" href=\"#frame\">frame</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>int <a class=\"id\" href=\"#readonly\">readonly</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#ref\">ref</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ref\">ref</a> = <a class=\"id\" href=\"#get_free_entries\">get_free_entries</a>(1);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#unlikely\">unlikely</a>(<a class=\"id\" href=\"#ref\">ref</a> &lt; 0))", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOSPC\">ENOSPC</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#gnttab_grant_foreign_access_ref\">gnttab_grant_foreign_access_ref</a>(<a class=\"id\" href=\"#ref\">ref</a>, <a class=\"id\" href=\"#domid\">domid</a>, <a class=\"id\" href=\"#frame\">frame</a>, <a class=\"id\" href=\"#readonly\">readonly</a>);", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ref\">ref</a>;", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#gnttab_grant_foreign_access\">gnttab_grant_foreign_access</a>);", 
"", 
"int <a class=\"id\" href=\"#gnttab_query_foreign_access\">gnttab_query_foreign_access</a>(<a class=\"id\" href=\"#grant_ref_t\">grant_ref_t</a> <a class=\"id\" href=\"#ref\">ref</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#nflags\">nflags</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#nflags\">nflags</a> = <a class=\"id\" href=\"#shared\">shared</a>[<a class=\"id\" href=\"#ref\">ref</a>].<a class=\"id\" href=\"#flags\">flags</a>;", 
"", 
"<span class=\"ts\"/>return (<a class=\"id\" href=\"#nflags\">nflags</a> &amp; (<a class=\"id\" href=\"#GTF_reading\">GTF_reading</a>|<a class=\"id\" href=\"#GTF_writing\">GTF_writing</a>));", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#gnttab_query_foreign_access\">gnttab_query_foreign_access</a>);", 
"", 
"int <a class=\"id\" href=\"#gnttab_end_foreign_access_ref\">gnttab_end_foreign_access_ref</a>(<a class=\"id\" href=\"#grant_ref_t\">grant_ref_t</a> <a class=\"id\" href=\"#ref\">ref</a>, int <a class=\"id\" href=\"#readonly\">readonly</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#flags\">flags</a>, <a class=\"id\" href=\"#nflags\">nflags</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#nflags\">nflags</a> = <a class=\"id\" href=\"#shared\">shared</a>[<a class=\"id\" href=\"#ref\">ref</a>].<a class=\"id\" href=\"#flags\">flags</a>;", 
"<span class=\"ts\"/>do {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#flags\">flags</a> = <a class=\"id\" href=\"#nflags\">nflags</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#flags\">flags</a> &amp; (<a class=\"id\" href=\"#GTF_reading\">GTF_reading</a>|<a class=\"id\" href=\"#GTF_writing\">GTF_writing</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_ALERT\">KERN_ALERT</a> \"WARNING: g.e. still in use!\\n\");", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>} while ((<a class=\"id\" href=\"#nflags\">nflags</a> = <a class=\"id\" href=\"#sync_cmpxchg\">sync_cmpxchg</a>(&amp;<a class=\"id\" href=\"#shared\">shared</a>[<a class=\"id\" href=\"#ref\">ref</a>].<a class=\"id\" href=\"#flags\">flags</a>, <a class=\"id\" href=\"#flags\">flags</a>, 0)) != <a class=\"id\" href=\"#flags\">flags</a>);", 
"", 
"<span class=\"ts\"/>return 1;", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#gnttab_end_foreign_access_ref\">gnttab_end_foreign_access_ref</a>);", 
"", 
"void <a class=\"id\" href=\"#gnttab_end_foreign_access\">gnttab_end_foreign_access</a>(<a class=\"id\" href=\"#grant_ref_t\">grant_ref_t</a> <a class=\"id\" href=\"#ref\">ref</a>, int <a class=\"id\" href=\"#readonly\">readonly</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       unsigned long <a class=\"id\" href=\"#page\">page</a>)", 
"{", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#gnttab_end_foreign_access_ref\">gnttab_end_foreign_access_ref</a>(<a class=\"id\" href=\"#ref\">ref</a>, <a class=\"id\" href=\"#readonly\">readonly</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#put_free_entry\">put_free_entry</a>(<a class=\"id\" href=\"#ref\">ref</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#page\">page</a> != 0)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#free_page\">free_page</a>(<a class=\"id\" href=\"#page\">page</a>);", 
"<span class=\"ts\"/>} else {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* XXX This needs to be fixed so that the ref and page are</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/>   placed on a list to be freed up later. */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_WARNING\">KERN_WARNING</a>", 
"<span class=\"ts\"/><span class=\"ts\"/>       \"WARNING: leaking g.e. and page still in use!\\n\");", 
"<span class=\"ts\"/>}", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#gnttab_end_foreign_access\">gnttab_end_foreign_access</a>);", 
"", 
"int <a class=\"id\" href=\"#gnttab_grant_foreign_transfer\">gnttab_grant_foreign_transfer</a>(<a class=\"id\" href=\"#domid_t\">domid_t</a> <a class=\"id\" href=\"#domid\">domid</a>, unsigned long <a class=\"id\" href=\"#pfn\">pfn</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#ref\">ref</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ref\">ref</a> = <a class=\"id\" href=\"#get_free_entries\">get_free_entries</a>(1);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#unlikely\">unlikely</a>(<a class=\"id\" href=\"#ref\">ref</a> &lt; 0))", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOSPC\">ENOSPC</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#gnttab_grant_foreign_transfer_ref\">gnttab_grant_foreign_transfer_ref</a>(<a class=\"id\" href=\"#ref\">ref</a>, <a class=\"id\" href=\"#domid\">domid</a>, <a class=\"id\" href=\"#pfn\">pfn</a>);", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ref\">ref</a>;", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#gnttab_grant_foreign_transfer\">gnttab_grant_foreign_transfer</a>);", 
"", 
"void <a class=\"id\" href=\"#gnttab_grant_foreign_transfer_ref\">gnttab_grant_foreign_transfer_ref</a>(<a class=\"id\" href=\"#grant_ref_t\">grant_ref_t</a> <a class=\"id\" href=\"#ref\">ref</a>, <a class=\"id\" href=\"#domid_t\">domid_t</a> <a class=\"id\" href=\"#domid\">domid</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       unsigned long <a class=\"id\" href=\"#pfn\">pfn</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#update_grant_entry\">update_grant_entry</a>(<a class=\"id\" href=\"#ref\">ref</a>, <a class=\"id\" href=\"#domid\">domid</a>, <a class=\"id\" href=\"#pfn\">pfn</a>, <a class=\"id\" href=\"#GTF_accept_transfer\">GTF_accept_transfer</a>);", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#gnttab_grant_foreign_transfer_ref\">gnttab_grant_foreign_transfer_ref</a>);", 
"", 
"unsigned long <a class=\"id\" href=\"#gnttab_end_foreign_transfer_ref\">gnttab_end_foreign_transfer_ref</a>(<a class=\"id\" href=\"#grant_ref_t\">grant_ref_t</a> <a class=\"id\" href=\"#ref\">ref</a>)", 
"{", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#frame\">frame</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a>           <a class=\"id\" href=\"#flags\">flags</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * If a transfer is not even yet started, try to reclaim the grant</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * reference and return failure (== 0).</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/>while (!((<a class=\"id\" href=\"#flags\">flags</a> = <a class=\"id\" href=\"#shared\">shared</a>[<a class=\"id\" href=\"#ref\">ref</a>].<a class=\"id\" href=\"#flags\">flags</a>) &amp; <a class=\"id\" href=\"#GTF_transfer_committed\">GTF_transfer_committed</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#sync_cmpxchg\">sync_cmpxchg</a>(&amp;<a class=\"id\" href=\"#shared\">shared</a>[<a class=\"id\" href=\"#ref\">ref</a>].<a class=\"id\" href=\"#flags\">flags</a>, <a class=\"id\" href=\"#flags\">flags</a>, 0) == <a class=\"id\" href=\"#flags\">flags</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#cpu_relax\">cpu_relax</a>();", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* If a transfer is in progress then wait until it is completed. */</span>", 
"<span class=\"ts\"/>while (!(<a class=\"id\" href=\"#flags\">flags</a> &amp; <a class=\"id\" href=\"#GTF_transfer_completed\">GTF_transfer_completed</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#flags\">flags</a> = <a class=\"id\" href=\"#shared\">shared</a>[<a class=\"id\" href=\"#ref\">ref</a>].<a class=\"id\" href=\"#flags\">flags</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#cpu_relax\">cpu_relax</a>();", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rmb\">rmb</a>();<span class=\"ts\"/><span class=\"comment\">/* Read the frame number /after/ reading completion status. */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#frame\">frame</a> = <a class=\"id\" href=\"#shared\">shared</a>[<a class=\"id\" href=\"#ref\">ref</a>].<a class=\"id\" href=\"#frame\">frame</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#BUG_ON\">BUG_ON</a>(<a class=\"id\" href=\"#frame\">frame</a> == 0);", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#frame\">frame</a>;", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#gnttab_end_foreign_transfer_ref\">gnttab_end_foreign_transfer_ref</a>);", 
"", 
"unsigned long <a class=\"id\" href=\"#gnttab_end_foreign_transfer\">gnttab_end_foreign_transfer</a>(<a class=\"id\" href=\"#grant_ref_t\">grant_ref_t</a> <a class=\"id\" href=\"#ref\">ref</a>)", 
"{", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#frame\">frame</a> = <a class=\"id\" href=\"#gnttab_end_foreign_transfer_ref\">gnttab_end_foreign_transfer_ref</a>(<a class=\"id\" href=\"#ref\">ref</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#put_free_entry\">put_free_entry</a>(<a class=\"id\" href=\"#ref\">ref</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#frame\">frame</a>;", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#gnttab_end_foreign_transfer\">gnttab_end_foreign_transfer</a>);", 
"", 
"void <a class=\"id\" href=\"#gnttab_free_grant_reference\">gnttab_free_grant_reference</a>(<a class=\"id\" href=\"#grant_ref_t\">grant_ref_t</a> <a class=\"id\" href=\"#ref\">ref</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#put_free_entry\">put_free_entry</a>(<a class=\"id\" href=\"#ref\">ref</a>);", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#gnttab_free_grant_reference\">gnttab_free_grant_reference</a>);", 
"", 
"void <a class=\"id\" href=\"#gnttab_free_grant_references\">gnttab_free_grant_references</a>(<a class=\"id\" href=\"#grant_ref_t\">grant_ref_t</a> <a class=\"id\" href=\"#head\">head</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#grant_ref_t\">grant_ref_t</a> <a class=\"id\" href=\"#ref\">ref</a>;", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#flags\">flags</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#count\">count</a> = 1;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#head\">head</a> == <a class=\"id\" href=\"#GNTTAB_LIST_END\">GNTTAB_LIST_END</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irqsave\">spin_lock_irqsave</a>(&amp;<a class=\"id\" href=\"#gnttab_list_lock\">gnttab_list_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ref\">ref</a> = <a class=\"id\" href=\"#head\">head</a>;", 
"<span class=\"ts\"/>while (<a class=\"id\" href=\"#gnttab_entry\">gnttab_entry</a>(<a class=\"id\" href=\"#ref\">ref</a>) != <a class=\"id\" href=\"#GNTTAB_LIST_END\">GNTTAB_LIST_END</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ref\">ref</a> = <a class=\"id\" href=\"#gnttab_entry\">gnttab_entry</a>(<a class=\"id\" href=\"#ref\">ref</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#count\">count</a>++;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#gnttab_entry\">gnttab_entry</a>(<a class=\"id\" href=\"#ref\">ref</a>) = <a class=\"id\" href=\"#gnttab_free_head\">gnttab_free_head</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#gnttab_free_head\">gnttab_free_head</a> = <a class=\"id\" href=\"#head\">head</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#gnttab_free_count\">gnttab_free_count</a> += <a class=\"id\" href=\"#count\">count</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#check_free_callbacks\">check_free_callbacks</a>();", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#gnttab_list_lock\">gnttab_list_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#gnttab_free_grant_references\">gnttab_free_grant_references</a>);", 
"", 
"int <a class=\"id\" href=\"#gnttab_alloc_grant_references\">gnttab_alloc_grant_references</a>(<a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#count\">count</a>, <a class=\"id\" href=\"#grant_ref_t\">grant_ref_t</a> *<a class=\"id\" href=\"#head\">head</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#h\">h</a> = <a class=\"id\" href=\"#get_free_entries\">get_free_entries</a>(<a class=\"id\" href=\"#count\">count</a>);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#h\">h</a> &lt; 0)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOSPC\">ENOSPC</a>;", 
"", 
"<span class=\"ts\"/>*<a class=\"id\" href=\"#head\">head</a> = <a class=\"id\" href=\"#h\">h</a>;", 
"", 
"<span class=\"ts\"/>return 0;", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#gnttab_alloc_grant_references\">gnttab_alloc_grant_references</a>);", 
"", 
"int <a class=\"id\" href=\"#gnttab_empty_grant_references\">gnttab_empty_grant_references</a>(const <a class=\"id\" href=\"#grant_ref_t\">grant_ref_t</a> *<a class=\"id\" href=\"#private_head\">private_head</a>)", 
"{", 
"<span class=\"ts\"/>return (*<a class=\"id\" href=\"#private_head\">private_head</a> == <a class=\"id\" href=\"#GNTTAB_LIST_END\">GNTTAB_LIST_END</a>);", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#gnttab_empty_grant_references\">gnttab_empty_grant_references</a>);", 
"", 
"int <a class=\"id\" href=\"#gnttab_claim_grant_reference\">gnttab_claim_grant_reference</a>(<a class=\"id\" href=\"#grant_ref_t\">grant_ref_t</a> *<a class=\"id\" href=\"#private_head\">private_head</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#grant_ref_t\">grant_ref_t</a> <a class=\"id\" href=\"#g\">g</a> = *<a class=\"id\" href=\"#private_head\">private_head</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#unlikely\">unlikely</a>(<a class=\"id\" href=\"#g\">g</a> == <a class=\"id\" href=\"#GNTTAB_LIST_END\">GNTTAB_LIST_END</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOSPC\">ENOSPC</a>;", 
"<span class=\"ts\"/>*<a class=\"id\" href=\"#private_head\">private_head</a> = <a class=\"id\" href=\"#gnttab_entry\">gnttab_entry</a>(<a class=\"id\" href=\"#g\">g</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#g\">g</a>;", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#gnttab_claim_grant_reference\">gnttab_claim_grant_reference</a>);", 
"", 
"void <a class=\"id\" href=\"#gnttab_release_grant_reference\">gnttab_release_grant_reference</a>(<a class=\"id\" href=\"#grant_ref_t\">grant_ref_t</a> *<a class=\"id\" href=\"#private_head\">private_head</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>    <a class=\"id\" href=\"#grant_ref_t\">grant_ref_t</a> <a class=\"id\" href=\"#release\">release</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#gnttab_entry\">gnttab_entry</a>(<a class=\"id\" href=\"#release\">release</a>) = *<a class=\"id\" href=\"#private_head\">private_head</a>;", 
"<span class=\"ts\"/>*<a class=\"id\" href=\"#private_head\">private_head</a> = <a class=\"id\" href=\"#release\">release</a>;", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#gnttab_release_grant_reference\">gnttab_release_grant_reference</a>);", 
"", 
"void <a class=\"id\" href=\"#gnttab_request_free_callback\">gnttab_request_free_callback</a>(struct <a class=\"id\" href=\"#gnttab_free_callback\">gnttab_free_callback</a> *<a class=\"id\" href=\"#callback\">callback</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>  void (*<a class=\"id\" href=\"#fn\">fn</a>)(void *), void *<a class=\"id\" href=\"#arg\">arg</a>, <a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#count\">count</a>)", 
"{", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#flags\">flags</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irqsave\">spin_lock_irqsave</a>(&amp;<a class=\"id\" href=\"#gnttab_list_lock\">gnttab_list_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#callback\">callback</a>-><a class=\"id\" href=\"#next\">next</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#callback\">callback</a>-><a class=\"id\" href=\"#fn\">fn</a> = <a class=\"id\" href=\"#fn\">fn</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#callback\">callback</a>-><a class=\"id\" href=\"#arg\">arg</a> = <a class=\"id\" href=\"#arg\">arg</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#callback\">callback</a>-><a class=\"id\" href=\"#count\">count</a> = <a class=\"id\" href=\"#count\">count</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#callback\">callback</a>-><a class=\"id\" href=\"#next\">next</a> = <a class=\"id\" href=\"#gnttab_free_callback_list\">gnttab_free_callback_list</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#gnttab_free_callback_list\">gnttab_free_callback_list</a> = <a class=\"id\" href=\"#callback\">callback</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#check_free_callbacks\">check_free_callbacks</a>();", 
"<a class=\"id\" href=\"#out\">out</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#gnttab_list_lock\">gnttab_list_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#gnttab_request_free_callback\">gnttab_request_free_callback</a>);", 
"", 
"void <a class=\"id\" href=\"#gnttab_cancel_free_callback\">gnttab_cancel_free_callback</a>(struct <a class=\"id\" href=\"#gnttab_free_callback\">gnttab_free_callback</a> *<a class=\"id\" href=\"#callback\">callback</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#gnttab_free_callback\">gnttab_free_callback</a> **<a class=\"id\" href=\"#pcb\">pcb</a>;", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#flags\">flags</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irqsave\">spin_lock_irqsave</a>(&amp;<a class=\"id\" href=\"#gnttab_list_lock\">gnttab_list_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#pcb\">pcb</a> = &amp;<a class=\"id\" href=\"#gnttab_free_callback_list\">gnttab_free_callback_list</a>; *<a class=\"id\" href=\"#pcb\">pcb</a>; <a class=\"id\" href=\"#pcb\">pcb</a> = &amp;(*<a class=\"id\" href=\"#pcb\">pcb</a>)-><a class=\"id\" href=\"#next\">next</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>if (*<a class=\"id\" href=\"#pcb\">pcb</a> == <a class=\"id\" href=\"#callback\">callback</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>*<a class=\"id\" href=\"#pcb\">pcb</a> = <a class=\"id\" href=\"#callback\">callback</a>-><a class=\"id\" href=\"#next\">next</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#gnttab_list_lock\">gnttab_list_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#gnttab_cancel_free_callback\">gnttab_cancel_free_callback</a>);", 
"", 
"static int <a class=\"id\" href=\"#grow_gnttab_list\">grow_gnttab_list</a>(unsigned int <a class=\"id\" href=\"#more_frames\">more_frames</a>)", 
"{", 
"<span class=\"ts\"/>unsigned int <a class=\"id\" href=\"#new_nr_grant_frames\">new_nr_grant_frames</a>, <a class=\"id\" href=\"#extra_entries\">extra_entries</a>, <a class=\"id\" href=\"#i\">i</a>;", 
"<span class=\"ts\"/>unsigned int <a class=\"id\" href=\"#nr_glist_frames\">nr_glist_frames</a>, <a class=\"id\" href=\"#new_nr_glist_frames\">new_nr_glist_frames</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#new_nr_grant_frames\">new_nr_grant_frames</a> = <a class=\"id\" href=\"#nr_grant_frames\">nr_grant_frames</a> + <a class=\"id\" href=\"#more_frames\">more_frames</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#extra_entries\">extra_entries</a>       = <a class=\"id\" href=\"#more_frames\">more_frames</a> * <a class=\"id\" href=\"#GREFS_PER_GRANT_FRAME\">GREFS_PER_GRANT_FRAME</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#nr_glist_frames\">nr_glist_frames</a> = (<a class=\"id\" href=\"#nr_grant_frames\">nr_grant_frames</a> * <a class=\"id\" href=\"#GREFS_PER_GRANT_FRAME\">GREFS_PER_GRANT_FRAME</a> + <a class=\"id\" href=\"#RPP\">RPP</a> - 1) / <a class=\"id\" href=\"#RPP\">RPP</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#new_nr_glist_frames\">new_nr_glist_frames</a> =", 
"<span class=\"ts\"/><span class=\"ts\"/>(<a class=\"id\" href=\"#new_nr_grant_frames\">new_nr_grant_frames</a> * <a class=\"id\" href=\"#GREFS_PER_GRANT_FRAME\">GREFS_PER_GRANT_FRAME</a> + <a class=\"id\" href=\"#RPP\">RPP</a> - 1) / <a class=\"id\" href=\"#RPP\">RPP</a>;", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = <a class=\"id\" href=\"#nr_glist_frames\">nr_glist_frames</a>; <a class=\"id\" href=\"#i\">i</a> &lt; <a class=\"id\" href=\"#new_nr_glist_frames\">new_nr_glist_frames</a>; <a class=\"id\" href=\"#i\">i</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#gnttab_list\">gnttab_list</a>[<a class=\"id\" href=\"#i\">i</a>] = (<a class=\"id\" href=\"#grant_ref_t\">grant_ref_t</a> *)<a class=\"id\" href=\"#__get_free_page\">__get_free_page</a>(<a class=\"id\" href=\"#GFP_ATOMIC\">GFP_ATOMIC</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#gnttab_list\">gnttab_list</a>[<a class=\"id\" href=\"#i\">i</a>])", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#grow_nomem\">grow_nomem</a>;", 
"<span class=\"ts\"/>}", 
"", 
"", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = <a class=\"id\" href=\"#GREFS_PER_GRANT_FRAME\">GREFS_PER_GRANT_FRAME</a> * <a class=\"id\" href=\"#nr_grant_frames\">nr_grant_frames</a>;", 
"<span class=\"ts\"/>     <a class=\"id\" href=\"#i\">i</a> &lt; <a class=\"id\" href=\"#GREFS_PER_GRANT_FRAME\">GREFS_PER_GRANT_FRAME</a> * <a class=\"id\" href=\"#new_nr_grant_frames\">new_nr_grant_frames</a> - 1; <a class=\"id\" href=\"#i\">i</a>++)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#gnttab_entry\">gnttab_entry</a>(<a class=\"id\" href=\"#i\">i</a>) = <a class=\"id\" href=\"#i\">i</a> + 1;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#gnttab_entry\">gnttab_entry</a>(<a class=\"id\" href=\"#i\">i</a>) = <a class=\"id\" href=\"#gnttab_free_head\">gnttab_free_head</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#gnttab_free_head\">gnttab_free_head</a> = <a class=\"id\" href=\"#GREFS_PER_GRANT_FRAME\">GREFS_PER_GRANT_FRAME</a> * <a class=\"id\" href=\"#nr_grant_frames\">nr_grant_frames</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#gnttab_free_count\">gnttab_free_count</a> += <a class=\"id\" href=\"#extra_entries\">extra_entries</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#nr_grant_frames\">nr_grant_frames</a> = <a class=\"id\" href=\"#new_nr_grant_frames\">new_nr_grant_frames</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#check_free_callbacks\">check_free_callbacks</a>();", 
"", 
"<span class=\"ts\"/>return 0;", 
"", 
"<a class=\"id\" href=\"#grow_nomem\">grow_nomem</a>:", 
"<span class=\"ts\"/>for ( ; <a class=\"id\" href=\"#i\">i</a> >= <a class=\"id\" href=\"#nr_glist_frames\">nr_glist_frames</a>; <a class=\"id\" href=\"#i\">i</a>--)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#free_page\">free_page</a>((unsigned long) <a class=\"id\" href=\"#gnttab_list\">gnttab_list</a>[<a class=\"id\" href=\"#i\">i</a>]);", 
"<span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"}", 
"", 
"static unsigned int <a class=\"id\" href=\"#__max_nr_grant_frames\">__max_nr_grant_frames</a>(void)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#gnttab_query_size\">gnttab_query_size</a> <a class=\"id\" href=\"#query\">query</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#rc\">rc</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#query\">query</a>.<a class=\"id\" href=\"#dom\">dom</a> = <a class=\"id\" href=\"#DOMID_SELF\">DOMID_SELF</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rc\">rc</a> = <a class=\"id\" href=\"#HYPERVISOR_grant_table_op\">HYPERVISOR_grant_table_op</a>(<a class=\"id\" href=\"#GNTTABOP_query_size\">GNTTABOP_query_size</a>, &amp;<a class=\"id\" href=\"#query\">query</a>, 1);", 
"<span class=\"ts\"/>if ((<a class=\"id\" href=\"#rc\">rc</a> &lt; 0) || (<a class=\"id\" href=\"#query\">query</a>.<a class=\"id\" href=\"#status\">status</a> != <a class=\"id\" href=\"#GNTST_okay\">GNTST_okay</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return 4; <span class=\"comment\">/* Legacy max supported number of frames */</span>", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#query\">query</a>.<a class=\"id\" href=\"#max_nr_frames\">max_nr_frames</a>;", 
"}", 
"", 
"unsigned int <a class=\"id\" href=\"#gnttab_max_grant_frames\">gnttab_max_grant_frames</a>(void)", 
"{", 
"<span class=\"ts\"/>unsigned int <a class=\"id\" href=\"#xen_max\">xen_max</a> = <a class=\"id\" href=\"#__max_nr_grant_frames\">__max_nr_grant_frames</a>();", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#xen_max\">xen_max</a> &gt; <a class=\"id\" href=\"#boot_max_nr_grant_frames\">boot_max_nr_grant_frames</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#boot_max_nr_grant_frames\">boot_max_nr_grant_frames</a>;", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#xen_max\">xen_max</a>;", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#gnttab_max_grant_frames\">gnttab_max_grant_frames</a>);", 
"", 
"static int <a class=\"id\" href=\"#gnttab_map\">gnttab_map</a>(unsigned int <a class=\"id\" href=\"#start_idx\">start_idx</a>, unsigned int <a class=\"id\" href=\"#end_idx\">end_idx</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#gnttab_setup_table\">gnttab_setup_table</a> <a class=\"id\" href=\"#setup\">setup</a>;", 
"<span class=\"ts\"/>unsigned long *<a class=\"id\" href=\"#frames\">frames</a>;", 
"<span class=\"ts\"/>unsigned int <a class=\"id\" href=\"#nr_gframes\">nr_gframes</a> = <a class=\"id\" href=\"#end_idx\">end_idx</a> + 1;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#rc\">rc</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#xen_hvm_domain\">xen_hvm_domain</a>()) {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#xen_add_to_physmap\">xen_add_to_physmap</a> <a class=\"id\" href=\"#xatp\">xatp</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>unsigned int <a class=\"id\" href=\"#i\">i</a> = <a class=\"id\" href=\"#end_idx\">end_idx</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rc\">rc</a> = 0;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * Loop backwards, so that the first hypercall has the largest</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * index, ensuring that the table will grow only once.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>do {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#xatp\">xatp</a>.<a class=\"id\" href=\"#domid\">domid</a> = <a class=\"id\" href=\"#DOMID_SELF\">DOMID_SELF</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#xatp\">xatp</a>.<a class=\"id\" href=\"#idx\">idx</a> = <a class=\"id\" href=\"#i\">i</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#xatp\">xatp</a>.<a class=\"id\" href=\"#space\">space</a> = <a class=\"id\" href=\"#XENMAPSPACE_grant_table\">XENMAPSPACE_grant_table</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#xatp\">xatp</a>.<a class=\"id\" href=\"#gpfn\">gpfn</a> = (<a class=\"id\" href=\"#xen_hvm_resume_frames\">xen_hvm_resume_frames</a> >> <a class=\"id\" href=\"#PAGE_SHIFT\">PAGE_SHIFT</a>) + <a class=\"id\" href=\"#i\">i</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rc\">rc</a> = <a class=\"id\" href=\"#HYPERVISOR_memory_op\">HYPERVISOR_memory_op</a>(<a class=\"id\" href=\"#XENMEM_add_to_physmap\">XENMEM_add_to_physmap</a>, &amp;<a class=\"id\" href=\"#xatp\">xatp</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#rc\">rc</a> != 0) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_WARNING\">KERN_WARNING</a>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>\"grant table add_to_physmap failed, err=%d\\n\", <a class=\"id\" href=\"#rc\">rc</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/>} while (<a class=\"id\" href=\"#i\">i</a>-- &gt; <a class=\"id\" href=\"#start_idx\">start_idx</a>);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#rc\">rc</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#frames\">frames</a> = <a class=\"id\" href=\"#kmalloc\">kmalloc</a>(<a class=\"id\" href=\"#nr_gframes\">nr_gframes</a> * sizeof(unsigned long), <a class=\"id\" href=\"#GFP_ATOMIC\">GFP_ATOMIC</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#frames\">frames</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#setup\">setup</a>.<a class=\"id\" href=\"#dom\">dom</a>        = <a class=\"id\" href=\"#DOMID_SELF\">DOMID_SELF</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#setup\">setup</a>.<a class=\"id\" href=\"#nr_frames\">nr_frames</a>  = <a class=\"id\" href=\"#nr_gframes\">nr_gframes</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#set_xen_guest_handle\">set_xen_guest_handle</a>(<a class=\"id\" href=\"#setup\">setup</a>.<a class=\"id\" href=\"#frame_list\">frame_list</a>, <a class=\"id\" href=\"#frames\">frames</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rc\">rc</a> = <a class=\"id\" href=\"#HYPERVISOR_grant_table_op\">HYPERVISOR_grant_table_op</a>(<a class=\"id\" href=\"#GNTTABOP_setup_table\">GNTTABOP_setup_table</a>, &amp;<a class=\"id\" href=\"#setup\">setup</a>, 1);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#rc\">rc</a> == -<a class=\"id\" href=\"#ENOSYS\">ENOSYS</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#frames\">frames</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOSYS\">ENOSYS</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#BUG_ON\">BUG_ON</a>(<a class=\"id\" href=\"#rc\">rc</a> || <a class=\"id\" href=\"#setup\">setup</a>.<a class=\"id\" href=\"#status\">status</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rc\">rc</a> = <a class=\"id\" href=\"#arch_gnttab_map_shared\">arch_gnttab_map_shared</a>(<a class=\"id\" href=\"#frames\">frames</a>, <a class=\"id\" href=\"#nr_gframes\">nr_gframes</a>, <a class=\"id\" href=\"#gnttab_max_grant_frames\">gnttab_max_grant_frames</a>(),", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>    &amp;<a class=\"id\" href=\"#shared\">shared</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#BUG_ON\">BUG_ON</a>(<a class=\"id\" href=\"#rc\">rc</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#frames\">frames</a>);", 
"", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"int <a class=\"id\" href=\"#gnttab_resume\">gnttab_resume</a>(void)", 
"{", 
"<span class=\"ts\"/>unsigned int <a class=\"id\" href=\"#max_nr_gframes\">max_nr_gframes</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#max_nr_gframes\">max_nr_gframes</a> = <a class=\"id\" href=\"#gnttab_max_grant_frames\">gnttab_max_grant_frames</a>();", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#max_nr_gframes\">max_nr_gframes</a> &lt; <a class=\"id\" href=\"#nr_grant_frames\">nr_grant_frames</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOSYS\">ENOSYS</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#xen_pv_domain\">xen_pv_domain</a>())", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#gnttab_map\">gnttab_map</a>(0, <a class=\"id\" href=\"#nr_grant_frames\">nr_grant_frames</a> - 1);", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#shared\">shared</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#shared\">shared</a> = <a class=\"id\" href=\"#ioremap\">ioremap</a>(<a class=\"id\" href=\"#xen_hvm_resume_frames\">xen_hvm_resume_frames</a>, <a class=\"id\" href=\"#PAGE_SIZE\">PAGE_SIZE</a> * <a class=\"id\" href=\"#max_nr_gframes\">max_nr_gframes</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#shared\">shared</a> == <a class=\"id\" href=\"#NULL\">NULL</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_WARNING\">KERN_WARNING</a>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>\"Failed to ioremap gnttab share frames!\");", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#gnttab_map\">gnttab_map</a>(0, <a class=\"id\" href=\"#nr_grant_frames\">nr_grant_frames</a> - 1);", 
"", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"int <a class=\"id\" href=\"#gnttab_suspend\">gnttab_suspend</a>(void)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#arch_gnttab_unmap_shared\">arch_gnttab_unmap_shared</a>(<a class=\"id\" href=\"#shared\">shared</a>, <a class=\"id\" href=\"#nr_grant_frames\">nr_grant_frames</a>);", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"static int <a class=\"id\" href=\"#gnttab_expand\">gnttab_expand</a>(unsigned int <a class=\"id\" href=\"#req_entries\">req_entries</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#rc\">rc</a>;", 
"<span class=\"ts\"/>unsigned int <a class=\"id\" href=\"#cur\">cur</a>, <a class=\"id\" href=\"#extra\">extra</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#cur\">cur</a> = <a class=\"id\" href=\"#nr_grant_frames\">nr_grant_frames</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#extra\">extra</a> = ((<a class=\"id\" href=\"#req_entries\">req_entries</a> + (<a class=\"id\" href=\"#GREFS_PER_GRANT_FRAME\">GREFS_PER_GRANT_FRAME</a>-1)) /", 
"<span class=\"ts\"/><span class=\"ts\"/> <a class=\"id\" href=\"#GREFS_PER_GRANT_FRAME\">GREFS_PER_GRANT_FRAME</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#cur\">cur</a> + <a class=\"id\" href=\"#extra\">extra</a> &gt; <a class=\"id\" href=\"#gnttab_max_grant_frames\">gnttab_max_grant_frames</a>())", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOSPC\">ENOSPC</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rc\">rc</a> = <a class=\"id\" href=\"#gnttab_map\">gnttab_map</a>(<a class=\"id\" href=\"#cur\">cur</a>, <a class=\"id\" href=\"#cur\">cur</a> + <a class=\"id\" href=\"#extra\">extra</a> - 1);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#rc\">rc</a> == 0)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rc\">rc</a> = <a class=\"id\" href=\"#grow_gnttab_list\">grow_gnttab_list</a>(<a class=\"id\" href=\"#extra\">extra</a>);", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#rc\">rc</a>;", 
"}", 
"", 
"int <a class=\"id\" href=\"#gnttab_init\">gnttab_init</a>(void)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#i\">i</a>;", 
"<span class=\"ts\"/>unsigned int <a class=\"id\" href=\"#max_nr_glist_frames\">max_nr_glist_frames</a>, <a class=\"id\" href=\"#nr_glist_frames\">nr_glist_frames</a>;", 
"<span class=\"ts\"/>unsigned int <a class=\"id\" href=\"#nr_init_grefs\">nr_init_grefs</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#nr_grant_frames\">nr_grant_frames</a> = 1;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#boot_max_nr_grant_frames\">boot_max_nr_grant_frames</a> = <a class=\"id\" href=\"#__max_nr_grant_frames\">__max_nr_grant_frames</a>();", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Determine the maximum number of frames required for the</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * grant reference free list on the current hypervisor.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#max_nr_glist_frames\">max_nr_glist_frames</a> = (<a class=\"id\" href=\"#boot_max_nr_grant_frames\">boot_max_nr_grant_frames</a> *", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       <a class=\"id\" href=\"#GREFS_PER_GRANT_FRAME\">GREFS_PER_GRANT_FRAME</a> / <a class=\"id\" href=\"#RPP\">RPP</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#gnttab_list\">gnttab_list</a> = <a class=\"id\" href=\"#kmalloc\">kmalloc</a>(<a class=\"id\" href=\"#max_nr_glist_frames\">max_nr_glist_frames</a> * sizeof(<a class=\"id\" href=\"#grant_ref_t\">grant_ref_t</a> *),", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>      <a class=\"id\" href=\"#GFP_KERNEL\">GFP_KERNEL</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#gnttab_list\">gnttab_list</a> == <a class=\"id\" href=\"#NULL\">NULL</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#nr_glist_frames\">nr_glist_frames</a> = (<a class=\"id\" href=\"#nr_grant_frames\">nr_grant_frames</a> * <a class=\"id\" href=\"#GREFS_PER_GRANT_FRAME\">GREFS_PER_GRANT_FRAME</a> + <a class=\"id\" href=\"#RPP\">RPP</a> - 1) / <a class=\"id\" href=\"#RPP\">RPP</a>;", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = 0; <a class=\"id\" href=\"#i\">i</a> &lt; <a class=\"id\" href=\"#nr_glist_frames\">nr_glist_frames</a>; <a class=\"id\" href=\"#i\">i</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#gnttab_list\">gnttab_list</a>[<a class=\"id\" href=\"#i\">i</a>] = (<a class=\"id\" href=\"#grant_ref_t\">grant_ref_t</a> *)<a class=\"id\" href=\"#__get_free_page\">__get_free_page</a>(<a class=\"id\" href=\"#GFP_KERNEL\">GFP_KERNEL</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#gnttab_list\">gnttab_list</a>[<a class=\"id\" href=\"#i\">i</a>] == <a class=\"id\" href=\"#NULL\">NULL</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#ini_nomem\">ini_nomem</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#gnttab_resume\">gnttab_resume</a>() &lt; 0)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENODEV\">ENODEV</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#nr_init_grefs\">nr_init_grefs</a> = <a class=\"id\" href=\"#nr_grant_frames\">nr_grant_frames</a> * <a class=\"id\" href=\"#GREFS_PER_GRANT_FRAME\">GREFS_PER_GRANT_FRAME</a>;", 
"", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = <a class=\"id\" href=\"#NR_RESERVED_ENTRIES\">NR_RESERVED_ENTRIES</a>; <a class=\"id\" href=\"#i\">i</a> &lt; <a class=\"id\" href=\"#nr_init_grefs\">nr_init_grefs</a> - 1; <a class=\"id\" href=\"#i\">i</a>++)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#gnttab_entry\">gnttab_entry</a>(<a class=\"id\" href=\"#i\">i</a>) = <a class=\"id\" href=\"#i\">i</a> + 1;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#gnttab_entry\">gnttab_entry</a>(<a class=\"id\" href=\"#nr_init_grefs\">nr_init_grefs</a> - 1) = <a class=\"id\" href=\"#GNTTAB_LIST_END\">GNTTAB_LIST_END</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#gnttab_free_count\">gnttab_free_count</a> = <a class=\"id\" href=\"#nr_init_grefs\">nr_init_grefs</a> - <a class=\"id\" href=\"#NR_RESERVED_ENTRIES\">NR_RESERVED_ENTRIES</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#gnttab_free_head\">gnttab_free_head</a>  = <a class=\"id\" href=\"#NR_RESERVED_ENTRIES\">NR_RESERVED_ENTRIES</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(\"Grant table initialized\\n\");", 
"<span class=\"ts\"/>return 0;", 
"", 
" <a class=\"id\" href=\"#ini_nomem\">ini_nomem</a>:", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a>--; <a class=\"id\" href=\"#i\">i</a> >= 0; <a class=\"id\" href=\"#i\">i</a>--)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#free_page\">free_page</a>((unsigned long)<a class=\"id\" href=\"#gnttab_list\">gnttab_list</a>[<a class=\"id\" href=\"#i\">i</a>]);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#gnttab_list\">gnttab_list</a>);", 
"<span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#gnttab_init\">gnttab_init</a>);", 
"", 
"static int <a class=\"id\" href=\"#__devinit\">__devinit</a> <a class=\"id\" href=\"#__gnttab_init\">__gnttab_init</a>(void)", 
"{", 
"<span class=\"ts\"/><span class=\"comment\">/* Delay grant-table initialization in the PV on HVM case */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#xen_hvm_domain\">xen_hvm_domain</a>())", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#xen_pv_domain\">xen_pv_domain</a>())", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENODEV\">ENODEV</a>;", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#gnttab_init\">gnttab_init</a>();", 
"}", 
"", 
"<a class=\"id\" href=\"#core_initcall\">core_initcall</a>(<a class=\"id\" href=\"#__gnttab_init\">__gnttab_init</a>);", 
];
xr_frag_insert('l/61/8a63c11fd680a4946458e891cd06aa8cc34f78.xr', __xr_tmp);
