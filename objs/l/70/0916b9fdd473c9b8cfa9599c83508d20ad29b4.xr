var __xr_tmp = [
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> *  scsi_netlink.c  - SCSI Transport Netlink Interface</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> *  Copyright (C) 2006   James Smart, Emulex Corporation</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> *  This program is free software; you can redistribute it and/or modify</span>", 
"<span class=\"comment\"> *  it under the terms of the GNU General Public License as published by</span>", 
"<span class=\"comment\"> *  the Free Software Foundation; either version 2 of the License, or</span>", 
"<span class=\"comment\"> *  (at your option) any later version.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> *  This program is distributed in the hope that it will be useful,</span>", 
"<span class=\"comment\"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>", 
"<span class=\"comment\"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>", 
"<span class=\"comment\"> *  GNU General Public License for more details.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> *  You should have received a copy of the GNU General Public License</span>", 
"<span class=\"comment\"> *  along with this program; if not, write to the Free Software</span>", 
"<span class=\"comment\"> *  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> */</span>", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#time\">time</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#jiffies\">jiffies</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#security\">security</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#delay\">delay</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#slab\">slab</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#net\">net</a>/<a class=\"id\" href=\"#sock\">sock</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#net\">net</a>/<a class=\"id\" href=\"#netlink\">netlink</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#scsi\">scsi</a>/<a class=\"id\" href=\"#scsi_netlink\">scsi_netlink</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> \"scsi_priv.h\"", 
"", 
"struct <a class=\"id\" href=\"#sock\">sock</a> *<a class=\"id\" href=\"#scsi_nl_sock\">scsi_nl_sock</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#scsi_nl_sock\">scsi_nl_sock</a>);", 
"", 
"static <a class=\"id\" href=\"#DEFINE_SPINLOCK\">DEFINE_SPINLOCK</a>(<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>);", 
"static struct <a class=\"id\" href=\"#list_head\">list_head</a> <a class=\"id\" href=\"#scsi_nl_drivers\">scsi_nl_drivers</a>;", 
"", 
"static <a class=\"id\" href=\"#u32\">u32</a><span class=\"ts\"/><a class=\"id\" href=\"#scsi_nl_state\">scsi_nl_state</a>;", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#STATE_EHANDLER_BSY\">STATE_EHANDLER_BSY</a><span class=\"ts\"/><span class=\"ts\"/>0x00000001", 
"", 
"struct <a class=\"id\" href=\"#scsi_nl_transport\">scsi_nl_transport</a> {", 
"<span class=\"ts\"/>int (*<a class=\"id\" href=\"#msg_handler\">msg_handler</a>)(struct <a class=\"id\" href=\"#sk_buff\">sk_buff</a> *);", 
"<span class=\"ts\"/>void (*<a class=\"id\" href=\"#event_handler\">event_handler</a>)(struct <a class=\"id\" href=\"#notifier_block\">notifier_block</a> *, unsigned long, void *);", 
"<span class=\"ts\"/>unsigned int <a class=\"id\" href=\"#refcnt\">refcnt</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#flags\">flags</a>;", 
"};", 
"", 
"<span class=\"comment\">/* flags values (bit flags) */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#HANDLER_DELETING\">HANDLER_DELETING</a><span class=\"ts\"/><span class=\"ts\"/>0x1", 
"", 
"static struct <a class=\"id\" href=\"#scsi_nl_transport\">scsi_nl_transport</a> <a class=\"id\" href=\"#transports\">transports</a>[<a class=\"id\" href=\"#SCSI_NL_MAX_TRANSPORTS\">SCSI_NL_MAX_TRANSPORTS</a>] =", 
"<span class=\"ts\"/>{ {<a class=\"id\" href=\"#NULL\">NULL</a>, }, };", 
"", 
"", 
"struct <a class=\"id\" href=\"#scsi_nl_drvr\">scsi_nl_drvr</a> {", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#list_head\">list_head</a> <a class=\"id\" href=\"#next\">next</a>;", 
"<span class=\"ts\"/>int (*<a class=\"id\" href=\"#dmsg_handler\">dmsg_handler</a>)(struct <a class=\"id\" href=\"#Scsi_Host\">Scsi_Host</a> *<a class=\"id\" href=\"#shost\">shost</a>, void *<a class=\"id\" href=\"#payload\">payload</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> <a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#len\">len</a>, <a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#pid\">pid</a>);", 
"<span class=\"ts\"/>void (*<a class=\"id\" href=\"#devt_handler\">devt_handler</a>)(struct <a class=\"id\" href=\"#notifier_block\">notifier_block</a> *<a class=\"id\" href=\"#nb\">nb</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> unsigned long <a class=\"id\" href=\"#event\">event</a>, void *<a class=\"id\" href=\"#notify_ptr\">notify_ptr</a>);", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#scsi_host_template\">scsi_host_template</a> *<a class=\"id\" href=\"#hostt\">hostt</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u64\">u64</a> <a class=\"id\" href=\"#vendor_id\">vendor_id</a>;", 
"<span class=\"ts\"/>unsigned int <a class=\"id\" href=\"#refcnt\">refcnt</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#flags\">flags</a>;", 
"};", 
"", 
"", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * scsi_nl_rcv_msg - Receive message handler.</span>", 
"<span class=\"comment\"> * @skb:<span class=\"ts\"/><span class=\"ts\"/>socket receive buffer</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Description: Extracts message from a receive buffer.</span>", 
"<span class=\"comment\"> *    Validates message header and calls appropriate transport message handler</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> **/</span>", 
"static void", 
"<a class=\"id\" href=\"#scsi_nl_rcv_msg\">scsi_nl_rcv_msg</a>(struct <a class=\"id\" href=\"#sk_buff\">sk_buff</a> *<a class=\"id\" href=\"#skb\">skb</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#nlmsghdr\">nlmsghdr</a> *<a class=\"id\" href=\"#nlh\">nlh</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#scsi_nl_hdr\">scsi_nl_hdr</a> *<a class=\"id\" href=\"#hdr\">hdr</a>;", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#flags\">flags</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#rlen\">rlen</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#err\">err</a>, <a class=\"id\" href=\"#tport\">tport</a>;", 
"", 
"<span class=\"ts\"/>while (<a class=\"id\" href=\"#skb\">skb</a>-><a class=\"id\" href=\"#len\">len</a> >= <a class=\"id\" href=\"#NLMSG_SPACE\">NLMSG_SPACE</a>(0)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = 0;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#nlh\">nlh</a> = <a class=\"id\" href=\"#nlmsg_hdr\">nlmsg_hdr</a>(<a class=\"id\" href=\"#skb\">skb</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if ((<a class=\"id\" href=\"#nlh\">nlh</a>-><a class=\"id\" href=\"#nlmsg_len\">nlmsg_len</a> &lt; (sizeof(*<a class=\"id\" href=\"#nlh\">nlh</a>) + sizeof(*<a class=\"id\" href=\"#hdr\">hdr</a>))) ||", 
"<span class=\"ts\"/><span class=\"ts\"/>    (<a class=\"id\" href=\"#skb\">skb</a>-><a class=\"id\" href=\"#len\">len</a> &lt; <a class=\"id\" href=\"#nlh\">nlh</a>-><a class=\"id\" href=\"#nlmsg_len\">nlmsg_len</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_WARNING\">KERN_WARNING</a> \"%s: discarding partial skb\\n\",", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> <a class=\"id\" href=\"#__func__\">__func__</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rlen\">rlen</a> = <a class=\"id\" href=\"#NLMSG_ALIGN\">NLMSG_ALIGN</a>(<a class=\"id\" href=\"#nlh\">nlh</a>-><a class=\"id\" href=\"#nlmsg_len\">nlmsg_len</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#rlen\">rlen</a> &gt; <a class=\"id\" href=\"#skb\">skb</a>-><a class=\"id\" href=\"#len\">len</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rlen\">rlen</a> = <a class=\"id\" href=\"#skb\">skb</a>-><a class=\"id\" href=\"#len\">len</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#nlh\">nlh</a>-><a class=\"id\" href=\"#nlmsg_type\">nlmsg_type</a> != <a class=\"id\" href=\"#SCSI_TRANSPORT_MSG\">SCSI_TRANSPORT_MSG</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#EBADMSG\">EBADMSG</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#next_msg\">next_msg</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#hdr\">hdr</a> = <a class=\"id\" href=\"#NLMSG_DATA\">NLMSG_DATA</a>(<a class=\"id\" href=\"#nlh\">nlh</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if ((<a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#version\">version</a> != <a class=\"id\" href=\"#SCSI_NL_VERSION\">SCSI_NL_VERSION</a>) ||", 
"<span class=\"ts\"/><span class=\"ts\"/>    (<a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#magic\">magic</a> != <a class=\"id\" href=\"#SCSI_NL_MAGIC\">SCSI_NL_MAGIC</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#EPROTOTYPE\">EPROTOTYPE</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#next_msg\">next_msg</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#security_netlink_recv\">security_netlink_recv</a>(<a class=\"id\" href=\"#skb\">skb</a>, <a class=\"id\" href=\"#CAP_SYS_ADMIN\">CAP_SYS_ADMIN</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#EPERM\">EPERM</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#next_msg\">next_msg</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#nlh\">nlh</a>-><a class=\"id\" href=\"#nlmsg_len\">nlmsg_len</a> &lt; (sizeof(*<a class=\"id\" href=\"#nlh\">nlh</a>) + <a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#msglen\">msglen</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_WARNING\">KERN_WARNING</a> \"%s: discarding partial message\\n\",", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> <a class=\"id\" href=\"#__func__\">__func__</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#next_msg\">next_msg</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * Deliver message to the appropriate transport</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irqsave\">spin_lock_irqsave</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tport\">tport</a> = <a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#transport\">transport</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if ((<a class=\"id\" href=\"#tport\">tport</a> &lt; <a class=\"id\" href=\"#SCSI_NL_MAX_TRANSPORTS\">SCSI_NL_MAX_TRANSPORTS</a>) &&", 
"<span class=\"ts\"/><span class=\"ts\"/>    !(<a class=\"id\" href=\"#transports\">transports</a>[<a class=\"id\" href=\"#tport\">tport</a>].<a class=\"id\" href=\"#flags\">flags</a> &amp; <a class=\"id\" href=\"#HANDLER_DELETING\">HANDLER_DELETING</a>) &&", 
"<span class=\"ts\"/><span class=\"ts\"/>    (<a class=\"id\" href=\"#transports\">transports</a>[<a class=\"id\" href=\"#tport\">tport</a>].<a class=\"id\" href=\"#msg_handler\">msg_handler</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#transports\">transports</a>[<a class=\"id\" href=\"#tport\">tport</a>].<a class=\"id\" href=\"#refcnt\">refcnt</a>++;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = <a class=\"id\" href=\"#transports\">transports</a>[<a class=\"id\" href=\"#tport\">tport</a>].<a class=\"id\" href=\"#msg_handler\">msg_handler</a>(<a class=\"id\" href=\"#skb\">skb</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irqsave\">spin_lock_irqsave</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#transports\">transports</a>[<a class=\"id\" href=\"#tport\">tport</a>].<a class=\"id\" href=\"#refcnt\">refcnt</a>--;", 
"<span class=\"ts\"/><span class=\"ts\"/>} else", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#ENOENT\">ENOENT</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"", 
"<a class=\"id\" href=\"#next_msg\">next_msg</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/>if ((<a class=\"id\" href=\"#err\">err</a>) || (<a class=\"id\" href=\"#nlh\">nlh</a>-><a class=\"id\" href=\"#nlmsg_flags\">nlmsg_flags</a> &amp; <a class=\"id\" href=\"#NLM_F_ACK\">NLM_F_ACK</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#netlink_ack\">netlink_ack</a>(<a class=\"id\" href=\"#skb\">skb</a>, <a class=\"id\" href=\"#nlh\">nlh</a>, <a class=\"id\" href=\"#err\">err</a>);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#skb_pull\">skb_pull</a>(<a class=\"id\" href=\"#skb\">skb</a>, <a class=\"id\" href=\"#rlen\">rlen</a>);", 
"<span class=\"ts\"/>}", 
"}", 
"", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * scsi_nl_rcv_event - Event handler for a netlink socket.</span>", 
"<span class=\"comment\"> * @this:<span class=\"ts\"/><span class=\"ts\"/>event notifier block</span>", 
"<span class=\"comment\"> * @event:<span class=\"ts\"/><span class=\"ts\"/>event type</span>", 
"<span class=\"comment\"> * @ptr:<span class=\"ts\"/><span class=\"ts\"/>event payload</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> **/</span>", 
"static int", 
"<a class=\"id\" href=\"#scsi_nl_rcv_event\">scsi_nl_rcv_event</a>(struct <a class=\"id\" href=\"#notifier_block\">notifier_block</a> *<a class=\"id\" href=\"#this\">this</a>, unsigned long <a class=\"id\" href=\"#event\">event</a>, void *<a class=\"id\" href=\"#ptr\">ptr</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#netlink_notify\">netlink_notify</a> *<a class=\"id\" href=\"#n\">n</a> = <a class=\"id\" href=\"#ptr\">ptr</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#scsi_nl_drvr\">scsi_nl_drvr</a> *<a class=\"id\" href=\"#driver\">driver</a>;", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#flags\">flags</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#tport\">tport</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#n\">n</a>-><a class=\"id\" href=\"#protocol\">protocol</a> != <a class=\"id\" href=\"#NETLINK_SCSITRANSPORT\">NETLINK_SCSITRANSPORT</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#NOTIFY_DONE\">NOTIFY_DONE</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irqsave\">spin_lock_irqsave</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#scsi_nl_state\">scsi_nl_state</a> |= <a class=\"id\" href=\"#STATE_EHANDLER_BSY\">STATE_EHANDLER_BSY</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Pass event on to any transports that may be listening</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#tport\">tport</a> = 0; <a class=\"id\" href=\"#tport\">tport</a> &lt; <a class=\"id\" href=\"#SCSI_NL_MAX_TRANSPORTS\">SCSI_NL_MAX_TRANSPORTS</a>; <a class=\"id\" href=\"#tport\">tport</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!(<a class=\"id\" href=\"#transports\">transports</a>[<a class=\"id\" href=\"#tport\">tport</a>].<a class=\"id\" href=\"#flags\">flags</a> &amp; <a class=\"id\" href=\"#HANDLER_DELETING\">HANDLER_DELETING</a>) &&", 
"<span class=\"ts\"/><span class=\"ts\"/>    (<a class=\"id\" href=\"#transports\">transports</a>[<a class=\"id\" href=\"#tport\">tport</a>].<a class=\"id\" href=\"#event_handler\">event_handler</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#transports\">transports</a>[<a class=\"id\" href=\"#tport\">tport</a>].<a class=\"id\" href=\"#event_handler\">event_handler</a>(<a class=\"id\" href=\"#this\">this</a>, <a class=\"id\" href=\"#event\">event</a>, <a class=\"id\" href=\"#ptr\">ptr</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irqsave\">spin_lock_irqsave</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Pass event on to any drivers that may be listening</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_for_each_entry\">list_for_each_entry</a>(<a class=\"id\" href=\"#driver\">driver</a>, &amp;<a class=\"id\" href=\"#scsi_nl_drivers\">scsi_nl_drivers</a>, <a class=\"id\" href=\"#next\">next</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!(<a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#flags\">flags</a> &amp; <a class=\"id\" href=\"#HANDLER_DELETING\">HANDLER_DELETING</a>) &&", 
"<span class=\"ts\"/><span class=\"ts\"/>    (<a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#devt_handler\">devt_handler</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#devt_handler\">devt_handler</a>(<a class=\"id\" href=\"#this\">this</a>, <a class=\"id\" href=\"#event\">event</a>, <a class=\"id\" href=\"#ptr\">ptr</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irqsave\">spin_lock_irqsave</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#scsi_nl_state\">scsi_nl_state</a> &= ~<a class=\"id\" href=\"#STATE_EHANDLER_BSY\">STATE_EHANDLER_BSY</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#NOTIFY_DONE\">NOTIFY_DONE</a>;", 
"}", 
"", 
"static struct <a class=\"id\" href=\"#notifier_block\">notifier_block</a> <a class=\"id\" href=\"#scsi_netlink_notifier\">scsi_netlink_notifier</a> = {", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#notifier_call\">notifier_call</a>  = <a class=\"id\" href=\"#scsi_nl_rcv_event\">scsi_nl_rcv_event</a>,", 
"};", 
"", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * GENERIC SCSI transport receive and event handlers</span>", 
"<span class=\"comment\"> */</span>", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * scsi_generic_msg_handler - receive message handler for GENERIC transport messages</span>", 
"<span class=\"comment\"> * @skb:<span class=\"ts\"/><span class=\"ts\"/>socket receive buffer</span>", 
"<span class=\"comment\"> **/</span>", 
"static int", 
"<a class=\"id\" href=\"#scsi_generic_msg_handler\">scsi_generic_msg_handler</a>(struct <a class=\"id\" href=\"#sk_buff\">sk_buff</a> *<a class=\"id\" href=\"#skb\">skb</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#nlmsghdr\">nlmsghdr</a> *<a class=\"id\" href=\"#nlh\">nlh</a> = <a class=\"id\" href=\"#nlmsg_hdr\">nlmsg_hdr</a>(<a class=\"id\" href=\"#skb\">skb</a>);", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#scsi_nl_hdr\">scsi_nl_hdr</a> *<a class=\"id\" href=\"#snlh\">snlh</a> = <a class=\"id\" href=\"#NLMSG_DATA\">NLMSG_DATA</a>(<a class=\"id\" href=\"#nlh\">nlh</a>);", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#scsi_nl_drvr\">scsi_nl_drvr</a> *<a class=\"id\" href=\"#driver\">driver</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#Scsi_Host\">Scsi_Host</a> *<a class=\"id\" href=\"#shost\">shost</a>;", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#flags\">flags</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#err\">err</a> = 0, <a class=\"id\" href=\"#match\">match</a>, <a class=\"id\" href=\"#pid\">pid</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pid\">pid</a> = <a class=\"id\" href=\"#NETLINK_CREDS\">NETLINK_CREDS</a>(<a class=\"id\" href=\"#skb\">skb</a>)-><a class=\"id\" href=\"#pid\">pid</a>;", 
"", 
"<span class=\"ts\"/>switch (<a class=\"id\" href=\"#snlh\">snlh</a>-><a class=\"id\" href=\"#msgtype\">msgtype</a>) {", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#SCSI_NL_SHOST_VENDOR\">SCSI_NL_SHOST_VENDOR</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/>{", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#scsi_nl_host_vendor_msg\">scsi_nl_host_vendor_msg</a> *<a class=\"id\" href=\"#msg\">msg</a> = <a class=\"id\" href=\"#NLMSG_DATA\">NLMSG_DATA</a>(<a class=\"id\" href=\"#nlh\">nlh</a>);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Locate the driver that corresponds to the message */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irqsave\">spin_lock_irqsave</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#match\">match</a> = 0;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#list_for_each_entry\">list_for_each_entry</a>(<a class=\"id\" href=\"#driver\">driver</a>, &amp;<a class=\"id\" href=\"#scsi_nl_drivers\">scsi_nl_drivers</a>, <a class=\"id\" href=\"#next\">next</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#vendor_id\">vendor_id</a> == <a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#vendor_id\">vendor_id</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#match\">match</a> = 1;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if ((!<a class=\"id\" href=\"#match\">match</a>) || (!<a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#dmsg_handler\">dmsg_handler</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#ESRCH\">ESRCH</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#rcv_exit\">rcv_exit</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#flags\">flags</a> &amp; <a class=\"id\" href=\"#HANDLER_DELETING\">HANDLER_DELETING</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#ESHUTDOWN\">ESHUTDOWN</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#rcv_exit\">rcv_exit</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#refcnt\">refcnt</a>++;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* if successful, scsi_host_lookup takes a shost reference */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#shost\">shost</a> = <a class=\"id\" href=\"#scsi_host_lookup\">scsi_host_lookup</a>(<a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#host_no\">host_no</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#shost\">shost</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#ENODEV\">ENODEV</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#driver_exit\">driver_exit</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* is this host owned by the vendor ? */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#shost\">shost</a>-><a class=\"id\" href=\"#hostt\">hostt</a> != <a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#hostt\">hostt</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#vendormsg_put\">vendormsg_put</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* pass message on to the driver */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = <a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#dmsg_handler\">dmsg_handler</a>(<a class=\"id\" href=\"#shost\">shost</a>, (void *)&amp;<a class=\"id\" href=\"#msg\">msg</a>[1],", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> <a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#vmsg_datalen\">vmsg_datalen</a>, <a class=\"id\" href=\"#pid\">pid</a>);", 
"", 
"<a class=\"id\" href=\"#vendormsg_put\">vendormsg_put</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* release reference by scsi_host_lookup */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#scsi_host_put\">scsi_host_put</a>(<a class=\"id\" href=\"#shost\">shost</a>);", 
"", 
"<a class=\"id\" href=\"#driver_exit\">driver_exit</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* release our own reference on the registration object */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irqsave\">spin_lock_irqsave</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#refcnt\">refcnt</a>--;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>default:", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#EBADR\">EBADR</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>}", 
"", 
"<a class=\"id\" href=\"#rcv_exit\">rcv_exit</a>:", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#err\">err</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_WARNING\">KERN_WARNING</a> \"%s: Msgtype %d failed - err %d\\n\",", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> <a class=\"id\" href=\"#__func__\">__func__</a>, <a class=\"id\" href=\"#snlh\">snlh</a>-><a class=\"id\" href=\"#msgtype\">msgtype</a>, <a class=\"id\" href=\"#err\">err</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#err\">err</a>;", 
"}", 
"", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * scsi_nl_add_transport -</span>", 
"<span class=\"comment\"> *    Registers message and event handlers for a transport. Enables</span>", 
"<span class=\"comment\"> *    receipt of netlink messages and events to a transport.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * @tport:<span class=\"ts\"/><span class=\"ts\"/>transport registering handlers</span>", 
"<span class=\"comment\"> * @msg_handler:<span class=\"ts\"/>receive message handler callback</span>", 
"<span class=\"comment\"> * @event_handler:<span class=\"ts\"/>receive event handler callback</span>", 
"<span class=\"comment\"> **/</span>", 
"int", 
"<a class=\"id\" href=\"#scsi_nl_add_transport\">scsi_nl_add_transport</a>(<a class=\"id\" href=\"#u8\">u8</a> <a class=\"id\" href=\"#tport\">tport</a>,", 
"<span class=\"ts\"/>int (*<a class=\"id\" href=\"#msg_handler\">msg_handler</a>)(struct <a class=\"id\" href=\"#sk_buff\">sk_buff</a> *),", 
"<span class=\"ts\"/>void (*<a class=\"id\" href=\"#event_handler\">event_handler</a>)(struct <a class=\"id\" href=\"#notifier_block\">notifier_block</a> *, unsigned long, void *))", 
"{", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#flags\">flags</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#err\">err</a> = 0;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#tport\">tport</a> >= <a class=\"id\" href=\"#SCSI_NL_MAX_TRANSPORTS\">SCSI_NL_MAX_TRANSPORTS</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irqsave\">spin_lock_irqsave</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#scsi_nl_state\">scsi_nl_state</a> &amp; <a class=\"id\" href=\"#STATE_EHANDLER_BSY\">STATE_EHANDLER_BSY</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msleep\">msleep</a>(1);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irqsave\">spin_lock_irqsave</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#transports\">transports</a>[<a class=\"id\" href=\"#tport\">tport</a>].<a class=\"id\" href=\"#msg_handler\">msg_handler</a> || <a class=\"id\" href=\"#transports\">transports</a>[<a class=\"id\" href=\"#tport\">tport</a>].<a class=\"id\" href=\"#event_handler\">event_handler</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#EALREADY\">EALREADY</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#register_out\">register_out</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#transports\">transports</a>[<a class=\"id\" href=\"#tport\">tport</a>].<a class=\"id\" href=\"#msg_handler\">msg_handler</a> = <a class=\"id\" href=\"#msg_handler\">msg_handler</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#transports\">transports</a>[<a class=\"id\" href=\"#tport\">tport</a>].<a class=\"id\" href=\"#event_handler\">event_handler</a> = <a class=\"id\" href=\"#event_handler\">event_handler</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#transports\">transports</a>[<a class=\"id\" href=\"#tport\">tport</a>].<a class=\"id\" href=\"#flags\">flags</a> = 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#transports\">transports</a>[<a class=\"id\" href=\"#tport\">tport</a>].<a class=\"id\" href=\"#refcnt\">refcnt</a> = 0;", 
"", 
"<a class=\"id\" href=\"#register_out\">register_out</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#err\">err</a>;", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#scsi_nl_add_transport\">scsi_nl_add_transport</a>);", 
"", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * scsi_nl_remove_transport -</span>", 
"<span class=\"comment\"> *    Disable transport receiption of messages and events</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * @tport:<span class=\"ts\"/><span class=\"ts\"/>transport deregistering handlers</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> **/</span>", 
"void", 
"<a class=\"id\" href=\"#scsi_nl_remove_transport\">scsi_nl_remove_transport</a>(<a class=\"id\" href=\"#u8\">u8</a> <a class=\"id\" href=\"#tport\">tport</a>)", 
"{", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#flags\">flags</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irqsave\">spin_lock_irqsave</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#scsi_nl_state\">scsi_nl_state</a> &amp; <a class=\"id\" href=\"#STATE_EHANDLER_BSY\">STATE_EHANDLER_BSY</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msleep\">msleep</a>(1);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irqsave\">spin_lock_irqsave</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#tport\">tport</a> &lt; <a class=\"id\" href=\"#SCSI_NL_MAX_TRANSPORTS\">SCSI_NL_MAX_TRANSPORTS</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#transports\">transports</a>[<a class=\"id\" href=\"#tport\">tport</a>].<a class=\"id\" href=\"#flags\">flags</a> |= <a class=\"id\" href=\"#HANDLER_DELETING\">HANDLER_DELETING</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>while (<a class=\"id\" href=\"#transports\">transports</a>[<a class=\"id\" href=\"#tport\">tport</a>].<a class=\"id\" href=\"#refcnt\">refcnt</a> != 0) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#schedule_timeout_uninterruptible\">schedule_timeout_uninterruptible</a>(<a class=\"id\" href=\"#HZ\">HZ</a>/4);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irqsave\">spin_lock_irqsave</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#transports\">transports</a>[<a class=\"id\" href=\"#tport\">tport</a>].<a class=\"id\" href=\"#msg_handler\">msg_handler</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#transports\">transports</a>[<a class=\"id\" href=\"#tport\">tport</a>].<a class=\"id\" href=\"#event_handler\">event_handler</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#transports\">transports</a>[<a class=\"id\" href=\"#tport\">tport</a>].<a class=\"id\" href=\"#flags\">flags</a> = 0;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"", 
"<span class=\"ts\"/>return;", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#scsi_nl_remove_transport\">scsi_nl_remove_transport</a>);", 
"", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * scsi_nl_add_driver -</span>", 
"<span class=\"comment\"> *    A driver is registering its interfaces for SCSI netlink messages</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * @vendor_id:          A unique identification value for the driver.</span>", 
"<span class=\"comment\"> * @hostt:<span class=\"ts\"/><span class=\"ts\"/>address of the driver's host template. Used</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>to verify an shost is bound to the driver</span>", 
"<span class=\"comment\"> * @nlmsg_handler:<span class=\"ts\"/>receive message handler callback</span>", 
"<span class=\"comment\"> * @nlevt_handler:<span class=\"ts\"/>receive event handler callback</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Returns:</span>", 
"<span class=\"comment\"> *   0 on Success</span>", 
"<span class=\"comment\"> *   error result otherwise</span>", 
"<span class=\"comment\"> **/</span>", 
"int", 
"<a class=\"id\" href=\"#scsi_nl_add_driver\">scsi_nl_add_driver</a>(<a class=\"id\" href=\"#u64\">u64</a> <a class=\"id\" href=\"#vendor_id\">vendor_id</a>, struct <a class=\"id\" href=\"#scsi_host_template\">scsi_host_template</a> *<a class=\"id\" href=\"#hostt\">hostt</a>,", 
"<span class=\"ts\"/>int (*<a class=\"id\" href=\"#nlmsg_handler\">nlmsg_handler</a>)(struct <a class=\"id\" href=\"#Scsi_Host\">Scsi_Host</a> *<a class=\"id\" href=\"#shost\">shost</a>, void *<a class=\"id\" href=\"#payload\">payload</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> <a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#len\">len</a>, <a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#pid\">pid</a>),", 
"<span class=\"ts\"/>void (*<a class=\"id\" href=\"#nlevt_handler\">nlevt_handler</a>)(struct <a class=\"id\" href=\"#notifier_block\">notifier_block</a> *<a class=\"id\" href=\"#nb\">nb</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> unsigned long <a class=\"id\" href=\"#event\">event</a>, void *<a class=\"id\" href=\"#notify_ptr\">notify_ptr</a>))", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#scsi_nl_drvr\">scsi_nl_drvr</a> *<a class=\"id\" href=\"#driver\">driver</a>;", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#flags\">flags</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#driver\">driver</a> = <a class=\"id\" href=\"#kzalloc\">kzalloc</a>(sizeof(*<a class=\"id\" href=\"#driver\">driver</a>), <a class=\"id\" href=\"#GFP_KERNEL\">GFP_KERNEL</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#unlikely\">unlikely</a>(!<a class=\"id\" href=\"#driver\">driver</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_ERR\">KERN_ERR</a> \"%s: allocation failure\\n\", <a class=\"id\" href=\"#__func__\">__func__</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#dmsg_handler\">dmsg_handler</a> = <a class=\"id\" href=\"#nlmsg_handler\">nlmsg_handler</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#devt_handler\">devt_handler</a> = <a class=\"id\" href=\"#nlevt_handler\">nlevt_handler</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#hostt\">hostt</a> = <a class=\"id\" href=\"#hostt\">hostt</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#vendor_id\">vendor_id</a> = <a class=\"id\" href=\"#vendor_id\">vendor_id</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irqsave\">spin_lock_irqsave</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#scsi_nl_state\">scsi_nl_state</a> &amp; <a class=\"id\" href=\"#STATE_EHANDLER_BSY\">STATE_EHANDLER_BSY</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msleep\">msleep</a>(1);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irqsave\">spin_lock_irqsave</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_add_tail\">list_add_tail</a>(&amp;<a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#next\">next</a>, &amp;<a class=\"id\" href=\"#scsi_nl_drivers\">scsi_nl_drivers</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"", 
"<span class=\"ts\"/>return 0;", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#scsi_nl_add_driver\">scsi_nl_add_driver</a>);", 
"", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * scsi_nl_remove_driver -</span>", 
"<span class=\"comment\"> *    An driver is unregistering with the SCSI netlink messages</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * @vendor_id:          The unique identification value for the driver.</span>", 
"<span class=\"comment\"> **/</span>", 
"void", 
"<a class=\"id\" href=\"#scsi_nl_remove_driver\">scsi_nl_remove_driver</a>(<a class=\"id\" href=\"#u64\">u64</a> <a class=\"id\" href=\"#vendor_id\">vendor_id</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#scsi_nl_drvr\">scsi_nl_drvr</a> *<a class=\"id\" href=\"#driver\">driver</a>;", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#flags\">flags</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irqsave\">spin_lock_irqsave</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#scsi_nl_state\">scsi_nl_state</a> &amp; <a class=\"id\" href=\"#STATE_EHANDLER_BSY\">STATE_EHANDLER_BSY</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msleep\">msleep</a>(1);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irqsave\">spin_lock_irqsave</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_for_each_entry\">list_for_each_entry</a>(<a class=\"id\" href=\"#driver\">driver</a>, &amp;<a class=\"id\" href=\"#scsi_nl_drivers\">scsi_nl_drivers</a>, <a class=\"id\" href=\"#next\">next</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#vendor_id\">vendor_id</a> == <a class=\"id\" href=\"#vendor_id\">vendor_id</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#flags\">flags</a> |= <a class=\"id\" href=\"#HANDLER_DELETING\">HANDLER_DELETING</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>while (<a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#refcnt\">refcnt</a> != 0) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#schedule_timeout_uninterruptible\">schedule_timeout_uninterruptible</a>(<a class=\"id\" href=\"#HZ\">HZ</a>/4);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irqsave\">spin_lock_irqsave</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#list_del\">list_del</a>(&amp;<a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#next\">next</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#driver\">driver</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#scsi_nl_lock\">scsi_nl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_ERR\">KERN_ERR</a> \"%s: removal of driver failed - vendor_id 0x%llx\\n\",", 
"<span class=\"ts\"/>       <a class=\"id\" href=\"#__func__\">__func__</a>, (unsigned long long)<a class=\"id\" href=\"#vendor_id\">vendor_id</a>);", 
"<span class=\"ts\"/>return;", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#scsi_nl_remove_driver\">scsi_nl_remove_driver</a>);", 
"", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * scsi_netlink_init - Called by SCSI subsystem to intialize</span>", 
"<span class=\"comment\"> * <span class=\"ts\"/>the SCSI transport netlink interface</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> **/</span>", 
"void", 
"<a class=\"id\" href=\"#scsi_netlink_init\">scsi_netlink_init</a>(void)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#error\">error</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#INIT_LIST_HEAD\">INIT_LIST_HEAD</a>(&amp;<a class=\"id\" href=\"#scsi_nl_drivers\">scsi_nl_drivers</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#error\">error</a> = <a class=\"id\" href=\"#netlink_register_notifier\">netlink_register_notifier</a>(&amp;<a class=\"id\" href=\"#scsi_netlink_notifier\">scsi_netlink_notifier</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#error\">error</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_ERR\">KERN_ERR</a> \"%s: register of event handler failed - %d\\n\",", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#__func__\">__func__</a>, <a class=\"id\" href=\"#error\">error</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#scsi_nl_sock\">scsi_nl_sock</a> = <a class=\"id\" href=\"#netlink_kernel_create\">netlink_kernel_create</a>(&amp;<a class=\"id\" href=\"#init_net\">init_net</a>, <a class=\"id\" href=\"#NETLINK_SCSITRANSPORT\">NETLINK_SCSITRANSPORT</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#SCSI_NL_GRP_CNT\">SCSI_NL_GRP_CNT</a>, <a class=\"id\" href=\"#scsi_nl_rcv_msg\">scsi_nl_rcv_msg</a>, <a class=\"id\" href=\"#NULL\">NULL</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#THIS_MODULE\">THIS_MODULE</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#scsi_nl_sock\">scsi_nl_sock</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_ERR\">KERN_ERR</a> \"%s: register of recieve handler failed\\n\",", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#__func__\">__func__</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#netlink_unregister_notifier\">netlink_unregister_notifier</a>(&amp;<a class=\"id\" href=\"#scsi_netlink_notifier\">scsi_netlink_notifier</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Register the entry points for the generic SCSI transport */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#error\">error</a> = <a class=\"id\" href=\"#scsi_nl_add_transport\">scsi_nl_add_transport</a>(<a class=\"id\" href=\"#SCSI_NL_TRANSPORT\">SCSI_NL_TRANSPORT</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#scsi_generic_msg_handler\">scsi_generic_msg_handler</a>, <a class=\"id\" href=\"#NULL\">NULL</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#error\">error</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_ERR\">KERN_ERR</a> \"%s: register of GENERIC transport handler\"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>\"  failed - %d\\n\", <a class=\"id\" href=\"#__func__\">__func__</a>, <a class=\"id\" href=\"#error\">error</a>);", 
"<span class=\"ts\"/>return;", 
"}", 
"", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * scsi_netlink_exit - Called by SCSI subsystem to disable the SCSI transport netlink interface</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> **/</span>", 
"void", 
"<a class=\"id\" href=\"#scsi_netlink_exit\">scsi_netlink_exit</a>(void)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#scsi_nl_remove_transport\">scsi_nl_remove_transport</a>(<a class=\"id\" href=\"#SCSI_NL_TRANSPORT\">SCSI_NL_TRANSPORT</a>);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#scsi_nl_sock\">scsi_nl_sock</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#netlink_kernel_release\">netlink_kernel_release</a>(<a class=\"id\" href=\"#scsi_nl_sock\">scsi_nl_sock</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#netlink_unregister_notifier\">netlink_unregister_notifier</a>(&amp;<a class=\"id\" href=\"#scsi_netlink_notifier\">scsi_netlink_notifier</a>);", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>return;", 
"}", 
"", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Exported Interfaces</span>", 
"<span class=\"comment\"> */</span>", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * scsi_nl_send_transport_msg -</span>", 
"<span class=\"comment\"> *    Generic function to send a single message from a SCSI transport to</span>", 
"<span class=\"comment\"> *    a single process</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * @pid:<span class=\"ts\"/><span class=\"ts\"/>receiving pid</span>", 
"<span class=\"comment\"> * @hdr:<span class=\"ts\"/><span class=\"ts\"/>message payload</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> **/</span>", 
"void", 
"<a class=\"id\" href=\"#scsi_nl_send_transport_msg\">scsi_nl_send_transport_msg</a>(<a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#pid\">pid</a>, struct <a class=\"id\" href=\"#scsi_nl_hdr\">scsi_nl_hdr</a> *<a class=\"id\" href=\"#hdr\">hdr</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#sk_buff\">sk_buff</a> *<a class=\"id\" href=\"#skb\">skb</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#nlmsghdr\">nlmsghdr</a><span class=\"ts\"/>*<a class=\"id\" href=\"#nlh\">nlh</a>;", 
"<span class=\"ts\"/>const char *<a class=\"id\" href=\"#fn\">fn</a>;", 
"<span class=\"ts\"/>char *<a class=\"id\" href=\"#datab\">datab</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#len\">len</a>, <a class=\"id\" href=\"#skblen\">skblen</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#err\">err</a>;", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#scsi_nl_sock\">scsi_nl_sock</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#ENOENT\">ENOENT</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#fn\">fn</a> = \"netlink socket\";", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#msg_fail\">msg_fail</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#len\">len</a> = <a class=\"id\" href=\"#NLMSG_SPACE\">NLMSG_SPACE</a>(<a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#msglen\">msglen</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#skblen\">skblen</a> = <a class=\"id\" href=\"#NLMSG_SPACE\">NLMSG_SPACE</a>(<a class=\"id\" href=\"#len\">len</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#skb\">skb</a> = <a class=\"id\" href=\"#alloc_skb\">alloc_skb</a>(<a class=\"id\" href=\"#skblen\">skblen</a>, <a class=\"id\" href=\"#GFP_KERNEL\">GFP_KERNEL</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#skb\">skb</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#ENOBUFS\">ENOBUFS</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#fn\">fn</a> = \"alloc_skb\";", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#msg_fail\">msg_fail</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#nlh\">nlh</a> = <a class=\"id\" href=\"#nlmsg_put\">nlmsg_put</a>(<a class=\"id\" href=\"#skb\">skb</a>, <a class=\"id\" href=\"#pid\">pid</a>, 0, <a class=\"id\" href=\"#SCSI_TRANSPORT_MSG\">SCSI_TRANSPORT_MSG</a>, <a class=\"id\" href=\"#len\">len</a> - sizeof(*<a class=\"id\" href=\"#nlh\">nlh</a>), 0);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#nlh\">nlh</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#ENOBUFS\">ENOBUFS</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#fn\">fn</a> = \"nlmsg_put\";", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#msg_fail_skb\">msg_fail_skb</a>;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#datab\">datab</a> = <a class=\"id\" href=\"#NLMSG_DATA\">NLMSG_DATA</a>(<a class=\"id\" href=\"#nlh\">nlh</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#memcpy\">memcpy</a>(<a class=\"id\" href=\"#datab\">datab</a>, <a class=\"id\" href=\"#hdr\">hdr</a>, <a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#msglen\">msglen</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = <a class=\"id\" href=\"#nlmsg_unicast\">nlmsg_unicast</a>(<a class=\"id\" href=\"#scsi_nl_sock\">scsi_nl_sock</a>, <a class=\"id\" href=\"#skb\">skb</a>, <a class=\"id\" href=\"#pid\">pid</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#err\">err</a> &lt; 0) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#fn\">fn</a> = \"nlmsg_unicast\";", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* nlmsg_unicast already kfree_skb'd */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#msg_fail\">msg_fail</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>return;", 
"", 
"<a class=\"id\" href=\"#msg_fail_skb\">msg_fail_skb</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kfree_skb\">kfree_skb</a>(<a class=\"id\" href=\"#skb\">skb</a>);", 
"<a class=\"id\" href=\"#msg_fail\">msg_fail</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_WARNING\">KERN_WARNING</a>", 
"<span class=\"ts\"/><span class=\"ts\"/>\"%s: Dropped Message : pid %d Transport %d, msgtype x%x, \"", 
"<span class=\"ts\"/><span class=\"ts\"/>\"msglen %d: %s : err %d\\n\",", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#__func__\">__func__</a>, <a class=\"id\" href=\"#pid\">pid</a>, <a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#transport\">transport</a>, <a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#msgtype\">msgtype</a>, <a class=\"id\" href=\"#hdr\">hdr</a>-><a class=\"id\" href=\"#msglen\">msglen</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#fn\">fn</a>, <a class=\"id\" href=\"#err\">err</a>);", 
"<span class=\"ts\"/>return;", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#scsi_nl_send_transport_msg\">scsi_nl_send_transport_msg</a>);", 
"", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * scsi_nl_send_vendor_msg - called to send a shost vendor unique message</span>", 
"<span class=\"comment\"> *                      to a specific process id.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * @pid:<span class=\"ts\"/><span class=\"ts\"/>process id of the receiver</span>", 
"<span class=\"comment\"> * @host_no:<span class=\"ts\"/><span class=\"ts\"/>host # sending the message</span>", 
"<span class=\"comment\"> * @vendor_id:<span class=\"ts\"/><span class=\"ts\"/>unique identifier for the driver's vendor</span>", 
"<span class=\"comment\"> * @data_len:<span class=\"ts\"/><span class=\"ts\"/>amount, in bytes, of vendor unique payload data</span>", 
"<span class=\"comment\"> * @data_buf:<span class=\"ts\"/><span class=\"ts\"/>pointer to vendor unique data buffer</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Returns:</span>", 
"<span class=\"comment\"> *   0 on successful return</span>", 
"<span class=\"comment\"> *   otherwise, failing error code</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Notes:</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>This routine assumes no locks are held on entry.</span>", 
"<span class=\"comment\"> */</span>", 
"int", 
"<a class=\"id\" href=\"#scsi_nl_send_vendor_msg\">scsi_nl_send_vendor_msg</a>(<a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#pid\">pid</a>, unsigned short <a class=\"id\" href=\"#host_no\">host_no</a>, <a class=\"id\" href=\"#u64\">u64</a> <a class=\"id\" href=\"#vendor_id\">vendor_id</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> char *<a class=\"id\" href=\"#data_buf\">data_buf</a>, <a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#data_len\">data_len</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#sk_buff\">sk_buff</a> *<a class=\"id\" href=\"#skb\">skb</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#nlmsghdr\">nlmsghdr</a><span class=\"ts\"/>*<a class=\"id\" href=\"#nlh\">nlh</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#scsi_nl_host_vendor_msg\">scsi_nl_host_vendor_msg</a> *<a class=\"id\" href=\"#msg\">msg</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#len\">len</a>, <a class=\"id\" href=\"#skblen\">skblen</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#err\">err</a>;", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#scsi_nl_sock\">scsi_nl_sock</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#ENOENT\">ENOENT</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#send_vendor_fail\">send_vendor_fail</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#len\">len</a> = <a class=\"id\" href=\"#SCSI_NL_MSGALIGN\">SCSI_NL_MSGALIGN</a>(sizeof(*<a class=\"id\" href=\"#msg\">msg</a>) + <a class=\"id\" href=\"#data_len\">data_len</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#skblen\">skblen</a> = <a class=\"id\" href=\"#NLMSG_SPACE\">NLMSG_SPACE</a>(<a class=\"id\" href=\"#len\">len</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#skb\">skb</a> = <a class=\"id\" href=\"#alloc_skb\">alloc_skb</a>(<a class=\"id\" href=\"#skblen\">skblen</a>, <a class=\"id\" href=\"#GFP_KERNEL\">GFP_KERNEL</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#skb\">skb</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#ENOBUFS\">ENOBUFS</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#send_vendor_fail\">send_vendor_fail</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#nlh\">nlh</a> = <a class=\"id\" href=\"#nlmsg_put\">nlmsg_put</a>(<a class=\"id\" href=\"#skb\">skb</a>, 0, 0, <a class=\"id\" href=\"#SCSI_TRANSPORT_MSG\">SCSI_TRANSPORT_MSG</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#skblen\">skblen</a> - sizeof(*<a class=\"id\" href=\"#nlh\">nlh</a>), 0);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#nlh\">nlh</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#ENOBUFS\">ENOBUFS</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#send_vendor_fail_skb\">send_vendor_fail_skb</a>;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#msg\">msg</a> = <a class=\"id\" href=\"#NLMSG_DATA\">NLMSG_DATA</a>(<a class=\"id\" href=\"#nlh\">nlh</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#INIT_SCSI_NL_HDR\">INIT_SCSI_NL_HDR</a>(&amp;<a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#snlh\">snlh</a>, <a class=\"id\" href=\"#SCSI_NL_TRANSPORT\">SCSI_NL_TRANSPORT</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#SCSI_NL_SHOST_VENDOR\">SCSI_NL_SHOST_VENDOR</a>, <a class=\"id\" href=\"#len\">len</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#vendor_id\">vendor_id</a> = <a class=\"id\" href=\"#vendor_id\">vendor_id</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#host_no\">host_no</a> = <a class=\"id\" href=\"#host_no\">host_no</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#vmsg_datalen\">vmsg_datalen</a> = <a class=\"id\" href=\"#data_len\">data_len</a>;<span class=\"ts\"/><span class=\"comment\">/* bytes */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#memcpy\">memcpy</a>(&amp;<a class=\"id\" href=\"#msg\">msg</a>[1], <a class=\"id\" href=\"#data_buf\">data_buf</a>, <a class=\"id\" href=\"#data_len\">data_len</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = <a class=\"id\" href=\"#nlmsg_unicast\">nlmsg_unicast</a>(<a class=\"id\" href=\"#scsi_nl_sock\">scsi_nl_sock</a>, <a class=\"id\" href=\"#skb\">skb</a>, <a class=\"id\" href=\"#pid\">pid</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#err\">err</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* nlmsg_multicast already kfree_skb'd */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#send_vendor_fail\">send_vendor_fail</a>;", 
"", 
"<span class=\"ts\"/>return 0;", 
"", 
"<a class=\"id\" href=\"#send_vendor_fail_skb\">send_vendor_fail_skb</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kfree_skb\">kfree_skb</a>(<a class=\"id\" href=\"#skb\">skb</a>);", 
"<a class=\"id\" href=\"#send_vendor_fail\">send_vendor_fail</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_WARNING\">KERN_WARNING</a>", 
"<span class=\"ts\"/><span class=\"ts\"/>\"%s: Dropped SCSI Msg : host %d vendor_unique - err %d\\n\",", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#__func__\">__func__</a>, <a class=\"id\" href=\"#host_no\">host_no</a>, <a class=\"id\" href=\"#err\">err</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#err\">err</a>;", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL\">EXPORT_SYMBOL</a>(<a class=\"id\" href=\"#scsi_nl_send_vendor_msg\">scsi_nl_send_vendor_msg</a>);", 
"", 
"", 
];
xr_frag_insert('l/70/0916b9fdd473c9b8cfa9599c83508d20ad29b4.xr', __xr_tmp);
