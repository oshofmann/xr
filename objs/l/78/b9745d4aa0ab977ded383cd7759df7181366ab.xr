var __xr_tmp = [
"<span class=\"comment\"> */</span>", 
"static void <a class=\"id\" href=\"#ahci_restore_initial_config\">ahci_restore_initial_config</a>(struct <a class=\"id\" href=\"#ata_host\">ata_host</a> *<a class=\"id\" href=\"#host\">host</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_host_priv\">ahci_host_priv</a> *<a class=\"id\" href=\"#hpriv\">hpriv</a> = <a class=\"id\" href=\"#host\">host</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"<span class=\"ts\"/>void <a class=\"id\" href=\"#__iomem\">__iomem</a> *<a class=\"id\" href=\"#mmio\">mmio</a> = <a class=\"id\" href=\"#hpriv\">hpriv</a>-><a class=\"id\" href=\"#mmio\">mmio</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#hpriv\">hpriv</a>-><a class=\"id\" href=\"#saved_cap\">saved_cap</a>, <a class=\"id\" href=\"#mmio\">mmio</a> + <a class=\"id\" href=\"#HOST_CAP\">HOST_CAP</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#hpriv\">hpriv</a>-><a class=\"id\" href=\"#saved_cap2\">saved_cap2</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#hpriv\">hpriv</a>-><a class=\"id\" href=\"#saved_cap2\">saved_cap2</a>, <a class=\"id\" href=\"#mmio\">mmio</a> + <a class=\"id\" href=\"#HOST_CAP2\">HOST_CAP2</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#hpriv\">hpriv</a>-><a class=\"id\" href=\"#saved_port_map\">saved_port_map</a>, <a class=\"id\" href=\"#mmio\">mmio</a> + <a class=\"id\" href=\"#HOST_PORTS_IMPL\">HOST_PORTS_IMPL</a>);", 
"<span class=\"ts\"/>(void) <a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#mmio\">mmio</a> + <a class=\"id\" href=\"#HOST_PORTS_IMPL\">HOST_PORTS_IMPL</a>);<span class=\"ts\"/><span class=\"comment\">/* flush */</span>", 
"}", 
"", 
"static unsigned <a class=\"id\" href=\"#ahci_scr_offset\">ahci_scr_offset</a>(struct <a class=\"id\" href=\"#ata_port\">ata_port</a> *<a class=\"id\" href=\"#ap\">ap</a>, unsigned int <a class=\"id\" href=\"#sc_reg\">sc_reg</a>)", 
"{", 
"<span class=\"ts\"/>static const int <a class=\"id\" href=\"#offset\">offset</a>[] = {", 
"<span class=\"ts\"/><span class=\"ts\"/>[<a class=\"id\" href=\"#SCR_STATUS\">SCR_STATUS</a>]<span class=\"ts\"/><span class=\"ts\"/>= <a class=\"id\" href=\"#PORT_SCR_STAT\">PORT_SCR_STAT</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/>[<a class=\"id\" href=\"#SCR_CONTROL\">SCR_CONTROL</a>]<span class=\"ts\"/><span class=\"ts\"/>= <a class=\"id\" href=\"#PORT_SCR_CTL\">PORT_SCR_CTL</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/>[<a class=\"id\" href=\"#SCR_ERROR\">SCR_ERROR</a>]<span class=\"ts\"/><span class=\"ts\"/>= <a class=\"id\" href=\"#PORT_SCR_ERR\">PORT_SCR_ERR</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/>[<a class=\"id\" href=\"#SCR_ACTIVE\">SCR_ACTIVE</a>]<span class=\"ts\"/><span class=\"ts\"/>= <a class=\"id\" href=\"#PORT_SCR_ACT\">PORT_SCR_ACT</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/>[<a class=\"id\" href=\"#SCR_NOTIFICATION\">SCR_NOTIFICATION</a>]<span class=\"ts\"/>= <a class=\"id\" href=\"#PORT_SCR_NTF\">PORT_SCR_NTF</a>,", 
"<span class=\"ts\"/>};", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_host_priv\">ahci_host_priv</a> *<a class=\"id\" href=\"#hpriv\">hpriv</a> = <a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#host\">host</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#sc_reg\">sc_reg</a> &lt; <a class=\"id\" href=\"#ARRAY_SIZE\">ARRAY_SIZE</a>(<a class=\"id\" href=\"#offset\">offset</a>) &&", 
"<span class=\"ts\"/>    (<a class=\"id\" href=\"#sc_reg\">sc_reg</a> != <a class=\"id\" href=\"#SCR_NOTIFICATION\">SCR_NOTIFICATION</a> || (<a class=\"id\" href=\"#hpriv\">hpriv</a>-><a class=\"id\" href=\"#cap\">cap</a> &amp; <a class=\"id\" href=\"#HOST_CAP_SNTF\">HOST_CAP_SNTF</a>)))", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#offset\">offset</a>[<a class=\"id\" href=\"#sc_reg\">sc_reg</a>];", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"static int <a class=\"id\" href=\"#ahci_scr_read\">ahci_scr_read</a>(struct <a class=\"id\" href=\"#ata_link\">ata_link</a> *<a class=\"id\" href=\"#link\">link</a>, unsigned int <a class=\"id\" href=\"#sc_reg\">sc_reg</a>, <a class=\"id\" href=\"#u32\">u32</a> *<a class=\"id\" href=\"#val\">val</a>)", 
"{", 
"<span class=\"ts\"/>void <a class=\"id\" href=\"#__iomem\">__iomem</a> *<a class=\"id\" href=\"#port_mmio\">port_mmio</a> = <a class=\"id\" href=\"#ahci_port_base\">ahci_port_base</a>(<a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#ap\">ap</a>);", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#offset\">offset</a> = <a class=\"id\" href=\"#ahci_scr_offset\">ahci_scr_offset</a>(<a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#ap\">ap</a>, <a class=\"id\" href=\"#sc_reg\">sc_reg</a>);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#offset\">offset</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>*<a class=\"id\" href=\"#val\">val</a> = <a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#offset\">offset</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"}", 
"", 
"static int <a class=\"id\" href=\"#ahci_scr_write\">ahci_scr_write</a>(struct <a class=\"id\" href=\"#ata_link\">ata_link</a> *<a class=\"id\" href=\"#link\">link</a>, unsigned int <a class=\"id\" href=\"#sc_reg\">sc_reg</a>, <a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#val\">val</a>)", 
"{", 
"<span class=\"ts\"/>void <a class=\"id\" href=\"#__iomem\">__iomem</a> *<a class=\"id\" href=\"#port_mmio\">port_mmio</a> = <a class=\"id\" href=\"#ahci_port_base\">ahci_port_base</a>(<a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#ap\">ap</a>);", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#offset\">offset</a> = <a class=\"id\" href=\"#ahci_scr_offset\">ahci_scr_offset</a>(<a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#ap\">ap</a>, <a class=\"id\" href=\"#sc_reg\">sc_reg</a>);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#offset\">offset</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#val\">val</a>, <a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#offset\">offset</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"}", 
"", 
"void <a class=\"id\" href=\"#ahci_start_engine\">ahci_start_engine</a>(struct <a class=\"id\" href=\"#ata_port\">ata_port</a> *<a class=\"id\" href=\"#ap\">ap</a>)", 
"{", 
"<span class=\"ts\"/>void <a class=\"id\" href=\"#__iomem\">__iomem</a> *<a class=\"id\" href=\"#port_mmio\">port_mmio</a> = <a class=\"id\" href=\"#ahci_port_base\">ahci_port_base</a>(<a class=\"id\" href=\"#ap\">ap</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#tmp\">tmp</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* start DMA */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tmp\">tmp</a> = <a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_CMD\">PORT_CMD</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tmp\">tmp</a> |= <a class=\"id\" href=\"#PORT_CMD_START\">PORT_CMD_START</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#tmp\">tmp</a>, <a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_CMD\">PORT_CMD</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_CMD\">PORT_CMD</a>); <span class=\"comment\">/* flush */</span>", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#ahci_start_engine\">ahci_start_engine</a>);", 
"", 
"int <a class=\"id\" href=\"#ahci_stop_engine\">ahci_stop_engine</a>(struct <a class=\"id\" href=\"#ata_port\">ata_port</a> *<a class=\"id\" href=\"#ap\">ap</a>)", 
"{", 
"<span class=\"ts\"/>void <a class=\"id\" href=\"#__iomem\">__iomem</a> *<a class=\"id\" href=\"#port_mmio\">port_mmio</a> = <a class=\"id\" href=\"#ahci_port_base\">ahci_port_base</a>(<a class=\"id\" href=\"#ap\">ap</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#tmp\">tmp</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tmp\">tmp</a> = <a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_CMD\">PORT_CMD</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* check if the HBA is idle */</span>", 
"<span class=\"ts\"/>if ((<a class=\"id\" href=\"#tmp\">tmp</a> &amp; (<a class=\"id\" href=\"#PORT_CMD_START\">PORT_CMD_START</a> | <a class=\"id\" href=\"#PORT_CMD_LIST_ON\">PORT_CMD_LIST_ON</a>)) == 0)", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* setting HBA to idle */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tmp\">tmp</a> &= ~<a class=\"id\" href=\"#PORT_CMD_START\">PORT_CMD_START</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#tmp\">tmp</a>, <a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_CMD\">PORT_CMD</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* wait for engine to stop. This could be as long as 500 msec */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tmp\">tmp</a> = <a class=\"id\" href=\"#ata_wait_register\">ata_wait_register</a>(<a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_CMD\">PORT_CMD</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#PORT_CMD_LIST_ON\">PORT_CMD_LIST_ON</a>, <a class=\"id\" href=\"#PORT_CMD_LIST_ON\">PORT_CMD_LIST_ON</a>, 1, 500);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#tmp\">tmp</a> &amp; <a class=\"id\" href=\"#PORT_CMD_LIST_ON\">PORT_CMD_LIST_ON</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EIO\">EIO</a>;", 
"", 
"<span class=\"ts\"/>return 0;", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#ahci_stop_engine\">ahci_stop_engine</a>);", 
"", 
"static void <a class=\"id\" href=\"#ahci_start_fis_rx\">ahci_start_fis_rx</a>(struct <a class=\"id\" href=\"#ata_port\">ata_port</a> *<a class=\"id\" href=\"#ap\">ap</a>)", 
"{", 
"<span class=\"ts\"/>void <a class=\"id\" href=\"#__iomem\">__iomem</a> *<a class=\"id\" href=\"#port_mmio\">port_mmio</a> = <a class=\"id\" href=\"#ahci_port_base\">ahci_port_base</a>(<a class=\"id\" href=\"#ap\">ap</a>);", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_host_priv\">ahci_host_priv</a> *<a class=\"id\" href=\"#hpriv\">hpriv</a> = <a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#host\">host</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_port_priv\">ahci_port_priv</a> *<a class=\"id\" href=\"#pp\">pp</a> = <a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#tmp\">tmp</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* set FIS registers */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#hpriv\">hpriv</a>-><a class=\"id\" href=\"#cap\">cap</a> &amp; <a class=\"id\" href=\"#HOST_CAP_64\">HOST_CAP_64</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>((<a class=\"id\" href=\"#pp\">pp</a>-><a class=\"id\" href=\"#cmd_slot_dma\">cmd_slot_dma</a> >> 16) >> 16,", 
"<span class=\"ts\"/><span class=\"ts\"/>       <a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_LST_ADDR_HI\">PORT_LST_ADDR_HI</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#pp\">pp</a>-><a class=\"id\" href=\"#cmd_slot_dma\">cmd_slot_dma</a> &amp; 0xffffffff, <a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_LST_ADDR\">PORT_LST_ADDR</a>);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#hpriv\">hpriv</a>-><a class=\"id\" href=\"#cap\">cap</a> &amp; <a class=\"id\" href=\"#HOST_CAP_64\">HOST_CAP_64</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>((<a class=\"id\" href=\"#pp\">pp</a>-><a class=\"id\" href=\"#rx_fis_dma\">rx_fis_dma</a> >> 16) >> 16,", 
"<span class=\"ts\"/><span class=\"ts\"/>       <a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_FIS_ADDR_HI\">PORT_FIS_ADDR_HI</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#pp\">pp</a>-><a class=\"id\" href=\"#rx_fis_dma\">rx_fis_dma</a> &amp; 0xffffffff, <a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_FIS_ADDR\">PORT_FIS_ADDR</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* enable FIS reception */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tmp\">tmp</a> = <a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_CMD\">PORT_CMD</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tmp\">tmp</a> |= <a class=\"id\" href=\"#PORT_CMD_FIS_RX\">PORT_CMD_FIS_RX</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#tmp\">tmp</a>, <a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_CMD\">PORT_CMD</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* flush */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_CMD\">PORT_CMD</a>);", 
"}", 
"", 
"static int <a class=\"id\" href=\"#ahci_stop_fis_rx\">ahci_stop_fis_rx</a>(struct <a class=\"id\" href=\"#ata_port\">ata_port</a> *<a class=\"id\" href=\"#ap\">ap</a>)", 
"{", 
"<span class=\"ts\"/>void <a class=\"id\" href=\"#__iomem\">__iomem</a> *<a class=\"id\" href=\"#port_mmio\">port_mmio</a> = <a class=\"id\" href=\"#ahci_port_base\">ahci_port_base</a>(<a class=\"id\" href=\"#ap\">ap</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#tmp\">tmp</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* disable FIS reception */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tmp\">tmp</a> = <a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_CMD\">PORT_CMD</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tmp\">tmp</a> &= ~<a class=\"id\" href=\"#PORT_CMD_FIS_RX\">PORT_CMD_FIS_RX</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#tmp\">tmp</a>, <a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_CMD\">PORT_CMD</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* wait for completion, spec says 500ms, give it 1000 */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tmp\">tmp</a> = <a class=\"id\" href=\"#ata_wait_register\">ata_wait_register</a>(<a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_CMD\">PORT_CMD</a>, <a class=\"id\" href=\"#PORT_CMD_FIS_ON\">PORT_CMD_FIS_ON</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#PORT_CMD_FIS_ON\">PORT_CMD_FIS_ON</a>, 10, 1000);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#tmp\">tmp</a> &amp; <a class=\"id\" href=\"#PORT_CMD_FIS_ON\">PORT_CMD_FIS_ON</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EBUSY\">EBUSY</a>;", 
"", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"static void <a class=\"id\" href=\"#ahci_power_up\">ahci_power_up</a>(struct <a class=\"id\" href=\"#ata_port\">ata_port</a> *<a class=\"id\" href=\"#ap\">ap</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_host_priv\">ahci_host_priv</a> *<a class=\"id\" href=\"#hpriv\">hpriv</a> = <a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#host\">host</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"<span class=\"ts\"/>void <a class=\"id\" href=\"#__iomem\">__iomem</a> *<a class=\"id\" href=\"#port_mmio\">port_mmio</a> = <a class=\"id\" href=\"#ahci_port_base\">ahci_port_base</a>(<a class=\"id\" href=\"#ap\">ap</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#cmd\">cmd</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#cmd\">cmd</a> = <a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_CMD\">PORT_CMD</a>) &amp; ~<a class=\"id\" href=\"#PORT_CMD_ICC_MASK\">PORT_CMD_ICC_MASK</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* spin up device */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#hpriv\">hpriv</a>-><a class=\"id\" href=\"#cap\">cap</a> &amp; <a class=\"id\" href=\"#HOST_CAP_SSS\">HOST_CAP_SSS</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#cmd\">cmd</a> |= <a class=\"id\" href=\"#PORT_CMD_SPIN_UP\">PORT_CMD_SPIN_UP</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#cmd\">cmd</a>, <a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_CMD\">PORT_CMD</a>);", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* wake up link */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#cmd\">cmd</a> | <a class=\"id\" href=\"#PORT_CMD_ICC_ACTIVE\">PORT_CMD_ICC_ACTIVE</a>, <a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_CMD\">PORT_CMD</a>);", 
"}", 
"", 
"static void <a class=\"id\" href=\"#ahci_disable_alpm\">ahci_disable_alpm</a>(struct <a class=\"id\" href=\"#ata_port\">ata_port</a> *<a class=\"id\" href=\"#ap\">ap</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_host_priv\">ahci_host_priv</a> *<a class=\"id\" href=\"#hpriv\">hpriv</a> = <a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#host\">host</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"<span class=\"ts\"/>void <a class=\"id\" href=\"#__iomem\">__iomem</a> *<a class=\"id\" href=\"#port_mmio\">port_mmio</a> = <a class=\"id\" href=\"#ahci_port_base\">ahci_port_base</a>(<a class=\"id\" href=\"#ap\">ap</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#cmd\">cmd</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_port_priv\">ahci_port_priv</a> *<a class=\"id\" href=\"#pp\">pp</a> = <a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* IPM bits should be disabled by libata-core */</span>", 
"<span class=\"ts\"/><span class=\"comment\">/* get the existing command bits */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#cmd\">cmd</a> = <a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_CMD\">PORT_CMD</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* disable ALPM and ASP */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#cmd\">cmd</a> &= ~<a class=\"id\" href=\"#PORT_CMD_ASP\">PORT_CMD_ASP</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#cmd\">cmd</a> &= ~<a class=\"id\" href=\"#PORT_CMD_ALPE\">PORT_CMD_ALPE</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* force the interface back to active */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#cmd\">cmd</a> |= <a class=\"id\" href=\"#PORT_CMD_ICC_ACTIVE\">PORT_CMD_ICC_ACTIVE</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* write out new cmd value */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#cmd\">cmd</a>, <a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_CMD\">PORT_CMD</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#cmd\">cmd</a> = <a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_CMD\">PORT_CMD</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* wait 10ms to be sure we've come out of any low power state */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#msleep\">msleep</a>(10);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* clear out any PhyRdy stuff from interrupt status */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#PORT_IRQ_PHYRDY\">PORT_IRQ_PHYRDY</a>, <a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_IRQ_STAT\">PORT_IRQ_STAT</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* go ahead and clean out PhyRdy Change from Serror too */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ahci_scr_write\">ahci_scr_write</a>(&amp;<a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#link\">link</a>, <a class=\"id\" href=\"#SCR_ERROR\">SCR_ERROR</a>, ((1 << 16) | (1 << 18)));", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Clear flag to indicate that we should ignore all PhyRdy</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * state changes</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#hpriv\">hpriv</a>-><a class=\"id\" href=\"#flags\">flags</a> &= ~<a class=\"id\" href=\"#AHCI_HFLAG_NO_HOTPLUG\">AHCI_HFLAG_NO_HOTPLUG</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Enable interrupts on Phy Ready.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pp\">pp</a>-><a class=\"id\" href=\"#intr_mask\">intr_mask</a> |= <a class=\"id\" href=\"#PORT_IRQ_PHYRDY\">PORT_IRQ_PHYRDY</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#pp\">pp</a>-><a class=\"id\" href=\"#intr_mask\">intr_mask</a>, <a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_IRQ_MASK\">PORT_IRQ_MASK</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * don't change the link pm policy - we can be called</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * just to turn of link pm temporarily</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"}", 
"", 
"static int <a class=\"id\" href=\"#ahci_enable_alpm\">ahci_enable_alpm</a>(struct <a class=\"id\" href=\"#ata_port\">ata_port</a> *<a class=\"id\" href=\"#ap\">ap</a>,", 
"<span class=\"ts\"/>enum <a class=\"id\" href=\"#link_pm\">link_pm</a> <a class=\"id\" href=\"#policy\">policy</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_host_priv\">ahci_host_priv</a> *<a class=\"id\" href=\"#hpriv\">hpriv</a> = <a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#host\">host</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"<span class=\"ts\"/>void <a class=\"id\" href=\"#__iomem\">__iomem</a> *<a class=\"id\" href=\"#port_mmio\">port_mmio</a> = <a class=\"id\" href=\"#ahci_port_base\">ahci_port_base</a>(<a class=\"id\" href=\"#ap\">ap</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#cmd\">cmd</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_port_priv\">ahci_port_priv</a> *<a class=\"id\" href=\"#pp\">pp</a> = <a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#asp\">asp</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Make sure the host is capable of link power management */</span>", 
"<span class=\"ts\"/>if (!(<a class=\"id\" href=\"#hpriv\">hpriv</a>-><a class=\"id\" href=\"#cap\">cap</a> &amp; <a class=\"id\" href=\"#HOST_CAP_ALPM\">HOST_CAP_ALPM</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"", 
"<span class=\"ts\"/>switch (<a class=\"id\" href=\"#policy\">policy</a>) {", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#MAX_PERFORMANCE\">MAX_PERFORMANCE</a>:", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#NOT_AVAILABLE\">NOT_AVAILABLE</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * if we came here with NOT_AVAILABLE,</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * it just means this is the first time we</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * have tried to enable - default to max performance,</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * and let the user go to lower power modes on request.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ahci_disable_alpm\">ahci_disable_alpm</a>(<a class=\"id\" href=\"#ap\">ap</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#MIN_POWER\">MIN_POWER</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* configure HBA to enter SLUMBER */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#asp\">asp</a> = <a class=\"id\" href=\"#PORT_CMD_ASP\">PORT_CMD_ASP</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#MEDIUM_POWER\">MEDIUM_POWER</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* configure HBA to enter PARTIAL */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#asp\">asp</a> = 0;", 
"<span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>default:", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Disable interrupts on Phy Ready. This keeps us from</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * getting woken up due to spurious phy ready interrupts</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * TBD - Hot plug should be done via polling now, is</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * that even supported?</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pp\">pp</a>-><a class=\"id\" href=\"#intr_mask\">intr_mask</a> &= ~<a class=\"id\" href=\"#PORT_IRQ_PHYRDY\">PORT_IRQ_PHYRDY</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#pp\">pp</a>-><a class=\"id\" href=\"#intr_mask\">intr_mask</a>, <a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_IRQ_MASK\">PORT_IRQ_MASK</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Set a flag to indicate that we should ignore all PhyRdy</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * state changes since these can happen now whenever we</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * change link state</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#hpriv\">hpriv</a>-><a class=\"id\" href=\"#flags\">flags</a> |= <a class=\"id\" href=\"#AHCI_HFLAG_NO_HOTPLUG\">AHCI_HFLAG_NO_HOTPLUG</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* get the existing command bits */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#cmd\">cmd</a> = <a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_CMD\">PORT_CMD</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Set ASP based on Policy</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#cmd\">cmd</a> |= <a class=\"id\" href=\"#asp\">asp</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Setting this bit will instruct the HBA to aggressively</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * enter a lower power link state when it's appropriate and</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * based on the value set above for ASP</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#cmd\">cmd</a> |= <a class=\"id\" href=\"#PORT_CMD_ALPE\">PORT_CMD_ALPE</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* write out new cmd value */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#cmd\">cmd</a>, <a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_CMD\">PORT_CMD</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#cmd\">cmd</a> = <a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_CMD\">PORT_CMD</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* IPM bits should be set by libata-core */</span>", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"#<a class=\"id\" href=\"#ifdef\">ifdef</a> <a class=\"id\" href=\"#CONFIG_PM\">CONFIG_PM</a>", 
"static void <a class=\"id\" href=\"#ahci_power_down\">ahci_power_down</a>(struct <a class=\"id\" href=\"#ata_port\">ata_port</a> *<a class=\"id\" href=\"#ap\">ap</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_host_priv\">ahci_host_priv</a> *<a class=\"id\" href=\"#hpriv\">hpriv</a> = <a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#host\">host</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"<span class=\"ts\"/>void <a class=\"id\" href=\"#__iomem\">__iomem</a> *<a class=\"id\" href=\"#port_mmio\">port_mmio</a> = <a class=\"id\" href=\"#ahci_port_base\">ahci_port_base</a>(<a class=\"id\" href=\"#ap\">ap</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#cmd\">cmd</a>, <a class=\"id\" href=\"#scontrol\">scontrol</a>;", 
"", 
"<span class=\"ts\"/>if (!(<a class=\"id\" href=\"#hpriv\">hpriv</a>-><a class=\"id\" href=\"#cap\">cap</a> &amp; <a class=\"id\" href=\"#HOST_CAP_SSS\">HOST_CAP_SSS</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* put device into listen mode, first set PxSCTL.DET to 0 */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#scontrol\">scontrol</a> = <a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_SCR_CTL\">PORT_SCR_CTL</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#scontrol\">scontrol</a> &= ~0xf;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#scontrol\">scontrol</a>, <a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_SCR_CTL\">PORT_SCR_CTL</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* then set PxCMD.SUD to 0 */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#cmd\">cmd</a> = <a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_CMD\">PORT_CMD</a>) &amp; ~<a class=\"id\" href=\"#PORT_CMD_ICC_MASK\">PORT_CMD_ICC_MASK</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#cmd\">cmd</a> &= ~<a class=\"id\" href=\"#PORT_CMD_SPIN_UP\">PORT_CMD_SPIN_UP</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#cmd\">cmd</a>, <a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_CMD\">PORT_CMD</a>);", 
"}", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
"", 
"static void <a class=\"id\" href=\"#ahci_start_port\">ahci_start_port</a>(struct <a class=\"id\" href=\"#ata_port\">ata_port</a> *<a class=\"id\" href=\"#ap\">ap</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_port_priv\">ahci_port_priv</a> *<a class=\"id\" href=\"#pp\">pp</a> = <a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ata_link\">ata_link</a> *<a class=\"id\" href=\"#link\">link</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_em_priv\">ahci_em_priv</a> *<a class=\"id\" href=\"#emp\">emp</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ssize_t\">ssize_t</a> <a class=\"id\" href=\"#rc\">rc</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#i\">i</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* enable FIS reception */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ahci_start_fis_rx\">ahci_start_fis_rx</a>(<a class=\"id\" href=\"#ap\">ap</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* enable DMA */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ahci_start_engine\">ahci_start_engine</a>(<a class=\"id\" href=\"#ap\">ap</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* turn on LEDs */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#flags\">flags</a> &amp; <a class=\"id\" href=\"#ATA_FLAG_EM\">ATA_FLAG_EM</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ata_for_each_link\">ata_for_each_link</a>(<a class=\"id\" href=\"#link\">link</a>, <a class=\"id\" href=\"#ap\">ap</a>, <a class=\"id\" href=\"#EDGE\">EDGE</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#emp\">emp</a> = &amp;<a class=\"id\" href=\"#pp\">pp</a>-><a class=\"id\" href=\"#em_priv\">em_priv</a>[<a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#pmp\">pmp</a>];", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* EM Transmit bit maybe busy during init */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = 0; <a class=\"id\" href=\"#i\">i</a> &lt; <a class=\"id\" href=\"#EM_MAX_RETRY\">EM_MAX_RETRY</a>; <a class=\"id\" href=\"#i\">i</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rc\">rc</a> = <a class=\"id\" href=\"#ahci_transmit_led_message\">ahci_transmit_led_message</a>(<a class=\"id\" href=\"#ap\">ap</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       <a class=\"id\" href=\"#emp\">emp</a>-><a class=\"id\" href=\"#led_state\">led_state</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       4);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#rc\">rc</a> == -<a class=\"id\" href=\"#EBUSY\">EBUSY</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msleep\">msleep</a>(1);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>else", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#flags\">flags</a> &amp; <a class=\"id\" href=\"#ATA_FLAG_SW_ACTIVITY\">ATA_FLAG_SW_ACTIVITY</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ata_for_each_link\">ata_for_each_link</a>(<a class=\"id\" href=\"#link\">link</a>, <a class=\"id\" href=\"#ap\">ap</a>, <a class=\"id\" href=\"#EDGE\">EDGE</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ahci_init_sw_activity\">ahci_init_sw_activity</a>(<a class=\"id\" href=\"#link\">link</a>);", 
"", 
"}", 
"", 
"static int <a class=\"id\" href=\"#ahci_deinit_port\">ahci_deinit_port</a>(struct <a class=\"id\" href=\"#ata_port\">ata_port</a> *<a class=\"id\" href=\"#ap\">ap</a>, const char **<a class=\"id\" href=\"#emsg\">emsg</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#rc\">rc</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* disable DMA */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rc\">rc</a> = <a class=\"id\" href=\"#ahci_stop_engine\">ahci_stop_engine</a>(<a class=\"id\" href=\"#ap\">ap</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#rc\">rc</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>*<a class=\"id\" href=\"#emsg\">emsg</a> = \"failed to stop engine\";", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#rc\">rc</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* disable FIS reception */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rc\">rc</a> = <a class=\"id\" href=\"#ahci_stop_fis_rx\">ahci_stop_fis_rx</a>(<a class=\"id\" href=\"#ap\">ap</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#rc\">rc</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>*<a class=\"id\" href=\"#emsg\">emsg</a> = \"failed stop FIS RX\";", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#rc\">rc</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"int <a class=\"id\" href=\"#ahci_reset_controller\">ahci_reset_controller</a>(struct <a class=\"id\" href=\"#ata_host\">ata_host</a> *<a class=\"id\" href=\"#host\">host</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_host_priv\">ahci_host_priv</a> *<a class=\"id\" href=\"#hpriv\">hpriv</a> = <a class=\"id\" href=\"#host\">host</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"<span class=\"ts\"/>void <a class=\"id\" href=\"#__iomem\">__iomem</a> *<a class=\"id\" href=\"#mmio\">mmio</a> = <a class=\"id\" href=\"#hpriv\">hpriv</a>-><a class=\"id\" href=\"#mmio\">mmio</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#tmp\">tmp</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* we must be in AHCI mode, before using anything</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * AHCI-specific, such as HOST_RESET.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ahci_enable_ahci\">ahci_enable_ahci</a>(<a class=\"id\" href=\"#mmio\">mmio</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* global controller reset */</span>", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#ahci_skip_host_reset\">ahci_skip_host_reset</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tmp\">tmp</a> = <a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#mmio\">mmio</a> + <a class=\"id\" href=\"#HOST_CTL\">HOST_CTL</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if ((<a class=\"id\" href=\"#tmp\">tmp</a> &amp; <a class=\"id\" href=\"#HOST_RESET\">HOST_RESET</a>) == 0) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#tmp\">tmp</a> | <a class=\"id\" href=\"#HOST_RESET\">HOST_RESET</a>, <a class=\"id\" href=\"#mmio\">mmio</a> + <a class=\"id\" href=\"#HOST_CTL\">HOST_CTL</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#mmio\">mmio</a> + <a class=\"id\" href=\"#HOST_CTL\">HOST_CTL</a>); <span class=\"comment\">/* flush */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * to perform host reset, OS should set HOST_RESET</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * and poll until this bit is read to be \"0\".</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * reset must complete within 1 second, or</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * the hardware should be considered fried.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tmp\">tmp</a> = <a class=\"id\" href=\"#ata_wait_register\">ata_wait_register</a>(<a class=\"id\" href=\"#mmio\">mmio</a> + <a class=\"id\" href=\"#HOST_CTL\">HOST_CTL</a>, <a class=\"id\" href=\"#HOST_RESET\">HOST_RESET</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#HOST_RESET\">HOST_RESET</a>, 10, 1000);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#tmp\">tmp</a> &amp; <a class=\"id\" href=\"#HOST_RESET\">HOST_RESET</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#dev_printk\">dev_printk</a>(<a class=\"id\" href=\"#KERN_ERR\">KERN_ERR</a>, <a class=\"id\" href=\"#host\">host</a>-><a class=\"id\" href=\"#dev\">dev</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>   \"controller reset failed (0x%x)\\n\", <a class=\"id\" href=\"#tmp\">tmp</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EIO\">EIO</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* turn on AHCI mode */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ahci_enable_ahci\">ahci_enable_ahci</a>(<a class=\"id\" href=\"#mmio\">mmio</a>);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Some registers might be cleared on reset.  Restore</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * initial values.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ahci_restore_initial_config\">ahci_restore_initial_config</a>(<a class=\"id\" href=\"#host\">host</a>);", 
"<span class=\"ts\"/>} else", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#dev_printk\">dev_printk</a>(<a class=\"id\" href=\"#KERN_INFO\">KERN_INFO</a>, <a class=\"id\" href=\"#host\">host</a>-><a class=\"id\" href=\"#dev\">dev</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>   \"skipping global host reset\\n\");", 
"", 
"<span class=\"ts\"/>return 0;", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#ahci_reset_controller\">ahci_reset_controller</a>);", 
"", 
"static void <a class=\"id\" href=\"#ahci_sw_activity\">ahci_sw_activity</a>(struct <a class=\"id\" href=\"#ata_link\">ata_link</a> *<a class=\"id\" href=\"#link\">link</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ata_port\">ata_port</a> *<a class=\"id\" href=\"#ap\">ap</a> = <a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#ap\">ap</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_port_priv\">ahci_port_priv</a> *<a class=\"id\" href=\"#pp\">pp</a> = <a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_em_priv\">ahci_em_priv</a> *<a class=\"id\" href=\"#emp\">emp</a> = &amp;<a class=\"id\" href=\"#pp\">pp</a>-><a class=\"id\" href=\"#em_priv\">em_priv</a>[<a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#pmp\">pmp</a>];", 
"", 
"<span class=\"ts\"/>if (!(<a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#flags\">flags</a> &amp; <a class=\"id\" href=\"#ATA_LFLAG_SW_ACTIVITY\">ATA_LFLAG_SW_ACTIVITY</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#emp\">emp</a>-><a class=\"id\" href=\"#activity\">activity</a>++;", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#timer_pending\">timer_pending</a>(&amp;<a class=\"id\" href=\"#emp\">emp</a>-><a class=\"id\" href=\"#timer\">timer</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#mod_timer\">mod_timer</a>(&amp;<a class=\"id\" href=\"#emp\">emp</a>-><a class=\"id\" href=\"#timer\">timer</a>, <a class=\"id\" href=\"#jiffies\">jiffies</a> + <a class=\"id\" href=\"#msecs_to_jiffies\">msecs_to_jiffies</a>(10));", 
"}", 
"", 
"static void <a class=\"id\" href=\"#ahci_sw_activity_blink\">ahci_sw_activity_blink</a>(unsigned long <a class=\"id\" href=\"#arg\">arg</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ata_link\">ata_link</a> *<a class=\"id\" href=\"#link\">link</a> = (struct <a class=\"id\" href=\"#ata_link\">ata_link</a> *)<a class=\"id\" href=\"#arg\">arg</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ata_port\">ata_port</a> *<a class=\"id\" href=\"#ap\">ap</a> = <a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#ap\">ap</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_port_priv\">ahci_port_priv</a> *<a class=\"id\" href=\"#pp\">pp</a> = <a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_em_priv\">ahci_em_priv</a> *<a class=\"id\" href=\"#emp\">emp</a> = &amp;<a class=\"id\" href=\"#pp\">pp</a>-><a class=\"id\" href=\"#em_priv\">em_priv</a>[<a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#pmp\">pmp</a>];", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#led_message\">led_message</a> = <a class=\"id\" href=\"#emp\">emp</a>-><a class=\"id\" href=\"#led_state\">led_state</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#activity_led_state\">activity_led_state</a>;", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#flags\">flags</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#led_message\">led_message</a> &= <a class=\"id\" href=\"#EM_MSG_LED_VALUE\">EM_MSG_LED_VALUE</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#led_message\">led_message</a> |= <a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#port_no\">port_no</a> | (<a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#pmp\">pmp</a> << 8);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* check to see if we've had activity.  If so,</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * toggle state of LED and reset timer.  If not,</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * turn LED to desired idle state.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irqsave\">spin_lock_irqsave</a>(<a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#lock\">lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#emp\">emp</a>-><a class=\"id\" href=\"#saved_activity\">saved_activity</a> != <a class=\"id\" href=\"#emp\">emp</a>-><a class=\"id\" href=\"#activity\">activity</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#emp\">emp</a>-><a class=\"id\" href=\"#saved_activity\">saved_activity</a> = <a class=\"id\" href=\"#emp\">emp</a>-><a class=\"id\" href=\"#activity\">activity</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* get the current LED state */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#activity_led_state\">activity_led_state</a> = <a class=\"id\" href=\"#led_message\">led_message</a> &amp; <a class=\"id\" href=\"#EM_MSG_LED_VALUE_ON\">EM_MSG_LED_VALUE_ON</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#activity_led_state\">activity_led_state</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#activity_led_state\">activity_led_state</a> = 0;", 
"<span class=\"ts\"/><span class=\"ts\"/>else", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#activity_led_state\">activity_led_state</a> = 1;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* clear old state */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#led_message\">led_message</a> &= ~<a class=\"id\" href=\"#EM_MSG_LED_VALUE_ACTIVITY\">EM_MSG_LED_VALUE_ACTIVITY</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* toggle state */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#led_message\">led_message</a> |= (<a class=\"id\" href=\"#activity_led_state\">activity_led_state</a> << 16);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#mod_timer\">mod_timer</a>(&amp;<a class=\"id\" href=\"#emp\">emp</a>-><a class=\"id\" href=\"#timer\">timer</a>, <a class=\"id\" href=\"#jiffies\">jiffies</a> + <a class=\"id\" href=\"#msecs_to_jiffies\">msecs_to_jiffies</a>(100));", 
"<span class=\"ts\"/>} else {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* switch to idle */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#led_message\">led_message</a> &= ~<a class=\"id\" href=\"#EM_MSG_LED_VALUE_ACTIVITY\">EM_MSG_LED_VALUE_ACTIVITY</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#emp\">emp</a>-><a class=\"id\" href=\"#blink_policy\">blink_policy</a> == <a class=\"id\" href=\"#BLINK_OFF\">BLINK_OFF</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#led_message\">led_message</a> |= (1 << 16);", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(<a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#lock\">lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ahci_transmit_led_message\">ahci_transmit_led_message</a>(<a class=\"id\" href=\"#ap\">ap</a>, <a class=\"id\" href=\"#led_message\">led_message</a>, 4);", 
"}", 
"", 
"static void <a class=\"id\" href=\"#ahci_init_sw_activity\">ahci_init_sw_activity</a>(struct <a class=\"id\" href=\"#ata_link\">ata_link</a> *<a class=\"id\" href=\"#link\">link</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ata_port\">ata_port</a> *<a class=\"id\" href=\"#ap\">ap</a> = <a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#ap\">ap</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_port_priv\">ahci_port_priv</a> *<a class=\"id\" href=\"#pp\">pp</a> = <a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_em_priv\">ahci_em_priv</a> *<a class=\"id\" href=\"#emp\">emp</a> = &amp;<a class=\"id\" href=\"#pp\">pp</a>-><a class=\"id\" href=\"#em_priv\">em_priv</a>[<a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#pmp\">pmp</a>];", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* init activity stats, setup timer */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#emp\">emp</a>-><a class=\"id\" href=\"#saved_activity\">saved_activity</a> = <a class=\"id\" href=\"#emp\">emp</a>-><a class=\"id\" href=\"#activity\">activity</a> = 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#setup_timer\">setup_timer</a>(&amp;<a class=\"id\" href=\"#emp\">emp</a>-><a class=\"id\" href=\"#timer\">timer</a>, <a class=\"id\" href=\"#ahci_sw_activity_blink\">ahci_sw_activity_blink</a>, (unsigned long)<a class=\"id\" href=\"#link\">link</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* check our blink policy and set flag for link if it's enabled */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#emp\">emp</a>-><a class=\"id\" href=\"#blink_policy\">blink_policy</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#flags\">flags</a> |= <a class=\"id\" href=\"#ATA_LFLAG_SW_ACTIVITY\">ATA_LFLAG_SW_ACTIVITY</a>;", 
"}", 
"", 
"int <a class=\"id\" href=\"#ahci_reset_em\">ahci_reset_em</a>(struct <a class=\"id\" href=\"#ata_host\">ata_host</a> *<a class=\"id\" href=\"#host\">host</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_host_priv\">ahci_host_priv</a> *<a class=\"id\" href=\"#hpriv\">hpriv</a> = <a class=\"id\" href=\"#host\">host</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"<span class=\"ts\"/>void <a class=\"id\" href=\"#__iomem\">__iomem</a> *<a class=\"id\" href=\"#mmio\">mmio</a> = <a class=\"id\" href=\"#hpriv\">hpriv</a>-><a class=\"id\" href=\"#mmio\">mmio</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#em_ctl\">em_ctl</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#em_ctl\">em_ctl</a> = <a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#mmio\">mmio</a> + <a class=\"id\" href=\"#HOST_EM_CTL\">HOST_EM_CTL</a>);", 
"<span class=\"ts\"/>if ((<a class=\"id\" href=\"#em_ctl\">em_ctl</a> &amp; <a class=\"id\" href=\"#EM_CTL_TM\">EM_CTL_TM</a>) || (<a class=\"id\" href=\"#em_ctl\">em_ctl</a> &amp; <a class=\"id\" href=\"#EM_CTL_RST\">EM_CTL_RST</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#em_ctl\">em_ctl</a> | <a class=\"id\" href=\"#EM_CTL_RST\">EM_CTL_RST</a>, <a class=\"id\" href=\"#mmio\">mmio</a> + <a class=\"id\" href=\"#HOST_EM_CTL\">HOST_EM_CTL</a>);", 
"<span class=\"ts\"/>return 0;", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#ahci_reset_em\">ahci_reset_em</a>);", 
"", 
"static <a class=\"id\" href=\"#ssize_t\">ssize_t</a> <a class=\"id\" href=\"#ahci_transmit_led_message\">ahci_transmit_led_message</a>(struct <a class=\"id\" href=\"#ata_port\">ata_port</a> *<a class=\"id\" href=\"#ap\">ap</a>, <a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#state\">state</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ssize_t\">ssize_t</a> <a class=\"id\" href=\"#size\">size</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_host_priv\">ahci_host_priv</a> *<a class=\"id\" href=\"#hpriv\">hpriv</a> = <a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#host\">host</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_port_priv\">ahci_port_priv</a> *<a class=\"id\" href=\"#pp\">pp</a> = <a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"<span class=\"ts\"/>void <a class=\"id\" href=\"#__iomem\">__iomem</a> *<a class=\"id\" href=\"#mmio\">mmio</a> = <a class=\"id\" href=\"#hpriv\">hpriv</a>-><a class=\"id\" href=\"#mmio\">mmio</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#em_ctl\">em_ctl</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#message\">message</a>[] = {0, 0};", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#flags\">flags</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#pmp\">pmp</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_em_priv\">ahci_em_priv</a> *<a class=\"id\" href=\"#emp\">emp</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* get the slot number from the message */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pmp\">pmp</a> = (<a class=\"id\" href=\"#state\">state</a> &amp; <a class=\"id\" href=\"#EM_MSG_LED_PMP_SLOT\">EM_MSG_LED_PMP_SLOT</a>) >> 8;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#pmp\">pmp</a> &lt; <a class=\"id\" href=\"#EM_MAX_SLOTS\">EM_MAX_SLOTS</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#emp\">emp</a> = &amp;<a class=\"id\" href=\"#pp\">pp</a>-><a class=\"id\" href=\"#em_priv\">em_priv</a>[<a class=\"id\" href=\"#pmp\">pmp</a>];", 
"<span class=\"ts\"/>else", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irqsave\">spin_lock_irqsave</a>(<a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#lock\">lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * if we are still busy transmitting a previous message,</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * do not allow</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#em_ctl\">em_ctl</a> = <a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#mmio\">mmio</a> + <a class=\"id\" href=\"#HOST_EM_CTL\">HOST_EM_CTL</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#em_ctl\">em_ctl</a> &amp; <a class=\"id\" href=\"#EM_CTL_TM\">EM_CTL_TM</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(<a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#lock\">lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EBUSY\">EBUSY</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#hpriv\">hpriv</a>-><a class=\"id\" href=\"#em_msg_type\">em_msg_type</a> &amp; <a class=\"id\" href=\"#EM_MSG_TYPE_LED\">EM_MSG_TYPE_LED</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * create message header - this is all zero except for</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * the message size, which is 4 bytes.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#message\">message</a>[0] |= (4 << 8);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* ignore 0:4 of byte zero, fill in port info yourself */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#message\">message</a>[1] = ((<a class=\"id\" href=\"#state\">state</a> &amp; ~<a class=\"id\" href=\"#EM_MSG_LED_HBA_PORT\">EM_MSG_LED_HBA_PORT</a>) | <a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#port_no\">port_no</a>);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* write message to EM_LOC */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#message\">message</a>[0], <a class=\"id\" href=\"#mmio\">mmio</a> + <a class=\"id\" href=\"#hpriv\">hpriv</a>-><a class=\"id\" href=\"#em_loc\">em_loc</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#message\">message</a>[1], <a class=\"id\" href=\"#mmio\">mmio</a> + <a class=\"id\" href=\"#hpriv\">hpriv</a>-><a class=\"id\" href=\"#em_loc\">em_loc</a>+4);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * tell hardware to transmit the message</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#em_ctl\">em_ctl</a> | <a class=\"id\" href=\"#EM_CTL_TM\">EM_CTL_TM</a>, <a class=\"id\" href=\"#mmio\">mmio</a> + <a class=\"id\" href=\"#HOST_EM_CTL\">HOST_EM_CTL</a>);", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* save off new led state for port/slot */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#emp\">emp</a>-><a class=\"id\" href=\"#led_state\">led_state</a> = <a class=\"id\" href=\"#state\">state</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(<a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#lock\">lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#size\">size</a>;", 
"}", 
"", 
"static <a class=\"id\" href=\"#ssize_t\">ssize_t</a> <a class=\"id\" href=\"#ahci_led_show\">ahci_led_show</a>(struct <a class=\"id\" href=\"#ata_port\">ata_port</a> *<a class=\"id\" href=\"#ap\">ap</a>, char *<a class=\"id\" href=\"#buf\">buf</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_port_priv\">ahci_port_priv</a> *<a class=\"id\" href=\"#pp\">pp</a> = <a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ata_link\">ata_link</a> *<a class=\"id\" href=\"#link\">link</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_em_priv\">ahci_em_priv</a> *<a class=\"id\" href=\"#emp\">emp</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#rc\">rc</a> = 0;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ata_for_each_link\">ata_for_each_link</a>(<a class=\"id\" href=\"#link\">link</a>, <a class=\"id\" href=\"#ap\">ap</a>, <a class=\"id\" href=\"#EDGE\">EDGE</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#emp\">emp</a> = &amp;<a class=\"id\" href=\"#pp\">pp</a>-><a class=\"id\" href=\"#em_priv\">em_priv</a>[<a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#pmp\">pmp</a>];", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rc\">rc</a> += <a class=\"id\" href=\"#sprintf\">sprintf</a>(<a class=\"id\" href=\"#buf\">buf</a>, \"%lx\\n\", <a class=\"id\" href=\"#emp\">emp</a>-><a class=\"id\" href=\"#led_state\">led_state</a>);", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#rc\">rc</a>;", 
"}", 
"", 
"static <a class=\"id\" href=\"#ssize_t\">ssize_t</a> <a class=\"id\" href=\"#ahci_led_store\">ahci_led_store</a>(struct <a class=\"id\" href=\"#ata_port\">ata_port</a> *<a class=\"id\" href=\"#ap\">ap</a>, const char *<a class=\"id\" href=\"#buf\">buf</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#size_t\">size_t</a> <a class=\"id\" href=\"#size\">size</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#state\">state</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#pmp\">pmp</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_port_priv\">ahci_port_priv</a> *<a class=\"id\" href=\"#pp\">pp</a> = <a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_em_priv\">ahci_em_priv</a> *<a class=\"id\" href=\"#emp\">emp</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#state\">state</a> = <a class=\"id\" href=\"#simple_strtoul\">simple_strtoul</a>(<a class=\"id\" href=\"#buf\">buf</a>, <a class=\"id\" href=\"#NULL\">NULL</a>, 0);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* get the slot number from the message */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pmp\">pmp</a> = (<a class=\"id\" href=\"#state\">state</a> &amp; <a class=\"id\" href=\"#EM_MSG_LED_PMP_SLOT\">EM_MSG_LED_PMP_SLOT</a>) >> 8;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#pmp\">pmp</a> &lt; <a class=\"id\" href=\"#EM_MAX_SLOTS\">EM_MAX_SLOTS</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#emp\">emp</a> = &amp;<a class=\"id\" href=\"#pp\">pp</a>-><a class=\"id\" href=\"#em_priv\">em_priv</a>[<a class=\"id\" href=\"#pmp\">pmp</a>];", 
"<span class=\"ts\"/>else", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* mask off the activity bits if we are in sw_activity</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * mode, user should turn off sw_activity before setting</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * activity led through em_message</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#emp\">emp</a>-><a class=\"id\" href=\"#blink_policy\">blink_policy</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#state\">state</a> &= ~<a class=\"id\" href=\"#EM_MSG_LED_VALUE_ACTIVITY\">EM_MSG_LED_VALUE_ACTIVITY</a>;", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ahci_transmit_led_message\">ahci_transmit_led_message</a>(<a class=\"id\" href=\"#ap\">ap</a>, <a class=\"id\" href=\"#state\">state</a>, <a class=\"id\" href=\"#size\">size</a>);", 
"}", 
"", 
"static <a class=\"id\" href=\"#ssize_t\">ssize_t</a> <a class=\"id\" href=\"#ahci_activity_store\">ahci_activity_store</a>(struct <a class=\"id\" href=\"#ata_device\">ata_device</a> *<a class=\"id\" href=\"#dev\">dev</a>, enum <a class=\"id\" href=\"#sw_activity\">sw_activity</a> <a class=\"id\" href=\"#val\">val</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ata_link\">ata_link</a> *<a class=\"id\" href=\"#link\">link</a> = <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#link\">link</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ata_port\">ata_port</a> *<a class=\"id\" href=\"#ap\">ap</a> = <a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#ap\">ap</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_port_priv\">ahci_port_priv</a> *<a class=\"id\" href=\"#pp\">pp</a> = <a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_em_priv\">ahci_em_priv</a> *<a class=\"id\" href=\"#emp\">emp</a> = &amp;<a class=\"id\" href=\"#pp\">pp</a>-><a class=\"id\" href=\"#em_priv\">em_priv</a>[<a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#pmp\">pmp</a>];", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#port_led_state\">port_led_state</a> = <a class=\"id\" href=\"#emp\">emp</a>-><a class=\"id\" href=\"#led_state\">led_state</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* save the desired Activity LED behavior */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#val\">val</a> == <a class=\"id\" href=\"#OFF\">OFF</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* clear LFLAG */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#flags\">flags</a> &= ~(<a class=\"id\" href=\"#ATA_LFLAG_SW_ACTIVITY\">ATA_LFLAG_SW_ACTIVITY</a>);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* set the LED to OFF */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#port_led_state\">port_led_state</a> &= <a class=\"id\" href=\"#EM_MSG_LED_VALUE_OFF\">EM_MSG_LED_VALUE_OFF</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#port_led_state\">port_led_state</a> |= (<a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#port_no\">port_no</a> | (<a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#pmp\">pmp</a> << 8));", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ahci_transmit_led_message\">ahci_transmit_led_message</a>(<a class=\"id\" href=\"#ap\">ap</a>, <a class=\"id\" href=\"#port_led_state\">port_led_state</a>, 4);", 
"<span class=\"ts\"/>} else {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#flags\">flags</a> |= <a class=\"id\" href=\"#ATA_LFLAG_SW_ACTIVITY\">ATA_LFLAG_SW_ACTIVITY</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#val\">val</a> == <a class=\"id\" href=\"#BLINK_OFF\">BLINK_OFF</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* set LED to ON for idle */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#port_led_state\">port_led_state</a> &= <a class=\"id\" href=\"#EM_MSG_LED_VALUE_OFF\">EM_MSG_LED_VALUE_OFF</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#port_led_state\">port_led_state</a> |= (<a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#port_no\">port_no</a> | (<a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#pmp\">pmp</a> << 8));", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#port_led_state\">port_led_state</a> |= <a class=\"id\" href=\"#EM_MSG_LED_VALUE_ON\">EM_MSG_LED_VALUE_ON</a>; <span class=\"comment\">/* check this */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ahci_transmit_led_message\">ahci_transmit_led_message</a>(<a class=\"id\" href=\"#ap\">ap</a>, <a class=\"id\" href=\"#port_led_state\">port_led_state</a>, 4);", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#emp\">emp</a>-><a class=\"id\" href=\"#blink_policy\">blink_policy</a> = <a class=\"id\" href=\"#val\">val</a>;", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"static <a class=\"id\" href=\"#ssize_t\">ssize_t</a> <a class=\"id\" href=\"#ahci_activity_show\">ahci_activity_show</a>(struct <a class=\"id\" href=\"#ata_device\">ata_device</a> *<a class=\"id\" href=\"#dev\">dev</a>, char *<a class=\"id\" href=\"#buf\">buf</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ata_link\">ata_link</a> *<a class=\"id\" href=\"#link\">link</a> = <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#link\">link</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ata_port\">ata_port</a> *<a class=\"id\" href=\"#ap\">ap</a> = <a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#ap\">ap</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_port_priv\">ahci_port_priv</a> *<a class=\"id\" href=\"#pp\">pp</a> = <a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_em_priv\">ahci_em_priv</a> *<a class=\"id\" href=\"#emp\">emp</a> = &amp;<a class=\"id\" href=\"#pp\">pp</a>-><a class=\"id\" href=\"#em_priv\">em_priv</a>[<a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#pmp\">pmp</a>];", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* display the saved value of activity behavior for this</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * disk.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#sprintf\">sprintf</a>(<a class=\"id\" href=\"#buf\">buf</a>, \"%d\\n\", <a class=\"id\" href=\"#emp\">emp</a>-><a class=\"id\" href=\"#blink_policy\">blink_policy</a>);", 
"}", 
"", 
"static void <a class=\"id\" href=\"#ahci_port_init\">ahci_port_init</a>(struct <a class=\"id\" href=\"#device\">device</a> *<a class=\"id\" href=\"#dev\">dev</a>, struct <a class=\"id\" href=\"#ata_port\">ata_port</a> *<a class=\"id\" href=\"#ap\">ap</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>   int <a class=\"id\" href=\"#port_no\">port_no</a>, void <a class=\"id\" href=\"#__iomem\">__iomem</a> *<a class=\"id\" href=\"#mmio\">mmio</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>   void <a class=\"id\" href=\"#__iomem\">__iomem</a> *<a class=\"id\" href=\"#port_mmio\">port_mmio</a>)", 
"{", 
"<span class=\"ts\"/>const char *<a class=\"id\" href=\"#emsg\">emsg</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#rc\">rc</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#tmp\">tmp</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* make sure port is not active */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rc\">rc</a> = <a class=\"id\" href=\"#ahci_deinit_port\">ahci_deinit_port</a>(<a class=\"id\" href=\"#ap\">ap</a>, &amp;<a class=\"id\" href=\"#emsg\">emsg</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#rc\">rc</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#dev_warn\">dev_warn</a>(<a class=\"id\" href=\"#dev\">dev</a>, \"%s (%d)\\n\", <a class=\"id\" href=\"#emsg\">emsg</a>, <a class=\"id\" href=\"#rc\">rc</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* clear SError */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tmp\">tmp</a> = <a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_SCR_ERR\">PORT_SCR_ERR</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#VPRINTK\">VPRINTK</a>(\"PORT_SCR_ERR 0x%x\\n\", <a class=\"id\" href=\"#tmp\">tmp</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#tmp\">tmp</a>, <a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_SCR_ERR\">PORT_SCR_ERR</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* clear port IRQ */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tmp\">tmp</a> = <a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_IRQ_STAT\">PORT_IRQ_STAT</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#VPRINTK\">VPRINTK</a>(\"PORT_IRQ_STAT 0x%x\\n\", <a class=\"id\" href=\"#tmp\">tmp</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#tmp\">tmp</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#tmp\">tmp</a>, <a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_IRQ_STAT\">PORT_IRQ_STAT</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(1 << <a class=\"id\" href=\"#port_no\">port_no</a>, <a class=\"id\" href=\"#mmio\">mmio</a> + <a class=\"id\" href=\"#HOST_IRQ_STAT\">HOST_IRQ_STAT</a>);", 
"}", 
"", 
"void <a class=\"id\" href=\"#ahci_init_controller\">ahci_init_controller</a>(struct <a class=\"id\" href=\"#ata_host\">ata_host</a> *<a class=\"id\" href=\"#host\">host</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_host_priv\">ahci_host_priv</a> *<a class=\"id\" href=\"#hpriv\">hpriv</a> = <a class=\"id\" href=\"#host\">host</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"<span class=\"ts\"/>void <a class=\"id\" href=\"#__iomem\">__iomem</a> *<a class=\"id\" href=\"#mmio\">mmio</a> = <a class=\"id\" href=\"#hpriv\">hpriv</a>-><a class=\"id\" href=\"#mmio\">mmio</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#i\">i</a>;", 
"<span class=\"ts\"/>void <a class=\"id\" href=\"#__iomem\">__iomem</a> *<a class=\"id\" href=\"#port_mmio\">port_mmio</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#tmp\">tmp</a>;", 
"", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = 0; <a class=\"id\" href=\"#i\">i</a> &lt; <a class=\"id\" href=\"#host\">host</a>-><a class=\"id\" href=\"#n_ports\">n_ports</a>; <a class=\"id\" href=\"#i\">i</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#ata_port\">ata_port</a> *<a class=\"id\" href=\"#ap\">ap</a> = <a class=\"id\" href=\"#host\">host</a>-><a class=\"id\" href=\"#ports\">ports</a>[<a class=\"id\" href=\"#i\">i</a>];", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#port_mmio\">port_mmio</a> = <a class=\"id\" href=\"#ahci_port_base\">ahci_port_base</a>(<a class=\"id\" href=\"#ap\">ap</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#ata_port_is_dummy\">ata_port_is_dummy</a>(<a class=\"id\" href=\"#ap\">ap</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ahci_port_init\">ahci_port_init</a>(<a class=\"id\" href=\"#host\">host</a>-><a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#ap\">ap</a>, <a class=\"id\" href=\"#i\">i</a>, <a class=\"id\" href=\"#mmio\">mmio</a>, <a class=\"id\" href=\"#port_mmio\">port_mmio</a>);", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tmp\">tmp</a> = <a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#mmio\">mmio</a> + <a class=\"id\" href=\"#HOST_CTL\">HOST_CTL</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#VPRINTK\">VPRINTK</a>(\"HOST_CTL 0x%x\\n\", <a class=\"id\" href=\"#tmp\">tmp</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#tmp\">tmp</a> | <a class=\"id\" href=\"#HOST_IRQ_EN\">HOST_IRQ_EN</a>, <a class=\"id\" href=\"#mmio\">mmio</a> + <a class=\"id\" href=\"#HOST_CTL\">HOST_CTL</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tmp\">tmp</a> = <a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#mmio\">mmio</a> + <a class=\"id\" href=\"#HOST_CTL\">HOST_CTL</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#VPRINTK\">VPRINTK</a>(\"HOST_CTL 0x%x\\n\", <a class=\"id\" href=\"#tmp\">tmp</a>);", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#ahci_init_controller\">ahci_init_controller</a>);", 
"", 
"static void <a class=\"id\" href=\"#ahci_dev_config\">ahci_dev_config</a>(struct <a class=\"id\" href=\"#ata_device\">ata_device</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_host_priv\">ahci_host_priv</a> *<a class=\"id\" href=\"#hpriv\">hpriv</a> = <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#host\">host</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#hpriv\">hpriv</a>-><a class=\"id\" href=\"#flags\">flags</a> &amp; <a class=\"id\" href=\"#AHCI_HFLAG_SECT255\">AHCI_HFLAG_SECT255</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#max_sectors\">max_sectors</a> = 255;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ata_dev_printk\">ata_dev_printk</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#KERN_INFO\">KERN_INFO</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       \"SB600 AHCI: limiting to 255 sectors per cmd\\n\");", 
"<span class=\"ts\"/>}", 
"}", 
"", 
"static unsigned int <a class=\"id\" href=\"#ahci_dev_classify\">ahci_dev_classify</a>(struct <a class=\"id\" href=\"#ata_port\">ata_port</a> *<a class=\"id\" href=\"#ap\">ap</a>)", 
"{", 
"<span class=\"ts\"/>void <a class=\"id\" href=\"#__iomem\">__iomem</a> *<a class=\"id\" href=\"#port_mmio\">port_mmio</a> = <a class=\"id\" href=\"#ahci_port_base\">ahci_port_base</a>(<a class=\"id\" href=\"#ap\">ap</a>);", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ata_taskfile\">ata_taskfile</a> <a class=\"id\" href=\"#tf\">tf</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#tmp\">tmp</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tmp\">tmp</a> = <a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_SIG\">PORT_SIG</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tf\">tf</a>.<a class=\"id\" href=\"#lbah\">lbah</a><span class=\"ts\"/><span class=\"ts\"/>= (<a class=\"id\" href=\"#tmp\">tmp</a> >> 24)<span class=\"ts\"/>&amp; 0xff;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tf\">tf</a>.<a class=\"id\" href=\"#lbam\">lbam</a><span class=\"ts\"/><span class=\"ts\"/>= (<a class=\"id\" href=\"#tmp\">tmp</a> >> 16)<span class=\"ts\"/>&amp; 0xff;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tf\">tf</a>.<a class=\"id\" href=\"#lbal\">lbal</a><span class=\"ts\"/><span class=\"ts\"/>= (<a class=\"id\" href=\"#tmp\">tmp</a> >> 8)<span class=\"ts\"/>&amp; 0xff;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tf\">tf</a>.<a class=\"id\" href=\"#nsect\">nsect</a><span class=\"ts\"/>= (<a class=\"id\" href=\"#tmp\">tmp</a>)<span class=\"ts\"/><span class=\"ts\"/>&amp; 0xff;", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ata_dev_classify\">ata_dev_classify</a>(&amp;<a class=\"id\" href=\"#tf\">tf</a>);", 
"}", 
"", 
"static void <a class=\"id\" href=\"#ahci_fill_cmd_slot\">ahci_fill_cmd_slot</a>(struct <a class=\"id\" href=\"#ahci_port_priv\">ahci_port_priv</a> *<a class=\"id\" href=\"#pp\">pp</a>, unsigned int <a class=\"id\" href=\"#tag\">tag</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       <a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#opts\">opts</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dma_addr_t\">dma_addr_t</a> <a class=\"id\" href=\"#cmd_tbl_dma\">cmd_tbl_dma</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#cmd_tbl_dma\">cmd_tbl_dma</a> = <a class=\"id\" href=\"#pp\">pp</a>-><a class=\"id\" href=\"#cmd_tbl_dma\">cmd_tbl_dma</a> + <a class=\"id\" href=\"#tag\">tag</a> * <a class=\"id\" href=\"#AHCI_CMD_TBL_SZ\">AHCI_CMD_TBL_SZ</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pp\">pp</a>-><a class=\"id\" href=\"#cmd_slot\">cmd_slot</a>[<a class=\"id\" href=\"#tag\">tag</a>].<a class=\"id\" href=\"#opts\">opts</a> = <a class=\"id\" href=\"#cpu_to_le32\">cpu_to_le32</a>(<a class=\"id\" href=\"#opts\">opts</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pp\">pp</a>-><a class=\"id\" href=\"#cmd_slot\">cmd_slot</a>[<a class=\"id\" href=\"#tag\">tag</a>].<a class=\"id\" href=\"#status\">status</a> = 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pp\">pp</a>-><a class=\"id\" href=\"#cmd_slot\">cmd_slot</a>[<a class=\"id\" href=\"#tag\">tag</a>].<a class=\"id\" href=\"#tbl_addr\">tbl_addr</a> = <a class=\"id\" href=\"#cpu_to_le32\">cpu_to_le32</a>(<a class=\"id\" href=\"#cmd_tbl_dma\">cmd_tbl_dma</a> &amp; 0xffffffff);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pp\">pp</a>-><a class=\"id\" href=\"#cmd_slot\">cmd_slot</a>[<a class=\"id\" href=\"#tag\">tag</a>].<a class=\"id\" href=\"#tbl_addr_hi\">tbl_addr_hi</a> = <a class=\"id\" href=\"#cpu_to_le32\">cpu_to_le32</a>((<a class=\"id\" href=\"#cmd_tbl_dma\">cmd_tbl_dma</a> >> 16) >> 16);", 
"}", 
"", 
"int <a class=\"id\" href=\"#ahci_kick_engine\">ahci_kick_engine</a>(struct <a class=\"id\" href=\"#ata_port\">ata_port</a> *<a class=\"id\" href=\"#ap\">ap</a>)", 
"{", 
"<span class=\"ts\"/>void <a class=\"id\" href=\"#__iomem\">__iomem</a> *<a class=\"id\" href=\"#port_mmio\">port_mmio</a> = <a class=\"id\" href=\"#ahci_port_base\">ahci_port_base</a>(<a class=\"id\" href=\"#ap\">ap</a>);", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_host_priv\">ahci_host_priv</a> *<a class=\"id\" href=\"#hpriv\">hpriv</a> = <a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#host\">host</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u8\">u8</a> <a class=\"id\" href=\"#status\">status</a> = <a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_TFDATA\">PORT_TFDATA</a>) &amp; 0xFF;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#tmp\">tmp</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#busy\">busy</a>, <a class=\"id\" href=\"#rc\">rc</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* stop engine */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rc\">rc</a> = <a class=\"id\" href=\"#ahci_stop_engine\">ahci_stop_engine</a>(<a class=\"id\" href=\"#ap\">ap</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#rc\">rc</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out_restart\">out_restart</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* need to do CLO?</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * always do CLO if PMP is attached (AHCI-1.3 9.2)</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#busy\">busy</a> = <a class=\"id\" href=\"#status\">status</a> &amp; (<a class=\"id\" href=\"#ATA_BUSY\">ATA_BUSY</a> | <a class=\"id\" href=\"#ATA_DRQ\">ATA_DRQ</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#busy\">busy</a> && !<a class=\"id\" href=\"#sata_pmp_attached\">sata_pmp_attached</a>(<a class=\"id\" href=\"#ap\">ap</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rc\">rc</a> = 0;", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out_restart\">out_restart</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>if (!(<a class=\"id\" href=\"#hpriv\">hpriv</a>-><a class=\"id\" href=\"#cap\">cap</a> &amp; <a class=\"id\" href=\"#HOST_CAP_CLO\">HOST_CAP_CLO</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rc\">rc</a> = -<a class=\"id\" href=\"#EOPNOTSUPP\">EOPNOTSUPP</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out_restart\">out_restart</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* perform CLO */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tmp\">tmp</a> = <a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_CMD\">PORT_CMD</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tmp\">tmp</a> |= <a class=\"id\" href=\"#PORT_CMD_CLO\">PORT_CMD_CLO</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#tmp\">tmp</a>, <a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_CMD\">PORT_CMD</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rc\">rc</a> = 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tmp\">tmp</a> = <a class=\"id\" href=\"#ata_wait_register\">ata_wait_register</a>(<a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_CMD\">PORT_CMD</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#PORT_CMD_CLO\">PORT_CMD_CLO</a>, <a class=\"id\" href=\"#PORT_CMD_CLO\">PORT_CMD_CLO</a>, 1, 500);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#tmp\">tmp</a> &amp; <a class=\"id\" href=\"#PORT_CMD_CLO\">PORT_CMD_CLO</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rc\">rc</a> = -<a class=\"id\" href=\"#EIO\">EIO</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* restart engine */</span>", 
" <a class=\"id\" href=\"#out_restart\">out_restart</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ahci_start_engine\">ahci_start_engine</a>(<a class=\"id\" href=\"#ap\">ap</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#rc\">rc</a>;", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#ahci_kick_engine\">ahci_kick_engine</a>);", 
"", 
"static int <a class=\"id\" href=\"#ahci_exec_polled_cmd\">ahci_exec_polled_cmd</a>(struct <a class=\"id\" href=\"#ata_port\">ata_port</a> *<a class=\"id\" href=\"#ap\">ap</a>, int <a class=\"id\" href=\"#pmp\">pmp</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#ata_taskfile\">ata_taskfile</a> *<a class=\"id\" href=\"#tf\">tf</a>, int <a class=\"id\" href=\"#is_cmd\">is_cmd</a>, <a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#flags\">flags</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#timeout_msec\">timeout_msec</a>)", 
"{", 
"<span class=\"ts\"/>const <a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#cmd_fis_len\">cmd_fis_len</a> = 5; <span class=\"comment\">/* five dwords */</span>", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_port_priv\">ahci_port_priv</a> *<a class=\"id\" href=\"#pp\">pp</a> = <a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"<span class=\"ts\"/>void <a class=\"id\" href=\"#__iomem\">__iomem</a> *<a class=\"id\" href=\"#port_mmio\">port_mmio</a> = <a class=\"id\" href=\"#ahci_port_base\">ahci_port_base</a>(<a class=\"id\" href=\"#ap\">ap</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u8\">u8</a> *<a class=\"id\" href=\"#fis\">fis</a> = <a class=\"id\" href=\"#pp\">pp</a>-><a class=\"id\" href=\"#cmd_tbl\">cmd_tbl</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#tmp\">tmp</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* prep the command */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ata_tf_to_fis\">ata_tf_to_fis</a>(<a class=\"id\" href=\"#tf\">tf</a>, <a class=\"id\" href=\"#pmp\">pmp</a>, <a class=\"id\" href=\"#is_cmd\">is_cmd</a>, <a class=\"id\" href=\"#fis\">fis</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ahci_fill_cmd_slot\">ahci_fill_cmd_slot</a>(<a class=\"id\" href=\"#pp\">pp</a>, 0, <a class=\"id\" href=\"#cmd_fis_len\">cmd_fis_len</a> | <a class=\"id\" href=\"#flags\">flags</a> | (<a class=\"id\" href=\"#pmp\">pmp</a> << 12));", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* issue &amp; wait */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(1, <a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_CMD_ISSUE\">PORT_CMD_ISSUE</a>);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#timeout_msec\">timeout_msec</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tmp\">tmp</a> = <a class=\"id\" href=\"#ata_wait_register\">ata_wait_register</a>(<a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_CMD_ISSUE\">PORT_CMD_ISSUE</a>, 0x1, 0x1,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>1, <a class=\"id\" href=\"#timeout_msec\">timeout_msec</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#tmp\">tmp</a> &amp; 0x1) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ahci_kick_engine\">ahci_kick_engine</a>(<a class=\"id\" href=\"#ap\">ap</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EBUSY\">EBUSY</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>} else", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_CMD_ISSUE\">PORT_CMD_ISSUE</a>);<span class=\"ts\"/><span class=\"comment\">/* flush */</span>", 
"", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"int <a class=\"id\" href=\"#ahci_do_softreset\">ahci_do_softreset</a>(struct <a class=\"id\" href=\"#ata_link\">ata_link</a> *<a class=\"id\" href=\"#link\">link</a>, unsigned int *<a class=\"id\" href=\"#class\">class</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/>      int <a class=\"id\" href=\"#pmp\">pmp</a>, unsigned long <a class=\"id\" href=\"#deadline\">deadline</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/>      int (*<a class=\"id\" href=\"#check_ready\">check_ready</a>)(struct <a class=\"id\" href=\"#ata_link\">ata_link</a> *<a class=\"id\" href=\"#link\">link</a>))", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ata_port\">ata_port</a> *<a class=\"id\" href=\"#ap\">ap</a> = <a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#ap\">ap</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_host_priv\">ahci_host_priv</a> *<a class=\"id\" href=\"#hpriv\">hpriv</a> = <a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#host\">host</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"<span class=\"ts\"/>const char *<a class=\"id\" href=\"#reason\">reason</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#now\">now</a>, <a class=\"id\" href=\"#msecs\">msecs</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ata_taskfile\">ata_taskfile</a> <a class=\"id\" href=\"#tf\">tf</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#rc\">rc</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#DPRINTK\">DPRINTK</a>(\"ENTER\\n\");", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* prepare for SRST (AHCI-1.1 10.4.1) */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rc\">rc</a> = <a class=\"id\" href=\"#ahci_kick_engine\">ahci_kick_engine</a>(<a class=\"id\" href=\"#ap\">ap</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#rc\">rc</a> && <a class=\"id\" href=\"#rc\">rc</a> != -<a class=\"id\" href=\"#EOPNOTSUPP\">EOPNOTSUPP</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ata_link_printk\">ata_link_printk</a>(<a class=\"id\" href=\"#link\">link</a>, <a class=\"id\" href=\"#KERN_WARNING\">KERN_WARNING</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>\"failed to reset engine (errno=%d)\\n\", <a class=\"id\" href=\"#rc\">rc</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ata_tf_init\">ata_tf_init</a>(<a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#device\">device</a>, &amp;<a class=\"id\" href=\"#tf\">tf</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* issue the first D2H Register FIS */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#msecs\">msecs</a> = 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#now\">now</a> = <a class=\"id\" href=\"#jiffies\">jiffies</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#time_after\">time_after</a>(<a class=\"id\" href=\"#deadline\">deadline</a>, <a class=\"id\" href=\"#now\">now</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msecs\">msecs</a> = <a class=\"id\" href=\"#jiffies_to_msecs\">jiffies_to_msecs</a>(<a class=\"id\" href=\"#deadline\">deadline</a> - <a class=\"id\" href=\"#now\">now</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tf\">tf</a>.<a class=\"id\" href=\"#ctl\">ctl</a> |= <a class=\"id\" href=\"#ATA_SRST\">ATA_SRST</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#ahci_exec_polled_cmd\">ahci_exec_polled_cmd</a>(<a class=\"id\" href=\"#ap\">ap</a>, <a class=\"id\" href=\"#pmp\">pmp</a>, &amp;<a class=\"id\" href=\"#tf\">tf</a>, 0,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> <a class=\"id\" href=\"#AHCI_CMD_RESET\">AHCI_CMD_RESET</a> | <a class=\"id\" href=\"#AHCI_CMD_CLR_BUSY\">AHCI_CMD_CLR_BUSY</a>, <a class=\"id\" href=\"#msecs\">msecs</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rc\">rc</a> = -<a class=\"id\" href=\"#EIO\">EIO</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#reason\">reason</a> = \"1st FIS failed\";", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#fail\">fail</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* spec says at least 5us, but be generous and sleep for 1ms */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#msleep\">msleep</a>(1);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* issue the second D2H Register FIS */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tf\">tf</a>.<a class=\"id\" href=\"#ctl\">ctl</a> &= ~<a class=\"id\" href=\"#ATA_SRST\">ATA_SRST</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ahci_exec_polled_cmd\">ahci_exec_polled_cmd</a>(<a class=\"id\" href=\"#ap\">ap</a>, <a class=\"id\" href=\"#pmp\">pmp</a>, &amp;<a class=\"id\" href=\"#tf\">tf</a>, 0, 0, 0);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* wait for link to become ready */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rc\">rc</a> = <a class=\"id\" href=\"#ata_wait_after_reset\">ata_wait_after_reset</a>(<a class=\"id\" href=\"#link\">link</a>, <a class=\"id\" href=\"#deadline\">deadline</a>, <a class=\"id\" href=\"#check_ready\">check_ready</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#rc\">rc</a> == -<a class=\"id\" href=\"#EBUSY\">EBUSY</a> && <a class=\"id\" href=\"#hpriv\">hpriv</a>-><a class=\"id\" href=\"#flags\">flags</a> &amp; <a class=\"id\" href=\"#AHCI_HFLAG_SRST_TOUT_IS_OFFLINE\">AHCI_HFLAG_SRST_TOUT_IS_OFFLINE</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * Workaround for cases where link online status can't</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * be trusted.  Treat device readiness timeout as link</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * offline.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ata_link_printk\">ata_link_printk</a>(<a class=\"id\" href=\"#link\">link</a>, <a class=\"id\" href=\"#KERN_INFO\">KERN_INFO</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>\"device not ready, treating as offline\\n\");", 
"<span class=\"ts\"/><span class=\"ts\"/>*<a class=\"id\" href=\"#class\">class</a> = <a class=\"id\" href=\"#ATA_DEV_NONE\">ATA_DEV_NONE</a>;", 
"<span class=\"ts\"/>} else if (<a class=\"id\" href=\"#rc\">rc</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* link occupied, -ENODEV too is an error */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#reason\">reason</a> = \"device not ready\";", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#fail\">fail</a>;", 
"<span class=\"ts\"/>} else", 
"<span class=\"ts\"/><span class=\"ts\"/>*<a class=\"id\" href=\"#class\">class</a> = <a class=\"id\" href=\"#ahci_dev_classify\">ahci_dev_classify</a>(<a class=\"id\" href=\"#ap\">ap</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#DPRINTK\">DPRINTK</a>(\"EXIT, class=%u\\n\", *<a class=\"id\" href=\"#class\">class</a>);", 
"<span class=\"ts\"/>return 0;", 
"", 
" <a class=\"id\" href=\"#fail\">fail</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ata_link_printk\">ata_link_printk</a>(<a class=\"id\" href=\"#link\">link</a>, <a class=\"id\" href=\"#KERN_ERR\">KERN_ERR</a>, \"softreset failed (%s)\\n\", <a class=\"id\" href=\"#reason\">reason</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#rc\">rc</a>;", 
"}", 
"", 
"int <a class=\"id\" href=\"#ahci_check_ready\">ahci_check_ready</a>(struct <a class=\"id\" href=\"#ata_link\">ata_link</a> *<a class=\"id\" href=\"#link\">link</a>)", 
"{", 
"<span class=\"ts\"/>void <a class=\"id\" href=\"#__iomem\">__iomem</a> *<a class=\"id\" href=\"#port_mmio\">port_mmio</a> = <a class=\"id\" href=\"#ahci_port_base\">ahci_port_base</a>(<a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#ap\">ap</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u8\">u8</a> <a class=\"id\" href=\"#status\">status</a> = <a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_TFDATA\">PORT_TFDATA</a>) &amp; 0xFF;", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ata_check_ready\">ata_check_ready</a>(<a class=\"id\" href=\"#status\">status</a>);", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#ahci_check_ready\">ahci_check_ready</a>);", 
"", 
"static int <a class=\"id\" href=\"#ahci_softreset\">ahci_softreset</a>(struct <a class=\"id\" href=\"#ata_link\">ata_link</a> *<a class=\"id\" href=\"#link\">link</a>, unsigned int *<a class=\"id\" href=\"#class\">class</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>  unsigned long <a class=\"id\" href=\"#deadline\">deadline</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#pmp\">pmp</a> = <a class=\"id\" href=\"#sata_srst_pmp\">sata_srst_pmp</a>(<a class=\"id\" href=\"#link\">link</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#DPRINTK\">DPRINTK</a>(\"ENTER\\n\");", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ahci_do_softreset\">ahci_do_softreset</a>(<a class=\"id\" href=\"#link\">link</a>, <a class=\"id\" href=\"#class\">class</a>, <a class=\"id\" href=\"#pmp\">pmp</a>, <a class=\"id\" href=\"#deadline\">deadline</a>, <a class=\"id\" href=\"#ahci_check_ready\">ahci_check_ready</a>);", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#ahci_do_softreset\">ahci_do_softreset</a>);", 
"", 
"static int <a class=\"id\" href=\"#ahci_hardreset\">ahci_hardreset</a>(struct <a class=\"id\" href=\"#ata_link\">ata_link</a> *<a class=\"id\" href=\"#link\">link</a>, unsigned int *<a class=\"id\" href=\"#class\">class</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>  unsigned long <a class=\"id\" href=\"#deadline\">deadline</a>)", 
"{", 
"<span class=\"ts\"/>const unsigned long *<a class=\"id\" href=\"#timing\">timing</a> = <a class=\"id\" href=\"#sata_ehc_deb_timing\">sata_ehc_deb_timing</a>(&amp;<a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#eh_context\">eh_context</a>);", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ata_port\">ata_port</a> *<a class=\"id\" href=\"#ap\">ap</a> = <a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#ap\">ap</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_port_priv\">ahci_port_priv</a> *<a class=\"id\" href=\"#pp\">pp</a> = <a class=\"id\" href=\"#ap\">ap</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u8\">u8</a> *<a class=\"id\" href=\"#d2h_fis\">d2h_fis</a> = <a class=\"id\" href=\"#pp\">pp</a>-><a class=\"id\" href=\"#rx_fis\">rx_fis</a> + <a class=\"id\" href=\"#RX_FIS_D2H_REG\">RX_FIS_D2H_REG</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ata_taskfile\">ata_taskfile</a> <a class=\"id\" href=\"#tf\">tf</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bool\">bool</a> <a class=\"id\" href=\"#online\">online</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#rc\">rc</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#DPRINTK\">DPRINTK</a>(\"ENTER\\n\");", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ahci_stop_engine\">ahci_stop_engine</a>(<a class=\"id\" href=\"#ap\">ap</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* clear D2H reception area to properly wait for D2H FIS */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ata_tf_init\">ata_tf_init</a>(<a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#device\">device</a>, &amp;<a class=\"id\" href=\"#tf\">tf</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tf\">tf</a>.<a class=\"id\" href=\"#command\">command</a> = 0x80;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ata_tf_to_fis\">ata_tf_to_fis</a>(&amp;<a class=\"id\" href=\"#tf\">tf</a>, 0, 0, <a class=\"id\" href=\"#d2h_fis\">d2h_fis</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rc\">rc</a> = <a class=\"id\" href=\"#sata_link_hardreset\">sata_link_hardreset</a>(<a class=\"id\" href=\"#link\">link</a>, <a class=\"id\" href=\"#timing\">timing</a>, <a class=\"id\" href=\"#deadline\">deadline</a>, &amp;<a class=\"id\" href=\"#online\">online</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> <a class=\"id\" href=\"#ahci_check_ready\">ahci_check_ready</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ahci_start_engine\">ahci_start_engine</a>(<a class=\"id\" href=\"#ap\">ap</a>);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#online\">online</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>*<a class=\"id\" href=\"#class\">class</a> = <a class=\"id\" href=\"#ahci_dev_classify\">ahci_dev_classify</a>(<a class=\"id\" href=\"#ap\">ap</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#DPRINTK\">DPRINTK</a>(\"EXIT, rc=%d, class=%u\\n\", <a class=\"id\" href=\"#rc\">rc</a>, *<a class=\"id\" href=\"#class\">class</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#rc\">rc</a>;", 
"}", 
"", 
"static void <a class=\"id\" href=\"#ahci_postreset\">ahci_postreset</a>(struct <a class=\"id\" href=\"#ata_link\">ata_link</a> *<a class=\"id\" href=\"#link\">link</a>, unsigned int *<a class=\"id\" href=\"#class\">class</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ata_port\">ata_port</a> *<a class=\"id\" href=\"#ap\">ap</a> = <a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#ap\">ap</a>;", 
"<span class=\"ts\"/>void <a class=\"id\" href=\"#__iomem\">__iomem</a> *<a class=\"id\" href=\"#port_mmio\">port_mmio</a> = <a class=\"id\" href=\"#ahci_port_base\">ahci_port_base</a>(<a class=\"id\" href=\"#ap\">ap</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#new_tmp\">new_tmp</a>, <a class=\"id\" href=\"#tmp\">tmp</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ata_std_postreset\">ata_std_postreset</a>(<a class=\"id\" href=\"#link\">link</a>, <a class=\"id\" href=\"#class\">class</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Make sure port's ATAPI bit is set appropriately */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#new_tmp\">new_tmp</a> = <a class=\"id\" href=\"#tmp\">tmp</a> = <a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_CMD\">PORT_CMD</a>);", 
"<span class=\"ts\"/>if (*<a class=\"id\" href=\"#class\">class</a> == <a class=\"id\" href=\"#ATA_DEV_ATAPI\">ATA_DEV_ATAPI</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#new_tmp\">new_tmp</a> |= <a class=\"id\" href=\"#PORT_CMD_ATAPI\">PORT_CMD_ATAPI</a>;", 
"<span class=\"ts\"/>else", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#new_tmp\">new_tmp</a> &= ~<a class=\"id\" href=\"#PORT_CMD_ATAPI\">PORT_CMD_ATAPI</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#new_tmp\">new_tmp</a> != <a class=\"id\" href=\"#tmp\">tmp</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#new_tmp\">new_tmp</a>, <a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_CMD\">PORT_CMD</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#port_mmio\">port_mmio</a> + <a class=\"id\" href=\"#PORT_CMD\">PORT_CMD</a>); <span class=\"comment\">/* flush */</span>", 
"<span class=\"ts\"/>}", 
"}", 
"", 
"static unsigned int <a class=\"id\" href=\"#ahci_fill_sg\">ahci_fill_sg</a>(struct <a class=\"id\" href=\"#ata_queued_cmd\">ata_queued_cmd</a> *<a class=\"id\" href=\"#qc\">qc</a>, void *<a class=\"id\" href=\"#cmd_tbl\">cmd_tbl</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#scatterlist\">scatterlist</a> *<a class=\"id\" href=\"#sg\">sg</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#ahci_sg\">ahci_sg</a> *<a class=\"id\" href=\"#ahci_sg\">ahci_sg</a> = <a class=\"id\" href=\"#cmd_tbl\">cmd_tbl</a> + <a class=\"id\" href=\"#AHCI_CMD_TBL_HDR_SZ\">AHCI_CMD_TBL_HDR_SZ</a>;", 
"<span class=\"ts\"/>unsigned int <a class=\"id\" href=\"#si\">si</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#VPRINTK\">VPRINTK</a>(\"ENTER\\n\");", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Next, the S/G list.</span>", 
];
xr_frag_insert('l/78/b9745d4aa0ab977ded383cd7759df7181366ab.xr', __xr_tmp);
