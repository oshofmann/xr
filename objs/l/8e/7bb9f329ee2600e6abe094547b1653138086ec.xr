var __xr_tmp = [
"<span class=\"comment\"> */</span>", 
"static <a class=\"id\" href=\"#bool\">bool</a> <a class=\"id\" href=\"#tomoyo_print_entry\">tomoyo_print_entry</a>(struct <a class=\"id\" href=\"#tomoyo_io_buffer\">tomoyo_io_buffer</a> *<a class=\"id\" href=\"#head\">head</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       struct <a class=\"id\" href=\"#tomoyo_acl_info\">tomoyo_acl_info</a> *<a class=\"id\" href=\"#acl\">acl</a>)", 
"{", 
"<span class=\"ts\"/>const <a class=\"id\" href=\"#u8\">u8</a> <a class=\"id\" href=\"#acl_type\">acl_type</a> = <a class=\"id\" href=\"#acl\">acl</a>-><a class=\"id\" href=\"#type\">type</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u8\">u8</a> <a class=\"id\" href=\"#bit\">bit</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#acl\">acl</a>-><a class=\"id\" href=\"#is_deleted\">is_deleted</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#true\">true</a>;", 
" <a class=\"id\" href=\"#next\">next</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bit\">bit</a> = <a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#bit\">bit</a>;", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#tomoyo_flush\">tomoyo_flush</a>(<a class=\"id\" href=\"#head\">head</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#false\">false</a>;", 
"<span class=\"ts\"/>else if (<a class=\"id\" href=\"#acl_type\">acl_type</a> == <a class=\"id\" href=\"#TOMOYO_TYPE_PATH_ACL\">TOMOYO_TYPE_PATH_ACL</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_path_acl\">tomoyo_path_acl</a> *<a class=\"id\" href=\"#ptr\">ptr</a> =", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#container_of\">container_of</a>(<a class=\"id\" href=\"#acl\">acl</a>, <a class=\"id\" href=\"#typeof\">typeof</a>(*<a class=\"id\" href=\"#ptr\">ptr</a>), <a class=\"id\" href=\"#head\">head</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>const <a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#perm\">perm</a> = <a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#perm\">perm</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>for ( ; <a class=\"id\" href=\"#bit\">bit</a> &lt; <a class=\"id\" href=\"#TOMOYO_MAX_PATH_OPERATION\">TOMOYO_MAX_PATH_OPERATION</a>; <a class=\"id\" href=\"#bit\">bit</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (!(<a class=\"id\" href=\"#perm\">perm</a> &amp; (1 << <a class=\"id\" href=\"#bit\">bit</a>)))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#print_execute_only\">print_execute_only</a> &&", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>    <a class=\"id\" href=\"#bit\">bit</a> != <a class=\"id\" href=\"#TOMOYO_TYPE_EXECUTE\">TOMOYO_TYPE_EXECUTE</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Print \"read/write\" instead of \"read\" and \"write\". */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if ((<a class=\"id\" href=\"#bit\">bit</a> == <a class=\"id\" href=\"#TOMOYO_TYPE_READ\">TOMOYO_TYPE_READ</a> ||", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>     <a class=\"id\" href=\"#bit\">bit</a> == <a class=\"id\" href=\"#TOMOYO_TYPE_WRITE\">TOMOYO_TYPE_WRITE</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>    && (<a class=\"id\" href=\"#perm\">perm</a> &amp; (1 << <a class=\"id\" href=\"#TOMOYO_TYPE_READ_WRITE\">TOMOYO_TYPE_READ_WRITE</a>)))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#bit\">bit</a> >= <a class=\"id\" href=\"#TOMOYO_MAX_PATH_OPERATION\">TOMOYO_MAX_PATH_OPERATION</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#done\">done</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_io_printf\">tomoyo_io_printf</a>(<a class=\"id\" href=\"#head\">head</a>, \"allow_%s\", <a class=\"id\" href=\"#tomoyo_path_keyword\">tomoyo_path_keyword</a>[<a class=\"id\" href=\"#bit\">bit</a>]);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_print_name_union\">tomoyo_print_name_union</a>(<a class=\"id\" href=\"#head\">head</a>, &amp;<a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#name\">name</a>);", 
"<span class=\"ts\"/>} else if (<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#print_execute_only\">print_execute_only</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#true\">true</a>;", 
"<span class=\"ts\"/>} else if (<a class=\"id\" href=\"#acl_type\">acl_type</a> == <a class=\"id\" href=\"#TOMOYO_TYPE_PATH2_ACL\">TOMOYO_TYPE_PATH2_ACL</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_path2_acl\">tomoyo_path2_acl</a> *<a class=\"id\" href=\"#ptr\">ptr</a> =", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#container_of\">container_of</a>(<a class=\"id\" href=\"#acl\">acl</a>, <a class=\"id\" href=\"#typeof\">typeof</a>(*<a class=\"id\" href=\"#ptr\">ptr</a>), <a class=\"id\" href=\"#head\">head</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bit\">bit</a> = <a class=\"id\" href=\"#tomoyo_fns\">tomoyo_fns</a>(<a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#perm\">perm</a>, <a class=\"id\" href=\"#bit\">bit</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#bit\">bit</a> >= <a class=\"id\" href=\"#TOMOYO_MAX_PATH2_OPERATION\">TOMOYO_MAX_PATH2_OPERATION</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#done\">done</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_io_printf\">tomoyo_io_printf</a>(<a class=\"id\" href=\"#head\">head</a>, \"allow_%s\", <a class=\"id\" href=\"#tomoyo_path2_keyword\">tomoyo_path2_keyword</a>[<a class=\"id\" href=\"#bit\">bit</a>]);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_print_name_union\">tomoyo_print_name_union</a>(<a class=\"id\" href=\"#head\">head</a>, &amp;<a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#name1\">name1</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_print_name_union\">tomoyo_print_name_union</a>(<a class=\"id\" href=\"#head\">head</a>, &amp;<a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#name2\">name2</a>);", 
"<span class=\"ts\"/>} else if (<a class=\"id\" href=\"#acl_type\">acl_type</a> == <a class=\"id\" href=\"#TOMOYO_TYPE_PATH_NUMBER_ACL\">TOMOYO_TYPE_PATH_NUMBER_ACL</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_path_number_acl\">tomoyo_path_number_acl</a> *<a class=\"id\" href=\"#ptr\">ptr</a> =", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#container_of\">container_of</a>(<a class=\"id\" href=\"#acl\">acl</a>, <a class=\"id\" href=\"#typeof\">typeof</a>(*<a class=\"id\" href=\"#ptr\">ptr</a>), <a class=\"id\" href=\"#head\">head</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bit\">bit</a> = <a class=\"id\" href=\"#tomoyo_fns\">tomoyo_fns</a>(<a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#perm\">perm</a>, <a class=\"id\" href=\"#bit\">bit</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#bit\">bit</a> >= <a class=\"id\" href=\"#TOMOYO_MAX_PATH_NUMBER_OPERATION\">TOMOYO_MAX_PATH_NUMBER_OPERATION</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#done\">done</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_io_printf\">tomoyo_io_printf</a>(<a class=\"id\" href=\"#head\">head</a>, \"allow_%s\",", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> <a class=\"id\" href=\"#tomoyo_path_number_keyword\">tomoyo_path_number_keyword</a>[<a class=\"id\" href=\"#bit\">bit</a>]);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_print_name_union\">tomoyo_print_name_union</a>(<a class=\"id\" href=\"#head\">head</a>, &amp;<a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#name\">name</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_print_number_union\">tomoyo_print_number_union</a>(<a class=\"id\" href=\"#head\">head</a>, &amp;<a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#number\">number</a>);", 
"<span class=\"ts\"/>} else if (<a class=\"id\" href=\"#acl_type\">acl_type</a> == <a class=\"id\" href=\"#TOMOYO_TYPE_MKDEV_ACL\">TOMOYO_TYPE_MKDEV_ACL</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_mkdev_acl\">tomoyo_mkdev_acl</a> *<a class=\"id\" href=\"#ptr\">ptr</a> =", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#container_of\">container_of</a>(<a class=\"id\" href=\"#acl\">acl</a>, <a class=\"id\" href=\"#typeof\">typeof</a>(*<a class=\"id\" href=\"#ptr\">ptr</a>), <a class=\"id\" href=\"#head\">head</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bit\">bit</a> = <a class=\"id\" href=\"#tomoyo_fns\">tomoyo_fns</a>(<a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#perm\">perm</a>, <a class=\"id\" href=\"#bit\">bit</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#bit\">bit</a> >= <a class=\"id\" href=\"#TOMOYO_MAX_MKDEV_OPERATION\">TOMOYO_MAX_MKDEV_OPERATION</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#done\">done</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_io_printf\">tomoyo_io_printf</a>(<a class=\"id\" href=\"#head\">head</a>, \"allow_%s\", <a class=\"id\" href=\"#tomoyo_mkdev_keyword\">tomoyo_mkdev_keyword</a>[<a class=\"id\" href=\"#bit\">bit</a>]);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_print_name_union\">tomoyo_print_name_union</a>(<a class=\"id\" href=\"#head\">head</a>, &amp;<a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#name\">name</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_print_number_union\">tomoyo_print_number_union</a>(<a class=\"id\" href=\"#head\">head</a>, &amp;<a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#mode\">mode</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_print_number_union\">tomoyo_print_number_union</a>(<a class=\"id\" href=\"#head\">head</a>, &amp;<a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#major\">major</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_print_number_union\">tomoyo_print_number_union</a>(<a class=\"id\" href=\"#head\">head</a>, &amp;<a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#minor\">minor</a>);", 
"<span class=\"ts\"/>} else if (<a class=\"id\" href=\"#acl_type\">acl_type</a> == <a class=\"id\" href=\"#TOMOYO_TYPE_MOUNT_ACL\">TOMOYO_TYPE_MOUNT_ACL</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_mount_acl\">tomoyo_mount_acl</a> *<a class=\"id\" href=\"#ptr\">ptr</a> =", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#container_of\">container_of</a>(<a class=\"id\" href=\"#acl\">acl</a>, <a class=\"id\" href=\"#typeof\">typeof</a>(*<a class=\"id\" href=\"#ptr\">ptr</a>), <a class=\"id\" href=\"#head\">head</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_io_printf\">tomoyo_io_printf</a>(<a class=\"id\" href=\"#head\">head</a>, \"allow_mount\");", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_print_name_union\">tomoyo_print_name_union</a>(<a class=\"id\" href=\"#head\">head</a>, &amp;<a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#dev_name\">dev_name</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_print_name_union\">tomoyo_print_name_union</a>(<a class=\"id\" href=\"#head\">head</a>, &amp;<a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#dir_name\">dir_name</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_print_name_union\">tomoyo_print_name_union</a>(<a class=\"id\" href=\"#head\">head</a>, &amp;<a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#fs_type\">fs_type</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_print_number_union\">tomoyo_print_number_union</a>(<a class=\"id\" href=\"#head\">head</a>, &amp;<a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#bit\">bit</a> = <a class=\"id\" href=\"#bit\">bit</a> + 1;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_io_printf\">tomoyo_io_printf</a>(<a class=\"id\" href=\"#head\">head</a>, \"\\n\");", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#acl_type\">acl_type</a> != <a class=\"id\" href=\"#TOMOYO_TYPE_MOUNT_ACL\">TOMOYO_TYPE_MOUNT_ACL</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#next\">next</a>;", 
" <a class=\"id\" href=\"#done\">done</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#bit\">bit</a> = 0;", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#true\">true</a>;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * tomoyo_read_domain2 - Read domain policy.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * @head:   Pointer to \"struct tomoyo_io_buffer\".</span>", 
"<span class=\"comment\"> * @domain: Pointer to \"struct tomoyo_domain_info\".</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Caller holds tomoyo_read_lock().</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Returns true on success, false otherwise.</span>", 
"<span class=\"comment\"> */</span>", 
"static <a class=\"id\" href=\"#bool\">bool</a> <a class=\"id\" href=\"#tomoyo_read_domain2\">tomoyo_read_domain2</a>(struct <a class=\"id\" href=\"#tomoyo_io_buffer\">tomoyo_io_buffer</a> *<a class=\"id\" href=\"#head\">head</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_domain_info\">tomoyo_domain_info</a> *<a class=\"id\" href=\"#domain\">domain</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_for_each_cookie\">list_for_each_cookie</a>(<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#acl\">acl</a>, &amp;<a class=\"id\" href=\"#domain\">domain</a>-><a class=\"id\" href=\"#acl_info_list\">acl_info_list</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_acl_info\">tomoyo_acl_info</a> *<a class=\"id\" href=\"#ptr\">ptr</a> =", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#list_entry\">list_entry</a>(<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#acl\">acl</a>, <a class=\"id\" href=\"#typeof\">typeof</a>(*<a class=\"id\" href=\"#ptr\">ptr</a>), <a class=\"id\" href=\"#list\">list</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#tomoyo_print_entry\">tomoyo_print_entry</a>(<a class=\"id\" href=\"#head\">head</a>, <a class=\"id\" href=\"#ptr\">ptr</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#false\">false</a>;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#acl\">acl</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#true\">true</a>;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * tomoyo_read_domain - Read domain policy.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * @head: Pointer to \"struct tomoyo_io_buffer\".</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Caller holds tomoyo_read_lock().</span>", 
"<span class=\"comment\"> */</span>", 
"static void <a class=\"id\" href=\"#tomoyo_read_domain\">tomoyo_read_domain</a>(struct <a class=\"id\" href=\"#tomoyo_io_buffer\">tomoyo_io_buffer</a> *<a class=\"id\" href=\"#head\">head</a>)", 
"{", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#eof\">eof</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_for_each_cookie\">list_for_each_cookie</a>(<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#domain\">domain</a>, &amp;<a class=\"id\" href=\"#tomoyo_domain_list\">tomoyo_domain_list</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_domain_info\">tomoyo_domain_info</a> *<a class=\"id\" href=\"#domain\">domain</a> =", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#list_entry\">list_entry</a>(<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#domain\">domain</a>, <a class=\"id\" href=\"#typeof\">typeof</a>(*<a class=\"id\" href=\"#domain\">domain</a>), <a class=\"id\" href=\"#list\">list</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>switch (<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#step\">step</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>case 0:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#domain\">domain</a>-><a class=\"id\" href=\"#is_deleted\">is_deleted</a> &&", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>    !<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#print_this_domain_only\">print_this_domain_only</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Print domainname and flags. */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_set_string\">tomoyo_set_string</a>(<a class=\"id\" href=\"#head\">head</a>, <a class=\"id\" href=\"#domain\">domain</a>-><a class=\"id\" href=\"#domainname\">domainname</a>-><a class=\"id\" href=\"#name\">name</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_set_lf\">tomoyo_set_lf</a>(<a class=\"id\" href=\"#head\">head</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_io_printf\">tomoyo_io_printf</a>(<a class=\"id\" href=\"#head\">head</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> <a class=\"id\" href=\"#TOMOYO_KEYWORD_USE_PROFILE\">TOMOYO_KEYWORD_USE_PROFILE</a> \"%u\\n\",", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> <a class=\"id\" href=\"#domain\">domain</a>-><a class=\"id\" href=\"#profile\">profile</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#domain\">domain</a>-><a class=\"id\" href=\"#quota_warned\">quota_warned</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_set_string\">tomoyo_set_string</a>(<a class=\"id\" href=\"#head\">head</a>, \"quota_exceeded\\n\");", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#domain\">domain</a>-><a class=\"id\" href=\"#transition_failed\">transition_failed</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_set_string\">tomoyo_set_string</a>(<a class=\"id\" href=\"#head\">head</a>, \"transition_failed\\n\");", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#domain\">domain</a>-><a class=\"id\" href=\"#ignore_global_allow_read\">ignore_global_allow_read</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_set_string\">tomoyo_set_string</a>(<a class=\"id\" href=\"#head\">head</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       <a class=\"id\" href=\"#TOMOYO_KEYWORD_IGNORE_GLOBAL_ALLOW_READ\">TOMOYO_KEYWORD_IGNORE_GLOBAL_ALLOW_READ</a>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>  \"\\n\");", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#step\">step</a>++;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_set_lf\">tomoyo_set_lf</a>(<a class=\"id\" href=\"#head\">head</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* fall through */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>case 1:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#tomoyo_read_domain2\">tomoyo_read_domain2</a>(<a class=\"id\" href=\"#head\">head</a>, <a class=\"id\" href=\"#domain\">domain</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#step\">step</a>++;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#tomoyo_set_lf\">tomoyo_set_lf</a>(<a class=\"id\" href=\"#head\">head</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* fall through */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>case 2:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#step\">step</a> = 0;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#print_this_domain_only\">print_this_domain_only</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#done\">done</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
" <a class=\"id\" href=\"#done\">done</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#eof\">eof</a> = <a class=\"id\" href=\"#true\">true</a>;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * tomoyo_write_domain_profile - Assign profile for specified domain.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * @head: Pointer to \"struct tomoyo_io_buffer\".</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Returns 0 on success, -EINVAL otherwise.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * This is equivalent to doing</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> *     ( echo \"select \" $domainname; echo \"use_profile \" $profile ) |</span>", 
"<span class=\"comment\"> *     /usr/sbin/tomoyo-loadpolicy -d</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Caller holds tomoyo_read_lock().</span>", 
"<span class=\"comment\"> */</span>", 
"static int <a class=\"id\" href=\"#tomoyo_write_domain_profile\">tomoyo_write_domain_profile</a>(struct <a class=\"id\" href=\"#tomoyo_io_buffer\">tomoyo_io_buffer</a> *<a class=\"id\" href=\"#head\">head</a>)", 
"{", 
"<span class=\"ts\"/>char *<a class=\"id\" href=\"#data\">data</a> = <a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#write_buf\">write_buf</a>;", 
"<span class=\"ts\"/>char *<a class=\"id\" href=\"#cp\">cp</a> = <a class=\"id\" href=\"#strchr\">strchr</a>(<a class=\"id\" href=\"#data\">data</a>, ' ');", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_domain_info\">tomoyo_domain_info</a> *<a class=\"id\" href=\"#domain\">domain</a>;", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#profile\">profile</a>;", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#cp\">cp</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"<span class=\"ts\"/>*<a class=\"id\" href=\"#cp\">cp</a> = '\\0';", 
"<span class=\"ts\"/><a class=\"id\" href=\"#domain\">domain</a> = <a class=\"id\" href=\"#tomoyo_find_domain\">tomoyo_find_domain</a>(<a class=\"id\" href=\"#cp\">cp</a> + 1);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#strict_strtoul\">strict_strtoul</a>(<a class=\"id\" href=\"#data\">data</a>, 10, &amp;<a class=\"id\" href=\"#profile\">profile</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#domain\">domain</a> && <a class=\"id\" href=\"#profile\">profile</a> &lt; <a class=\"id\" href=\"#TOMOYO_MAX_PROFILES\">TOMOYO_MAX_PROFILES</a>", 
"<span class=\"ts\"/>    && (<a class=\"id\" href=\"#tomoyo_profile_ptr\">tomoyo_profile_ptr</a>[<a class=\"id\" href=\"#profile\">profile</a>] || !<a class=\"id\" href=\"#tomoyo_policy_loaded\">tomoyo_policy_loaded</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#domain\">domain</a>-><a class=\"id\" href=\"#profile\">profile</a> = (<a class=\"id\" href=\"#u8\">u8</a>) <a class=\"id\" href=\"#profile\">profile</a>;", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * tomoyo_read_domain_profile - Read only domainname and profile.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * @head: Pointer to \"struct tomoyo_io_buffer\".</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Returns list of profile number and domainname pairs.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * This is equivalent to doing</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> *     grep -A 1 '^&lt;kernel&gt;' /sys/kernel/security/tomoyo/domain_policy |</span>", 
"<span class=\"comment\"> *     awk ' { if ( domainname == \"\" ) { if ( $1 == \"&lt;kernel&gt;\" )</span>", 
"<span class=\"comment\"> *     domainname = $0; } else if ( $1 == \"use_profile\" ) {</span>", 
"<span class=\"comment\"> *     print $2 \" \" domainname; domainname = \"\"; } } ; '</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Caller holds tomoyo_read_lock().</span>", 
"<span class=\"comment\"> */</span>", 
"static void <a class=\"id\" href=\"#tomoyo_read_domain_profile\">tomoyo_read_domain_profile</a>(struct <a class=\"id\" href=\"#tomoyo_io_buffer\">tomoyo_io_buffer</a> *<a class=\"id\" href=\"#head\">head</a>)", 
"{", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#eof\">eof</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_for_each_cookie\">list_for_each_cookie</a>(<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#domain\">domain</a>, &amp;<a class=\"id\" href=\"#tomoyo_domain_list\">tomoyo_domain_list</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_domain_info\">tomoyo_domain_info</a> *<a class=\"id\" href=\"#domain\">domain</a> =", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#list_entry\">list_entry</a>(<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#domain\">domain</a>, <a class=\"id\" href=\"#typeof\">typeof</a>(*<a class=\"id\" href=\"#domain\">domain</a>), <a class=\"id\" href=\"#list\">list</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#domain\">domain</a>-><a class=\"id\" href=\"#is_deleted\">is_deleted</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#tomoyo_flush\">tomoyo_flush</a>(<a class=\"id\" href=\"#head\">head</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_io_printf\">tomoyo_io_printf</a>(<a class=\"id\" href=\"#head\">head</a>, \"%u \", <a class=\"id\" href=\"#domain\">domain</a>-><a class=\"id\" href=\"#profile\">profile</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_set_string\">tomoyo_set_string</a>(<a class=\"id\" href=\"#head\">head</a>, <a class=\"id\" href=\"#domain\">domain</a>-><a class=\"id\" href=\"#domainname\">domainname</a>-><a class=\"id\" href=\"#name\">name</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_set_lf\">tomoyo_set_lf</a>(<a class=\"id\" href=\"#head\">head</a>);", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#eof\">eof</a> = <a class=\"id\" href=\"#true\">true</a>;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * tomoyo_write_pid: Specify PID to obtain domainname.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * @head: Pointer to \"struct tomoyo_io_buffer\".</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Returns 0.</span>", 
"<span class=\"comment\"> */</span>", 
"static int <a class=\"id\" href=\"#tomoyo_write_pid\">tomoyo_write_pid</a>(struct <a class=\"id\" href=\"#tomoyo_io_buffer\">tomoyo_io_buffer</a> *<a class=\"id\" href=\"#head\">head</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#eof\">eof</a> = <a class=\"id\" href=\"#false\">false</a>;", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * tomoyo_read_pid - Get domainname of the specified PID.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * @head: Pointer to \"struct tomoyo_io_buffer\".</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Returns the domainname which the specified PID is in on success,</span>", 
"<span class=\"comment\"> * empty string otherwise.</span>", 
"<span class=\"comment\"> * The PID is specified by tomoyo_write_pid() so that the user can obtain</span>", 
"<span class=\"comment\"> * using read()/write() interface rather than sysctl() interface.</span>", 
"<span class=\"comment\"> */</span>", 
"static void <a class=\"id\" href=\"#tomoyo_read_pid\">tomoyo_read_pid</a>(struct <a class=\"id\" href=\"#tomoyo_io_buffer\">tomoyo_io_buffer</a> *<a class=\"id\" href=\"#head\">head</a>)", 
"{", 
"<span class=\"ts\"/>char *<a class=\"id\" href=\"#buf\">buf</a> = <a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#write_buf\">write_buf</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bool\">bool</a> <a class=\"id\" href=\"#global_pid\">global_pid</a> = <a class=\"id\" href=\"#false\">false</a>;", 
"<span class=\"ts\"/>unsigned int <a class=\"id\" href=\"#pid\">pid</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#task_struct\">task_struct</a> *<a class=\"id\" href=\"#p\">p</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_domain_info\">tomoyo_domain_info</a> *<a class=\"id\" href=\"#domain\">domain</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Accessing write_buf is safe because head-&gt;io_sem is held. */</span>", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#buf\">buf</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#eof\">eof</a> = <a class=\"id\" href=\"#true\">true</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>return; <span class=\"comment\">/* Do nothing if open(O_RDONLY). */</span>", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#w_pos\">w_pos</a> || <a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#eof\">eof</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#eof\">eof</a> = <a class=\"id\" href=\"#true\">true</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#tomoyo_str_starts\">tomoyo_str_starts</a>(&amp;<a class=\"id\" href=\"#buf\">buf</a>, \"global-pid \"))", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#global_pid\">global_pid</a> = <a class=\"id\" href=\"#true\">true</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pid\">pid</a> = (unsigned int) <a class=\"id\" href=\"#simple_strtoul\">simple_strtoul</a>(<a class=\"id\" href=\"#buf\">buf</a>, <a class=\"id\" href=\"#NULL\">NULL</a>, 10);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rcu_read_lock\">rcu_read_lock</a>();", 
"<span class=\"ts\"/><a class=\"id\" href=\"#read_lock\">read_lock</a>(&amp;<a class=\"id\" href=\"#tasklist_lock\">tasklist_lock</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#global_pid\">global_pid</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#p\">p</a> = <a class=\"id\" href=\"#find_task_by_pid_ns\">find_task_by_pid_ns</a>(<a class=\"id\" href=\"#pid\">pid</a>, &amp;<a class=\"id\" href=\"#init_pid_ns\">init_pid_ns</a>);", 
"<span class=\"ts\"/>else", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#p\">p</a> = <a class=\"id\" href=\"#find_task_by_vpid\">find_task_by_vpid</a>(<a class=\"id\" href=\"#pid\">pid</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#p\">p</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#domain\">domain</a> = <a class=\"id\" href=\"#tomoyo_real_domain\">tomoyo_real_domain</a>(<a class=\"id\" href=\"#p\">p</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#read_unlock\">read_unlock</a>(&amp;<a class=\"id\" href=\"#tasklist_lock\">tasklist_lock</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rcu_read_unlock\">rcu_read_unlock</a>();", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#domain\">domain</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_io_printf\">tomoyo_io_printf</a>(<a class=\"id\" href=\"#head\">head</a>, \"%u %u \", <a class=\"id\" href=\"#pid\">pid</a>, <a class=\"id\" href=\"#domain\">domain</a>-><a class=\"id\" href=\"#profile\">profile</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_set_string\">tomoyo_set_string</a>(<a class=\"id\" href=\"#head\">head</a>, <a class=\"id\" href=\"#domain\">domain</a>-><a class=\"id\" href=\"#domainname\">domainname</a>-><a class=\"id\" href=\"#name\">name</a>);", 
"}", 
"", 
"static const char *<a class=\"id\" href=\"#tomoyo_transition_type\">tomoyo_transition_type</a>[<a class=\"id\" href=\"#TOMOYO_MAX_TRANSITION_TYPE\">TOMOYO_MAX_TRANSITION_TYPE</a>] = {", 
"<span class=\"ts\"/>[<a class=\"id\" href=\"#TOMOYO_TRANSITION_CONTROL_NO_INITIALIZE\">TOMOYO_TRANSITION_CONTROL_NO_INITIALIZE</a>]", 
"<span class=\"ts\"/>= <a class=\"id\" href=\"#TOMOYO_KEYWORD_NO_INITIALIZE_DOMAIN\">TOMOYO_KEYWORD_NO_INITIALIZE_DOMAIN</a>,", 
"<span class=\"ts\"/>[<a class=\"id\" href=\"#TOMOYO_TRANSITION_CONTROL_INITIALIZE\">TOMOYO_TRANSITION_CONTROL_INITIALIZE</a>]", 
"<span class=\"ts\"/>= <a class=\"id\" href=\"#TOMOYO_KEYWORD_INITIALIZE_DOMAIN\">TOMOYO_KEYWORD_INITIALIZE_DOMAIN</a>,", 
"<span class=\"ts\"/>[<a class=\"id\" href=\"#TOMOYO_TRANSITION_CONTROL_NO_KEEP\">TOMOYO_TRANSITION_CONTROL_NO_KEEP</a>] = <a class=\"id\" href=\"#TOMOYO_KEYWORD_NO_KEEP_DOMAIN\">TOMOYO_KEYWORD_NO_KEEP_DOMAIN</a>,", 
"<span class=\"ts\"/>[<a class=\"id\" href=\"#TOMOYO_TRANSITION_CONTROL_KEEP\">TOMOYO_TRANSITION_CONTROL_KEEP</a>] = <a class=\"id\" href=\"#TOMOYO_KEYWORD_KEEP_DOMAIN\">TOMOYO_KEYWORD_KEEP_DOMAIN</a>", 
"};", 
"", 
"static const char *<a class=\"id\" href=\"#tomoyo_group_name\">tomoyo_group_name</a>[<a class=\"id\" href=\"#TOMOYO_MAX_GROUP\">TOMOYO_MAX_GROUP</a>] = {", 
"<span class=\"ts\"/>[<a class=\"id\" href=\"#TOMOYO_PATH_GROUP\">TOMOYO_PATH_GROUP</a>] = <a class=\"id\" href=\"#TOMOYO_KEYWORD_PATH_GROUP\">TOMOYO_KEYWORD_PATH_GROUP</a>,", 
"<span class=\"ts\"/>[<a class=\"id\" href=\"#TOMOYO_NUMBER_GROUP\">TOMOYO_NUMBER_GROUP</a>] = <a class=\"id\" href=\"#TOMOYO_KEYWORD_NUMBER_GROUP\">TOMOYO_KEYWORD_NUMBER_GROUP</a>", 
"};", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * tomoyo_write_exception - Write exception policy.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * @head: Pointer to \"struct tomoyo_io_buffer\".</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Returns 0 on success, negative value otherwise.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Caller holds tomoyo_read_lock().</span>", 
"<span class=\"comment\"> */</span>", 
"static int <a class=\"id\" href=\"#tomoyo_write_exception\">tomoyo_write_exception</a>(struct <a class=\"id\" href=\"#tomoyo_io_buffer\">tomoyo_io_buffer</a> *<a class=\"id\" href=\"#head\">head</a>)", 
"{", 
"<span class=\"ts\"/>char *<a class=\"id\" href=\"#data\">data</a> = <a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#write_buf\">write_buf</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bool\">bool</a> <a class=\"id\" href=\"#is_delete\">is_delete</a> = <a class=\"id\" href=\"#tomoyo_str_starts\">tomoyo_str_starts</a>(&amp;<a class=\"id\" href=\"#data\">data</a>, <a class=\"id\" href=\"#TOMOYO_KEYWORD_DELETE\">TOMOYO_KEYWORD_DELETE</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u8\">u8</a> <a class=\"id\" href=\"#i\">i</a>;", 
"<span class=\"ts\"/>static const struct {", 
"<span class=\"ts\"/><span class=\"ts\"/>const char *<a class=\"id\" href=\"#keyword\">keyword</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>int (*<a class=\"id\" href=\"#write\">write</a>) (char *, const <a class=\"id\" href=\"#bool\">bool</a>);", 
"<span class=\"ts\"/>} <a class=\"id\" href=\"#tomoyo_callback\">tomoyo_callback</a>[4] = {", 
"<span class=\"ts\"/><span class=\"ts\"/>{ <a class=\"id\" href=\"#TOMOYO_KEYWORD_AGGREGATOR\">TOMOYO_KEYWORD_AGGREGATOR</a>, <a class=\"id\" href=\"#tomoyo_write_aggregator\">tomoyo_write_aggregator</a> },", 
"<span class=\"ts\"/><span class=\"ts\"/>{ <a class=\"id\" href=\"#TOMOYO_KEYWORD_FILE_PATTERN\">TOMOYO_KEYWORD_FILE_PATTERN</a>, <a class=\"id\" href=\"#tomoyo_write_pattern\">tomoyo_write_pattern</a> },", 
"<span class=\"ts\"/><span class=\"ts\"/>{ <a class=\"id\" href=\"#TOMOYO_KEYWORD_DENY_REWRITE\">TOMOYO_KEYWORD_DENY_REWRITE</a>, <a class=\"id\" href=\"#tomoyo_write_no_rewrite\">tomoyo_write_no_rewrite</a> },", 
"<span class=\"ts\"/><span class=\"ts\"/>{ <a class=\"id\" href=\"#TOMOYO_KEYWORD_ALLOW_READ\">TOMOYO_KEYWORD_ALLOW_READ</a>, <a class=\"id\" href=\"#tomoyo_write_globally_readable\">tomoyo_write_globally_readable</a> },", 
"<span class=\"ts\"/>};", 
"", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = 0; <a class=\"id\" href=\"#i\">i</a> &lt; <a class=\"id\" href=\"#TOMOYO_MAX_TRANSITION_TYPE\">TOMOYO_MAX_TRANSITION_TYPE</a>; <a class=\"id\" href=\"#i\">i</a>++)", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#tomoyo_str_starts\">tomoyo_str_starts</a>(&amp;<a class=\"id\" href=\"#data\">data</a>, <a class=\"id\" href=\"#tomoyo_transition_type\">tomoyo_transition_type</a>[<a class=\"id\" href=\"#i\">i</a>]))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#tomoyo_write_transition_control\">tomoyo_write_transition_control</a>(<a class=\"id\" href=\"#data\">data</a>, <a class=\"id\" href=\"#is_delete\">is_delete</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       <a class=\"id\" href=\"#i\">i</a>);", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = 0; <a class=\"id\" href=\"#i\">i</a> &lt; 4; <a class=\"id\" href=\"#i\">i</a>++)", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#tomoyo_str_starts\">tomoyo_str_starts</a>(&amp;<a class=\"id\" href=\"#data\">data</a>, <a class=\"id\" href=\"#tomoyo_callback\">tomoyo_callback</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#keyword\">keyword</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#tomoyo_callback\">tomoyo_callback</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#write\">write</a>(<a class=\"id\" href=\"#data\">data</a>, <a class=\"id\" href=\"#is_delete\">is_delete</a>);", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = 0; <a class=\"id\" href=\"#i\">i</a> &lt; <a class=\"id\" href=\"#TOMOYO_MAX_GROUP\">TOMOYO_MAX_GROUP</a>; <a class=\"id\" href=\"#i\">i</a>++)", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#tomoyo_str_starts\">tomoyo_str_starts</a>(&amp;<a class=\"id\" href=\"#data\">data</a>, <a class=\"id\" href=\"#tomoyo_group_name\">tomoyo_group_name</a>[<a class=\"id\" href=\"#i\">i</a>]))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#tomoyo_write_group\">tomoyo_write_group</a>(<a class=\"id\" href=\"#data\">data</a>, <a class=\"id\" href=\"#is_delete\">is_delete</a>, <a class=\"id\" href=\"#i\">i</a>);", 
"<span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * tomoyo_read_group - Read \"struct tomoyo_path_group\"/\"struct tomoyo_number_group\" list.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * @head: Pointer to \"struct tomoyo_io_buffer\".</span>", 
"<span class=\"comment\"> * @idx:  Index number.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Returns true on success, false otherwise.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Caller holds tomoyo_read_lock().</span>", 
"<span class=\"comment\"> */</span>", 
"static <a class=\"id\" href=\"#bool\">bool</a> <a class=\"id\" href=\"#tomoyo_read_group\">tomoyo_read_group</a>(struct <a class=\"id\" href=\"#tomoyo_io_buffer\">tomoyo_io_buffer</a> *<a class=\"id\" href=\"#head\">head</a>, const int <a class=\"id\" href=\"#idx\">idx</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_for_each_cookie\">list_for_each_cookie</a>(<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#group\">group</a>, &amp;<a class=\"id\" href=\"#tomoyo_group_list\">tomoyo_group_list</a>[<a class=\"id\" href=\"#idx\">idx</a>]) {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_group\">tomoyo_group</a> *<a class=\"id\" href=\"#group\">group</a> =", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#list_entry\">list_entry</a>(<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#group\">group</a>, <a class=\"id\" href=\"#typeof\">typeof</a>(*<a class=\"id\" href=\"#group\">group</a>), <a class=\"id\" href=\"#list\">list</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#list_for_each_cookie\">list_for_each_cookie</a>(<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#acl\">acl</a>, &amp;<a class=\"id\" href=\"#group\">group</a>-><a class=\"id\" href=\"#member_list\">member_list</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_acl_head\">tomoyo_acl_head</a> *<a class=\"id\" href=\"#ptr\">ptr</a> =", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#list_entry\">list_entry</a>(<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#acl\">acl</a>, <a class=\"id\" href=\"#typeof\">typeof</a>(*<a class=\"id\" href=\"#ptr\">ptr</a>), <a class=\"id\" href=\"#list\">list</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#is_deleted\">is_deleted</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#tomoyo_flush\">tomoyo_flush</a>(<a class=\"id\" href=\"#head\">head</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#false\">false</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_set_string\">tomoyo_set_string</a>(<a class=\"id\" href=\"#head\">head</a>, <a class=\"id\" href=\"#tomoyo_group_name\">tomoyo_group_name</a>[<a class=\"id\" href=\"#idx\">idx</a>]);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_set_string\">tomoyo_set_string</a>(<a class=\"id\" href=\"#head\">head</a>, <a class=\"id\" href=\"#group\">group</a>-><a class=\"id\" href=\"#group_name\">group_name</a>-><a class=\"id\" href=\"#name\">name</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#idx\">idx</a> == <a class=\"id\" href=\"#TOMOYO_PATH_GROUP\">TOMOYO_PATH_GROUP</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_set_space\">tomoyo_set_space</a>(<a class=\"id\" href=\"#head\">head</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_set_string\">tomoyo_set_string</a>(<a class=\"id\" href=\"#head\">head</a>, <a class=\"id\" href=\"#container_of\">container_of</a>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       (<a class=\"id\" href=\"#ptr\">ptr</a>, struct <a class=\"id\" href=\"#tomoyo_path_group\">tomoyo_path_group</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>)-><a class=\"id\" href=\"#member_name\">member_name</a>-><a class=\"id\" href=\"#name\">name</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>} else if (<a class=\"id\" href=\"#idx\">idx</a> == <a class=\"id\" href=\"#TOMOYO_NUMBER_GROUP\">TOMOYO_NUMBER_GROUP</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_print_number_union\">tomoyo_print_number_union</a>(<a class=\"id\" href=\"#head\">head</a>, &amp;<a class=\"id\" href=\"#container_of\">container_of</a>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>  (<a class=\"id\" href=\"#ptr\">ptr</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>   struct <a class=\"id\" href=\"#tomoyo_number_group\">tomoyo_number_group</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>   <a class=\"id\" href=\"#head\">head</a>)-><a class=\"id\" href=\"#number\">number</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_set_lf\">tomoyo_set_lf</a>(<a class=\"id\" href=\"#head\">head</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#acl\">acl</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#group\">group</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#true\">true</a>;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * tomoyo_read_policy - Read \"struct tomoyo_..._entry\" list.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * @head: Pointer to \"struct tomoyo_io_buffer\".</span>", 
"<span class=\"comment\"> * @idx:  Index number.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Returns true on success, false otherwise.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Caller holds tomoyo_read_lock().</span>", 
"<span class=\"comment\"> */</span>", 
"static <a class=\"id\" href=\"#bool\">bool</a> <a class=\"id\" href=\"#tomoyo_read_policy\">tomoyo_read_policy</a>(struct <a class=\"id\" href=\"#tomoyo_io_buffer\">tomoyo_io_buffer</a> *<a class=\"id\" href=\"#head\">head</a>, const int <a class=\"id\" href=\"#idx\">idx</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_for_each_cookie\">list_for_each_cookie</a>(<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#acl\">acl</a>, &amp;<a class=\"id\" href=\"#tomoyo_policy_list\">tomoyo_policy_list</a>[<a class=\"id\" href=\"#idx\">idx</a>]) {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_acl_head\">tomoyo_acl_head</a> *<a class=\"id\" href=\"#acl\">acl</a> =", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#container_of\">container_of</a>(<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#acl\">acl</a>, <a class=\"id\" href=\"#typeof\">typeof</a>(*<a class=\"id\" href=\"#acl\">acl</a>), <a class=\"id\" href=\"#list\">list</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#acl\">acl</a>-><a class=\"id\" href=\"#is_deleted\">is_deleted</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#tomoyo_flush\">tomoyo_flush</a>(<a class=\"id\" href=\"#head\">head</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#false\">false</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>switch (<a class=\"id\" href=\"#idx\">idx</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>case <a class=\"id\" href=\"#TOMOYO_ID_TRANSITION_CONTROL\">TOMOYO_ID_TRANSITION_CONTROL</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>{", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_transition_control\">tomoyo_transition_control</a> *<a class=\"id\" href=\"#ptr\">ptr</a> =", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#container_of\">container_of</a>(<a class=\"id\" href=\"#acl\">acl</a>, <a class=\"id\" href=\"#typeof\">typeof</a>(*<a class=\"id\" href=\"#ptr\">ptr</a>), <a class=\"id\" href=\"#head\">head</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_set_string\">tomoyo_set_string</a>(<a class=\"id\" href=\"#head\">head</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>  <a class=\"id\" href=\"#tomoyo_transition_type\">tomoyo_transition_type</a>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>  [<a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#type\">type</a>]);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#program\">program</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_set_string\">tomoyo_set_string</a>(<a class=\"id\" href=\"#head\">head</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>  <a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#program\">program</a>-><a class=\"id\" href=\"#name\">name</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#program\">program</a> && <a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#domainname\">domainname</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_set_string\">tomoyo_set_string</a>(<a class=\"id\" href=\"#head\">head</a>, \" from \");", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#domainname\">domainname</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_set_string\">tomoyo_set_string</a>(<a class=\"id\" href=\"#head\">head</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>  <a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#domainname\">domainname</a>->", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>  <a class=\"id\" href=\"#name\">name</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>case <a class=\"id\" href=\"#TOMOYO_ID_GLOBALLY_READABLE\">TOMOYO_ID_GLOBALLY_READABLE</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>{", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_readable_file\">tomoyo_readable_file</a> *<a class=\"id\" href=\"#ptr\">ptr</a> =", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#container_of\">container_of</a>(<a class=\"id\" href=\"#acl\">acl</a>, <a class=\"id\" href=\"#typeof\">typeof</a>(*<a class=\"id\" href=\"#ptr\">ptr</a>), <a class=\"id\" href=\"#head\">head</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_set_string\">tomoyo_set_string</a>(<a class=\"id\" href=\"#head\">head</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>  <a class=\"id\" href=\"#TOMOYO_KEYWORD_ALLOW_READ\">TOMOYO_KEYWORD_ALLOW_READ</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_set_string\">tomoyo_set_string</a>(<a class=\"id\" href=\"#head\">head</a>, <a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#filename\">filename</a>-><a class=\"id\" href=\"#name\">name</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>case <a class=\"id\" href=\"#TOMOYO_ID_AGGREGATOR\">TOMOYO_ID_AGGREGATOR</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>{", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_aggregator\">tomoyo_aggregator</a> *<a class=\"id\" href=\"#ptr\">ptr</a> =", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#container_of\">container_of</a>(<a class=\"id\" href=\"#acl\">acl</a>, <a class=\"id\" href=\"#typeof\">typeof</a>(*<a class=\"id\" href=\"#ptr\">ptr</a>), <a class=\"id\" href=\"#head\">head</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_set_string\">tomoyo_set_string</a>(<a class=\"id\" href=\"#head\">head</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>  <a class=\"id\" href=\"#TOMOYO_KEYWORD_AGGREGATOR\">TOMOYO_KEYWORD_AGGREGATOR</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_set_string\">tomoyo_set_string</a>(<a class=\"id\" href=\"#head\">head</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>  <a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#original_name\">original_name</a>-><a class=\"id\" href=\"#name\">name</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_set_space\">tomoyo_set_space</a>(<a class=\"id\" href=\"#head\">head</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_set_string\">tomoyo_set_string</a>(<a class=\"id\" href=\"#head\">head</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       <a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#aggregated_name\">aggregated_name</a>-><a class=\"id\" href=\"#name\">name</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>case <a class=\"id\" href=\"#TOMOYO_ID_PATTERN\">TOMOYO_ID_PATTERN</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>{", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_no_pattern\">tomoyo_no_pattern</a> *<a class=\"id\" href=\"#ptr\">ptr</a> =", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#container_of\">container_of</a>(<a class=\"id\" href=\"#acl\">acl</a>, <a class=\"id\" href=\"#typeof\">typeof</a>(*<a class=\"id\" href=\"#ptr\">ptr</a>), <a class=\"id\" href=\"#head\">head</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_set_string\">tomoyo_set_string</a>(<a class=\"id\" href=\"#head\">head</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>  <a class=\"id\" href=\"#TOMOYO_KEYWORD_FILE_PATTERN\">TOMOYO_KEYWORD_FILE_PATTERN</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_set_string\">tomoyo_set_string</a>(<a class=\"id\" href=\"#head\">head</a>, <a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#pattern\">pattern</a>-><a class=\"id\" href=\"#name\">name</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>case <a class=\"id\" href=\"#TOMOYO_ID_NO_REWRITE\">TOMOYO_ID_NO_REWRITE</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>{", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_no_rewrite\">tomoyo_no_rewrite</a> *<a class=\"id\" href=\"#ptr\">ptr</a> =", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#container_of\">container_of</a>(<a class=\"id\" href=\"#acl\">acl</a>, <a class=\"id\" href=\"#typeof\">typeof</a>(*<a class=\"id\" href=\"#ptr\">ptr</a>), <a class=\"id\" href=\"#head\">head</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_set_string\">tomoyo_set_string</a>(<a class=\"id\" href=\"#head\">head</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>  <a class=\"id\" href=\"#TOMOYO_KEYWORD_DENY_REWRITE\">TOMOYO_KEYWORD_DENY_REWRITE</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_set_string\">tomoyo_set_string</a>(<a class=\"id\" href=\"#head\">head</a>, <a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#pattern\">pattern</a>-><a class=\"id\" href=\"#name\">name</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>default:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_set_lf\">tomoyo_set_lf</a>(<a class=\"id\" href=\"#head\">head</a>);", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#acl\">acl</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#true\">true</a>;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * tomoyo_read_exception - Read exception policy.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * @head: Pointer to \"struct tomoyo_io_buffer\".</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Caller holds tomoyo_read_lock().</span>", 
"<span class=\"comment\"> */</span>", 
"static void <a class=\"id\" href=\"#tomoyo_read_exception\">tomoyo_read_exception</a>(struct <a class=\"id\" href=\"#tomoyo_io_buffer\">tomoyo_io_buffer</a> *<a class=\"id\" href=\"#head\">head</a>)", 
"{", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#eof\">eof</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"<span class=\"ts\"/>while (<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#step\">step</a> &lt; <a class=\"id\" href=\"#TOMOYO_MAX_POLICY\">TOMOYO_MAX_POLICY</a> &&", 
"<span class=\"ts\"/>       <a class=\"id\" href=\"#tomoyo_read_policy\">tomoyo_read_policy</a>(<a class=\"id\" href=\"#head\">head</a>, <a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#step\">step</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#step\">step</a>++;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#step\">step</a> &lt; <a class=\"id\" href=\"#TOMOYO_MAX_POLICY\">TOMOYO_MAX_POLICY</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"<span class=\"ts\"/>while (<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#step\">step</a> &lt; <a class=\"id\" href=\"#TOMOYO_MAX_POLICY\">TOMOYO_MAX_POLICY</a> + <a class=\"id\" href=\"#TOMOYO_MAX_GROUP\">TOMOYO_MAX_GROUP</a> &&", 
"<span class=\"ts\"/>       <a class=\"id\" href=\"#tomoyo_read_group\">tomoyo_read_group</a>(<a class=\"id\" href=\"#head\">head</a>, <a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#step\">step</a> - <a class=\"id\" href=\"#TOMOYO_MAX_POLICY\">TOMOYO_MAX_POLICY</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#step\">step</a>++;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#step\">step</a> &lt; <a class=\"id\" href=\"#TOMOYO_MAX_POLICY\">TOMOYO_MAX_POLICY</a> + <a class=\"id\" href=\"#TOMOYO_MAX_GROUP\">TOMOYO_MAX_GROUP</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#eof\">eof</a> = <a class=\"id\" href=\"#true\">true</a>;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * tomoyo_print_header - Get header line of audit log.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * @r: Pointer to \"struct tomoyo_request_info\".</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Returns string representation.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * This function uses kmalloc(), so caller must kfree() if this function</span>", 
"<span class=\"comment\"> * didn't return NULL.</span>", 
"<span class=\"comment\"> */</span>", 
"static char *<a class=\"id\" href=\"#tomoyo_print_header\">tomoyo_print_header</a>(struct <a class=\"id\" href=\"#tomoyo_request_info\">tomoyo_request_info</a> *<a class=\"id\" href=\"#r\">r</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#timeval\">timeval</a> <a class=\"id\" href=\"#tv\">tv</a>;", 
"<span class=\"ts\"/>const <a class=\"id\" href=\"#pid_t\">pid_t</a> <a class=\"id\" href=\"#gpid\">gpid</a> = <a class=\"id\" href=\"#task_pid_nr\">task_pid_nr</a>(<a class=\"id\" href=\"#current\">current</a>);", 
"<span class=\"ts\"/>static const int <a class=\"id\" href=\"#tomoyo_buffer_len\">tomoyo_buffer_len</a> = 4096;", 
"<span class=\"ts\"/>char *<a class=\"id\" href=\"#buffer\">buffer</a> = <a class=\"id\" href=\"#kmalloc\">kmalloc</a>(<a class=\"id\" href=\"#tomoyo_buffer_len\">tomoyo_buffer_len</a>, <a class=\"id\" href=\"#GFP_NOFS\">GFP_NOFS</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pid_t\">pid_t</a> <a class=\"id\" href=\"#ppid\">ppid</a>;", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#buffer\">buffer</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#do_gettimeofday\">do_gettimeofday</a>(&amp;<a class=\"id\" href=\"#tv\">tv</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rcu_read_lock\">rcu_read_lock</a>();", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ppid\">ppid</a> = <a class=\"id\" href=\"#task_tgid_vnr\">task_tgid_vnr</a>(<a class=\"id\" href=\"#current\">current</a>-><a class=\"id\" href=\"#real_parent\">real_parent</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rcu_read_unlock\">rcu_read_unlock</a>();", 
"<span class=\"ts\"/><a class=\"id\" href=\"#snprintf\">snprintf</a>(<a class=\"id\" href=\"#buffer\">buffer</a>, <a class=\"id\" href=\"#tomoyo_buffer_len\">tomoyo_buffer_len</a> - 1,", 
"<span class=\"ts\"/><span class=\"ts\"/> \"#timestamp=%lu profile=%u mode=%s (global-pid=%u)\"", 
"<span class=\"ts\"/><span class=\"ts\"/> \" task={ pid=%u ppid=%u uid=%u gid=%u euid=%u\"", 
"<span class=\"ts\"/><span class=\"ts\"/> \" egid=%u suid=%u sgid=%u fsuid=%u fsgid=%u }\",", 
"<span class=\"ts\"/><span class=\"ts\"/> <a class=\"id\" href=\"#tv\">tv</a>.<a class=\"id\" href=\"#tv_sec\">tv_sec</a>, <a class=\"id\" href=\"#r\">r</a>-><a class=\"id\" href=\"#profile\">profile</a>, <a class=\"id\" href=\"#tomoyo_mode\">tomoyo_mode</a>[<a class=\"id\" href=\"#r\">r</a>-><a class=\"id\" href=\"#mode\">mode</a>], <a class=\"id\" href=\"#gpid\">gpid</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/> <a class=\"id\" href=\"#task_tgid_vnr\">task_tgid_vnr</a>(<a class=\"id\" href=\"#current\">current</a>), <a class=\"id\" href=\"#ppid\">ppid</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/> <a class=\"id\" href=\"#current_uid\">current_uid</a>(), <a class=\"id\" href=\"#current_gid\">current_gid</a>(), <a class=\"id\" href=\"#current_euid\">current_euid</a>(),", 
"<span class=\"ts\"/><span class=\"ts\"/> <a class=\"id\" href=\"#current_egid\">current_egid</a>(), <a class=\"id\" href=\"#current_suid\">current_suid</a>(), <a class=\"id\" href=\"#current_sgid\">current_sgid</a>(),", 
"<span class=\"ts\"/><span class=\"ts\"/> <a class=\"id\" href=\"#current_fsuid\">current_fsuid</a>(), <a class=\"id\" href=\"#current_fsgid\">current_fsgid</a>());", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#buffer\">buffer</a>;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * tomoyo_init_audit_log - Allocate buffer for audit logs.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * @len: Required size.</span>", 
"<span class=\"comment\"> * @r:   Pointer to \"struct tomoyo_request_info\".</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Returns pointer to allocated memory.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * The @len is updated to add the header lines' size on success.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * This function uses kzalloc(), so caller must kfree() if this function</span>", 
"<span class=\"comment\"> * didn't return NULL.</span>", 
"<span class=\"comment\"> */</span>", 
"static char *<a class=\"id\" href=\"#tomoyo_init_audit_log\">tomoyo_init_audit_log</a>(int *<a class=\"id\" href=\"#len\">len</a>, struct <a class=\"id\" href=\"#tomoyo_request_info\">tomoyo_request_info</a> *<a class=\"id\" href=\"#r\">r</a>)", 
"{", 
"<span class=\"ts\"/>char *<a class=\"id\" href=\"#buf\">buf</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/>const char *<a class=\"id\" href=\"#header\">header</a>;", 
"<span class=\"ts\"/>const char *<a class=\"id\" href=\"#domainname\">domainname</a>;", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#r\">r</a>-><a class=\"id\" href=\"#domain\">domain</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#r\">r</a>-><a class=\"id\" href=\"#domain\">domain</a> = <a class=\"id\" href=\"#tomoyo_domain\">tomoyo_domain</a>();", 
"<span class=\"ts\"/><a class=\"id\" href=\"#domainname\">domainname</a> = <a class=\"id\" href=\"#r\">r</a>-><a class=\"id\" href=\"#domain\">domain</a>-><a class=\"id\" href=\"#domainname\">domainname</a>-><a class=\"id\" href=\"#name\">name</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#header\">header</a> = <a class=\"id\" href=\"#tomoyo_print_header\">tomoyo_print_header</a>(<a class=\"id\" href=\"#r\">r</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#header\">header</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/>*<a class=\"id\" href=\"#len\">len</a> += <a class=\"id\" href=\"#strlen\">strlen</a>(<a class=\"id\" href=\"#domainname\">domainname</a>) + <a class=\"id\" href=\"#strlen\">strlen</a>(<a class=\"id\" href=\"#header\">header</a>) + 10;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#buf\">buf</a> = <a class=\"id\" href=\"#kzalloc\">kzalloc</a>(*<a class=\"id\" href=\"#len\">len</a>, <a class=\"id\" href=\"#GFP_NOFS\">GFP_NOFS</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#buf\">buf</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#snprintf\">snprintf</a>(<a class=\"id\" href=\"#buf\">buf</a>, (*<a class=\"id\" href=\"#len\">len</a>) - 1, \"%s\\n%s\\n\", <a class=\"id\" href=\"#header\">header</a>, <a class=\"id\" href=\"#domainname\">domainname</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#header\">header</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#buf\">buf</a>;", 
"}", 
"", 
"<span class=\"comment\">/* Wait queue for tomoyo_query_list. */</span>", 
"static <a class=\"id\" href=\"#DECLARE_WAIT_QUEUE_HEAD\">DECLARE_WAIT_QUEUE_HEAD</a>(<a class=\"id\" href=\"#tomoyo_query_wait\">tomoyo_query_wait</a>);", 
"", 
"<span class=\"comment\">/* Lock for manipulating tomoyo_query_list. */</span>", 
"static <a class=\"id\" href=\"#DEFINE_SPINLOCK\">DEFINE_SPINLOCK</a>(<a class=\"id\" href=\"#tomoyo_query_list_lock\">tomoyo_query_list_lock</a>);", 
"", 
"<span class=\"comment\">/* Structure for query. */</span>", 
"struct <a class=\"id\" href=\"#tomoyo_query\">tomoyo_query</a> {", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#list_head\">list_head</a> <a class=\"id\" href=\"#list\">list</a>;", 
"<span class=\"ts\"/>char *<a class=\"id\" href=\"#query\">query</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#query_len\">query_len</a>;", 
"<span class=\"ts\"/>unsigned int <a class=\"id\" href=\"#serial\">serial</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#timer\">timer</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#answer\">answer</a>;", 
"};", 
"", 
"<span class=\"comment\">/* The list for \"struct tomoyo_query\". */</span>", 
"static <a class=\"id\" href=\"#LIST_HEAD\">LIST_HEAD</a>(<a class=\"id\" href=\"#tomoyo_query_list\">tomoyo_query_list</a>);", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Number of \"struct file\" referring /sys/kernel/security/tomoyo/query</span>", 
"<span class=\"comment\"> * interface.</span>", 
"<span class=\"comment\"> */</span>", 
"static <a class=\"id\" href=\"#atomic_t\">atomic_t</a> <a class=\"id\" href=\"#tomoyo_query_observers\">tomoyo_query_observers</a> = <a class=\"id\" href=\"#ATOMIC_INIT\">ATOMIC_INIT</a>(0);", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * tomoyo_supervisor - Ask for the supervisor's decision.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * @r:       Pointer to \"struct tomoyo_request_info\".</span>", 
"<span class=\"comment\"> * @fmt:     The printf()'s format string, followed by parameters.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Returns 0 if the supervisor decided to permit the access request which</span>", 
"<span class=\"comment\"> * violated the policy in enforcing mode, TOMOYO_RETRY_REQUEST if the</span>", 
"<span class=\"comment\"> * supervisor decided to retry the access request which violated the policy in</span>", 
"<span class=\"comment\"> * enforcing mode, 0 if it is not in enforcing mode, -EPERM otherwise.</span>", 
"<span class=\"comment\"> */</span>", 
"int <a class=\"id\" href=\"#tomoyo_supervisor\">tomoyo_supervisor</a>(struct <a class=\"id\" href=\"#tomoyo_request_info\">tomoyo_request_info</a> *<a class=\"id\" href=\"#r\">r</a>, const char *<a class=\"id\" href=\"#fmt\">fmt</a>, ...)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#va_list\">va_list</a> <a class=\"id\" href=\"#args\">args</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#error\">error</a> = -<a class=\"id\" href=\"#EPERM\">EPERM</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#pos\">pos</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#len\">len</a>;", 
"<span class=\"ts\"/>static unsigned int <a class=\"id\" href=\"#tomoyo_serial\">tomoyo_serial</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_query\">tomoyo_query</a> *<a class=\"id\" href=\"#entry\">entry</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bool\">bool</a> <a class=\"id\" href=\"#quota_exceeded\">quota_exceeded</a> = <a class=\"id\" href=\"#false\">false</a>;", 
"<span class=\"ts\"/>char *<a class=\"id\" href=\"#header\">header</a>;", 
"<span class=\"ts\"/>switch (<a class=\"id\" href=\"#r\">r</a>-><a class=\"id\" href=\"#mode\">mode</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>char *<a class=\"id\" href=\"#buffer\">buffer</a>;", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#TOMOYO_CONFIG_LEARNING\">TOMOYO_CONFIG_LEARNING</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#tomoyo_domain_quota_is_ok\">tomoyo_domain_quota_is_ok</a>(<a class=\"id\" href=\"#r\">r</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#va_start\">va_start</a>(<a class=\"id\" href=\"#args\">args</a>, <a class=\"id\" href=\"#fmt\">fmt</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#len\">len</a> = <a class=\"id\" href=\"#vsnprintf\">vsnprintf</a>((char *) &amp;<a class=\"id\" href=\"#pos\">pos</a>, sizeof(<a class=\"id\" href=\"#pos\">pos</a>) - 1, <a class=\"id\" href=\"#fmt\">fmt</a>, <a class=\"id\" href=\"#args\">args</a>) + 4;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#va_end\">va_end</a>(<a class=\"id\" href=\"#args\">args</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#buffer\">buffer</a> = <a class=\"id\" href=\"#kmalloc\">kmalloc</a>(<a class=\"id\" href=\"#len\">len</a>, <a class=\"id\" href=\"#GFP_NOFS\">GFP_NOFS</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#buffer\">buffer</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#va_start\">va_start</a>(<a class=\"id\" href=\"#args\">args</a>, <a class=\"id\" href=\"#fmt\">fmt</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#vsnprintf\">vsnprintf</a>(<a class=\"id\" href=\"#buffer\">buffer</a>, <a class=\"id\" href=\"#len\">len</a> - 1, <a class=\"id\" href=\"#fmt\">fmt</a>, <a class=\"id\" href=\"#args\">args</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#va_end\">va_end</a>(<a class=\"id\" href=\"#args\">args</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_normalize_line\">tomoyo_normalize_line</a>(<a class=\"id\" href=\"#buffer\">buffer</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_write_domain2\">tomoyo_write_domain2</a>(<a class=\"id\" href=\"#buffer\">buffer</a>, <a class=\"id\" href=\"#r\">r</a>-><a class=\"id\" href=\"#domain\">domain</a>, <a class=\"id\" href=\"#false\">false</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#buffer\">buffer</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* fall through */</span>", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#TOMOYO_CONFIG_PERMISSIVE\">TOMOYO_CONFIG_PERMISSIVE</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#r\">r</a>-><a class=\"id\" href=\"#domain\">domain</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#r\">r</a>-><a class=\"id\" href=\"#domain\">domain</a> = <a class=\"id\" href=\"#tomoyo_domain\">tomoyo_domain</a>();", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#atomic_read\">atomic_read</a>(&amp;<a class=\"id\" href=\"#tomoyo_query_observers\">tomoyo_query_observers</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EPERM\">EPERM</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#va_start\">va_start</a>(<a class=\"id\" href=\"#args\">args</a>, <a class=\"id\" href=\"#fmt\">fmt</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#len\">len</a> = <a class=\"id\" href=\"#vsnprintf\">vsnprintf</a>((char *) &amp;<a class=\"id\" href=\"#pos\">pos</a>, sizeof(<a class=\"id\" href=\"#pos\">pos</a>) - 1, <a class=\"id\" href=\"#fmt\">fmt</a>, <a class=\"id\" href=\"#args\">args</a>) + 32;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#va_end\">va_end</a>(<a class=\"id\" href=\"#args\">args</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#header\">header</a> = <a class=\"id\" href=\"#tomoyo_init_audit_log\">tomoyo_init_audit_log</a>(&amp;<a class=\"id\" href=\"#len\">len</a>, <a class=\"id\" href=\"#r\">r</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#header\">header</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#entry\">entry</a> = <a class=\"id\" href=\"#kzalloc\">kzalloc</a>(sizeof(*<a class=\"id\" href=\"#entry\">entry</a>), <a class=\"id\" href=\"#GFP_NOFS\">GFP_NOFS</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#entry\">entry</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#query\">query</a> = <a class=\"id\" href=\"#kzalloc\">kzalloc</a>(<a class=\"id\" href=\"#len\">len</a>, <a class=\"id\" href=\"#GFP_NOFS\">GFP_NOFS</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#query\">query</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#len\">len</a> = <a class=\"id\" href=\"#ksize\">ksize</a>(<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#query\">query</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock\">spin_lock</a>(&amp;<a class=\"id\" href=\"#tomoyo_query_list_lock\">tomoyo_query_list_lock</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#tomoyo_quota_for_query\">tomoyo_quota_for_query</a> && <a class=\"id\" href=\"#tomoyo_query_memory_size\">tomoyo_query_memory_size</a> + <a class=\"id\" href=\"#len\">len</a> +", 
"<span class=\"ts\"/>    sizeof(*<a class=\"id\" href=\"#entry\">entry</a>) >= <a class=\"id\" href=\"#tomoyo_quota_for_query\">tomoyo_quota_for_query</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#quota_exceeded\">quota_exceeded</a> = <a class=\"id\" href=\"#true\">true</a>;", 
"<span class=\"ts\"/>} else {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_query_memory_size\">tomoyo_query_memory_size</a> += <a class=\"id\" href=\"#len\">len</a> + sizeof(*<a class=\"id\" href=\"#entry\">entry</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#serial\">serial</a> = <a class=\"id\" href=\"#tomoyo_serial\">tomoyo_serial</a>++;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock\">spin_unlock</a>(&amp;<a class=\"id\" href=\"#tomoyo_query_list_lock\">tomoyo_query_list_lock</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#quota_exceeded\">quota_exceeded</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pos\">pos</a> = <a class=\"id\" href=\"#snprintf\">snprintf</a>(<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#query\">query</a>, <a class=\"id\" href=\"#len\">len</a> - 1, \"Q%u-%hu\\n%s\",", 
"<span class=\"ts\"/><span class=\"ts\"/>       <a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#serial\">serial</a>, <a class=\"id\" href=\"#r\">r</a>-><a class=\"id\" href=\"#retry\">retry</a>, <a class=\"id\" href=\"#header\">header</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#header\">header</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#header\">header</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#va_start\">va_start</a>(<a class=\"id\" href=\"#args\">args</a>, <a class=\"id\" href=\"#fmt\">fmt</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#vsnprintf\">vsnprintf</a>(<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#query\">query</a> + <a class=\"id\" href=\"#pos\">pos</a>, <a class=\"id\" href=\"#len\">len</a> - 1 - <a class=\"id\" href=\"#pos\">pos</a>, <a class=\"id\" href=\"#fmt\">fmt</a>, <a class=\"id\" href=\"#args\">args</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#query_len\">query_len</a> = <a class=\"id\" href=\"#strlen\">strlen</a>(<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#query\">query</a>) + 1;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#va_end\">va_end</a>(<a class=\"id\" href=\"#args\">args</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock\">spin_lock</a>(&amp;<a class=\"id\" href=\"#tomoyo_query_list_lock\">tomoyo_query_list_lock</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_add_tail\">list_add_tail</a>(&amp;<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#list\">list</a>, &amp;<a class=\"id\" href=\"#tomoyo_query_list\">tomoyo_query_list</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock\">spin_unlock</a>(&amp;<a class=\"id\" href=\"#tomoyo_query_list_lock\">tomoyo_query_list_lock</a>);", 
"<span class=\"ts\"/><span class=\"comment\">/* Give 10 seconds for supervisor's opinion. */</span>", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#timer\">timer</a> = 0;", 
"<span class=\"ts\"/>     <a class=\"id\" href=\"#atomic_read\">atomic_read</a>(&amp;<a class=\"id\" href=\"#tomoyo_query_observers\">tomoyo_query_observers</a>) && <a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#timer\">timer</a> &lt; 100;", 
"<span class=\"ts\"/>     <a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#timer\">timer</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#wake_up\">wake_up</a>(&amp;<a class=\"id\" href=\"#tomoyo_query_wait\">tomoyo_query_wait</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#set_current_state\">set_current_state</a>(<a class=\"id\" href=\"#TASK_INTERRUPTIBLE\">TASK_INTERRUPTIBLE</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#schedule_timeout\">schedule_timeout</a>(<a class=\"id\" href=\"#HZ\">HZ</a> / 10);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#answer\">answer</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock\">spin_lock</a>(&amp;<a class=\"id\" href=\"#tomoyo_query_list_lock\">tomoyo_query_list_lock</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_del\">list_del</a>(&amp;<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#list\">list</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_query_memory_size\">tomoyo_query_memory_size</a> -= <a class=\"id\" href=\"#len\">len</a> + sizeof(*<a class=\"id\" href=\"#entry\">entry</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock\">spin_unlock</a>(&amp;<a class=\"id\" href=\"#tomoyo_query_list_lock\">tomoyo_query_list_lock</a>);", 
"<span class=\"ts\"/>switch (<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#answer\">answer</a>) {", 
"<span class=\"ts\"/>case 3: <span class=\"comment\">/* Asked to retry by administrator. */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#error\">error</a> = <a class=\"id\" href=\"#TOMOYO_RETRY_REQUEST\">TOMOYO_RETRY_REQUEST</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#r\">r</a>-><a class=\"id\" href=\"#retry\">retry</a>++;", 
"<span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>case 1:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Granted by administrator. */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#error\">error</a> = 0;", 
"<span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>case 0:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Timed out. */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>default:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Rejected by administrator. */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>}", 
" <a class=\"id\" href=\"#out\">out</a>:", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#entry\">entry</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#query\">query</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#entry\">entry</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#header\">header</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#error\">error</a>;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * tomoyo_poll_query - poll() for /sys/kernel/security/tomoyo/query.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * @file: Pointer to \"struct file\".</span>", 
"<span class=\"comment\"> * @wait: Pointer to \"poll_table\".</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Returns POLLIN | POLLRDNORM when ready to read, 0 otherwise.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Waits for access requests which violated policy in enforcing mode.</span>", 
"<span class=\"comment\"> */</span>", 
"static int <a class=\"id\" href=\"#tomoyo_poll_query\">tomoyo_poll_query</a>(struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#file\">file</a>, <a class=\"id\" href=\"#poll_table\">poll_table</a> *<a class=\"id\" href=\"#wait\">wait</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#list_head\">list_head</a> *<a class=\"id\" href=\"#tmp\">tmp</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bool\">bool</a> <a class=\"id\" href=\"#found\">found</a> = <a class=\"id\" href=\"#false\">false</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u8\">u8</a> <a class=\"id\" href=\"#i\">i</a>;", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = 0; <a class=\"id\" href=\"#i\">i</a> &lt; 2; <a class=\"id\" href=\"#i\">i</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_lock\">spin_lock</a>(&amp;<a class=\"id\" href=\"#tomoyo_query_list_lock\">tomoyo_query_list_lock</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#list_for_each\">list_for_each</a>(<a class=\"id\" href=\"#tmp\">tmp</a>, &amp;<a class=\"id\" href=\"#tomoyo_query_list\">tomoyo_query_list</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_query\">tomoyo_query</a> *<a class=\"id\" href=\"#ptr\">ptr</a> =", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#list_entry\">list_entry</a>(<a class=\"id\" href=\"#tmp\">tmp</a>, <a class=\"id\" href=\"#typeof\">typeof</a>(*<a class=\"id\" href=\"#ptr\">ptr</a>), <a class=\"id\" href=\"#list\">list</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#answer\">answer</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#found\">found</a> = <a class=\"id\" href=\"#true\">true</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock\">spin_unlock</a>(&amp;<a class=\"id\" href=\"#tomoyo_query_list_lock\">tomoyo_query_list_lock</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#found\">found</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#POLLIN\">POLLIN</a> | <a class=\"id\" href=\"#POLLRDNORM\">POLLRDNORM</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#i\">i</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#poll_wait\">poll_wait</a>(<a class=\"id\" href=\"#file\">file</a>, &amp;<a class=\"id\" href=\"#tomoyo_query_wait\">tomoyo_query_wait</a>, <a class=\"id\" href=\"#wait\">wait</a>);", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * tomoyo_read_query - Read access requests which violated policy in enforcing mode.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * @head: Pointer to \"struct tomoyo_io_buffer\".</span>", 
"<span class=\"comment\"> */</span>", 
"static void <a class=\"id\" href=\"#tomoyo_read_query\">tomoyo_read_query</a>(struct <a class=\"id\" href=\"#tomoyo_io_buffer\">tomoyo_io_buffer</a> *<a class=\"id\" href=\"#head\">head</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#list_head\">list_head</a> *<a class=\"id\" href=\"#tmp\">tmp</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#pos\">pos</a> = 0;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#len\">len</a> = 0;", 
"<span class=\"ts\"/>char *<a class=\"id\" href=\"#buf\">buf</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#w_pos\">w_pos</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#read_buf\">read_buf</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#read_buf\">read_buf</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#read_buf\">read_buf</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock\">spin_lock</a>(&amp;<a class=\"id\" href=\"#tomoyo_query_list_lock\">tomoyo_query_list_lock</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_for_each\">list_for_each</a>(<a class=\"id\" href=\"#tmp\">tmp</a>, &amp;<a class=\"id\" href=\"#tomoyo_query_list\">tomoyo_query_list</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_query\">tomoyo_query</a> *<a class=\"id\" href=\"#ptr\">ptr</a> = <a class=\"id\" href=\"#list_entry\">list_entry</a>(<a class=\"id\" href=\"#tmp\">tmp</a>, <a class=\"id\" href=\"#typeof\">typeof</a>(*<a class=\"id\" href=\"#ptr\">ptr</a>), <a class=\"id\" href=\"#list\">list</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#answer\">answer</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#pos\">pos</a>++ != <a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#query_index\">query_index</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#len\">len</a> = <a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#query_len\">query_len</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock\">spin_unlock</a>(&amp;<a class=\"id\" href=\"#tomoyo_query_list_lock\">tomoyo_query_list_lock</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#len\">len</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#query_index\">query_index</a> = 0;", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#buf\">buf</a> = <a class=\"id\" href=\"#kzalloc\">kzalloc</a>(<a class=\"id\" href=\"#len\">len</a>, <a class=\"id\" href=\"#GFP_NOFS\">GFP_NOFS</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#buf\">buf</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pos\">pos</a> = 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock\">spin_lock</a>(&amp;<a class=\"id\" href=\"#tomoyo_query_list_lock\">tomoyo_query_list_lock</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_for_each\">list_for_each</a>(<a class=\"id\" href=\"#tmp\">tmp</a>, &amp;<a class=\"id\" href=\"#tomoyo_query_list\">tomoyo_query_list</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_query\">tomoyo_query</a> *<a class=\"id\" href=\"#ptr\">ptr</a> = <a class=\"id\" href=\"#list_entry\">list_entry</a>(<a class=\"id\" href=\"#tmp\">tmp</a>, <a class=\"id\" href=\"#typeof\">typeof</a>(*<a class=\"id\" href=\"#ptr\">ptr</a>), <a class=\"id\" href=\"#list\">list</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#answer\">answer</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#pos\">pos</a>++ != <a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#query_index\">query_index</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * Some query can be skipped because tomoyo_query_list</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * can change, but I don't care.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#len\">len</a> == <a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#query_len\">query_len</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#memmove\">memmove</a>(<a class=\"id\" href=\"#buf\">buf</a>, <a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#query\">query</a>, <a class=\"id\" href=\"#len\">len</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock\">spin_unlock</a>(&amp;<a class=\"id\" href=\"#tomoyo_query_list_lock\">tomoyo_query_list_lock</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#buf\">buf</a>[0]) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#read_buf\">read_buf</a> = <a class=\"id\" href=\"#buf\">buf</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#w\">w</a>[<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#w_pos\">w_pos</a>++] = <a class=\"id\" href=\"#buf\">buf</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#query_index\">query_index</a>++;", 
"<span class=\"ts\"/>} else {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#buf\">buf</a>);", 
"<span class=\"ts\"/>}", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * tomoyo_write_answer - Write the supervisor's decision.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * @head: Pointer to \"struct tomoyo_io_buffer\".</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Returns 0 on success, -EINVAL otherwise.</span>", 
"<span class=\"comment\"> */</span>", 
"static int <a class=\"id\" href=\"#tomoyo_write_answer\">tomoyo_write_answer</a>(struct <a class=\"id\" href=\"#tomoyo_io_buffer\">tomoyo_io_buffer</a> *<a class=\"id\" href=\"#head\">head</a>)", 
"{", 
"<span class=\"ts\"/>char *<a class=\"id\" href=\"#data\">data</a> = <a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#write_buf\">write_buf</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#list_head\">list_head</a> *<a class=\"id\" href=\"#tmp\">tmp</a>;", 
"<span class=\"ts\"/>unsigned int <a class=\"id\" href=\"#serial\">serial</a>;", 
"<span class=\"ts\"/>unsigned int <a class=\"id\" href=\"#answer\">answer</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock\">spin_lock</a>(&amp;<a class=\"id\" href=\"#tomoyo_query_list_lock\">tomoyo_query_list_lock</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_for_each\">list_for_each</a>(<a class=\"id\" href=\"#tmp\">tmp</a>, &amp;<a class=\"id\" href=\"#tomoyo_query_list\">tomoyo_query_list</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_query\">tomoyo_query</a> *<a class=\"id\" href=\"#ptr\">ptr</a> = <a class=\"id\" href=\"#list_entry\">list_entry</a>(<a class=\"id\" href=\"#tmp\">tmp</a>, <a class=\"id\" href=\"#typeof\">typeof</a>(*<a class=\"id\" href=\"#ptr\">ptr</a>), <a class=\"id\" href=\"#list\">list</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#timer\">timer</a> = 0;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock\">spin_unlock</a>(&amp;<a class=\"id\" href=\"#tomoyo_query_list_lock\">tomoyo_query_list_lock</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#sscanf\">sscanf</a>(<a class=\"id\" href=\"#data\">data</a>, \"A%u=%u\", &amp;<a class=\"id\" href=\"#serial\">serial</a>, &amp;<a class=\"id\" href=\"#answer\">answer</a>) != 2)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock\">spin_lock</a>(&amp;<a class=\"id\" href=\"#tomoyo_query_list_lock\">tomoyo_query_list_lock</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_for_each\">list_for_each</a>(<a class=\"id\" href=\"#tmp\">tmp</a>, &amp;<a class=\"id\" href=\"#tomoyo_query_list\">tomoyo_query_list</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_query\">tomoyo_query</a> *<a class=\"id\" href=\"#ptr\">ptr</a> = <a class=\"id\" href=\"#list_entry\">list_entry</a>(<a class=\"id\" href=\"#tmp\">tmp</a>, <a class=\"id\" href=\"#typeof\">typeof</a>(*<a class=\"id\" href=\"#ptr\">ptr</a>), <a class=\"id\" href=\"#list\">list</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#serial\">serial</a> != <a class=\"id\" href=\"#serial\">serial</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#answer\">answer</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ptr\">ptr</a>-><a class=\"id\" href=\"#answer\">answer</a> = <a class=\"id\" href=\"#answer\">answer</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock\">spin_unlock</a>(&amp;<a class=\"id\" href=\"#tomoyo_query_list_lock\">tomoyo_query_list_lock</a>);", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * tomoyo_read_version: Get version.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * @head: Pointer to \"struct tomoyo_io_buffer\".</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Returns version information.</span>", 
"<span class=\"comment\"> */</span>", 
"static void <a class=\"id\" href=\"#tomoyo_read_version\">tomoyo_read_version</a>(struct <a class=\"id\" href=\"#tomoyo_io_buffer\">tomoyo_io_buffer</a> *<a class=\"id\" href=\"#head\">head</a>)", 
"{", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#eof\">eof</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_io_printf\">tomoyo_io_printf</a>(<a class=\"id\" href=\"#head\">head</a>, \"2.3.0\");", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#eof\">eof</a> = <a class=\"id\" href=\"#true\">true</a>;", 
"<span class=\"ts\"/>}", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * tomoyo_read_self_domain - Get the current process's domainname.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * @head: Pointer to \"struct tomoyo_io_buffer\".</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Returns the current process's domainname.</span>", 
"<span class=\"comment\"> */</span>", 
"static void <a class=\"id\" href=\"#tomoyo_read_self_domain\">tomoyo_read_self_domain</a>(struct <a class=\"id\" href=\"#tomoyo_io_buffer\">tomoyo_io_buffer</a> *<a class=\"id\" href=\"#head\">head</a>)", 
"{", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#eof\">eof</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * tomoyo_domain()-&gt;domainname != NULL</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * because every process belongs to a domain and</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * the domain's name cannot be NULL.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_io_printf\">tomoyo_io_printf</a>(<a class=\"id\" href=\"#head\">head</a>, \"%s\", <a class=\"id\" href=\"#tomoyo_domain\">tomoyo_domain</a>()-><a class=\"id\" href=\"#domainname\">domainname</a>-><a class=\"id\" href=\"#name\">name</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#r\">r</a>.<a class=\"id\" href=\"#eof\">eof</a> = <a class=\"id\" href=\"#true\">true</a>;", 
"<span class=\"ts\"/>}", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * tomoyo_open_control - open() for /sys/kernel/security/tomoyo/ interface.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * @type: Type of interface.</span>", 
"<span class=\"comment\"> * @file: Pointer to \"struct file\".</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Associates policy handler and returns 0 on success, -ENOMEM otherwise.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Caller acquires tomoyo_read_lock().</span>", 
"<span class=\"comment\"> */</span>", 
"int <a class=\"id\" href=\"#tomoyo_open_control\">tomoyo_open_control</a>(const <a class=\"id\" href=\"#u8\">u8</a> <a class=\"id\" href=\"#type\">type</a>, struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#file\">file</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_io_buffer\">tomoyo_io_buffer</a> *<a class=\"id\" href=\"#head\">head</a> = <a class=\"id\" href=\"#kzalloc\">kzalloc</a>(sizeof(*<a class=\"id\" href=\"#head\">head</a>), <a class=\"id\" href=\"#GFP_NOFS\">GFP_NOFS</a>);", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#head\">head</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_init\">mutex_init</a>(&amp;<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#io_sem\">io_sem</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#type\">type</a> = <a class=\"id\" href=\"#type\">type</a>;", 
"<span class=\"ts\"/>switch (<a class=\"id\" href=\"#type\">type</a>) {", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#TOMOYO_DOMAINPOLICY\">TOMOYO_DOMAINPOLICY</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* /sys/kernel/security/tomoyo/domain_policy */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#write\">write</a> = <a class=\"id\" href=\"#tomoyo_write_domain\">tomoyo_write_domain</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#read\">read</a> = <a class=\"id\" href=\"#tomoyo_read_domain\">tomoyo_read_domain</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#TOMOYO_EXCEPTIONPOLICY\">TOMOYO_EXCEPTIONPOLICY</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* /sys/kernel/security/tomoyo/exception_policy */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#write\">write</a> = <a class=\"id\" href=\"#tomoyo_write_exception\">tomoyo_write_exception</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#read\">read</a> = <a class=\"id\" href=\"#tomoyo_read_exception\">tomoyo_read_exception</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#TOMOYO_SELFDOMAIN\">TOMOYO_SELFDOMAIN</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* /sys/kernel/security/tomoyo/self_domain */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#read\">read</a> = <a class=\"id\" href=\"#tomoyo_read_self_domain\">tomoyo_read_self_domain</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#TOMOYO_DOMAIN_STATUS\">TOMOYO_DOMAIN_STATUS</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* /sys/kernel/security/tomoyo/.domain_status */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#write\">write</a> = <a class=\"id\" href=\"#tomoyo_write_domain_profile\">tomoyo_write_domain_profile</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#read\">read</a> = <a class=\"id\" href=\"#tomoyo_read_domain_profile\">tomoyo_read_domain_profile</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#TOMOYO_PROCESS_STATUS\">TOMOYO_PROCESS_STATUS</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* /sys/kernel/security/tomoyo/.process_status */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#write\">write</a> = <a class=\"id\" href=\"#tomoyo_write_pid\">tomoyo_write_pid</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#read\">read</a> = <a class=\"id\" href=\"#tomoyo_read_pid\">tomoyo_read_pid</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#TOMOYO_VERSION\">TOMOYO_VERSION</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* /sys/kernel/security/tomoyo/version */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#read\">read</a> = <a class=\"id\" href=\"#tomoyo_read_version\">tomoyo_read_version</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#readbuf_size\">readbuf_size</a> = 128;", 
"<span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#TOMOYO_MEMINFO\">TOMOYO_MEMINFO</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* /sys/kernel/security/tomoyo/meminfo */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#write\">write</a> = <a class=\"id\" href=\"#tomoyo_write_memory_quota\">tomoyo_write_memory_quota</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#read\">read</a> = <a class=\"id\" href=\"#tomoyo_read_memory_counter\">tomoyo_read_memory_counter</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#readbuf_size\">readbuf_size</a> = 512;", 
"<span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#TOMOYO_PROFILE\">TOMOYO_PROFILE</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* /sys/kernel/security/tomoyo/profile */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#write\">write</a> = <a class=\"id\" href=\"#tomoyo_write_profile\">tomoyo_write_profile</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#read\">read</a> = <a class=\"id\" href=\"#tomoyo_read_profile\">tomoyo_read_profile</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#TOMOYO_QUERY\">TOMOYO_QUERY</a>: <span class=\"comment\">/* /sys/kernel/security/tomoyo/query */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#poll\">poll</a> = <a class=\"id\" href=\"#tomoyo_poll_query\">tomoyo_poll_query</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#write\">write</a> = <a class=\"id\" href=\"#tomoyo_write_answer\">tomoyo_write_answer</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#read\">read</a> = <a class=\"id\" href=\"#tomoyo_read_query\">tomoyo_read_query</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#TOMOYO_MANAGER\">TOMOYO_MANAGER</a>:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* /sys/kernel/security/tomoyo/manager */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#write\">write</a> = <a class=\"id\" href=\"#tomoyo_write_manager\">tomoyo_write_manager</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#read\">read</a> = <a class=\"id\" href=\"#tomoyo_read_manager\">tomoyo_read_manager</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>if (!(<a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#f_mode\">f_mode</a> &amp; <a class=\"id\" href=\"#FMODE_READ\">FMODE_READ</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * No need to allocate read_buf since it is not opened</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * for reading.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#read\">read</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#poll\">poll</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/>} else if (!<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#poll\">poll</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Don't allocate read_buf for poll() access. */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#readbuf_size\">readbuf_size</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#readbuf_size\">readbuf_size</a> = 4096 * 2;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#read_buf\">read_buf</a> = <a class=\"id\" href=\"#kzalloc\">kzalloc</a>(<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#readbuf_size\">readbuf_size</a>, <a class=\"id\" href=\"#GFP_NOFS\">GFP_NOFS</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#read_buf\">read_buf</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#head\">head</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>if (!(<a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#f_mode\">f_mode</a> &amp; <a class=\"id\" href=\"#FMODE_WRITE\">FMODE_WRITE</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * No need to allocate write_buf since it is not opened</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * for writing.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#write\">write</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/>} else if (<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#write\">write</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#writebuf_size\">writebuf_size</a> = 4096 * 2;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#write_buf\">write_buf</a> = <a class=\"id\" href=\"#kzalloc\">kzalloc</a>(<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#writebuf_size\">writebuf_size</a>, <a class=\"id\" href=\"#GFP_NOFS\">GFP_NOFS</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#write_buf\">write_buf</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#read_buf\">read_buf</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#head\">head</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#type\">type</a> != <a class=\"id\" href=\"#TOMOYO_QUERY\">TOMOYO_QUERY</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#reader_idx\">reader_idx</a> = <a class=\"id\" href=\"#tomoyo_read_lock\">tomoyo_read_lock</a>();", 
"<span class=\"ts\"/><a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#private_data\">private_data</a> = <a class=\"id\" href=\"#head\">head</a>;", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Call the handler now if the file is</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * /sys/kernel/security/tomoyo/self_domain</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * so that the user can use</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * cat &lt; /sys/kernel/security/tomoyo/self_domain\"</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * to know the current process's domainname.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#type\">type</a> == <a class=\"id\" href=\"#TOMOYO_SELFDOMAIN\">TOMOYO_SELFDOMAIN</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_read_control\">tomoyo_read_control</a>(<a class=\"id\" href=\"#file\">file</a>, <a class=\"id\" href=\"#NULL\">NULL</a>, 0);", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * If the file is /sys/kernel/security/tomoyo/query , increment the</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * observer counter.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * The obserber counter is used by tomoyo_supervisor() to see if</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * there is some process monitoring /sys/kernel/security/tomoyo/query.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/>else if (<a class=\"id\" href=\"#type\">type</a> == <a class=\"id\" href=\"#TOMOYO_QUERY\">TOMOYO_QUERY</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#atomic_inc\">atomic_inc</a>(&amp;<a class=\"id\" href=\"#tomoyo_query_observers\">tomoyo_query_observers</a>);", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * tomoyo_poll_control - poll() for /sys/kernel/security/tomoyo/ interface.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * @file: Pointer to \"struct file\".</span>", 
"<span class=\"comment\"> * @wait: Pointer to \"poll_table\".</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Waits for read readiness.</span>", 
"<span class=\"comment\"> * /sys/kernel/security/tomoyo/query is handled by /usr/sbin/tomoyo-queryd .</span>", 
"<span class=\"comment\"> */</span>", 
"int <a class=\"id\" href=\"#tomoyo_poll_control\">tomoyo_poll_control</a>(struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#file\">file</a>, <a class=\"id\" href=\"#poll_table\">poll_table</a> *<a class=\"id\" href=\"#wait\">wait</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_io_buffer\">tomoyo_io_buffer</a> *<a class=\"id\" href=\"#head\">head</a> = <a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#poll\">poll</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOSYS\">ENOSYS</a>;", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#poll\">poll</a>(<a class=\"id\" href=\"#file\">file</a>, <a class=\"id\" href=\"#wait\">wait</a>);", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * tomoyo_read_control - read() for /sys/kernel/security/tomoyo/ interface.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * @file:       Pointer to \"struct file\".</span>", 
"<span class=\"comment\"> * @buffer:     Poiner to buffer to write to.</span>", 
"<span class=\"comment\"> * @buffer_len: Size of @buffer.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Returns bytes read on success, negative value otherwise.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Caller holds tomoyo_read_lock().</span>", 
"<span class=\"comment\"> */</span>", 
"int <a class=\"id\" href=\"#tomoyo_read_control\">tomoyo_read_control</a>(struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#file\">file</a>, char <a class=\"id\" href=\"#__user\">__user</a> *<a class=\"id\" href=\"#buffer\">buffer</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>const int <a class=\"id\" href=\"#buffer_len\">buffer_len</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#len\">len</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_io_buffer\">tomoyo_io_buffer</a> *<a class=\"id\" href=\"#head\">head</a> = <a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#read\">read</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOSYS\">ENOSYS</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#mutex_lock_interruptible\">mutex_lock_interruptible</a>(&amp;<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#io_sem\">io_sem</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINTR\">EINTR</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#read_user_buf\">read_user_buf</a> = <a class=\"id\" href=\"#buffer\">buffer</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#read_user_buf_avail\">read_user_buf_avail</a> = <a class=\"id\" href=\"#buffer_len\">buffer_len</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#tomoyo_flush\">tomoyo_flush</a>(<a class=\"id\" href=\"#head\">head</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Call the policy handler. */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#read\">read</a>(<a class=\"id\" href=\"#head\">head</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_flush\">tomoyo_flush</a>(<a class=\"id\" href=\"#head\">head</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#len\">len</a> = <a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#read_user_buf\">read_user_buf</a> - <a class=\"id\" href=\"#buffer\">buffer</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_unlock\">mutex_unlock</a>(&amp;<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#io_sem\">io_sem</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#len\">len</a>;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * tomoyo_write_control - write() for /sys/kernel/security/tomoyo/ interface.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * @file:       Pointer to \"struct file\".</span>", 
"<span class=\"comment\"> * @buffer:     Pointer to buffer to read from.</span>", 
"<span class=\"comment\"> * @buffer_len: Size of @buffer.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Returns @buffer_len on success, negative value otherwise.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Caller holds tomoyo_read_lock().</span>", 
"<span class=\"comment\"> */</span>", 
"int <a class=\"id\" href=\"#tomoyo_write_control\">tomoyo_write_control</a>(struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#file\">file</a>, const char <a class=\"id\" href=\"#__user\">__user</a> *<a class=\"id\" href=\"#buffer\">buffer</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> const int <a class=\"id\" href=\"#buffer_len\">buffer_len</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_io_buffer\">tomoyo_io_buffer</a> *<a class=\"id\" href=\"#head\">head</a> = <a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#error\">error</a> = <a class=\"id\" href=\"#buffer_len\">buffer_len</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#avail_len\">avail_len</a> = <a class=\"id\" href=\"#buffer_len\">buffer_len</a>;", 
"<span class=\"ts\"/>char *<a class=\"id\" href=\"#cp0\">cp0</a> = <a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#write_buf\">write_buf</a>;", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#write\">write</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOSYS\">ENOSYS</a>;", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#access_ok\">access_ok</a>(<a class=\"id\" href=\"#VERIFY_READ\">VERIFY_READ</a>, <a class=\"id\" href=\"#buffer\">buffer</a>, <a class=\"id\" href=\"#buffer_len\">buffer_len</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EFAULT\">EFAULT</a>;", 
"<span class=\"ts\"/><span class=\"comment\">/* Don't allow updating policies by non manager programs. */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#write\">write</a> != <a class=\"id\" href=\"#tomoyo_write_pid\">tomoyo_write_pid</a> &&", 
"<span class=\"ts\"/>    <a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#write\">write</a> != <a class=\"id\" href=\"#tomoyo_write_domain\">tomoyo_write_domain</a> && !<a class=\"id\" href=\"#tomoyo_manager\">tomoyo_manager</a>())", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EPERM\">EPERM</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#mutex_lock_interruptible\">mutex_lock_interruptible</a>(&amp;<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#io_sem\">io_sem</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINTR\">EINTR</a>;", 
"<span class=\"ts\"/><span class=\"comment\">/* Read a line and dispatch it to the policy handler. */</span>", 
"<span class=\"ts\"/>while (<a class=\"id\" href=\"#avail_len\">avail_len</a> &gt; 0) {", 
"<span class=\"ts\"/><span class=\"ts\"/>char <a class=\"id\" href=\"#c\">c</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#write_avail\">write_avail</a> >= <a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#writebuf_size\">writebuf_size</a> - 1) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#error\">error</a> = -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>} else if (<a class=\"id\" href=\"#get_user\">get_user</a>(<a class=\"id\" href=\"#c\">c</a>, <a class=\"id\" href=\"#buffer\">buffer</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#error\">error</a> = -<a class=\"id\" href=\"#EFAULT\">EFAULT</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#buffer\">buffer</a>++;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#avail_len\">avail_len</a>--;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#cp0\">cp0</a>[<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#write_avail\">write_avail</a>++] = <a class=\"id\" href=\"#c\">c</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#c\">c</a> != '\\n')", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#cp0\">cp0</a>[<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#write_avail\">write_avail</a> - 1] = '\\0';", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#write_avail\">write_avail</a> = 0;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_normalize_line\">tomoyo_normalize_line</a>(<a class=\"id\" href=\"#cp0\">cp0</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#write\">write</a>(<a class=\"id\" href=\"#head\">head</a>);", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_unlock\">mutex_unlock</a>(&amp;<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#io_sem\">io_sem</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#error\">error</a>;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * tomoyo_close_control - close() for /sys/kernel/security/tomoyo/ interface.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * @file: Pointer to \"struct file\".</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Releases memory and returns 0.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Caller looses tomoyo_read_lock().</span>", 
"<span class=\"comment\"> */</span>", 
"int <a class=\"id\" href=\"#tomoyo_close_control\">tomoyo_close_control</a>(struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#file\">file</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_io_buffer\">tomoyo_io_buffer</a> *<a class=\"id\" href=\"#head\">head</a> = <a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#private_data\">private_data</a>;", 
"<span class=\"ts\"/>const <a class=\"id\" href=\"#bool\">bool</a> <a class=\"id\" href=\"#is_write\">is_write</a> = !!<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#write_buf\">write_buf</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * If the file is /sys/kernel/security/tomoyo/query , decrement the</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * observer counter.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#type\">type</a> == <a class=\"id\" href=\"#TOMOYO_QUERY\">TOMOYO_QUERY</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#atomic_dec\">atomic_dec</a>(&amp;<a class=\"id\" href=\"#tomoyo_query_observers\">tomoyo_query_observers</a>);", 
"<span class=\"ts\"/>else", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_read_unlock\">tomoyo_read_unlock</a>(<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#reader_idx\">reader_idx</a>);", 
"<span class=\"ts\"/><span class=\"comment\">/* Release memory used for policy I/O. */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#read_buf\">read_buf</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#read_buf\">read_buf</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#write_buf\">write_buf</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a>-><a class=\"id\" href=\"#write_buf\">write_buf</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#head\">head</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#head\">head</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#private_data\">private_data</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#is_write\">is_write</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_run_gc\">tomoyo_run_gc</a>();", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * tomoyo_check_profile - Check all profiles currently assigned to domains are defined.</span>", 
"<span class=\"comment\"> */</span>", 
"void <a class=\"id\" href=\"#tomoyo_check_profile\">tomoyo_check_profile</a>(void)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#tomoyo_domain_info\">tomoyo_domain_info</a> *<a class=\"id\" href=\"#domain\">domain</a>;", 
"<span class=\"ts\"/>const int <a class=\"id\" href=\"#idx\">idx</a> = <a class=\"id\" href=\"#tomoyo_read_lock\">tomoyo_read_lock</a>();", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_policy_loaded\">tomoyo_policy_loaded</a> = <a class=\"id\" href=\"#true\">true</a>;", 
"<span class=\"ts\"/><span class=\"comment\">/* Check all profiles currently assigned to domains are defined. */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_for_each_entry_rcu\">list_for_each_entry_rcu</a>(<a class=\"id\" href=\"#domain\">domain</a>, &amp;<a class=\"id\" href=\"#tomoyo_domain_list\">tomoyo_domain_list</a>, <a class=\"id\" href=\"#list\">list</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>const <a class=\"id\" href=\"#u8\">u8</a> <a class=\"id\" href=\"#profile\">profile</a> = <a class=\"id\" href=\"#domain\">domain</a>-><a class=\"id\" href=\"#profile\">profile</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#tomoyo_profile_ptr\">tomoyo_profile_ptr</a>[<a class=\"id\" href=\"#profile\">profile</a>])", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#panic\">panic</a>(\"Profile %u (used by '%s') not defined.\\n\",", 
"<span class=\"ts\"/><span class=\"ts\"/>      <a class=\"id\" href=\"#profile\">profile</a>, <a class=\"id\" href=\"#domain\">domain</a>-><a class=\"id\" href=\"#domainname\">domainname</a>-><a class=\"id\" href=\"#name\">name</a>);", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tomoyo_read_unlock\">tomoyo_read_unlock</a>(<a class=\"id\" href=\"#idx\">idx</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#tomoyo_profile_version\">tomoyo_profile_version</a> != 20090903)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#panic\">panic</a>(\"Profile version %u is not supported.\\n\",", 
"<span class=\"ts\"/><span class=\"ts\"/>      <a class=\"id\" href=\"#tomoyo_profile_version\">tomoyo_profile_version</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_INFO\">KERN_INFO</a> \"TOMOYO: 2.3.0\\n\");", 
"<span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_INFO\">KERN_INFO</a> \"Mandatory Access Control activated.\\n\");", 
"}", 
];
xr_frag_insert('l/8e/7bb9f329ee2600e6abe094547b1653138086ec.xr', __xr_tmp);
