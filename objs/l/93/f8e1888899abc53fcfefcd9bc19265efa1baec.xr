var __xr_tmp = [
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * linux/drivers/char/vc_screen.c</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Provide access to virtual console memory.</span>", 
"<span class=\"comment\"> * /dev/vcs0: the screen as it is being viewed right now (possibly scrolled)</span>", 
"<span class=\"comment\"> * /dev/vcsN: the screen of /dev/ttyN (1 &lt;= N &lt;= 63)</span>", 
"<span class=\"comment\"> *            [minor: N]</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * /dev/vcsaN: idem, but including attributes, and prefixed with</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>the 4 bytes lines,columns,x,y (as screendump used to give).</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>Attribute/character pair is in native endianity.</span>", 
"<span class=\"comment\"> *            [minor: N+128]</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * This replaces screendump and part of selection, so that the system</span>", 
"<span class=\"comment\"> * administrator can control access using file system permissions.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * aeb@cwi.nl - efter Friedas begravelse - 950211</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * machek@k332.feld.cvut.cz - modified not to send characters to wrong console</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/> - fixed some fatal off-by-one bugs (0-- no longer == -1 -&gt; looping and looping and looping...)</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/> - making it shorter - scr_readw are macros which expand in PRETTY long code</span>", 
"<span class=\"comment\"> */</span>", 
"", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#kernel\">kernel</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#major\">major</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#errno\">errno</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#tty\">tty</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#interrupt\">interrupt</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#mm\">mm</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#init\">init</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#mutex\">mutex</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#vt_kern\">vt_kern</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#selection\">selection</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#kbd_kern\">kbd_kern</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#console\">console</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#device\">device</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#smp_lock\">smp_lock</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#asm\">asm</a>/<a class=\"id\" href=\"#uaccess\">uaccess</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#asm\">asm</a>/<a class=\"id\" href=\"#byteorder\">byteorder</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#asm\">asm</a>/<a class=\"id\" href=\"#unaligned\">unaligned</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"", 
"#<a class=\"id\" href=\"#undef\">undef</a> <a class=\"id\" href=\"#attr\">attr</a>", 
"#<a class=\"id\" href=\"#undef\">undef</a> <a class=\"id\" href=\"#org\">org</a>", 
"#<a class=\"id\" href=\"#undef\">undef</a> <a class=\"id\" href=\"#addr\">addr</a>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#HEADER_SIZE\">HEADER_SIZE</a><span class=\"ts\"/>4", 
"", 
"static int", 
"<a class=\"id\" href=\"#vcs_size\">vcs_size</a>(struct <a class=\"id\" href=\"#inode\">inode</a> *<a class=\"id\" href=\"#inode\">inode</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#size\">size</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#minor\">minor</a> = <a class=\"id\" href=\"#iminor\">iminor</a>(<a class=\"id\" href=\"#inode\">inode</a>);", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#currcons\">currcons</a> = <a class=\"id\" href=\"#minor\">minor</a> &amp; 127;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#vc_data\">vc_data</a> *<a class=\"id\" href=\"#vc\">vc</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#currcons\">currcons</a> == 0)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#currcons\">currcons</a> = <a class=\"id\" href=\"#fg_console\">fg_console</a>;", 
"<span class=\"ts\"/>else", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#currcons\">currcons</a>--;", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#vc_cons_allocated\">vc_cons_allocated</a>(<a class=\"id\" href=\"#currcons\">currcons</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENXIO\">ENXIO</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#vc\">vc</a> = <a class=\"id\" href=\"#vc_cons\">vc_cons</a>[<a class=\"id\" href=\"#currcons\">currcons</a>].<a class=\"id\" href=\"#d\">d</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#size\">size</a> = <a class=\"id\" href=\"#vc\">vc</a>-><a class=\"id\" href=\"#vc_rows\">vc_rows</a> * <a class=\"id\" href=\"#vc\">vc</a>-><a class=\"id\" href=\"#vc_cols\">vc_cols</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#minor\">minor</a> &amp; 128)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#size\">size</a> = 2*<a class=\"id\" href=\"#size\">size</a> + <a class=\"id\" href=\"#HEADER_SIZE\">HEADER_SIZE</a>;", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#size\">size</a>;", 
"}", 
"", 
"static <a class=\"id\" href=\"#loff_t\">loff_t</a> <a class=\"id\" href=\"#vcs_lseek\">vcs_lseek</a>(struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#file\">file</a>, <a class=\"id\" href=\"#loff_t\">loff_t</a> <a class=\"id\" href=\"#offset\">offset</a>, int <a class=\"id\" href=\"#orig\">orig</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#size\">size</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_lock\">mutex_lock</a>(&amp;<a class=\"id\" href=\"#con_buf_mtx\">con_buf_mtx</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#size\">size</a> = <a class=\"id\" href=\"#vcs_size\">vcs_size</a>(<a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#f_path\">f_path</a>.<a class=\"id\" href=\"#dentry\">dentry</a>-><a class=\"id\" href=\"#d_inode\">d_inode</a>);", 
"<span class=\"ts\"/>switch (<a class=\"id\" href=\"#orig\">orig</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>default:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#mutex_unlock\">mutex_unlock</a>(&amp;<a class=\"id\" href=\"#con_buf_mtx\">con_buf_mtx</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>case 2:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#offset\">offset</a> += <a class=\"id\" href=\"#size\">size</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>case 1:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#offset\">offset</a> += <a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#f_pos\">f_pos</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>case 0:", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#offset\">offset</a> &lt; 0 || <a class=\"id\" href=\"#offset\">offset</a> &gt; <a class=\"id\" href=\"#size\">size</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#mutex_unlock\">mutex_unlock</a>(&amp;<a class=\"id\" href=\"#con_buf_mtx\">con_buf_mtx</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#f_pos\">f_pos</a> = <a class=\"id\" href=\"#offset\">offset</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_unlock\">mutex_unlock</a>(&amp;<a class=\"id\" href=\"#con_buf_mtx\">con_buf_mtx</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#f_pos\">f_pos</a>;", 
"}", 
"", 
"", 
"static <a class=\"id\" href=\"#ssize_t\">ssize_t</a>", 
"<a class=\"id\" href=\"#vcs_read\">vcs_read</a>(struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#file\">file</a>, char <a class=\"id\" href=\"#__user\">__user</a> *<a class=\"id\" href=\"#buf\">buf</a>, <a class=\"id\" href=\"#size_t\">size_t</a> <a class=\"id\" href=\"#count\">count</a>, <a class=\"id\" href=\"#loff_t\">loff_t</a> *<a class=\"id\" href=\"#ppos\">ppos</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#inode\">inode</a> *<a class=\"id\" href=\"#inode\">inode</a> = <a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#f_path\">f_path</a>.<a class=\"id\" href=\"#dentry\">dentry</a>-><a class=\"id\" href=\"#d_inode\">d_inode</a>;", 
"<span class=\"ts\"/>unsigned int <a class=\"id\" href=\"#currcons\">currcons</a> = <a class=\"id\" href=\"#iminor\">iminor</a>(<a class=\"id\" href=\"#inode\">inode</a>);", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#vc_data\">vc_data</a> *<a class=\"id\" href=\"#vc\">vc</a>;", 
"<span class=\"ts\"/>long <a class=\"id\" href=\"#pos\">pos</a>;", 
"<span class=\"ts\"/>long <a class=\"id\" href=\"#viewed\">viewed</a>, <a class=\"id\" href=\"#attr\">attr</a>, <a class=\"id\" href=\"#read\">read</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#col\">col</a>, <a class=\"id\" href=\"#maxcol\">maxcol</a>;", 
"<span class=\"ts\"/>unsigned short *<a class=\"id\" href=\"#org\">org</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ssize_t\">ssize_t</a> <a class=\"id\" href=\"#ret\">ret</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_lock\">mutex_lock</a>(&amp;<a class=\"id\" href=\"#con_buf_mtx\">con_buf_mtx</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pos\">pos</a> = *<a class=\"id\" href=\"#ppos\">ppos</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Select the proper current console and verify</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * sanity of the situation under the console lock.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#acquire_console_sem\">acquire_console_sem</a>();", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#attr\">attr</a> = (<a class=\"id\" href=\"#currcons\">currcons</a> &amp; 128);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#currcons\">currcons</a> = (<a class=\"id\" href=\"#currcons\">currcons</a> &amp; 127);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#currcons\">currcons</a> == 0) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#currcons\">currcons</a> = <a class=\"id\" href=\"#fg_console\">fg_console</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#viewed\">viewed</a> = 1;", 
"<span class=\"ts\"/>} else {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#currcons\">currcons</a>--;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#viewed\">viewed</a> = 0;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = -<a class=\"id\" href=\"#ENXIO\">ENXIO</a>;", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#vc_cons_allocated\">vc_cons_allocated</a>(<a class=\"id\" href=\"#currcons\">currcons</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#unlock_out\">unlock_out</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#vc\">vc</a> = <a class=\"id\" href=\"#vc_cons\">vc_cons</a>[<a class=\"id\" href=\"#currcons\">currcons</a>].<a class=\"id\" href=\"#d\">d</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#pos\">pos</a> &lt; 0)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#unlock_out\">unlock_out</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#read\">read</a> = 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = 0;", 
"<span class=\"ts\"/>while (<a class=\"id\" href=\"#count\">count</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>char *<a class=\"id\" href=\"#con_buf0\">con_buf0</a>, *<a class=\"id\" href=\"#con_buf_start\">con_buf_start</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>long <a class=\"id\" href=\"#this_round\">this_round</a>, <a class=\"id\" href=\"#size\">size</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ssize_t\">ssize_t</a> <a class=\"id\" href=\"#orig_count\">orig_count</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>long <a class=\"id\" href=\"#p\">p</a> = <a class=\"id\" href=\"#pos\">pos</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Check whether we are above size each round,</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * as copy_to_user at the end of this loop</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * could sleep.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#size\">size</a> = <a class=\"id\" href=\"#vcs_size\">vcs_size</a>(<a class=\"id\" href=\"#inode\">inode</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#pos\">pos</a> >= <a class=\"id\" href=\"#size\">size</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#count\">count</a> &gt; <a class=\"id\" href=\"#size\">size</a> - <a class=\"id\" href=\"#pos\">pos</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#count\">count</a> = <a class=\"id\" href=\"#size\">size</a> - <a class=\"id\" href=\"#pos\">pos</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#this_round\">this_round</a> = <a class=\"id\" href=\"#count\">count</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#this_round\">this_round</a> &gt; <a class=\"id\" href=\"#CON_BUF_SIZE\">CON_BUF_SIZE</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#this_round\">this_round</a> = <a class=\"id\" href=\"#CON_BUF_SIZE\">CON_BUF_SIZE</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Perform the whole read into the local con_buf.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * Then we can drop the console spinlock and safely</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * attempt to move it to userspace.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#con_buf_start\">con_buf_start</a> = <a class=\"id\" href=\"#con_buf0\">con_buf0</a> = <a class=\"id\" href=\"#con_buf\">con_buf</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#orig_count\">orig_count</a> = <a class=\"id\" href=\"#this_round\">this_round</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#maxcol\">maxcol</a> = <a class=\"id\" href=\"#vc\">vc</a>-><a class=\"id\" href=\"#vc_cols\">vc_cols</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#attr\">attr</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#org\">org</a> = <a class=\"id\" href=\"#screen_pos\">screen_pos</a>(<a class=\"id\" href=\"#vc\">vc</a>, <a class=\"id\" href=\"#p\">p</a>, <a class=\"id\" href=\"#viewed\">viewed</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#col\">col</a> = <a class=\"id\" href=\"#p\">p</a> % <a class=\"id\" href=\"#maxcol\">maxcol</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#p\">p</a> += <a class=\"id\" href=\"#maxcol\">maxcol</a> - <a class=\"id\" href=\"#col\">col</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>while (<a class=\"id\" href=\"#this_round\">this_round</a>-- &gt; 0) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>*<a class=\"id\" href=\"#con_buf0\">con_buf0</a>++ = (<a class=\"id\" href=\"#vcs_scr_readw\">vcs_scr_readw</a>(<a class=\"id\" href=\"#vc\">vc</a>, <a class=\"id\" href=\"#org\">org</a>++) &amp; 0xff);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (++<a class=\"id\" href=\"#col\">col</a> == <a class=\"id\" href=\"#maxcol\">maxcol</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#org\">org</a> = <a class=\"id\" href=\"#screen_pos\">screen_pos</a>(<a class=\"id\" href=\"#vc\">vc</a>, <a class=\"id\" href=\"#p\">p</a>, <a class=\"id\" href=\"#viewed\">viewed</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#col\">col</a> = 0;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#p\">p</a> += <a class=\"id\" href=\"#maxcol\">maxcol</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/>} else {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#p\">p</a> &lt; <a class=\"id\" href=\"#HEADER_SIZE\">HEADER_SIZE</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#size_t\">size_t</a> <a class=\"id\" href=\"#tmp_count\">tmp_count</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#con_buf0\">con_buf0</a>[0] = (char)<a class=\"id\" href=\"#vc\">vc</a>-><a class=\"id\" href=\"#vc_rows\">vc_rows</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#con_buf0\">con_buf0</a>[1] = (char)<a class=\"id\" href=\"#vc\">vc</a>-><a class=\"id\" href=\"#vc_cols\">vc_cols</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#getconsxy\">getconsxy</a>(<a class=\"id\" href=\"#vc\">vc</a>, <a class=\"id\" href=\"#con_buf0\">con_buf0</a> + 2);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#con_buf_start\">con_buf_start</a> += <a class=\"id\" href=\"#p\">p</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#this_round\">this_round</a> += <a class=\"id\" href=\"#p\">p</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#this_round\">this_round</a> &gt; <a class=\"id\" href=\"#CON_BUF_SIZE\">CON_BUF_SIZE</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#this_round\">this_round</a> = <a class=\"id\" href=\"#CON_BUF_SIZE\">CON_BUF_SIZE</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#orig_count\">orig_count</a> = <a class=\"id\" href=\"#this_round\">this_round</a> - <a class=\"id\" href=\"#p\">p</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tmp_count\">tmp_count</a> = <a class=\"id\" href=\"#HEADER_SIZE\">HEADER_SIZE</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#tmp_count\">tmp_count</a> &gt; <a class=\"id\" href=\"#this_round\">this_round</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tmp_count\">tmp_count</a> = <a class=\"id\" href=\"#this_round\">this_round</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Advance state pointers and move on. */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#this_round\">this_round</a> -= <a class=\"id\" href=\"#tmp_count\">tmp_count</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#p\">p</a> = <a class=\"id\" href=\"#HEADER_SIZE\">HEADER_SIZE</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#con_buf0\">con_buf0</a> = <a class=\"id\" href=\"#con_buf\">con_buf</a> + <a class=\"id\" href=\"#HEADER_SIZE\">HEADER_SIZE</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* If this_round &gt;= 0, then p is even... */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>} else if (<a class=\"id\" href=\"#p\">p</a> &amp; 1) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Skip first byte for output if start address is odd</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> * Update region sizes up/down depending on free</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> * space in buffer.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#con_buf_start\">con_buf_start</a>++;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#this_round\">this_round</a> &lt; <a class=\"id\" href=\"#CON_BUF_SIZE\">CON_BUF_SIZE</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#this_round\">this_round</a>++;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>else", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#orig_count\">orig_count</a>--;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#this_round\">this_round</a> &gt; 0) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>unsigned short *<a class=\"id\" href=\"#tmp_buf\">tmp_buf</a> = (unsigned short *)<a class=\"id\" href=\"#con_buf0\">con_buf0</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#p\">p</a> -= <a class=\"id\" href=\"#HEADER_SIZE\">HEADER_SIZE</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#p\">p</a> /= 2;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#col\">col</a> = <a class=\"id\" href=\"#p\">p</a> % <a class=\"id\" href=\"#maxcol\">maxcol</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#org\">org</a> = <a class=\"id\" href=\"#screen_pos\">screen_pos</a>(<a class=\"id\" href=\"#vc\">vc</a>, <a class=\"id\" href=\"#p\">p</a>, <a class=\"id\" href=\"#viewed\">viewed</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#p\">p</a> += <a class=\"id\" href=\"#maxcol\">maxcol</a> - <a class=\"id\" href=\"#col\">col</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Buffer has even length, so we can always copy</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> * character + attribute. We do not copy last byte</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> * to userspace if this_round is odd.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#this_round\">this_round</a> = (<a class=\"id\" href=\"#this_round\">this_round</a> + 1) >> 1;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>while (<a class=\"id\" href=\"#this_round\">this_round</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>*<a class=\"id\" href=\"#tmp_buf\">tmp_buf</a>++ = <a class=\"id\" href=\"#vcs_scr_readw\">vcs_scr_readw</a>(<a class=\"id\" href=\"#vc\">vc</a>, <a class=\"id\" href=\"#org\">org</a>++);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#this_round\">this_round</a> --;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (++<a class=\"id\" href=\"#col\">col</a> == <a class=\"id\" href=\"#maxcol\">maxcol</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#org\">org</a> = <a class=\"id\" href=\"#screen_pos\">screen_pos</a>(<a class=\"id\" href=\"#vc\">vc</a>, <a class=\"id\" href=\"#p\">p</a>, <a class=\"id\" href=\"#viewed\">viewed</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#col\">col</a> = 0;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#p\">p</a> += <a class=\"id\" href=\"#maxcol\">maxcol</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Finally, release the console semaphore while we push</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * all the data to userspace from our temporary buffer.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> *</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * AKPM: Even though it's a semaphore, we should drop it because</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * the pagefault handling code may want to call printk().</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#release_console_sem\">release_console_sem</a>();", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#copy_to_user\">copy_to_user</a>(<a class=\"id\" href=\"#buf\">buf</a>, <a class=\"id\" href=\"#con_buf_start\">con_buf_start</a>, <a class=\"id\" href=\"#orig_count\">orig_count</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#acquire_console_sem\">acquire_console_sem</a>();", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#ret\">ret</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#read\">read</a> += (<a class=\"id\" href=\"#orig_count\">orig_count</a> - <a class=\"id\" href=\"#ret\">ret</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = -<a class=\"id\" href=\"#EFAULT\">EFAULT</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#buf\">buf</a> += <a class=\"id\" href=\"#orig_count\">orig_count</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pos\">pos</a> += <a class=\"id\" href=\"#orig_count\">orig_count</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#read\">read</a> += <a class=\"id\" href=\"#orig_count\">orig_count</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#count\">count</a> -= <a class=\"id\" href=\"#orig_count\">orig_count</a>;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>*<a class=\"id\" href=\"#ppos\">ppos</a> += <a class=\"id\" href=\"#read\">read</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#read\">read</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#read\">read</a>;", 
"<a class=\"id\" href=\"#unlock_out\">unlock_out</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#release_console_sem\">release_console_sem</a>();", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_unlock\">mutex_unlock</a>(&amp;<a class=\"id\" href=\"#con_buf_mtx\">con_buf_mtx</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ret\">ret</a>;", 
"}", 
"", 
"static <a class=\"id\" href=\"#ssize_t\">ssize_t</a>", 
"<a class=\"id\" href=\"#vcs_write\">vcs_write</a>(struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#file\">file</a>, const char <a class=\"id\" href=\"#__user\">__user</a> *<a class=\"id\" href=\"#buf\">buf</a>, <a class=\"id\" href=\"#size_t\">size_t</a> <a class=\"id\" href=\"#count\">count</a>, <a class=\"id\" href=\"#loff_t\">loff_t</a> *<a class=\"id\" href=\"#ppos\">ppos</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#inode\">inode</a> *<a class=\"id\" href=\"#inode\">inode</a> = <a class=\"id\" href=\"#file\">file</a>-><a class=\"id\" href=\"#f_path\">f_path</a>.<a class=\"id\" href=\"#dentry\">dentry</a>-><a class=\"id\" href=\"#d_inode\">d_inode</a>;", 
"<span class=\"ts\"/>unsigned int <a class=\"id\" href=\"#currcons\">currcons</a> = <a class=\"id\" href=\"#iminor\">iminor</a>(<a class=\"id\" href=\"#inode\">inode</a>);", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#vc_data\">vc_data</a> *<a class=\"id\" href=\"#vc\">vc</a>;", 
"<span class=\"ts\"/>long <a class=\"id\" href=\"#pos\">pos</a>;", 
"<span class=\"ts\"/>long <a class=\"id\" href=\"#viewed\">viewed</a>, <a class=\"id\" href=\"#attr\">attr</a>, <a class=\"id\" href=\"#size\">size</a>, <a class=\"id\" href=\"#written\">written</a>;", 
"<span class=\"ts\"/>char *<a class=\"id\" href=\"#con_buf0\">con_buf0</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#col\">col</a>, <a class=\"id\" href=\"#maxcol\">maxcol</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> *<a class=\"id\" href=\"#org0\">org0</a> = <a class=\"id\" href=\"#NULL\">NULL</a>, *<a class=\"id\" href=\"#org\">org</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#size_t\">size_t</a> <a class=\"id\" href=\"#ret\">ret</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_lock\">mutex_lock</a>(&amp;<a class=\"id\" href=\"#con_buf_mtx\">con_buf_mtx</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pos\">pos</a> = *<a class=\"id\" href=\"#ppos\">ppos</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Select the proper current console and verify</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * sanity of the situation under the console lock.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#acquire_console_sem\">acquire_console_sem</a>();", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#attr\">attr</a> = (<a class=\"id\" href=\"#currcons\">currcons</a> &amp; 128);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#currcons\">currcons</a> = (<a class=\"id\" href=\"#currcons\">currcons</a> &amp; 127);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#currcons\">currcons</a> == 0) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#currcons\">currcons</a> = <a class=\"id\" href=\"#fg_console\">fg_console</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#viewed\">viewed</a> = 1;", 
"<span class=\"ts\"/>} else {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#currcons\">currcons</a>--;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#viewed\">viewed</a> = 0;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = -<a class=\"id\" href=\"#ENXIO\">ENXIO</a>;", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#vc_cons_allocated\">vc_cons_allocated</a>(<a class=\"id\" href=\"#currcons\">currcons</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#unlock_out\">unlock_out</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#vc\">vc</a> = <a class=\"id\" href=\"#vc_cons\">vc_cons</a>[<a class=\"id\" href=\"#currcons\">currcons</a>].<a class=\"id\" href=\"#d\">d</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#size\">size</a> = <a class=\"id\" href=\"#vcs_size\">vcs_size</a>(<a class=\"id\" href=\"#inode\">inode</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#pos\">pos</a> &lt; 0 || <a class=\"id\" href=\"#pos\">pos</a> &gt; <a class=\"id\" href=\"#size\">size</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#unlock_out\">unlock_out</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#count\">count</a> &gt; <a class=\"id\" href=\"#size\">size</a> - <a class=\"id\" href=\"#pos\">pos</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#count\">count</a> = <a class=\"id\" href=\"#size\">size</a> - <a class=\"id\" href=\"#pos\">pos</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#written\">written</a> = 0;", 
"<span class=\"ts\"/>while (<a class=\"id\" href=\"#count\">count</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>long <a class=\"id\" href=\"#this_round\">this_round</a> = <a class=\"id\" href=\"#count\">count</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#size_t\">size_t</a> <a class=\"id\" href=\"#orig_count\">orig_count</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>long <a class=\"id\" href=\"#p\">p</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#this_round\">this_round</a> &gt; <a class=\"id\" href=\"#CON_BUF_SIZE\">CON_BUF_SIZE</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#this_round\">this_round</a> = <a class=\"id\" href=\"#CON_BUF_SIZE\">CON_BUF_SIZE</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Temporarily drop the console lock so that we can read</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * in the write data from userspace safely.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#release_console_sem\">release_console_sem</a>();", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#copy_from_user\">copy_from_user</a>(<a class=\"id\" href=\"#con_buf\">con_buf</a>, <a class=\"id\" href=\"#buf\">buf</a>, <a class=\"id\" href=\"#this_round\">this_round</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#acquire_console_sem\">acquire_console_sem</a>();", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#ret\">ret</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#this_round\">this_round</a> -= <a class=\"id\" href=\"#ret\">ret</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#this_round\">this_round</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Abort loop if no data were copied. Otherwise</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> * fail with -EFAULT.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#written\">written</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = -<a class=\"id\" href=\"#EFAULT\">EFAULT</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#unlock_out\">unlock_out</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* The vcs_size might have changed while we slept to grab</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * the user buffer, so recheck.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * Return data written up to now on failure.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#size\">size</a> = <a class=\"id\" href=\"#vcs_size\">vcs_size</a>(<a class=\"id\" href=\"#inode\">inode</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#pos\">pos</a> >= <a class=\"id\" href=\"#size\">size</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#this_round\">this_round</a> &gt; <a class=\"id\" href=\"#size\">size</a> - <a class=\"id\" href=\"#pos\">pos</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#this_round\">this_round</a> = <a class=\"id\" href=\"#size\">size</a> - <a class=\"id\" href=\"#pos\">pos</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* OK, now actually push the write to the console</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * under the lock using the local kernel buffer.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#con_buf0\">con_buf0</a> = <a class=\"id\" href=\"#con_buf\">con_buf</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#orig_count\">orig_count</a> = <a class=\"id\" href=\"#this_round\">this_round</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#maxcol\">maxcol</a> = <a class=\"id\" href=\"#vc\">vc</a>-><a class=\"id\" href=\"#vc_cols\">vc_cols</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#p\">p</a> = <a class=\"id\" href=\"#pos\">pos</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#attr\">attr</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#org0\">org0</a> = <a class=\"id\" href=\"#org\">org</a> = <a class=\"id\" href=\"#screen_pos\">screen_pos</a>(<a class=\"id\" href=\"#vc\">vc</a>, <a class=\"id\" href=\"#p\">p</a>, <a class=\"id\" href=\"#viewed\">viewed</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#col\">col</a> = <a class=\"id\" href=\"#p\">p</a> % <a class=\"id\" href=\"#maxcol\">maxcol</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#p\">p</a> += <a class=\"id\" href=\"#maxcol\">maxcol</a> - <a class=\"id\" href=\"#col\">col</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>while (<a class=\"id\" href=\"#this_round\">this_round</a> &gt; 0) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>unsigned char <a class=\"id\" href=\"#c\">c</a> = *<a class=\"id\" href=\"#con_buf0\">con_buf0</a>++;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#this_round\">this_round</a>--;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#vcs_scr_writew\">vcs_scr_writew</a>(<a class=\"id\" href=\"#vc\">vc</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       (<a class=\"id\" href=\"#vcs_scr_readw\">vcs_scr_readw</a>(<a class=\"id\" href=\"#vc\">vc</a>, <a class=\"id\" href=\"#org\">org</a>) &amp; 0xff00) | <a class=\"id\" href=\"#c\">c</a>, <a class=\"id\" href=\"#org\">org</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#org\">org</a>++;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (++<a class=\"id\" href=\"#col\">col</a> == <a class=\"id\" href=\"#maxcol\">maxcol</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#org\">org</a> = <a class=\"id\" href=\"#screen_pos\">screen_pos</a>(<a class=\"id\" href=\"#vc\">vc</a>, <a class=\"id\" href=\"#p\">p</a>, <a class=\"id\" href=\"#viewed\">viewed</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#col\">col</a> = 0;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#p\">p</a> += <a class=\"id\" href=\"#maxcol\">maxcol</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/>} else {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#p\">p</a> &lt; <a class=\"id\" href=\"#HEADER_SIZE\">HEADER_SIZE</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>char <a class=\"id\" href=\"#header\">header</a>[<a class=\"id\" href=\"#HEADER_SIZE\">HEADER_SIZE</a>];", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#getconsxy\">getconsxy</a>(<a class=\"id\" href=\"#vc\">vc</a>, <a class=\"id\" href=\"#header\">header</a> + 2);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>while (<a class=\"id\" href=\"#p\">p</a> &lt; <a class=\"id\" href=\"#HEADER_SIZE\">HEADER_SIZE</a> && <a class=\"id\" href=\"#this_round\">this_round</a> &gt; 0) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#this_round\">this_round</a>--;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#header\">header</a>[<a class=\"id\" href=\"#p\">p</a>++] = *<a class=\"id\" href=\"#con_buf0\">con_buf0</a>++;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#viewed\">viewed</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#putconsxy\">putconsxy</a>(<a class=\"id\" href=\"#vc\">vc</a>, <a class=\"id\" href=\"#header\">header</a> + 2);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#p\">p</a> -= <a class=\"id\" href=\"#HEADER_SIZE\">HEADER_SIZE</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#col\">col</a> = (<a class=\"id\" href=\"#p\">p</a>/2) % <a class=\"id\" href=\"#maxcol\">maxcol</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#this_round\">this_round</a> &gt; 0) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#org0\">org0</a> = <a class=\"id\" href=\"#org\">org</a> = <a class=\"id\" href=\"#screen_pos\">screen_pos</a>(<a class=\"id\" href=\"#vc\">vc</a>, <a class=\"id\" href=\"#p\">p</a>/2, <a class=\"id\" href=\"#viewed\">viewed</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if ((<a class=\"id\" href=\"#p\">p</a> &amp; 1) && <a class=\"id\" href=\"#this_round\">this_round</a> &gt; 0) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>char <a class=\"id\" href=\"#c\">c</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#this_round\">this_round</a>--;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#c\">c</a> = *<a class=\"id\" href=\"#con_buf0\">con_buf0</a>++;", 
"#<a class=\"id\" href=\"#ifdef\">ifdef</a> <a class=\"id\" href=\"#__BIG_ENDIAN\">__BIG_ENDIAN</a>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#vcs_scr_writew\">vcs_scr_writew</a>(<a class=\"id\" href=\"#vc\">vc</a>, <a class=\"id\" href=\"#c\">c</a> |", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>     (<a class=\"id\" href=\"#vcs_scr_readw\">vcs_scr_readw</a>(<a class=\"id\" href=\"#vc\">vc</a>, <a class=\"id\" href=\"#org\">org</a>) &amp; 0xff00), <a class=\"id\" href=\"#org\">org</a>);", 
"#else", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#vcs_scr_writew\">vcs_scr_writew</a>(<a class=\"id\" href=\"#vc\">vc</a>, (<a class=\"id\" href=\"#c\">c</a> << 8) |", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>     (<a class=\"id\" href=\"#vcs_scr_readw\">vcs_scr_readw</a>(<a class=\"id\" href=\"#vc\">vc</a>, <a class=\"id\" href=\"#org\">org</a>) &amp; 0xff), <a class=\"id\" href=\"#org\">org</a>);", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#org\">org</a>++;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#p\">p</a>++;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (++<a class=\"id\" href=\"#col\">col</a> == <a class=\"id\" href=\"#maxcol\">maxcol</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#org\">org</a> = <a class=\"id\" href=\"#screen_pos\">screen_pos</a>(<a class=\"id\" href=\"#vc\">vc</a>, <a class=\"id\" href=\"#p\">p</a>/2, <a class=\"id\" href=\"#viewed\">viewed</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#col\">col</a> = 0;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#p\">p</a> /= 2;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#p\">p</a> += <a class=\"id\" href=\"#maxcol\">maxcol</a> - <a class=\"id\" href=\"#col\">col</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>while (<a class=\"id\" href=\"#this_round\">this_round</a> &gt; 1) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>unsigned short <a class=\"id\" href=\"#w\">w</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#w\">w</a> = <a class=\"id\" href=\"#get_unaligned\">get_unaligned</a>(((unsigned short *)<a class=\"id\" href=\"#con_buf0\">con_buf0</a>));", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#vcs_scr_writew\">vcs_scr_writew</a>(<a class=\"id\" href=\"#vc\">vc</a>, <a class=\"id\" href=\"#w\">w</a>, <a class=\"id\" href=\"#org\">org</a>++);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#con_buf0\">con_buf0</a> += 2;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#this_round\">this_round</a> -= 2;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (++<a class=\"id\" href=\"#col\">col</a> == <a class=\"id\" href=\"#maxcol\">maxcol</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#org\">org</a> = <a class=\"id\" href=\"#screen_pos\">screen_pos</a>(<a class=\"id\" href=\"#vc\">vc</a>, <a class=\"id\" href=\"#p\">p</a>, <a class=\"id\" href=\"#viewed\">viewed</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#col\">col</a> = 0;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#p\">p</a> += <a class=\"id\" href=\"#maxcol\">maxcol</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#this_round\">this_round</a> &gt; 0) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>unsigned char <a class=\"id\" href=\"#c\">c</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#c\">c</a> = *<a class=\"id\" href=\"#con_buf0\">con_buf0</a>++;", 
"#<a class=\"id\" href=\"#ifdef\">ifdef</a> <a class=\"id\" href=\"#__BIG_ENDIAN\">__BIG_ENDIAN</a>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#vcs_scr_writew\">vcs_scr_writew</a>(<a class=\"id\" href=\"#vc\">vc</a>, (<a class=\"id\" href=\"#vcs_scr_readw\">vcs_scr_readw</a>(<a class=\"id\" href=\"#vc\">vc</a>, <a class=\"id\" href=\"#org\">org</a>) &amp; 0xff) | (<a class=\"id\" href=\"#c\">c</a> << 8), <a class=\"id\" href=\"#org\">org</a>);", 
"#else", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#vcs_scr_writew\">vcs_scr_writew</a>(<a class=\"id\" href=\"#vc\">vc</a>, (<a class=\"id\" href=\"#vcs_scr_readw\">vcs_scr_readw</a>(<a class=\"id\" href=\"#vc\">vc</a>, <a class=\"id\" href=\"#org\">org</a>) &amp; 0xff00) | <a class=\"id\" href=\"#c\">c</a>, <a class=\"id\" href=\"#org\">org</a>);", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#count\">count</a> -= <a class=\"id\" href=\"#orig_count\">orig_count</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#written\">written</a> += <a class=\"id\" href=\"#orig_count\">orig_count</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#buf\">buf</a> += <a class=\"id\" href=\"#orig_count\">orig_count</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pos\">pos</a> += <a class=\"id\" href=\"#orig_count\">orig_count</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#org0\">org0</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#update_region\">update_region</a>(<a class=\"id\" href=\"#vc\">vc</a>, (unsigned long)(<a class=\"id\" href=\"#org0\">org0</a>), <a class=\"id\" href=\"#org\">org</a> - <a class=\"id\" href=\"#org0\">org0</a>);", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>*<a class=\"id\" href=\"#ppos\">ppos</a> += <a class=\"id\" href=\"#written\">written</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#written\">written</a>;", 
"", 
"<a class=\"id\" href=\"#unlock_out\">unlock_out</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#release_console_sem\">release_console_sem</a>();", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_unlock\">mutex_unlock</a>(&amp;<a class=\"id\" href=\"#con_buf_mtx\">con_buf_mtx</a>);", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ret\">ret</a>;", 
"}", 
"", 
"static int", 
"<a class=\"id\" href=\"#vcs_open\">vcs_open</a>(struct <a class=\"id\" href=\"#inode\">inode</a> *<a class=\"id\" href=\"#inode\">inode</a>, struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#filp\">filp</a>)", 
"{", 
"<span class=\"ts\"/>unsigned int <a class=\"id\" href=\"#currcons\">currcons</a> = <a class=\"id\" href=\"#iminor\">iminor</a>(<a class=\"id\" href=\"#inode\">inode</a>) &amp; 127;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#ret\">ret</a> = 0;", 
"<span class=\"ts\"/>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tty_lock\">tty_lock</a>();", 
"<span class=\"ts\"/>if(<a class=\"id\" href=\"#currcons\">currcons</a> && !<a class=\"id\" href=\"#vc_cons_allocated\">vc_cons_allocated</a>(<a class=\"id\" href=\"#currcons\">currcons</a>-1))", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = -<a class=\"id\" href=\"#ENXIO\">ENXIO</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tty_unlock\">tty_unlock</a>();", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ret\">ret</a>;", 
"}", 
"", 
"static const struct <a class=\"id\" href=\"#file_operations\">file_operations</a> <a class=\"id\" href=\"#vcs_fops\">vcs_fops</a> = {", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#llseek\">llseek</a><span class=\"ts\"/><span class=\"ts\"/>= <a class=\"id\" href=\"#vcs_lseek\">vcs_lseek</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#read\">read</a><span class=\"ts\"/><span class=\"ts\"/>= <a class=\"id\" href=\"#vcs_read\">vcs_read</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#write\">write</a><span class=\"ts\"/><span class=\"ts\"/>= <a class=\"id\" href=\"#vcs_write\">vcs_write</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#open\">open</a><span class=\"ts\"/><span class=\"ts\"/>= <a class=\"id\" href=\"#vcs_open\">vcs_open</a>,", 
"};", 
"", 
"static struct <a class=\"id\" href=\"#class\">class</a> *<a class=\"id\" href=\"#vc_class\">vc_class</a>;", 
"", 
"void <a class=\"id\" href=\"#vcs_make_sysfs\">vcs_make_sysfs</a>(int <a class=\"id\" href=\"#index\">index</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#device_create\">device_create</a>(<a class=\"id\" href=\"#vc_class\">vc_class</a>, <a class=\"id\" href=\"#NULL\">NULL</a>, <a class=\"id\" href=\"#MKDEV\">MKDEV</a>(<a class=\"id\" href=\"#VCS_MAJOR\">VCS_MAJOR</a>, <a class=\"id\" href=\"#index\">index</a> + 1), <a class=\"id\" href=\"#NULL\">NULL</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/>      \"vcs%u\", <a class=\"id\" href=\"#index\">index</a> + 1);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#device_create\">device_create</a>(<a class=\"id\" href=\"#vc_class\">vc_class</a>, <a class=\"id\" href=\"#NULL\">NULL</a>, <a class=\"id\" href=\"#MKDEV\">MKDEV</a>(<a class=\"id\" href=\"#VCS_MAJOR\">VCS_MAJOR</a>, <a class=\"id\" href=\"#index\">index</a> + 129), <a class=\"id\" href=\"#NULL\">NULL</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/>      \"vcsa%u\", <a class=\"id\" href=\"#index\">index</a> + 1);", 
"}", 
"", 
"void <a class=\"id\" href=\"#vcs_remove_sysfs\">vcs_remove_sysfs</a>(int <a class=\"id\" href=\"#index\">index</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#device_destroy\">device_destroy</a>(<a class=\"id\" href=\"#vc_class\">vc_class</a>, <a class=\"id\" href=\"#MKDEV\">MKDEV</a>(<a class=\"id\" href=\"#VCS_MAJOR\">VCS_MAJOR</a>, <a class=\"id\" href=\"#index\">index</a> + 1));", 
"<span class=\"ts\"/><a class=\"id\" href=\"#device_destroy\">device_destroy</a>(<a class=\"id\" href=\"#vc_class\">vc_class</a>, <a class=\"id\" href=\"#MKDEV\">MKDEV</a>(<a class=\"id\" href=\"#VCS_MAJOR\">VCS_MAJOR</a>, <a class=\"id\" href=\"#index\">index</a> + 129));", 
"}", 
"", 
"int <a class=\"id\" href=\"#__init\">__init</a> <a class=\"id\" href=\"#vcs_init\">vcs_init</a>(void)", 
"{", 
"<span class=\"ts\"/>unsigned int <a class=\"id\" href=\"#i\">i</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#register_chrdev\">register_chrdev</a>(<a class=\"id\" href=\"#VCS_MAJOR\">VCS_MAJOR</a>, \"vcs\", &amp;<a class=\"id\" href=\"#vcs_fops\">vcs_fops</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#panic\">panic</a>(\"unable to get major %d for vcs device\", <a class=\"id\" href=\"#VCS_MAJOR\">VCS_MAJOR</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#vc_class\">vc_class</a> = <a class=\"id\" href=\"#class_create\">class_create</a>(<a class=\"id\" href=\"#THIS_MODULE\">THIS_MODULE</a>, \"vc\");", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#device_create\">device_create</a>(<a class=\"id\" href=\"#vc_class\">vc_class</a>, <a class=\"id\" href=\"#NULL\">NULL</a>, <a class=\"id\" href=\"#MKDEV\">MKDEV</a>(<a class=\"id\" href=\"#VCS_MAJOR\">VCS_MAJOR</a>, 0), <a class=\"id\" href=\"#NULL\">NULL</a>, \"vcs\");", 
"<span class=\"ts\"/><a class=\"id\" href=\"#device_create\">device_create</a>(<a class=\"id\" href=\"#vc_class\">vc_class</a>, <a class=\"id\" href=\"#NULL\">NULL</a>, <a class=\"id\" href=\"#MKDEV\">MKDEV</a>(<a class=\"id\" href=\"#VCS_MAJOR\">VCS_MAJOR</a>, 128), <a class=\"id\" href=\"#NULL\">NULL</a>, \"vcsa\");", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = 0; <a class=\"id\" href=\"#i\">i</a> &lt; <a class=\"id\" href=\"#MIN_NR_CONSOLES\">MIN_NR_CONSOLES</a>; <a class=\"id\" href=\"#i\">i</a>++)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#vcs_make_sysfs\">vcs_make_sysfs</a>(<a class=\"id\" href=\"#i\">i</a>);", 
"<span class=\"ts\"/>return 0;", 
"}", 
];
xr_frag_insert('l/93/f8e1888899abc53fcfefcd9bc19265efa1baec.xr', __xr_tmp);
