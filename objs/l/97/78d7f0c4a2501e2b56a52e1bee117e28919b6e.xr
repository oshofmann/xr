var __xr_tmp = [
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>\"JBD2: Detected IO errors while flushing file data \"", 
"<span class=\"ts\"/><span class=\"ts\"/>       \"on %s\\n\", <a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_devname\">j_devname</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_flags\">j_flags</a> &amp; <a class=\"id\" href=\"#JBD2_ABORT_ON_SYNCDATA_ERR\">JBD2_ABORT_ON_SYNCDATA_ERR</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jbd2_journal_abort\">jbd2_journal_abort</a>(<a class=\"id\" href=\"#journal\">journal</a>, <a class=\"id\" href=\"#err\">err</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = 0;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Lo and behold: we have just managed to send a transaction to</span>", 
"<span class=\"comment\">           the log.  Before we can commit it, wait for the IO so far to</span>", 
"<span class=\"comment\">           complete.  Control buffers being written are on the</span>", 
"<span class=\"comment\">           transaction's t_log_list queue, and metadata buffers are on</span>", 
"<span class=\"comment\">           the t_iobuf_list queue.</span>", 
"<span class=\"comment\"></span>", 
"<span class=\"comment\"><span class=\"ts\"/>   Wait for the buffers in reverse order.  That way we are</span>", 
"<span class=\"comment\"><span class=\"ts\"/>   less likely to be woken up until all IOs have completed, and</span>", 
"<span class=\"comment\"><span class=\"ts\"/>   so we incur less scheduling load.</span>", 
"<span class=\"comment\"><span class=\"ts\"/>*/</span>", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#jbd_debug\">jbd_debug</a>(3, \"JBD: commit phase 3\\n\");", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * akpm: these are BJ_IO, and j_list_lock is not needed.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * See __journal_try_to_free_buffer.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<a class=\"id\" href=\"#wait_for_iobuf\">wait_for_iobuf</a>:", 
"<span class=\"ts\"/>while (<a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>-><a class=\"id\" href=\"#t_iobuf_list\">t_iobuf_list</a> != <a class=\"id\" href=\"#NULL\">NULL</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#buffer_head\">buffer_head</a> *<a class=\"id\" href=\"#bh\">bh</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jh\">jh</a> = <a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>-><a class=\"id\" href=\"#t_iobuf_list\">t_iobuf_list</a>-><a class=\"id\" href=\"#b_tprev\">b_tprev</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bh\">bh</a> = <a class=\"id\" href=\"#jh2bh\">jh2bh</a>(<a class=\"id\" href=\"#jh\">jh</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#buffer_locked\">buffer_locked</a>(<a class=\"id\" href=\"#bh\">bh</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#wait_on_buffer\">wait_on_buffer</a>(<a class=\"id\" href=\"#bh\">bh</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#wait_for_iobuf\">wait_for_iobuf</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#cond_resched\">cond_resched</a>())", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#wait_for_iobuf\">wait_for_iobuf</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#unlikely\">unlikely</a>(!<a class=\"id\" href=\"#buffer_uptodate\">buffer_uptodate</a>(<a class=\"id\" href=\"#bh\">bh</a>)))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#EIO\">EIO</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#clear_buffer_jwrite\">clear_buffer_jwrite</a>(<a class=\"id\" href=\"#bh\">bh</a>);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#JBUFFER_TRACE\">JBUFFER_TRACE</a>(<a class=\"id\" href=\"#jh\">jh</a>, \"ph4: unfile after journal write\");", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jbd2_journal_unfile_buffer\">jbd2_journal_unfile_buffer</a>(<a class=\"id\" href=\"#journal\">journal</a>, <a class=\"id\" href=\"#jh\">jh</a>);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * -&gt;t_iobuf_list should contain only dummy buffer_heads</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * which were created by jbd2_journal_write_metadata_buffer().</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#BUFFER_TRACE\">BUFFER_TRACE</a>(<a class=\"id\" href=\"#bh\">bh</a>, \"dumping temporary bh\");", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jbd2_journal_put_journal_head\">jbd2_journal_put_journal_head</a>(<a class=\"id\" href=\"#jh\">jh</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#__brelse\">__brelse</a>(<a class=\"id\" href=\"#bh\">bh</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#J_ASSERT_BH\">J_ASSERT_BH</a>(<a class=\"id\" href=\"#bh\">bh</a>, <a class=\"id\" href=\"#atomic_read\">atomic_read</a>(&amp;<a class=\"id\" href=\"#bh\">bh</a>-><a class=\"id\" href=\"#b_count\">b_count</a>) == 0);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#free_buffer_head\">free_buffer_head</a>(<a class=\"id\" href=\"#bh\">bh</a>);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* We also have to unlock and free the corresponding</span>", 
"<span class=\"comment\">                   shadowed buffer */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jh\">jh</a> = <a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>-><a class=\"id\" href=\"#t_shadow_list\">t_shadow_list</a>-><a class=\"id\" href=\"#b_tprev\">b_tprev</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bh\">bh</a> = <a class=\"id\" href=\"#jh2bh\">jh2bh</a>(<a class=\"id\" href=\"#jh\">jh</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#clear_bit\">clear_bit</a>(<a class=\"id\" href=\"#BH_JWrite\">BH_JWrite</a>, &amp;<a class=\"id\" href=\"#bh\">bh</a>-><a class=\"id\" href=\"#b_state\">b_state</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#J_ASSERT_BH\">J_ASSERT_BH</a>(<a class=\"id\" href=\"#bh\">bh</a>, <a class=\"id\" href=\"#buffer_jbddirty\">buffer_jbddirty</a>(<a class=\"id\" href=\"#bh\">bh</a>));", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* The metadata is now released for reuse, but we need</span>", 
"<span class=\"comment\">                   to remember it against this transaction so that when</span>", 
"<span class=\"comment\">                   we finally commit, we can do any checkpointing</span>", 
"<span class=\"comment\">                   required. */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#JBUFFER_TRACE\">JBUFFER_TRACE</a>(<a class=\"id\" href=\"#jh\">jh</a>, \"file as BJ_Forget\");", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jbd2_journal_file_buffer\">jbd2_journal_file_buffer</a>(<a class=\"id\" href=\"#jh\">jh</a>, <a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>, <a class=\"id\" href=\"#BJ_Forget\">BJ_Forget</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Wake up any transactions which were waiting for this</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/>   IO to complete */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#wake_up_bit\">wake_up_bit</a>(&amp;<a class=\"id\" href=\"#bh\">bh</a>-><a class=\"id\" href=\"#b_state\">b_state</a>, <a class=\"id\" href=\"#BH_Unshadow\">BH_Unshadow</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#JBUFFER_TRACE\">JBUFFER_TRACE</a>(<a class=\"id\" href=\"#jh\">jh</a>, \"brelse shadowed buffer\");", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#__brelse\">__brelse</a>(<a class=\"id\" href=\"#bh\">bh</a>);", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#J_ASSERT\">J_ASSERT</a> (<a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>-><a class=\"id\" href=\"#t_shadow_list\">t_shadow_list</a> == <a class=\"id\" href=\"#NULL\">NULL</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#jbd_debug\">jbd_debug</a>(3, \"JBD: commit phase 4\\n\");", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Here we wait for the revoke record and descriptor record buffers */</span>", 
" <a class=\"id\" href=\"#wait_for_ctlbuf\">wait_for_ctlbuf</a>:", 
"<span class=\"ts\"/>while (<a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>-><a class=\"id\" href=\"#t_log_list\">t_log_list</a> != <a class=\"id\" href=\"#NULL\">NULL</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#buffer_head\">buffer_head</a> *<a class=\"id\" href=\"#bh\">bh</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jh\">jh</a> = <a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>-><a class=\"id\" href=\"#t_log_list\">t_log_list</a>-><a class=\"id\" href=\"#b_tprev\">b_tprev</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bh\">bh</a> = <a class=\"id\" href=\"#jh2bh\">jh2bh</a>(<a class=\"id\" href=\"#jh\">jh</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#buffer_locked\">buffer_locked</a>(<a class=\"id\" href=\"#bh\">bh</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#wait_on_buffer\">wait_on_buffer</a>(<a class=\"id\" href=\"#bh\">bh</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#wait_for_ctlbuf\">wait_for_ctlbuf</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#cond_resched\">cond_resched</a>())", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#wait_for_ctlbuf\">wait_for_ctlbuf</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#unlikely\">unlikely</a>(!<a class=\"id\" href=\"#buffer_uptodate\">buffer_uptodate</a>(<a class=\"id\" href=\"#bh\">bh</a>)))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = -<a class=\"id\" href=\"#EIO\">EIO</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#BUFFER_TRACE\">BUFFER_TRACE</a>(<a class=\"id\" href=\"#bh\">bh</a>, \"ph5: control buffer writeout done: unfile\");", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#clear_buffer_jwrite\">clear_buffer_jwrite</a>(<a class=\"id\" href=\"#bh\">bh</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jbd2_journal_unfile_buffer\">jbd2_journal_unfile_buffer</a>(<a class=\"id\" href=\"#journal\">journal</a>, <a class=\"id\" href=\"#jh\">jh</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jbd2_journal_put_journal_head\">jbd2_journal_put_journal_head</a>(<a class=\"id\" href=\"#jh\">jh</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#__brelse\">__brelse</a>(<a class=\"id\" href=\"#bh\">bh</a>);<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* One for getblk */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* AKPM: bforget here */</span>", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#err\">err</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jbd2_journal_abort\">jbd2_journal_abort</a>(<a class=\"id\" href=\"#journal\">journal</a>, <a class=\"id\" href=\"#err\">err</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#jbd_debug\">jbd_debug</a>(3, \"JBD: commit phase 5\\n\");", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#JBD2_HAS_INCOMPAT_FEATURE\">JBD2_HAS_INCOMPAT_FEATURE</a>(<a class=\"id\" href=\"#journal\">journal</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       <a class=\"id\" href=\"#JBD2_FEATURE_INCOMPAT_ASYNC_COMMIT\">JBD2_FEATURE_INCOMPAT_ASYNC_COMMIT</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = <a class=\"id\" href=\"#journal_submit_commit_record\">journal_submit_commit_record</a>(<a class=\"id\" href=\"#journal\">journal</a>, <a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>&amp;<a class=\"id\" href=\"#cbh\">cbh</a>, <a class=\"id\" href=\"#crc32_sum\">crc32_sum</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#err\">err</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#__jbd2_journal_abort_hard\">__jbd2_journal_abort_hard</a>(<a class=\"id\" href=\"#journal\">journal</a>);", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#err\">err</a> && !<a class=\"id\" href=\"#is_journal_aborted\">is_journal_aborted</a>(<a class=\"id\" href=\"#journal\">journal</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = <a class=\"id\" href=\"#journal_wait_on_commit_record\">journal_wait_on_commit_record</a>(<a class=\"id\" href=\"#journal\">journal</a>, <a class=\"id\" href=\"#cbh\">cbh</a>);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#err\">err</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jbd2_journal_abort\">jbd2_journal_abort</a>(<a class=\"id\" href=\"#journal\">journal</a>, <a class=\"id\" href=\"#err\">err</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* End of a transaction!  Finally, we can do checkpoint</span>", 
"<span class=\"comment\">           processing: any buffers committed as a result of this</span>", 
"<span class=\"comment\">           transaction can be removed from any checkpoint list it was on</span>", 
"<span class=\"comment\">           before. */</span>", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#jbd_debug\">jbd_debug</a>(3, \"JBD: commit phase 6\\n\");", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#J_ASSERT\">J_ASSERT</a>(<a class=\"id\" href=\"#list_empty\">list_empty</a>(&amp;<a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>-><a class=\"id\" href=\"#t_inode_list\">t_inode_list</a>));", 
"<span class=\"ts\"/><a class=\"id\" href=\"#J_ASSERT\">J_ASSERT</a>(<a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>-><a class=\"id\" href=\"#t_buffers\">t_buffers</a> == <a class=\"id\" href=\"#NULL\">NULL</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#J_ASSERT\">J_ASSERT</a>(<a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>-><a class=\"id\" href=\"#t_checkpoint_list\">t_checkpoint_list</a> == <a class=\"id\" href=\"#NULL\">NULL</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#J_ASSERT\">J_ASSERT</a>(<a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>-><a class=\"id\" href=\"#t_iobuf_list\">t_iobuf_list</a> == <a class=\"id\" href=\"#NULL\">NULL</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#J_ASSERT\">J_ASSERT</a>(<a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>-><a class=\"id\" href=\"#t_shadow_list\">t_shadow_list</a> == <a class=\"id\" href=\"#NULL\">NULL</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#J_ASSERT\">J_ASSERT</a>(<a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>-><a class=\"id\" href=\"#t_log_list\">t_log_list</a> == <a class=\"id\" href=\"#NULL\">NULL</a>);", 
"", 
"<a class=\"id\" href=\"#restart_loop\">restart_loop</a>:", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * As there are other places (journal_unmap_buffer()) adding buffers</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * to this list we have to be careful and hold the j_list_lock.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock\">spin_lock</a>(&amp;<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_list_lock\">j_list_lock</a>);", 
"<span class=\"ts\"/>while (<a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>-><a class=\"id\" href=\"#t_forget\">t_forget</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#transaction_t\">transaction_t</a> *<a class=\"id\" href=\"#cp_transaction\">cp_transaction</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#buffer_head\">buffer_head</a> *<a class=\"id\" href=\"#bh\">bh</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jh\">jh</a> = <a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>-><a class=\"id\" href=\"#t_forget\">t_forget</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock\">spin_unlock</a>(&amp;<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_list_lock\">j_list_lock</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bh\">bh</a> = <a class=\"id\" href=\"#jh2bh\">jh2bh</a>(<a class=\"id\" href=\"#jh\">jh</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jbd_lock_bh_state\">jbd_lock_bh_state</a>(<a class=\"id\" href=\"#bh\">bh</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#J_ASSERT_JH\">J_ASSERT_JH</a>(<a class=\"id\" href=\"#jh\">jh</a>,<span class=\"ts\"/><a class=\"id\" href=\"#jh\">jh</a>-><a class=\"id\" href=\"#b_transaction\">b_transaction</a> == <a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * If there is undo-protected committed data against</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * this buffer, then we can remove it now.  If it is a</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * buffer needing such protection, the old frozen_data</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * field now points to a committed version of the</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * buffer, so rotate that field to the new committed</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * data.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> *</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * Otherwise, we can just throw away the frozen data now.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> *</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * We also know that the frozen data has already fired</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * its triggers if they exist, so we can clear that too.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#jh\">jh</a>-><a class=\"id\" href=\"#b_committed_data\">b_committed_data</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jbd2_free\">jbd2_free</a>(<a class=\"id\" href=\"#jh\">jh</a>-><a class=\"id\" href=\"#b_committed_data\">b_committed_data</a>, <a class=\"id\" href=\"#bh\">bh</a>-><a class=\"id\" href=\"#b_size\">b_size</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jh\">jh</a>-><a class=\"id\" href=\"#b_committed_data\">b_committed_data</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#jh\">jh</a>-><a class=\"id\" href=\"#b_frozen_data\">b_frozen_data</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jh\">jh</a>-><a class=\"id\" href=\"#b_committed_data\">b_committed_data</a> = <a class=\"id\" href=\"#jh\">jh</a>-><a class=\"id\" href=\"#b_frozen_data\">b_frozen_data</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jh\">jh</a>-><a class=\"id\" href=\"#b_frozen_data\">b_frozen_data</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jh\">jh</a>-><a class=\"id\" href=\"#b_frozen_triggers\">b_frozen_triggers</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/>} else if (<a class=\"id\" href=\"#jh\">jh</a>-><a class=\"id\" href=\"#b_frozen_data\">b_frozen_data</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jbd2_free\">jbd2_free</a>(<a class=\"id\" href=\"#jh\">jh</a>-><a class=\"id\" href=\"#b_frozen_data\">b_frozen_data</a>, <a class=\"id\" href=\"#bh\">bh</a>-><a class=\"id\" href=\"#b_size\">b_size</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jh\">jh</a>-><a class=\"id\" href=\"#b_frozen_data\">b_frozen_data</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jh\">jh</a>-><a class=\"id\" href=\"#b_frozen_triggers\">b_frozen_triggers</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_lock\">spin_lock</a>(&amp;<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_list_lock\">j_list_lock</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#cp_transaction\">cp_transaction</a> = <a class=\"id\" href=\"#jh\">jh</a>-><a class=\"id\" href=\"#b_cp_transaction\">b_cp_transaction</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#cp_transaction\">cp_transaction</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#JBUFFER_TRACE\">JBUFFER_TRACE</a>(<a class=\"id\" href=\"#jh\">jh</a>, \"remove from old cp transaction\");", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#cp_transaction\">cp_transaction</a>-><a class=\"id\" href=\"#t_chp_stats\">t_chp_stats</a>.<a class=\"id\" href=\"#cs_dropped\">cs_dropped</a>++;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#__jbd2_journal_remove_checkpoint\">__jbd2_journal_remove_checkpoint</a>(<a class=\"id\" href=\"#jh\">jh</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Only re-checkpoint the buffer_head if it is marked</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * dirty.  If the buffer was added to the BJ_Forget list</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * by jbd2_journal_forget, it may no longer be dirty and</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * there's no point in keeping a checkpoint record for</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * it. */</span>", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* A buffer which has been freed while still being</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * journaled by a previous transaction may end up still</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * being dirty here, but we want to avoid writing back</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * that buffer in the future after the \"add to orphan\"</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * operation been committed,  That's not only a performance</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * gain, it also stops aliasing problems if the buffer is</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * left behind for writeback and gets reallocated for another</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * use in a different page. */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#buffer_freed\">buffer_freed</a>(<a class=\"id\" href=\"#bh\">bh</a>) && !<a class=\"id\" href=\"#jh\">jh</a>-><a class=\"id\" href=\"#b_next_transaction\">b_next_transaction</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#clear_buffer_freed\">clear_buffer_freed</a>(<a class=\"id\" href=\"#bh\">bh</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#clear_buffer_jbddirty\">clear_buffer_jbddirty</a>(<a class=\"id\" href=\"#bh\">bh</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#buffer_jbddirty\">buffer_jbddirty</a>(<a class=\"id\" href=\"#bh\">bh</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#JBUFFER_TRACE\">JBUFFER_TRACE</a>(<a class=\"id\" href=\"#jh\">jh</a>, \"add to new checkpointing trans\");", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#__jbd2_journal_insert_checkpoint\">__jbd2_journal_insert_checkpoint</a>(<a class=\"id\" href=\"#jh\">jh</a>, <a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#is_journal_aborted\">is_journal_aborted</a>(<a class=\"id\" href=\"#journal\">journal</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#clear_buffer_jbddirty\">clear_buffer_jbddirty</a>(<a class=\"id\" href=\"#bh\">bh</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#JBUFFER_TRACE\">JBUFFER_TRACE</a>(<a class=\"id\" href=\"#jh\">jh</a>, \"refile for checkpoint writeback\");", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#__jbd2_journal_refile_buffer\">__jbd2_journal_refile_buffer</a>(<a class=\"id\" href=\"#jh\">jh</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jbd_unlock_bh_state\">jbd_unlock_bh_state</a>(<a class=\"id\" href=\"#bh\">bh</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>} else {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#J_ASSERT_BH\">J_ASSERT_BH</a>(<a class=\"id\" href=\"#bh\">bh</a>, !<a class=\"id\" href=\"#buffer_dirty\">buffer_dirty</a>(<a class=\"id\" href=\"#bh\">bh</a>));", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* The buffer on BJ_Forget list and not jbddirty means</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> * it has been freed by this transaction and hence it</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> * could not have been reallocated until this</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> * transaction has committed. *BUT* it could be</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> * reallocated once we have written all the data to</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> * disk and before we process the buffer on BJ_Forget</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> * list. */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#JBUFFER_TRACE\">JBUFFER_TRACE</a>(<a class=\"id\" href=\"#jh\">jh</a>, \"refile or unfile freed buffer\");", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#__jbd2_journal_refile_buffer\">__jbd2_journal_refile_buffer</a>(<a class=\"id\" href=\"#jh\">jh</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#jh\">jh</a>-><a class=\"id\" href=\"#b_transaction\">b_transaction</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jbd_unlock_bh_state\">jbd_unlock_bh_state</a>(<a class=\"id\" href=\"#bh\">bh</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> <span class=\"comment\">/* needs a brelse */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jbd2_journal_remove_journal_head\">jbd2_journal_remove_journal_head</a>(<a class=\"id\" href=\"#bh\">bh</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#release_buffer_page\">release_buffer_page</a>(<a class=\"id\" href=\"#bh\">bh</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>} else", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#jbd_unlock_bh_state\">jbd_unlock_bh_state</a>(<a class=\"id\" href=\"#bh\">bh</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#cond_resched_lock\">cond_resched_lock</a>(&amp;<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_list_lock\">j_list_lock</a>);", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock\">spin_unlock</a>(&amp;<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_list_lock\">j_list_lock</a>);", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * This is a bit sleazy.  We use j_list_lock to protect transition</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * of a transaction into T_FINISHED state and calling</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * __jbd2_journal_drop_transaction(). Otherwise we could race with</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * other checkpointing code processing the transaction...</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#write_lock\">write_lock</a>(&amp;<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_state_lock\">j_state_lock</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock\">spin_lock</a>(&amp;<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_list_lock\">j_list_lock</a>);", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Now recheck if some buffers did not get attached to the transaction</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * while the lock was dropped...</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>-><a class=\"id\" href=\"#t_forget\">t_forget</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock\">spin_unlock</a>(&amp;<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_list_lock\">j_list_lock</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#write_unlock\">write_unlock</a>(&amp;<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_state_lock\">j_state_lock</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#restart_loop\">restart_loop</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Done with this transaction! */</span>", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#jbd_debug\">jbd_debug</a>(3, \"JBD: commit phase 7\\n\");", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#J_ASSERT\">J_ASSERT</a>(<a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>-><a class=\"id\" href=\"#t_state\">t_state</a> == <a class=\"id\" href=\"#T_COMMIT\">T_COMMIT</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>-><a class=\"id\" href=\"#t_start\">t_start</a> = <a class=\"id\" href=\"#jiffies\">jiffies</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#stats\">stats</a>.<a class=\"id\" href=\"#run\">run</a>.<a class=\"id\" href=\"#rs_logging\">rs_logging</a> = <a class=\"id\" href=\"#jbd2_time_diff\">jbd2_time_diff</a>(<a class=\"id\" href=\"#stats\">stats</a>.<a class=\"id\" href=\"#run\">run</a>.<a class=\"id\" href=\"#rs_logging\">rs_logging</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>      <a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>-><a class=\"id\" href=\"#t_start\">t_start</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * File the transaction statistics</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#stats\">stats</a>.<a class=\"id\" href=\"#ts_tid\">ts_tid</a> = <a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>-><a class=\"id\" href=\"#t_tid\">t_tid</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#stats\">stats</a>.<a class=\"id\" href=\"#run\">run</a>.<a class=\"id\" href=\"#rs_handle_count\">rs_handle_count</a> =", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#atomic_read\">atomic_read</a>(&amp;<a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>-><a class=\"id\" href=\"#t_handle_count\">t_handle_count</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#trace_jbd2_run_stats\">trace_jbd2_run_stats</a>(<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_fs_dev\">j_fs_dev</a>-><a class=\"id\" href=\"#bd_dev\">bd_dev</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>     <a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>-><a class=\"id\" href=\"#t_tid\">t_tid</a>, &amp;<a class=\"id\" href=\"#stats\">stats</a>.<a class=\"id\" href=\"#run\">run</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Calculate overall stats</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock\">spin_lock</a>(&amp;<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_history_lock\">j_history_lock</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_stats\">j_stats</a>.<a class=\"id\" href=\"#ts_tid\">ts_tid</a>++;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_stats\">j_stats</a>.<a class=\"id\" href=\"#run\">run</a>.<a class=\"id\" href=\"#rs_wait\">rs_wait</a> += <a class=\"id\" href=\"#stats\">stats</a>.<a class=\"id\" href=\"#run\">run</a>.<a class=\"id\" href=\"#rs_wait\">rs_wait</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_stats\">j_stats</a>.<a class=\"id\" href=\"#run\">run</a>.<a class=\"id\" href=\"#rs_running\">rs_running</a> += <a class=\"id\" href=\"#stats\">stats</a>.<a class=\"id\" href=\"#run\">run</a>.<a class=\"id\" href=\"#rs_running\">rs_running</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_stats\">j_stats</a>.<a class=\"id\" href=\"#run\">run</a>.<a class=\"id\" href=\"#rs_locked\">rs_locked</a> += <a class=\"id\" href=\"#stats\">stats</a>.<a class=\"id\" href=\"#run\">run</a>.<a class=\"id\" href=\"#rs_locked\">rs_locked</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_stats\">j_stats</a>.<a class=\"id\" href=\"#run\">run</a>.<a class=\"id\" href=\"#rs_flushing\">rs_flushing</a> += <a class=\"id\" href=\"#stats\">stats</a>.<a class=\"id\" href=\"#run\">run</a>.<a class=\"id\" href=\"#rs_flushing\">rs_flushing</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_stats\">j_stats</a>.<a class=\"id\" href=\"#run\">run</a>.<a class=\"id\" href=\"#rs_logging\">rs_logging</a> += <a class=\"id\" href=\"#stats\">stats</a>.<a class=\"id\" href=\"#run\">run</a>.<a class=\"id\" href=\"#rs_logging\">rs_logging</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_stats\">j_stats</a>.<a class=\"id\" href=\"#run\">run</a>.<a class=\"id\" href=\"#rs_handle_count\">rs_handle_count</a> += <a class=\"id\" href=\"#stats\">stats</a>.<a class=\"id\" href=\"#run\">run</a>.<a class=\"id\" href=\"#rs_handle_count\">rs_handle_count</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_stats\">j_stats</a>.<a class=\"id\" href=\"#run\">run</a>.<a class=\"id\" href=\"#rs_blocks\">rs_blocks</a> += <a class=\"id\" href=\"#stats\">stats</a>.<a class=\"id\" href=\"#run\">run</a>.<a class=\"id\" href=\"#rs_blocks\">rs_blocks</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_stats\">j_stats</a>.<a class=\"id\" href=\"#run\">run</a>.<a class=\"id\" href=\"#rs_blocks_logged\">rs_blocks_logged</a> += <a class=\"id\" href=\"#stats\">stats</a>.<a class=\"id\" href=\"#run\">run</a>.<a class=\"id\" href=\"#rs_blocks_logged\">rs_blocks_logged</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock\">spin_unlock</a>(&amp;<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_history_lock\">j_history_lock</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>-><a class=\"id\" href=\"#t_state\">t_state</a> = <a class=\"id\" href=\"#T_FINISHED\">T_FINISHED</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#J_ASSERT\">J_ASSERT</a>(<a class=\"id\" href=\"#commit_transaction\">commit_transaction</a> == <a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_committing_transaction\">j_committing_transaction</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_commit_sequence\">j_commit_sequence</a> = <a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>-><a class=\"id\" href=\"#t_tid\">t_tid</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_committing_transaction\">j_committing_transaction</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#commit_time\">commit_time</a> = <a class=\"id\" href=\"#ktime_to_ns\">ktime_to_ns</a>(<a class=\"id\" href=\"#ktime_sub\">ktime_sub</a>(<a class=\"id\" href=\"#ktime_get\">ktime_get</a>(), <a class=\"id\" href=\"#start_time\">start_time</a>));", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * weight the commit time higher than the average time so we don't</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * react too strongly to vast changes in the commit time</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#likely\">likely</a>(<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_average_commit_time\">j_average_commit_time</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_average_commit_time\">j_average_commit_time</a> = (<a class=\"id\" href=\"#commit_time\">commit_time</a> +", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_average_commit_time\">j_average_commit_time</a>*3) / 4;", 
"<span class=\"ts\"/>else", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_average_commit_time\">j_average_commit_time</a> = <a class=\"id\" href=\"#commit_time\">commit_time</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#write_unlock\">write_unlock</a>(&amp;<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_state_lock\">j_state_lock</a>);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>-><a class=\"id\" href=\"#t_checkpoint_list\">t_checkpoint_list</a> == <a class=\"id\" href=\"#NULL\">NULL</a> &&", 
"<span class=\"ts\"/>    <a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>-><a class=\"id\" href=\"#t_checkpoint_io_list\">t_checkpoint_io_list</a> == <a class=\"id\" href=\"#NULL\">NULL</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#__jbd2_journal_drop_transaction\">__jbd2_journal_drop_transaction</a>(<a class=\"id\" href=\"#journal\">journal</a>, <a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#to_free\">to_free</a> = 1;", 
"<span class=\"ts\"/>} else {", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_checkpoint_transactions\">j_checkpoint_transactions</a> == <a class=\"id\" href=\"#NULL\">NULL</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_checkpoint_transactions\">j_checkpoint_transactions</a> = <a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>-><a class=\"id\" href=\"#t_cpnext\">t_cpnext</a> = <a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>-><a class=\"id\" href=\"#t_cpprev\">t_cpprev</a> = <a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>} else {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>-><a class=\"id\" href=\"#t_cpnext\">t_cpnext</a> =", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_checkpoint_transactions\">j_checkpoint_transactions</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>-><a class=\"id\" href=\"#t_cpprev\">t_cpprev</a> =", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>-><a class=\"id\" href=\"#t_cpnext\">t_cpnext</a>-><a class=\"id\" href=\"#t_cpprev\">t_cpprev</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>-><a class=\"id\" href=\"#t_cpnext\">t_cpnext</a>-><a class=\"id\" href=\"#t_cpprev\">t_cpprev</a> =", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>-><a class=\"id\" href=\"#t_cpprev\">t_cpprev</a>-><a class=\"id\" href=\"#t_cpnext\">t_cpnext</a> =", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock\">spin_unlock</a>(&amp;<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_list_lock\">j_list_lock</a>);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_commit_callback\">j_commit_callback</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_commit_callback\">j_commit_callback</a>(<a class=\"id\" href=\"#journal\">journal</a>, <a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#trace_jbd2_end_commit\">trace_jbd2_end_commit</a>(<a class=\"id\" href=\"#journal\">journal</a>, <a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#jbd_debug\">jbd_debug</a>(1, \"JBD: commit %d complete, head %d\\n\",", 
"<span class=\"ts\"/><span class=\"ts\"/>  <a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_commit_sequence\">j_commit_sequence</a>, <a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_tail_sequence\">j_tail_sequence</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#to_free\">to_free</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#commit_transaction\">commit_transaction</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#wake_up\">wake_up</a>(&amp;<a class=\"id\" href=\"#journal\">journal</a>-><a class=\"id\" href=\"#j_wait_done_commit\">j_wait_done_commit</a>);", 
"}", 
];
xr_frag_insert('l/97/78d7f0c4a2501e2b56a52e1bee117e28919b6e.xr', __xr_tmp);
