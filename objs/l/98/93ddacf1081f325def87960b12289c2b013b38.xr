var __xr_tmp = [
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#err\">err</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#slab\">slab</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#reboot\">reboot</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#sysrq\">sysrq</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#stop_machine\">stop_machine</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#freezer\">freezer</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#xen\">xen</a>/<a class=\"id\" href=\"#xen\">xen</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#xen\">xen</a>/<a class=\"id\" href=\"#xenbus\">xenbus</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#xen\">xen</a>/<a class=\"id\" href=\"#grant_table\">grant_table</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#xen\">xen</a>/<a class=\"id\" href=\"#events\">events</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#xen\">xen</a>/<a class=\"id\" href=\"#hvc\">hvc</a>-<a class=\"id\" href=\"#console\">console</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#xen\">xen</a>/<a class=\"id\" href=\"#xen\">xen</a>-<a class=\"id\" href=\"#ops\">ops</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#asm\">asm</a>/<a class=\"id\" href=\"#xen\">xen</a>/<a class=\"id\" href=\"#hypercall\">hypercall</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#asm\">asm</a>/<a class=\"id\" href=\"#xen\">xen</a>/<a class=\"id\" href=\"#page\">page</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#asm\">asm</a>/<a class=\"id\" href=\"#xen\">xen</a>/<a class=\"id\" href=\"#hypervisor\">hypervisor</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"", 
"enum <a class=\"id\" href=\"#shutdown_state\">shutdown_state</a> {", 
"<span class=\"ts\"/><a class=\"id\" href=\"#SHUTDOWN_INVALID\">SHUTDOWN_INVALID</a> = -1,", 
"<span class=\"ts\"/><a class=\"id\" href=\"#SHUTDOWN_POWEROFF\">SHUTDOWN_POWEROFF</a> = 0,", 
"<span class=\"ts\"/><a class=\"id\" href=\"#SHUTDOWN_SUSPEND\">SHUTDOWN_SUSPEND</a> = 2,", 
"<span class=\"ts\"/><span class=\"comment\">/* Code 3 is SHUTDOWN_CRASH, which we don't use because the domain can only</span>", 
"<span class=\"comment\"><span class=\"ts\"/>   report a crash, not be instructed to crash!</span>", 
"<span class=\"comment\"><span class=\"ts\"/>   HALT is the same as POWEROFF, as far as we're concerned.  The tools use</span>", 
"<span class=\"comment\"><span class=\"ts\"/>   the distinction when we return the reason code to them.  */</span>", 
"<span class=\"ts\"/> <a class=\"id\" href=\"#SHUTDOWN_HALT\">SHUTDOWN_HALT</a> = 4,", 
"};", 
"", 
"<span class=\"comment\">/* Ignore multiple shutdown requests. */</span>", 
"static enum <a class=\"id\" href=\"#shutdown_state\">shutdown_state</a> <a class=\"id\" href=\"#shutting_down\">shutting_down</a> = <a class=\"id\" href=\"#SHUTDOWN_INVALID\">SHUTDOWN_INVALID</a>;", 
"", 
"#<a class=\"id\" href=\"#ifdef\">ifdef</a> <a class=\"id\" href=\"#CONFIG_PM_SLEEP\">CONFIG_PM_SLEEP</a>", 
"static int <a class=\"id\" href=\"#xen_hvm_suspend\">xen_hvm_suspend</a>(void *<a class=\"id\" href=\"#data\">data</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#sched_shutdown\">sched_shutdown</a> <a class=\"id\" href=\"#r\">r</a> = { .<a class=\"id\" href=\"#reason\">reason</a> = <a class=\"id\" href=\"#SHUTDOWN_suspend\">SHUTDOWN_suspend</a> };", 
"<span class=\"ts\"/>int *<a class=\"id\" href=\"#cancelled\">cancelled</a> = <a class=\"id\" href=\"#data\">data</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#BUG_ON\">BUG_ON</a>(!<a class=\"id\" href=\"#irqs_disabled\">irqs_disabled</a>());", 
"", 
"<span class=\"ts\"/>*<a class=\"id\" href=\"#cancelled\">cancelled</a> = <a class=\"id\" href=\"#HYPERVISOR_sched_op\">HYPERVISOR_sched_op</a>(<a class=\"id\" href=\"#SCHEDOP_shutdown\">SCHEDOP_shutdown</a>, &amp;<a class=\"id\" href=\"#r\">r</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#xen_hvm_post_suspend\">xen_hvm_post_suspend</a>(*<a class=\"id\" href=\"#cancelled\">cancelled</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#gnttab_resume\">gnttab_resume</a>();", 
"", 
"<span class=\"ts\"/>if (!*<a class=\"id\" href=\"#cancelled\">cancelled</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#xen_irq_resume\">xen_irq_resume</a>();", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#xen_timer_resume\">xen_timer_resume</a>();", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"static int <a class=\"id\" href=\"#xen_suspend\">xen_suspend</a>(void *<a class=\"id\" href=\"#data\">data</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#err\">err</a>;", 
"<span class=\"ts\"/>int *<a class=\"id\" href=\"#cancelled\">cancelled</a> = <a class=\"id\" href=\"#data\">data</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#BUG_ON\">BUG_ON</a>(!<a class=\"id\" href=\"#irqs_disabled\">irqs_disabled</a>());", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = <a class=\"id\" href=\"#sysdev_suspend\">sysdev_suspend</a>(<a class=\"id\" href=\"#PMSG_SUSPEND\">PMSG_SUSPEND</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#err\">err</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_ERR\">KERN_ERR</a> \"xen_suspend: sysdev_suspend failed: %d\\n\",", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#err\">err</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#xen_mm_pin_all\">xen_mm_pin_all</a>();", 
"<span class=\"ts\"/><a class=\"id\" href=\"#gnttab_suspend\">gnttab_suspend</a>();", 
"<span class=\"ts\"/><a class=\"id\" href=\"#xen_pre_suspend\">xen_pre_suspend</a>();", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * This hypercall returns 1 if suspend was cancelled</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * or the domain was merely checkpointed, and 0 if it</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * is resuming in a new domain.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/>*<a class=\"id\" href=\"#cancelled\">cancelled</a> = <a class=\"id\" href=\"#HYPERVISOR_suspend\">HYPERVISOR_suspend</a>(<a class=\"id\" href=\"#virt_to_mfn\">virt_to_mfn</a>(<a class=\"id\" href=\"#xen_start_info\">xen_start_info</a>));", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#xen_post_suspend\">xen_post_suspend</a>(*<a class=\"id\" href=\"#cancelled\">cancelled</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#gnttab_resume\">gnttab_resume</a>();", 
"<span class=\"ts\"/><a class=\"id\" href=\"#xen_mm_unpin_all\">xen_mm_unpin_all</a>();", 
"", 
"<span class=\"ts\"/>if (!*<a class=\"id\" href=\"#cancelled\">cancelled</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#xen_irq_resume\">xen_irq_resume</a>();", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#xen_console_resume\">xen_console_resume</a>();", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#xen_timer_resume\">xen_timer_resume</a>();", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#sysdev_resume\">sysdev_resume</a>();", 
"", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"static void <a class=\"id\" href=\"#do_suspend\">do_suspend</a>(void)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#err\">err</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#cancelled\">cancelled</a> = 1;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shutting_down\">shutting_down</a> = <a class=\"id\" href=\"#SHUTDOWN_SUSPEND\">SHUTDOWN_SUSPEND</a>;", 
"", 
"#<a class=\"id\" href=\"#ifdef\">ifdef</a> <a class=\"id\" href=\"#CONFIG_PREEMPT\">CONFIG_PREEMPT</a>", 
"<span class=\"ts\"/><span class=\"comment\">/* If the kernel is preemptible, we need to freeze all the processes</span>", 
"<span class=\"comment\"><span class=\"ts\"/>   to prevent them from being in the middle of a pagetable update</span>", 
"<span class=\"comment\"><span class=\"ts\"/>   during suspend. */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = <a class=\"id\" href=\"#freeze_processes\">freeze_processes</a>();", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#err\">err</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_ERR\">KERN_ERR</a> \"xen suspend: freeze failed %d\\n\", <a class=\"id\" href=\"#err\">err</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"<span class=\"ts\"/>}", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = <a class=\"id\" href=\"#dpm_suspend_start\">dpm_suspend_start</a>(<a class=\"id\" href=\"#PMSG_SUSPEND\">PMSG_SUSPEND</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#err\">err</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_ERR\">KERN_ERR</a> \"xen suspend: dpm_suspend_start %d\\n\", <a class=\"id\" href=\"#err\">err</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out_thaw\">out_thaw</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_DEBUG\">KERN_DEBUG</a> \"suspending xenstore...\\n\");", 
"<span class=\"ts\"/><a class=\"id\" href=\"#xs_suspend\">xs_suspend</a>();", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = <a class=\"id\" href=\"#dpm_suspend_noirq\">dpm_suspend_noirq</a>(<a class=\"id\" href=\"#PMSG_SUSPEND\">PMSG_SUSPEND</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#err\">err</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_ERR\">KERN_ERR</a> \"dpm_suspend_noirq failed: %d\\n\", <a class=\"id\" href=\"#err\">err</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out_resume\">out_resume</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#xen_hvm_domain\">xen_hvm_domain</a>())", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = <a class=\"id\" href=\"#stop_machine\">stop_machine</a>(<a class=\"id\" href=\"#xen_hvm_suspend\">xen_hvm_suspend</a>, &amp;<a class=\"id\" href=\"#cancelled\">cancelled</a>, <a class=\"id\" href=\"#cpumask_of\">cpumask_of</a>(0));", 
"<span class=\"ts\"/>else", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = <a class=\"id\" href=\"#stop_machine\">stop_machine</a>(<a class=\"id\" href=\"#xen_suspend\">xen_suspend</a>, &amp;<a class=\"id\" href=\"#cancelled\">cancelled</a>, <a class=\"id\" href=\"#cpumask_of\">cpumask_of</a>(0));", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dpm_resume_noirq\">dpm_resume_noirq</a>(<a class=\"id\" href=\"#PMSG_RESUME\">PMSG_RESUME</a>);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#err\">err</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_ERR\">KERN_ERR</a> \"failed to start xen_suspend: %d\\n\", <a class=\"id\" href=\"#err\">err</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#cancelled\">cancelled</a> = 1;", 
"<span class=\"ts\"/>}", 
"", 
"<a class=\"id\" href=\"#out_resume\">out_resume</a>:", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#cancelled\">cancelled</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#xen_arch_resume\">xen_arch_resume</a>();", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#xs_resume\">xs_resume</a>();", 
"<span class=\"ts\"/>} else", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#xs_suspend_cancel\">xs_suspend_cancel</a>();", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dpm_resume_end\">dpm_resume_end</a>(<a class=\"id\" href=\"#PMSG_RESUME\">PMSG_RESUME</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Make sure timer events get retriggered on all CPUs */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#clock_was_set\">clock_was_set</a>();", 
"", 
"<a class=\"id\" href=\"#out_thaw\">out_thaw</a>:", 
"#<a class=\"id\" href=\"#ifdef\">ifdef</a> <a class=\"id\" href=\"#CONFIG_PREEMPT\">CONFIG_PREEMPT</a>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#thaw_processes\">thaw_processes</a>();", 
"<a class=\"id\" href=\"#out\">out</a>:", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#shutting_down\">shutting_down</a> = <a class=\"id\" href=\"#SHUTDOWN_INVALID\">SHUTDOWN_INVALID</a>;", 
"}", 
"#<a class=\"id\" href=\"#endif\">endif</a><span class=\"ts\"/><span class=\"comment\">/* CONFIG_PM_SLEEP */</span>", 
"", 
"static void <a class=\"id\" href=\"#shutdown_handler\">shutdown_handler</a>(struct <a class=\"id\" href=\"#xenbus_watch\">xenbus_watch</a> *<a class=\"id\" href=\"#watch\">watch</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>     const char **<a class=\"id\" href=\"#vec\">vec</a>, unsigned int <a class=\"id\" href=\"#len\">len</a>)", 
"{", 
"<span class=\"ts\"/>char *<a class=\"id\" href=\"#str\">str</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#xenbus_transaction\">xenbus_transaction</a> <a class=\"id\" href=\"#xbt\">xbt</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#err\">err</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#shutting_down\">shutting_down</a> != <a class=\"id\" href=\"#SHUTDOWN_INVALID\">SHUTDOWN_INVALID</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"", 
" <a class=\"id\" href=\"#again\">again</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = <a class=\"id\" href=\"#xenbus_transaction_start\">xenbus_transaction_start</a>(&amp;<a class=\"id\" href=\"#xbt\">xbt</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#err\">err</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#str\">str</a> = (char *)<a class=\"id\" href=\"#xenbus_read\">xenbus_read</a>(<a class=\"id\" href=\"#xbt\">xbt</a>, \"control\", \"shutdown\", <a class=\"id\" href=\"#NULL\">NULL</a>);", 
"<span class=\"ts\"/><span class=\"comment\">/* Ignore read errors and empty reads. */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#XENBUS_IS_ERR_READ\">XENBUS_IS_ERR_READ</a>(<a class=\"id\" href=\"#str\">str</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#xenbus_transaction_end\">xenbus_transaction_end</a>(<a class=\"id\" href=\"#xbt\">xbt</a>, 1);", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#xenbus_write\">xenbus_write</a>(<a class=\"id\" href=\"#xbt\">xbt</a>, \"control\", \"shutdown\", \"\");", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = <a class=\"id\" href=\"#xenbus_transaction_end\">xenbus_transaction_end</a>(<a class=\"id\" href=\"#xbt\">xbt</a>, 0);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#err\">err</a> == -<a class=\"id\" href=\"#EAGAIN\">EAGAIN</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#str\">str</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#again\">again</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#strcmp\">strcmp</a>(<a class=\"id\" href=\"#str\">str</a>, \"poweroff\") == 0 ||", 
"<span class=\"ts\"/>    <a class=\"id\" href=\"#strcmp\">strcmp</a>(<a class=\"id\" href=\"#str\">str</a>, \"halt\") == 0) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#shutting_down\">shutting_down</a> = <a class=\"id\" href=\"#SHUTDOWN_POWEROFF\">SHUTDOWN_POWEROFF</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#orderly_poweroff\">orderly_poweroff</a>(<a class=\"id\" href=\"#false\">false</a>);", 
"<span class=\"ts\"/>} else if (<a class=\"id\" href=\"#strcmp\">strcmp</a>(<a class=\"id\" href=\"#str\">str</a>, \"reboot\") == 0) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#shutting_down\">shutting_down</a> = <a class=\"id\" href=\"#SHUTDOWN_POWEROFF\">SHUTDOWN_POWEROFF</a>; <span class=\"comment\">/* ? */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ctrl_alt_del\">ctrl_alt_del</a>();", 
"#<a class=\"id\" href=\"#ifdef\">ifdef</a> <a class=\"id\" href=\"#CONFIG_PM_SLEEP\">CONFIG_PM_SLEEP</a>", 
"<span class=\"ts\"/>} else if (<a class=\"id\" href=\"#strcmp\">strcmp</a>(<a class=\"id\" href=\"#str\">str</a>, \"suspend\") == 0) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#do_suspend\">do_suspend</a>();", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
"<span class=\"ts\"/>} else {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_INFO\">KERN_INFO</a> \"Ignoring shutdown request: %s\\n\", <a class=\"id\" href=\"#str\">str</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#shutting_down\">shutting_down</a> = <a class=\"id\" href=\"#SHUTDOWN_INVALID\">SHUTDOWN_INVALID</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#str\">str</a>);", 
"}", 
"", 
"#<a class=\"id\" href=\"#ifdef\">ifdef</a> <a class=\"id\" href=\"#CONFIG_MAGIC_SYSRQ\">CONFIG_MAGIC_SYSRQ</a>", 
"static void <a class=\"id\" href=\"#sysrq_handler\">sysrq_handler</a>(struct <a class=\"id\" href=\"#xenbus_watch\">xenbus_watch</a> *<a class=\"id\" href=\"#watch\">watch</a>, const char **<a class=\"id\" href=\"#vec\">vec</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>  unsigned int <a class=\"id\" href=\"#len\">len</a>)", 
"{", 
"<span class=\"ts\"/>char <a class=\"id\" href=\"#sysrq_key\">sysrq_key</a> = '\\0';", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#xenbus_transaction\">xenbus_transaction</a> <a class=\"id\" href=\"#xbt\">xbt</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#err\">err</a>;", 
"", 
" <a class=\"id\" href=\"#again\">again</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = <a class=\"id\" href=\"#xenbus_transaction_start\">xenbus_transaction_start</a>(&amp;<a class=\"id\" href=\"#xbt\">xbt</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#err\">err</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#xenbus_scanf\">xenbus_scanf</a>(<a class=\"id\" href=\"#xbt\">xbt</a>, \"control\", \"sysrq\", \"%c\", &amp;<a class=\"id\" href=\"#sysrq_key\">sysrq_key</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_ERR\">KERN_ERR</a> \"Unable to read sysrq code in \"", 
"<span class=\"ts\"/><span class=\"ts\"/>       \"control/sysrq\\n\");", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#xenbus_transaction_end\">xenbus_transaction_end</a>(<a class=\"id\" href=\"#xbt\">xbt</a>, 1);", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#sysrq_key\">sysrq_key</a> != '\\0')", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#xenbus_printf\">xenbus_printf</a>(<a class=\"id\" href=\"#xbt\">xbt</a>, \"control\", \"sysrq\", \"%c\", '\\0');", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = <a class=\"id\" href=\"#xenbus_transaction_end\">xenbus_transaction_end</a>(<a class=\"id\" href=\"#xbt\">xbt</a>, 0);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#err\">err</a> == -<a class=\"id\" href=\"#EAGAIN\">EAGAIN</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#again\">again</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#sysrq_key\">sysrq_key</a> != '\\0')", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#handle_sysrq\">handle_sysrq</a>(<a class=\"id\" href=\"#sysrq_key\">sysrq_key</a>);", 
"}", 
"", 
"static struct <a class=\"id\" href=\"#xenbus_watch\">xenbus_watch</a> <a class=\"id\" href=\"#sysrq_watch\">sysrq_watch</a> = {", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#node\">node</a> = \"control/sysrq\",", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#callback\">callback</a> = <a class=\"id\" href=\"#sysrq_handler\">sysrq_handler</a>", 
"};", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
"", 
"static struct <a class=\"id\" href=\"#xenbus_watch\">xenbus_watch</a> <a class=\"id\" href=\"#shutdown_watch\">shutdown_watch</a> = {", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#node\">node</a> = \"control/shutdown\",", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#callback\">callback</a> = <a class=\"id\" href=\"#shutdown_handler\">shutdown_handler</a>", 
"};", 
"", 
"static int <a class=\"id\" href=\"#setup_shutdown_watcher\">setup_shutdown_watcher</a>(void)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#err\">err</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = <a class=\"id\" href=\"#register_xenbus_watch\">register_xenbus_watch</a>(&amp;<a class=\"id\" href=\"#shutdown_watch\">shutdown_watch</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#err\">err</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_ERR\">KERN_ERR</a> \"Failed to set shutdown watcher\\n\");", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#err\">err</a>;", 
"<span class=\"ts\"/>}", 
"", 
"#<a class=\"id\" href=\"#ifdef\">ifdef</a> <a class=\"id\" href=\"#CONFIG_MAGIC_SYSRQ\">CONFIG_MAGIC_SYSRQ</a>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = <a class=\"id\" href=\"#register_xenbus_watch\">register_xenbus_watch</a>(&amp;<a class=\"id\" href=\"#sysrq_watch\">sysrq_watch</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#err\">err</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_ERR\">KERN_ERR</a> \"Failed to set sysrq watcher\\n\");", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#err\">err</a>;", 
"<span class=\"ts\"/>}", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
"", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"static int <a class=\"id\" href=\"#shutdown_event\">shutdown_event</a>(struct <a class=\"id\" href=\"#notifier_block\">notifier_block</a> *<a class=\"id\" href=\"#notifier\">notifier</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>  unsigned long <a class=\"id\" href=\"#event\">event</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>  void *<a class=\"id\" href=\"#data\">data</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#setup_shutdown_watcher\">setup_shutdown_watcher</a>();", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#NOTIFY_DONE\">NOTIFY_DONE</a>;", 
"}", 
"", 
"static int <a class=\"id\" href=\"#__init\">__init</a> <a class=\"id\" href=\"#__setup_shutdown_event\">__setup_shutdown_event</a>(void)", 
"{", 
"<span class=\"ts\"/><span class=\"comment\">/* Delay initialization in the PV on HVM case */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#xen_hvm_domain\">xen_hvm_domain</a>())", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#xen_pv_domain\">xen_pv_domain</a>())", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENODEV\">ENODEV</a>;", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#xen_setup_shutdown_event\">xen_setup_shutdown_event</a>();", 
"}", 
"", 
"int <a class=\"id\" href=\"#xen_setup_shutdown_event\">xen_setup_shutdown_event</a>(void)", 
"{", 
"<span class=\"ts\"/>static struct <a class=\"id\" href=\"#notifier_block\">notifier_block</a> <a class=\"id\" href=\"#xenstore_notifier\">xenstore_notifier</a> = {", 
"<span class=\"ts\"/><span class=\"ts\"/>.<a class=\"id\" href=\"#notifier_call\">notifier_call</a> = <a class=\"id\" href=\"#shutdown_event\">shutdown_event</a>", 
"<span class=\"ts\"/>};", 
"<span class=\"ts\"/><a class=\"id\" href=\"#register_xenstore_notifier\">register_xenstore_notifier</a>(&amp;<a class=\"id\" href=\"#xenstore_notifier\">xenstore_notifier</a>);", 
"", 
"<span class=\"ts\"/>return 0;", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#xen_setup_shutdown_event\">xen_setup_shutdown_event</a>);", 
"", 
"<a class=\"id\" href=\"#subsys_initcall\">subsys_initcall</a>(<a class=\"id\" href=\"#__setup_shutdown_event\">__setup_shutdown_event</a>);", 
];
xr_frag_insert('l/98/93ddacf1081f325def87960b12289c2b013b38.xr', __xr_tmp);
