var __xr_tmp = [
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * File:<span class=\"ts\"/>msi.c</span>", 
"<span class=\"comment\"> * Purpose:<span class=\"ts\"/>PCI Message Signaled Interrupt (MSI)</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Copyright (C) 2003-2004 Intel</span>", 
"<span class=\"comment\"> * Copyright (C) Tom Long Nguyen (tom.l.nguyen@intel.com)</span>", 
"<span class=\"comment\"> */</span>", 
"", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#err\">err</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#mm\">mm</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#irq\">irq</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#interrupt\">interrupt</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#init\">init</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#ioport\">ioport</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#pci\">pci</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#proc_fs\">proc_fs</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#msi\">msi</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#smp\">smp</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#errno\">errno</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#io\">io</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#slab\">slab</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"", 
"#<a class=\"id\" href=\"#include\">include</a> \"pci.h\"", 
"#<a class=\"id\" href=\"#include\">include</a> \"msi.h\"", 
"", 
"static int <a class=\"id\" href=\"#pci_msi_enable\">pci_msi_enable</a> = 1;", 
"", 
"<span class=\"comment\">/* Arch hooks */</span>", 
"", 
"#<a class=\"id\" href=\"#ifndef\">ifndef</a> <a class=\"id\" href=\"#arch_msi_check_device\">arch_msi_check_device</a>", 
"int <a class=\"id\" href=\"#arch_msi_check_device\">arch_msi_check_device</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>, int <a class=\"id\" href=\"#nvec\">nvec</a>, int <a class=\"id\" href=\"#type\">type</a>)", 
"{", 
"<span class=\"ts\"/>return 0;", 
"}", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
"", 
"#<a class=\"id\" href=\"#ifndef\">ifndef</a> <a class=\"id\" href=\"#arch_setup_msi_irqs\">arch_setup_msi_irqs</a>", 
"int <a class=\"id\" href=\"#arch_setup_msi_irqs\">arch_setup_msi_irqs</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>, int <a class=\"id\" href=\"#nvec\">nvec</a>, int <a class=\"id\" href=\"#type\">type</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#msi_desc\">msi_desc</a> *<a class=\"id\" href=\"#entry\">entry</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#ret\">ret</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * If an architecture wants to support multiple MSI, it needs to</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * override arch_setup_msi_irqs()</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#type\">type</a> == <a class=\"id\" href=\"#PCI_CAP_ID_MSI\">PCI_CAP_ID_MSI</a> && <a class=\"id\" href=\"#nvec\">nvec</a> &gt; 1)", 
"<span class=\"ts\"/><span class=\"ts\"/>return 1;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_for_each_entry\">list_for_each_entry</a>(<a class=\"id\" href=\"#entry\">entry</a>, &amp;<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#msi_list\">msi_list</a>, <a class=\"id\" href=\"#list\">list</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#arch_setup_msi_irq\">arch_setup_msi_irq</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#entry\">entry</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#ret\">ret</a> &lt; 0)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#ret\">ret</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#ret\">ret</a> &gt; 0)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOSPC\">ENOSPC</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>return 0;", 
"}", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
"", 
"#<a class=\"id\" href=\"#ifndef\">ifndef</a> <a class=\"id\" href=\"#arch_teardown_msi_irqs\">arch_teardown_msi_irqs</a>", 
"void <a class=\"id\" href=\"#arch_teardown_msi_irqs\">arch_teardown_msi_irqs</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#msi_desc\">msi_desc</a> *<a class=\"id\" href=\"#entry\">entry</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_for_each_entry\">list_for_each_entry</a>(<a class=\"id\" href=\"#entry\">entry</a>, &amp;<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#msi_list\">msi_list</a>, <a class=\"id\" href=\"#list\">list</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>int <a class=\"id\" href=\"#i\">i</a>, <a class=\"id\" href=\"#nvec\">nvec</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#irq\">irq</a> == 0)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#nvec\">nvec</a> = 1 << <a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msi_attrib\">msi_attrib</a>.<a class=\"id\" href=\"#multiple\">multiple</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = 0; <a class=\"id\" href=\"#i\">i</a> &lt; <a class=\"id\" href=\"#nvec\">nvec</a>; <a class=\"id\" href=\"#i\">i</a>++)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#arch_teardown_msi_irq\">arch_teardown_msi_irq</a>(<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#irq\">irq</a> + <a class=\"id\" href=\"#i\">i</a>);", 
"<span class=\"ts\"/>}", 
"}", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
"", 
"static void <a class=\"id\" href=\"#msi_set_enable\">msi_set_enable</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>, int <a class=\"id\" href=\"#pos\">pos</a>, int <a class=\"id\" href=\"#enable\">enable</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#control\">control</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#BUG_ON\">BUG_ON</a>(!<a class=\"id\" href=\"#pos\">pos</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_word\">pci_read_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_MSI_FLAGS\">PCI_MSI_FLAGS</a>, &amp;<a class=\"id\" href=\"#control\">control</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#control\">control</a> &= ~<a class=\"id\" href=\"#PCI_MSI_FLAGS_ENABLE\">PCI_MSI_FLAGS_ENABLE</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#enable\">enable</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#control\">control</a> |= <a class=\"id\" href=\"#PCI_MSI_FLAGS_ENABLE\">PCI_MSI_FLAGS_ENABLE</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_word\">pci_write_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_MSI_FLAGS\">PCI_MSI_FLAGS</a>, <a class=\"id\" href=\"#control\">control</a>);", 
"}", 
"", 
"static void <a class=\"id\" href=\"#msix_set_enable\">msix_set_enable</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>, int <a class=\"id\" href=\"#enable\">enable</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#pos\">pos</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#control\">control</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pos\">pos</a> = <a class=\"id\" href=\"#pci_find_capability\">pci_find_capability</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#PCI_CAP_ID_MSIX\">PCI_CAP_ID_MSIX</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#pos\">pos</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_word\">pci_read_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_MSIX_FLAGS\">PCI_MSIX_FLAGS</a>, &amp;<a class=\"id\" href=\"#control\">control</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#control\">control</a> &= ~<a class=\"id\" href=\"#PCI_MSIX_FLAGS_ENABLE\">PCI_MSIX_FLAGS_ENABLE</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#enable\">enable</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#control\">control</a> |= <a class=\"id\" href=\"#PCI_MSIX_FLAGS_ENABLE\">PCI_MSIX_FLAGS_ENABLE</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_word\">pci_write_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_MSIX_FLAGS\">PCI_MSIX_FLAGS</a>, <a class=\"id\" href=\"#control\">control</a>);", 
"<span class=\"ts\"/>}", 
"}", 
"", 
"static <a class=\"id\" href=\"#inline\">inline</a> <a class=\"id\" href=\"#__attribute_const__\">__attribute_const__</a> <a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#msi_mask\">msi_mask</a>(unsigned <a class=\"id\" href=\"#x\">x</a>)", 
"{", 
"<span class=\"ts\"/><span class=\"comment\">/* Don't shift by &gt;= width of type */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#x\">x</a> >= 5)", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0xffffffff;", 
"<span class=\"ts\"/>return (1 << (1 << <a class=\"id\" href=\"#x\">x</a>)) - 1;", 
"}", 
"", 
"static <a class=\"id\" href=\"#inline\">inline</a> <a class=\"id\" href=\"#__attribute_const__\">__attribute_const__</a> <a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#msi_capable_mask\">msi_capable_mask</a>(<a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#control\">control</a>)", 
"{", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#msi_mask\">msi_mask</a>((<a class=\"id\" href=\"#control\">control</a> >> 1) &amp; 7);", 
"}", 
"", 
"static <a class=\"id\" href=\"#inline\">inline</a> <a class=\"id\" href=\"#__attribute_const__\">__attribute_const__</a> <a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#msi_enabled_mask\">msi_enabled_mask</a>(<a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#control\">control</a>)", 
"{", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#msi_mask\">msi_mask</a>((<a class=\"id\" href=\"#control\">control</a> >> 4) &amp; 7);", 
"}", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * PCI 2.3 does not specify mask bits for each MSI interrupt.  Attempting to</span>", 
"<span class=\"comment\"> * mask all MSI interrupts by clearing the MSI enable bit does not work</span>", 
"<span class=\"comment\"> * reliably as devices without an INTx disable bit will then generate a</span>", 
"<span class=\"comment\"> * level IRQ which will never be cleared.</span>", 
"<span class=\"comment\"> */</span>", 
"static <a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#__msi_mask_irq\">__msi_mask_irq</a>(struct <a class=\"id\" href=\"#msi_desc\">msi_desc</a> *<a class=\"id\" href=\"#desc\">desc</a>, <a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#mask\">mask</a>, <a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#flag\">flag</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#mask_bits\">mask_bits</a> = <a class=\"id\" href=\"#desc\">desc</a>-><a class=\"id\" href=\"#masked\">masked</a>;", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#desc\">desc</a>-><a class=\"id\" href=\"#msi_attrib\">msi_attrib</a>.<a class=\"id\" href=\"#maskbit\">maskbit</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mask_bits\">mask_bits</a> &= ~<a class=\"id\" href=\"#mask\">mask</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mask_bits\">mask_bits</a> |= <a class=\"id\" href=\"#flag\">flag</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_dword\">pci_write_config_dword</a>(<a class=\"id\" href=\"#desc\">desc</a>-><a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#desc\">desc</a>-><a class=\"id\" href=\"#mask_pos\">mask_pos</a>, <a class=\"id\" href=\"#mask_bits\">mask_bits</a>);", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#mask_bits\">mask_bits</a>;", 
"}", 
"", 
"static void <a class=\"id\" href=\"#msi_mask_irq\">msi_mask_irq</a>(struct <a class=\"id\" href=\"#msi_desc\">msi_desc</a> *<a class=\"id\" href=\"#desc\">desc</a>, <a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#mask\">mask</a>, <a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#flag\">flag</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#desc\">desc</a>-><a class=\"id\" href=\"#masked\">masked</a> = <a class=\"id\" href=\"#__msi_mask_irq\">__msi_mask_irq</a>(<a class=\"id\" href=\"#desc\">desc</a>, <a class=\"id\" href=\"#mask\">mask</a>, <a class=\"id\" href=\"#flag\">flag</a>);", 
"}", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * This internal function does not flush PCI writes to the device.</span>", 
"<span class=\"comment\"> * All users must ensure that they read from the device before either</span>", 
"<span class=\"comment\"> * assuming that the device state is up to date, or returning out of this</span>", 
"<span class=\"comment\"> * file.  This saves a few milliseconds when initialising devices with lots</span>", 
"<span class=\"comment\"> * of MSI-X interrupts.</span>", 
"<span class=\"comment\"> */</span>", 
"static <a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#__msix_mask_irq\">__msix_mask_irq</a>(struct <a class=\"id\" href=\"#msi_desc\">msi_desc</a> *<a class=\"id\" href=\"#desc\">desc</a>, <a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#flag\">flag</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#mask_bits\">mask_bits</a> = <a class=\"id\" href=\"#desc\">desc</a>-><a class=\"id\" href=\"#masked\">masked</a>;", 
"<span class=\"ts\"/>unsigned <a class=\"id\" href=\"#offset\">offset</a> = <a class=\"id\" href=\"#desc\">desc</a>-><a class=\"id\" href=\"#msi_attrib\">msi_attrib</a>.<a class=\"id\" href=\"#entry_nr\">entry_nr</a> * <a class=\"id\" href=\"#PCI_MSIX_ENTRY_SIZE\">PCI_MSIX_ENTRY_SIZE</a> +", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#PCI_MSIX_ENTRY_VECTOR_CTRL\">PCI_MSIX_ENTRY_VECTOR_CTRL</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mask_bits\">mask_bits</a> &= ~1;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mask_bits\">mask_bits</a> |= <a class=\"id\" href=\"#flag\">flag</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#mask_bits\">mask_bits</a>, <a class=\"id\" href=\"#desc\">desc</a>-><a class=\"id\" href=\"#mask_base\">mask_base</a> + <a class=\"id\" href=\"#offset\">offset</a>);", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#mask_bits\">mask_bits</a>;", 
"}", 
"", 
"static void <a class=\"id\" href=\"#msix_mask_irq\">msix_mask_irq</a>(struct <a class=\"id\" href=\"#msi_desc\">msi_desc</a> *<a class=\"id\" href=\"#desc\">desc</a>, <a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#flag\">flag</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#desc\">desc</a>-><a class=\"id\" href=\"#masked\">masked</a> = <a class=\"id\" href=\"#__msix_mask_irq\">__msix_mask_irq</a>(<a class=\"id\" href=\"#desc\">desc</a>, <a class=\"id\" href=\"#flag\">flag</a>);", 
"}", 
"", 
"static void <a class=\"id\" href=\"#msi_set_mask_bit\">msi_set_mask_bit</a>(unsigned <a class=\"id\" href=\"#irq\">irq</a>, <a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#flag\">flag</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#msi_desc\">msi_desc</a> *<a class=\"id\" href=\"#desc\">desc</a> = <a class=\"id\" href=\"#get_irq_msi\">get_irq_msi</a>(<a class=\"id\" href=\"#irq\">irq</a>);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#desc\">desc</a>-><a class=\"id\" href=\"#msi_attrib\">msi_attrib</a>.<a class=\"id\" href=\"#is_msix\">is_msix</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msix_mask_irq\">msix_mask_irq</a>(<a class=\"id\" href=\"#desc\">desc</a>, <a class=\"id\" href=\"#flag\">flag</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#desc\">desc</a>-><a class=\"id\" href=\"#mask_base\">mask_base</a>);<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Flush write to device */</span>", 
"<span class=\"ts\"/>} else {", 
"<span class=\"ts\"/><span class=\"ts\"/>unsigned <a class=\"id\" href=\"#offset\">offset</a> = <a class=\"id\" href=\"#irq\">irq</a> - <a class=\"id\" href=\"#desc\">desc</a>-><a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#irq\">irq</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msi_mask_irq\">msi_mask_irq</a>(<a class=\"id\" href=\"#desc\">desc</a>, 1 << <a class=\"id\" href=\"#offset\">offset</a>, <a class=\"id\" href=\"#flag\">flag</a> << <a class=\"id\" href=\"#offset\">offset</a>);", 
"<span class=\"ts\"/>}", 
"}", 
"", 
"void <a class=\"id\" href=\"#mask_msi_irq\">mask_msi_irq</a>(unsigned int <a class=\"id\" href=\"#irq\">irq</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#msi_set_mask_bit\">msi_set_mask_bit</a>(<a class=\"id\" href=\"#irq\">irq</a>, 1);", 
"}", 
"", 
"void <a class=\"id\" href=\"#unmask_msi_irq\">unmask_msi_irq</a>(unsigned int <a class=\"id\" href=\"#irq\">irq</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#msi_set_mask_bit\">msi_set_mask_bit</a>(<a class=\"id\" href=\"#irq\">irq</a>, 0);", 
"}", 
"", 
"void <a class=\"id\" href=\"#read_msi_msg_desc\">read_msi_msg_desc</a>(struct <a class=\"id\" href=\"#irq_desc\">irq_desc</a> *<a class=\"id\" href=\"#desc\">desc</a>, struct <a class=\"id\" href=\"#msi_msg\">msi_msg</a> *<a class=\"id\" href=\"#msg\">msg</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#msi_desc\">msi_desc</a> *<a class=\"id\" href=\"#entry\">entry</a> = <a class=\"id\" href=\"#get_irq_desc_msi\">get_irq_desc_msi</a>(<a class=\"id\" href=\"#desc\">desc</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#BUG_ON\">BUG_ON</a>(<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#current_state\">current_state</a> != <a class=\"id\" href=\"#PCI_D0\">PCI_D0</a>);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msi_attrib\">msi_attrib</a>.<a class=\"id\" href=\"#is_msix\">is_msix</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>void <a class=\"id\" href=\"#__iomem\">__iomem</a> *<a class=\"id\" href=\"#base\">base</a> = <a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#mask_base\">mask_base</a> +", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msi_attrib\">msi_attrib</a>.<a class=\"id\" href=\"#entry_nr\">entry_nr</a> * <a class=\"id\" href=\"#PCI_MSIX_ENTRY_SIZE\">PCI_MSIX_ENTRY_SIZE</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#address_lo\">address_lo</a> = <a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#base\">base</a> + <a class=\"id\" href=\"#PCI_MSIX_ENTRY_LOWER_ADDR\">PCI_MSIX_ENTRY_LOWER_ADDR</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#address_hi\">address_hi</a> = <a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#base\">base</a> + <a class=\"id\" href=\"#PCI_MSIX_ENTRY_UPPER_ADDR\">PCI_MSIX_ENTRY_UPPER_ADDR</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#data\">data</a> = <a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#base\">base</a> + <a class=\"id\" href=\"#PCI_MSIX_ENTRY_DATA\">PCI_MSIX_ENTRY_DATA</a>);", 
"<span class=\"ts\"/>} else {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a> = <a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#dev\">dev</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>int <a class=\"id\" href=\"#pos\">pos</a> = <a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msi_attrib\">msi_attrib</a>.<a class=\"id\" href=\"#pos\">pos</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#data\">data</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_dword\">pci_read_config_dword</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#msi_lower_address_reg\">msi_lower_address_reg</a>(<a class=\"id\" href=\"#pos\">pos</a>),", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>&amp;<a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#address_lo\">address_lo</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msi_attrib\">msi_attrib</a>.<a class=\"id\" href=\"#is_64\">is_64</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_dword\">pci_read_config_dword</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#msi_upper_address_reg\">msi_upper_address_reg</a>(<a class=\"id\" href=\"#pos\">pos</a>),", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>&amp;<a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#address_hi\">address_hi</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_word\">pci_read_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#msi_data_reg\">msi_data_reg</a>(<a class=\"id\" href=\"#pos\">pos</a>, 1), &amp;<a class=\"id\" href=\"#data\">data</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>} else {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#address_hi\">address_hi</a> = 0;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_word\">pci_read_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#msi_data_reg\">msi_data_reg</a>(<a class=\"id\" href=\"#pos\">pos</a>, 0), &amp;<a class=\"id\" href=\"#data\">data</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#data\">data</a> = <a class=\"id\" href=\"#data\">data</a>;", 
"<span class=\"ts\"/>}", 
"}", 
"", 
"void <a class=\"id\" href=\"#read_msi_msg\">read_msi_msg</a>(unsigned int <a class=\"id\" href=\"#irq\">irq</a>, struct <a class=\"id\" href=\"#msi_msg\">msi_msg</a> *<a class=\"id\" href=\"#msg\">msg</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#irq_desc\">irq_desc</a> *<a class=\"id\" href=\"#desc\">desc</a> = <a class=\"id\" href=\"#irq_to_desc\">irq_to_desc</a>(<a class=\"id\" href=\"#irq\">irq</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#read_msi_msg_desc\">read_msi_msg_desc</a>(<a class=\"id\" href=\"#desc\">desc</a>, <a class=\"id\" href=\"#msg\">msg</a>);", 
"}", 
"", 
"void <a class=\"id\" href=\"#get_cached_msi_msg_desc\">get_cached_msi_msg_desc</a>(struct <a class=\"id\" href=\"#irq_desc\">irq_desc</a> *<a class=\"id\" href=\"#desc\">desc</a>, struct <a class=\"id\" href=\"#msi_msg\">msi_msg</a> *<a class=\"id\" href=\"#msg\">msg</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#msi_desc\">msi_desc</a> *<a class=\"id\" href=\"#entry\">entry</a> = <a class=\"id\" href=\"#get_irq_desc_msi\">get_irq_desc_msi</a>(<a class=\"id\" href=\"#desc\">desc</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Assert that the cache is valid, assuming that</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * valid messages are not all-zeroes. */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#BUG_ON\">BUG_ON</a>(!(<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msg\">msg</a>.<a class=\"id\" href=\"#address_hi\">address_hi</a> | <a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msg\">msg</a>.<a class=\"id\" href=\"#address_lo\">address_lo</a> |", 
"<span class=\"ts\"/><span class=\"ts\"/> <a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msg\">msg</a>.<a class=\"id\" href=\"#data\">data</a>));", 
"", 
"<span class=\"ts\"/>*<a class=\"id\" href=\"#msg\">msg</a> = <a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msg\">msg</a>;", 
"}", 
"", 
"void <a class=\"id\" href=\"#get_cached_msi_msg\">get_cached_msi_msg</a>(unsigned int <a class=\"id\" href=\"#irq\">irq</a>, struct <a class=\"id\" href=\"#msi_msg\">msi_msg</a> *<a class=\"id\" href=\"#msg\">msg</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#irq_desc\">irq_desc</a> *<a class=\"id\" href=\"#desc\">desc</a> = <a class=\"id\" href=\"#irq_to_desc\">irq_to_desc</a>(<a class=\"id\" href=\"#irq\">irq</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#get_cached_msi_msg_desc\">get_cached_msi_msg_desc</a>(<a class=\"id\" href=\"#desc\">desc</a>, <a class=\"id\" href=\"#msg\">msg</a>);", 
"}", 
"", 
"void <a class=\"id\" href=\"#write_msi_msg_desc\">write_msi_msg_desc</a>(struct <a class=\"id\" href=\"#irq_desc\">irq_desc</a> *<a class=\"id\" href=\"#desc\">desc</a>, struct <a class=\"id\" href=\"#msi_msg\">msi_msg</a> *<a class=\"id\" href=\"#msg\">msg</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#msi_desc\">msi_desc</a> *<a class=\"id\" href=\"#entry\">entry</a> = <a class=\"id\" href=\"#get_irq_desc_msi\">get_irq_desc_msi</a>(<a class=\"id\" href=\"#desc\">desc</a>);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#current_state\">current_state</a> != <a class=\"id\" href=\"#PCI_D0\">PCI_D0</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Don't touch the hardware now */</span>", 
"<span class=\"ts\"/>} else if (<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msi_attrib\">msi_attrib</a>.<a class=\"id\" href=\"#is_msix\">is_msix</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>void <a class=\"id\" href=\"#__iomem\">__iomem</a> *<a class=\"id\" href=\"#base\">base</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#base\">base</a> = <a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#mask_base\">mask_base</a> +", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msi_attrib\">msi_attrib</a>.<a class=\"id\" href=\"#entry_nr\">entry_nr</a> * <a class=\"id\" href=\"#PCI_MSIX_ENTRY_SIZE\">PCI_MSIX_ENTRY_SIZE</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#address_lo\">address_lo</a>, <a class=\"id\" href=\"#base\">base</a> + <a class=\"id\" href=\"#PCI_MSIX_ENTRY_LOWER_ADDR\">PCI_MSIX_ENTRY_LOWER_ADDR</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#address_hi\">address_hi</a>, <a class=\"id\" href=\"#base\">base</a> + <a class=\"id\" href=\"#PCI_MSIX_ENTRY_UPPER_ADDR\">PCI_MSIX_ENTRY_UPPER_ADDR</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#writel\">writel</a>(<a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#data\">data</a>, <a class=\"id\" href=\"#base\">base</a> + <a class=\"id\" href=\"#PCI_MSIX_ENTRY_DATA\">PCI_MSIX_ENTRY_DATA</a>);", 
"<span class=\"ts\"/>} else {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a> = <a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#dev\">dev</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>int <a class=\"id\" href=\"#pos\">pos</a> = <a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msi_attrib\">msi_attrib</a>.<a class=\"id\" href=\"#pos\">pos</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#msgctl\">msgctl</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_word\">pci_read_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#msi_control_reg\">msi_control_reg</a>(<a class=\"id\" href=\"#pos\">pos</a>), &amp;<a class=\"id\" href=\"#msgctl\">msgctl</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msgctl\">msgctl</a> &= ~<a class=\"id\" href=\"#PCI_MSI_FLAGS_QSIZE\">PCI_MSI_FLAGS_QSIZE</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msgctl\">msgctl</a> |= <a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msi_attrib\">msi_attrib</a>.<a class=\"id\" href=\"#multiple\">multiple</a> << 4;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_word\">pci_write_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#msi_control_reg\">msi_control_reg</a>(<a class=\"id\" href=\"#pos\">pos</a>), <a class=\"id\" href=\"#msgctl\">msgctl</a>);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_dword\">pci_write_config_dword</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#msi_lower_address_reg\">msi_lower_address_reg</a>(<a class=\"id\" href=\"#pos\">pos</a>),", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#address_lo\">address_lo</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msi_attrib\">msi_attrib</a>.<a class=\"id\" href=\"#is_64\">is_64</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_dword\">pci_write_config_dword</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#msi_upper_address_reg\">msi_upper_address_reg</a>(<a class=\"id\" href=\"#pos\">pos</a>),", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#address_hi\">address_hi</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_word\">pci_write_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#msi_data_reg\">msi_data_reg</a>(<a class=\"id\" href=\"#pos\">pos</a>, 1),", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#data\">data</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>} else {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_word\">pci_write_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#msi_data_reg\">msi_data_reg</a>(<a class=\"id\" href=\"#pos\">pos</a>, 0),", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msg\">msg</a>-><a class=\"id\" href=\"#data\">data</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msg\">msg</a> = *<a class=\"id\" href=\"#msg\">msg</a>;", 
"}", 
"", 
"void <a class=\"id\" href=\"#write_msi_msg\">write_msi_msg</a>(unsigned int <a class=\"id\" href=\"#irq\">irq</a>, struct <a class=\"id\" href=\"#msi_msg\">msi_msg</a> *<a class=\"id\" href=\"#msg\">msg</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#irq_desc\">irq_desc</a> *<a class=\"id\" href=\"#desc\">desc</a> = <a class=\"id\" href=\"#irq_to_desc\">irq_to_desc</a>(<a class=\"id\" href=\"#irq\">irq</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#write_msi_msg_desc\">write_msi_msg_desc</a>(<a class=\"id\" href=\"#desc\">desc</a>, <a class=\"id\" href=\"#msg\">msg</a>);", 
"}", 
"", 
"static void <a class=\"id\" href=\"#free_msi_irqs\">free_msi_irqs</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#msi_desc\">msi_desc</a> *<a class=\"id\" href=\"#entry\">entry</a>, *<a class=\"id\" href=\"#tmp\">tmp</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_for_each_entry\">list_for_each_entry</a>(<a class=\"id\" href=\"#entry\">entry</a>, &amp;<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#msi_list\">msi_list</a>, <a class=\"id\" href=\"#list\">list</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>int <a class=\"id\" href=\"#i\">i</a>, <a class=\"id\" href=\"#nvec\">nvec</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#irq\">irq</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#nvec\">nvec</a> = 1 << <a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msi_attrib\">msi_attrib</a>.<a class=\"id\" href=\"#multiple\">multiple</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = 0; <a class=\"id\" href=\"#i\">i</a> &lt; <a class=\"id\" href=\"#nvec\">nvec</a>; <a class=\"id\" href=\"#i\">i</a>++)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#BUG_ON\">BUG_ON</a>(<a class=\"id\" href=\"#irq_has_action\">irq_has_action</a>(<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#irq\">irq</a> + <a class=\"id\" href=\"#i\">i</a>));", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#arch_teardown_msi_irqs\">arch_teardown_msi_irqs</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_for_each_entry_safe\">list_for_each_entry_safe</a>(<a class=\"id\" href=\"#entry\">entry</a>, <a class=\"id\" href=\"#tmp\">tmp</a>, &amp;<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#msi_list\">msi_list</a>, <a class=\"id\" href=\"#list\">list</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msi_attrib\">msi_attrib</a>.<a class=\"id\" href=\"#is_msix\">is_msix</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#list_is_last\">list_is_last</a>(&amp;<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#list\">list</a>, &amp;<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#msi_list\">msi_list</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#iounmap\">iounmap</a>(<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#mask_base\">mask_base</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#list_del\">list_del</a>(&amp;<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#list\">list</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#entry\">entry</a>);", 
"<span class=\"ts\"/>}", 
"}", 
"", 
"static struct <a class=\"id\" href=\"#msi_desc\">msi_desc</a> *<a class=\"id\" href=\"#alloc_msi_entry\">alloc_msi_entry</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#msi_desc\">msi_desc</a> *<a class=\"id\" href=\"#desc\">desc</a> = <a class=\"id\" href=\"#kzalloc\">kzalloc</a>(sizeof(*<a class=\"id\" href=\"#desc\">desc</a>), <a class=\"id\" href=\"#GFP_KERNEL\">GFP_KERNEL</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#desc\">desc</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#INIT_LIST_HEAD\">INIT_LIST_HEAD</a>(&amp;<a class=\"id\" href=\"#desc\">desc</a>-><a class=\"id\" href=\"#list\">list</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#desc\">desc</a>-><a class=\"id\" href=\"#dev\">dev</a> = <a class=\"id\" href=\"#dev\">dev</a>;", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#desc\">desc</a>;", 
"}", 
"", 
"static void <a class=\"id\" href=\"#pci_intx_for_msi\">pci_intx_for_msi</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>, int <a class=\"id\" href=\"#enable\">enable</a>)", 
"{", 
"<span class=\"ts\"/>if (!(<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#dev_flags\">dev_flags</a> &amp; <a class=\"id\" href=\"#PCI_DEV_FLAGS_MSI_INTX_DISABLE_BUG\">PCI_DEV_FLAGS_MSI_INTX_DISABLE_BUG</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pci_intx\">pci_intx</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#enable\">enable</a>);", 
"}", 
"", 
"static void <a class=\"id\" href=\"#__pci_restore_msi_state\">__pci_restore_msi_state</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#pos\">pos</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#control\">control</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#msi_desc\">msi_desc</a> *<a class=\"id\" href=\"#entry\">entry</a>;", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#msi_enabled\">msi_enabled</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#entry\">entry</a> = <a class=\"id\" href=\"#get_irq_msi\">get_irq_msi</a>(<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#irq\">irq</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pos\">pos</a> = <a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msi_attrib\">msi_attrib</a>.<a class=\"id\" href=\"#pos\">pos</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_intx_for_msi\">pci_intx_for_msi</a>(<a class=\"id\" href=\"#dev\">dev</a>, 0);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#msi_set_enable\">msi_set_enable</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a>, 0);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#write_msi_msg\">write_msi_msg</a>(<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#irq\">irq</a>, &amp;<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msg\">msg</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_word\">pci_read_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_MSI_FLAGS\">PCI_MSI_FLAGS</a>, &amp;<a class=\"id\" href=\"#control\">control</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#msi_mask_irq\">msi_mask_irq</a>(<a class=\"id\" href=\"#entry\">entry</a>, <a class=\"id\" href=\"#msi_capable_mask\">msi_capable_mask</a>(<a class=\"id\" href=\"#control\">control</a>), <a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#masked\">masked</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#control\">control</a> &= ~<a class=\"id\" href=\"#PCI_MSI_FLAGS_QSIZE\">PCI_MSI_FLAGS_QSIZE</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#control\">control</a> |= (<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msi_attrib\">msi_attrib</a>.<a class=\"id\" href=\"#multiple\">multiple</a> << 4) | <a class=\"id\" href=\"#PCI_MSI_FLAGS_ENABLE\">PCI_MSI_FLAGS_ENABLE</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_word\">pci_write_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_MSI_FLAGS\">PCI_MSI_FLAGS</a>, <a class=\"id\" href=\"#control\">control</a>);", 
"}", 
"", 
"static void <a class=\"id\" href=\"#__pci_restore_msix_state\">__pci_restore_msix_state</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#pos\">pos</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#msi_desc\">msi_desc</a> *<a class=\"id\" href=\"#entry\">entry</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#control\">control</a>;", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#msix_enabled\">msix_enabled</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#BUG_ON\">BUG_ON</a>(<a class=\"id\" href=\"#list_empty\">list_empty</a>(&amp;<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#msi_list\">msi_list</a>));", 
"<span class=\"ts\"/><a class=\"id\" href=\"#entry\">entry</a> = <a class=\"id\" href=\"#list_first_entry\">list_first_entry</a>(&amp;<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#msi_list\">msi_list</a>, struct <a class=\"id\" href=\"#msi_desc\">msi_desc</a>, <a class=\"id\" href=\"#list\">list</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pos\">pos</a> = <a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msi_attrib\">msi_attrib</a>.<a class=\"id\" href=\"#pos\">pos</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_word\">pci_read_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_MSIX_FLAGS\">PCI_MSIX_FLAGS</a>, &amp;<a class=\"id\" href=\"#control\">control</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* route the table */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_intx_for_msi\">pci_intx_for_msi</a>(<a class=\"id\" href=\"#dev\">dev</a>, 0);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#control\">control</a> |= <a class=\"id\" href=\"#PCI_MSIX_FLAGS_ENABLE\">PCI_MSIX_FLAGS_ENABLE</a> | <a class=\"id\" href=\"#PCI_MSIX_FLAGS_MASKALL\">PCI_MSIX_FLAGS_MASKALL</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_word\">pci_write_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_MSIX_FLAGS\">PCI_MSIX_FLAGS</a>, <a class=\"id\" href=\"#control\">control</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_for_each_entry\">list_for_each_entry</a>(<a class=\"id\" href=\"#entry\">entry</a>, &amp;<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#msi_list\">msi_list</a>, <a class=\"id\" href=\"#list\">list</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#write_msi_msg\">write_msi_msg</a>(<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#irq\">irq</a>, &amp;<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msg\">msg</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msix_mask_irq\">msix_mask_irq</a>(<a class=\"id\" href=\"#entry\">entry</a>, <a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#masked\">masked</a>);", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#control\">control</a> &= ~<a class=\"id\" href=\"#PCI_MSIX_FLAGS_MASKALL\">PCI_MSIX_FLAGS_MASKALL</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_word\">pci_write_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_MSIX_FLAGS\">PCI_MSIX_FLAGS</a>, <a class=\"id\" href=\"#control\">control</a>);", 
"}", 
"", 
"void <a class=\"id\" href=\"#pci_restore_msi_state\">pci_restore_msi_state</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#__pci_restore_msi_state\">__pci_restore_msi_state</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#__pci_restore_msix_state\">__pci_restore_msix_state</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#pci_restore_msi_state\">pci_restore_msi_state</a>);", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * msi_capability_init - configure device's MSI capability structure</span>", 
"<span class=\"comment\"> * @dev: pointer to the pci_dev data structure of MSI device function</span>", 
"<span class=\"comment\"> * @nvec: number of interrupts to allocate</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Setup the MSI capability structure of the device with the requested</span>", 
"<span class=\"comment\"> * number of interrupts.  A return value of zero indicates the successful</span>", 
"<span class=\"comment\"> * setup of an entry with the new MSI irq.  A negative return value indicates</span>", 
"<span class=\"comment\"> * an error, and a positive return value indicates the number of interrupts</span>", 
"<span class=\"comment\"> * which could have been allocated.</span>", 
"<span class=\"comment\"> */</span>", 
"static int <a class=\"id\" href=\"#msi_capability_init\">msi_capability_init</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>, int <a class=\"id\" href=\"#nvec\">nvec</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#msi_desc\">msi_desc</a> *<a class=\"id\" href=\"#entry\">entry</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#pos\">pos</a>, <a class=\"id\" href=\"#ret\">ret</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#control\">control</a>;", 
"<span class=\"ts\"/>unsigned <a class=\"id\" href=\"#mask\">mask</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pos\">pos</a> = <a class=\"id\" href=\"#pci_find_capability\">pci_find_capability</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#PCI_CAP_ID_MSI\">PCI_CAP_ID_MSI</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#msi_set_enable\">msi_set_enable</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a>, 0);<span class=\"ts\"/><span class=\"comment\">/* Disable MSI during set up */</span>", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_word\">pci_read_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#msi_control_reg\">msi_control_reg</a>(<a class=\"id\" href=\"#pos\">pos</a>), &amp;<a class=\"id\" href=\"#control\">control</a>);", 
"<span class=\"ts\"/><span class=\"comment\">/* MSI Entry Initialization */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#entry\">entry</a> = <a class=\"id\" href=\"#alloc_msi_entry\">alloc_msi_entry</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#entry\">entry</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msi_attrib\">msi_attrib</a>.<a class=\"id\" href=\"#is_msix\">is_msix</a><span class=\"ts\"/>= 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msi_attrib\">msi_attrib</a>.<a class=\"id\" href=\"#is_64\">is_64</a><span class=\"ts\"/><span class=\"ts\"/>= <a class=\"id\" href=\"#is_64bit_address\">is_64bit_address</a>(<a class=\"id\" href=\"#control\">control</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msi_attrib\">msi_attrib</a>.<a class=\"id\" href=\"#entry_nr\">entry_nr</a><span class=\"ts\"/>= 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msi_attrib\">msi_attrib</a>.<a class=\"id\" href=\"#maskbit\">maskbit</a><span class=\"ts\"/>= <a class=\"id\" href=\"#is_mask_bit_support\">is_mask_bit_support</a>(<a class=\"id\" href=\"#control\">control</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msi_attrib\">msi_attrib</a>.<a class=\"id\" href=\"#default_irq\">default_irq</a><span class=\"ts\"/>= <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#irq\">irq</a>;<span class=\"ts\"/><span class=\"comment\">/* Save IOAPIC IRQ */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msi_attrib\">msi_attrib</a>.<a class=\"id\" href=\"#pos\">pos</a><span class=\"ts\"/><span class=\"ts\"/>= <a class=\"id\" href=\"#pos\">pos</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#mask_pos\">mask_pos</a> = <a class=\"id\" href=\"#msi_mask_reg\">msi_mask_reg</a>(<a class=\"id\" href=\"#pos\">pos</a>, <a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msi_attrib\">msi_attrib</a>.<a class=\"id\" href=\"#is_64\">is_64</a>);", 
"<span class=\"ts\"/><span class=\"comment\">/* All MSIs are unmasked by default, Mask them all */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msi_attrib\">msi_attrib</a>.<a class=\"id\" href=\"#maskbit\">maskbit</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_dword\">pci_read_config_dword</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#mask_pos\">mask_pos</a>, &amp;<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#masked\">masked</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mask\">mask</a> = <a class=\"id\" href=\"#msi_capable_mask\">msi_capable_mask</a>(<a class=\"id\" href=\"#control\">control</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#msi_mask_irq\">msi_mask_irq</a>(<a class=\"id\" href=\"#entry\">entry</a>, <a class=\"id\" href=\"#mask\">mask</a>, <a class=\"id\" href=\"#mask\">mask</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_add_tail\">list_add_tail</a>(&amp;<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#list\">list</a>, &amp;<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#msi_list\">msi_list</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Configure MSI capability structure */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#arch_setup_msi_irqs\">arch_setup_msi_irqs</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#nvec\">nvec</a>, <a class=\"id\" href=\"#PCI_CAP_ID_MSI\">PCI_CAP_ID_MSI</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#ret\">ret</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msi_mask_irq\">msi_mask_irq</a>(<a class=\"id\" href=\"#entry\">entry</a>, <a class=\"id\" href=\"#mask\">mask</a>, ~<a class=\"id\" href=\"#mask\">mask</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#free_msi_irqs\">free_msi_irqs</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#ret\">ret</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Set MSI enabled bits<span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_intx_for_msi\">pci_intx_for_msi</a>(<a class=\"id\" href=\"#dev\">dev</a>, 0);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#msi_set_enable\">msi_set_enable</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a>, 1);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#msi_enabled\">msi_enabled</a> = 1;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#irq\">irq</a> = <a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#irq\">irq</a>;", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"static void <a class=\"id\" href=\"#__iomem\">__iomem</a> *<a class=\"id\" href=\"#msix_map_region\">msix_map_region</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>, unsigned <a class=\"id\" href=\"#pos\">pos</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>unsigned <a class=\"id\" href=\"#nr_entries\">nr_entries</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#resource_size_t\">resource_size_t</a> <a class=\"id\" href=\"#phys_addr\">phys_addr</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#table_offset\">table_offset</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u8\">u8</a> <a class=\"id\" href=\"#bir\">bir</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_dword\">pci_read_config_dword</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#msix_table_offset_reg\">msix_table_offset_reg</a>(<a class=\"id\" href=\"#pos\">pos</a>), &amp;<a class=\"id\" href=\"#table_offset\">table_offset</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bir\">bir</a> = (<a class=\"id\" href=\"#u8\">u8</a>)(<a class=\"id\" href=\"#table_offset\">table_offset</a> &amp; <a class=\"id\" href=\"#PCI_MSIX_FLAGS_BIRMASK\">PCI_MSIX_FLAGS_BIRMASK</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#table_offset\">table_offset</a> &= ~<a class=\"id\" href=\"#PCI_MSIX_FLAGS_BIRMASK\">PCI_MSIX_FLAGS_BIRMASK</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#phys_addr\">phys_addr</a> = <a class=\"id\" href=\"#pci_resource_start\">pci_resource_start</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#bir\">bir</a>) + <a class=\"id\" href=\"#table_offset\">table_offset</a>;", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ioremap_nocache\">ioremap_nocache</a>(<a class=\"id\" href=\"#phys_addr\">phys_addr</a>, <a class=\"id\" href=\"#nr_entries\">nr_entries</a> * <a class=\"id\" href=\"#PCI_MSIX_ENTRY_SIZE\">PCI_MSIX_ENTRY_SIZE</a>);", 
"}", 
"", 
"static int <a class=\"id\" href=\"#msix_setup_entries\">msix_setup_entries</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>, unsigned <a class=\"id\" href=\"#pos\">pos</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>void <a class=\"id\" href=\"#__iomem\">__iomem</a> *<a class=\"id\" href=\"#base\">base</a>, struct <a class=\"id\" href=\"#msix_entry\">msix_entry</a> *<a class=\"id\" href=\"#entries\">entries</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>int <a class=\"id\" href=\"#nvec\">nvec</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#msi_desc\">msi_desc</a> *<a class=\"id\" href=\"#entry\">entry</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#i\">i</a>;", 
"", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = 0; <a class=\"id\" href=\"#i\">i</a> &lt; <a class=\"id\" href=\"#nvec\">nvec</a>; <a class=\"id\" href=\"#i\">i</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#entry\">entry</a> = <a class=\"id\" href=\"#alloc_msi_entry\">alloc_msi_entry</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#entry\">entry</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#i\">i</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#iounmap\">iounmap</a>(<a class=\"id\" href=\"#base\">base</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>else", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#free_msi_irqs\">free_msi_irqs</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* No enough memory. Don't try again */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msi_attrib\">msi_attrib</a>.<a class=\"id\" href=\"#is_msix\">is_msix</a><span class=\"ts\"/>= 1;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msi_attrib\">msi_attrib</a>.<a class=\"id\" href=\"#is_64\">is_64</a><span class=\"ts\"/><span class=\"ts\"/>= 1;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msi_attrib\">msi_attrib</a>.<a class=\"id\" href=\"#entry_nr\">entry_nr</a><span class=\"ts\"/>= <a class=\"id\" href=\"#entries\">entries</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#entry\">entry</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msi_attrib\">msi_attrib</a>.<a class=\"id\" href=\"#default_irq\">default_irq</a><span class=\"ts\"/>= <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#irq\">irq</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#msi_attrib\">msi_attrib</a>.<a class=\"id\" href=\"#pos\">pos</a><span class=\"ts\"/><span class=\"ts\"/>= <a class=\"id\" href=\"#pos\">pos</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#mask_base\">mask_base</a><span class=\"ts\"/><span class=\"ts\"/>= <a class=\"id\" href=\"#base\">base</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#list_add_tail\">list_add_tail</a>(&amp;<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#list\">list</a>, &amp;<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#msi_list\">msi_list</a>);", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"static void <a class=\"id\" href=\"#msix_program_entries\">msix_program_entries</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#msix_entry\">msix_entry</a> *<a class=\"id\" href=\"#entries\">entries</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#msi_desc\">msi_desc</a> *<a class=\"id\" href=\"#entry\">entry</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#i\">i</a> = 0;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_for_each_entry\">list_for_each_entry</a>(<a class=\"id\" href=\"#entry\">entry</a>, &amp;<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#msi_list\">msi_list</a>, <a class=\"id\" href=\"#list\">list</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>int <a class=\"id\" href=\"#offset\">offset</a> = <a class=\"id\" href=\"#entries\">entries</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#entry\">entry</a> * <a class=\"id\" href=\"#PCI_MSIX_ENTRY_SIZE\">PCI_MSIX_ENTRY_SIZE</a> +", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#PCI_MSIX_ENTRY_VECTOR_CTRL\">PCI_MSIX_ENTRY_VECTOR_CTRL</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#entries\">entries</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#vector\">vector</a> = <a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#irq\">irq</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#set_irq_msi\">set_irq_msi</a>(<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#irq\">irq</a>, <a class=\"id\" href=\"#entry\">entry</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#masked\">masked</a> = <a class=\"id\" href=\"#readl\">readl</a>(<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#mask_base\">mask_base</a> + <a class=\"id\" href=\"#offset\">offset</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#msix_mask_irq\">msix_mask_irq</a>(<a class=\"id\" href=\"#entry\">entry</a>, 1);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#i\">i</a>++;", 
"<span class=\"ts\"/>}", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * msix_capability_init - configure device's MSI-X capability</span>", 
"<span class=\"comment\"> * @dev: pointer to the pci_dev data structure of MSI-X device function</span>", 
"<span class=\"comment\"> * @entries: pointer to an array of struct msix_entry entries</span>", 
"<span class=\"comment\"> * @nvec: number of @entries</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Setup the MSI-X capability structure of device function with a</span>", 
"<span class=\"comment\"> * single MSI-X irq. A return of zero indicates the successful setup of</span>", 
"<span class=\"comment\"> * requested MSI-X entries with allocated irqs or non-zero for otherwise.</span>", 
"<span class=\"comment\"> **/</span>", 
"static int <a class=\"id\" href=\"#msix_capability_init\">msix_capability_init</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#msix_entry\">msix_entry</a> *<a class=\"id\" href=\"#entries\">entries</a>, int <a class=\"id\" href=\"#nvec\">nvec</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#pos\">pos</a>, <a class=\"id\" href=\"#ret\">ret</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#control\">control</a>;", 
"<span class=\"ts\"/>void <a class=\"id\" href=\"#__iomem\">__iomem</a> *<a class=\"id\" href=\"#base\">base</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pos\">pos</a> = <a class=\"id\" href=\"#pci_find_capability\">pci_find_capability</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#PCI_CAP_ID_MSIX\">PCI_CAP_ID_MSIX</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_word\">pci_read_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_MSIX_FLAGS\">PCI_MSIX_FLAGS</a>, &amp;<a class=\"id\" href=\"#control\">control</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Ensure MSI-X is disabled while it is set up */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#control\">control</a> &= ~<a class=\"id\" href=\"#PCI_MSIX_FLAGS_ENABLE\">PCI_MSIX_FLAGS_ENABLE</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_word\">pci_write_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_MSIX_FLAGS\">PCI_MSIX_FLAGS</a>, <a class=\"id\" href=\"#control\">control</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Request &amp; Map MSI-X table region */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#base\">base</a> = <a class=\"id\" href=\"#msix_map_region\">msix_map_region</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a>, <a class=\"id\" href=\"#multi_msix_capable\">multi_msix_capable</a>(<a class=\"id\" href=\"#control\">control</a>));", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#base\">base</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#msix_setup_entries\">msix_setup_entries</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a>, <a class=\"id\" href=\"#base\">base</a>, <a class=\"id\" href=\"#entries\">entries</a>, <a class=\"id\" href=\"#nvec\">nvec</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#ret\">ret</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#ret\">ret</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#arch_setup_msi_irqs\">arch_setup_msi_irqs</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#nvec\">nvec</a>, <a class=\"id\" href=\"#PCI_CAP_ID_MSIX\">PCI_CAP_ID_MSIX</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#ret\">ret</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#error\">error</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Some devices require MSI-X to be enabled before we can touch the</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * MSI-X registers.  We need to mask all the vectors to prevent</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * interrupts coming in before they're fully set up.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#control\">control</a> |= <a class=\"id\" href=\"#PCI_MSIX_FLAGS_MASKALL\">PCI_MSIX_FLAGS_MASKALL</a> | <a class=\"id\" href=\"#PCI_MSIX_FLAGS_ENABLE\">PCI_MSIX_FLAGS_ENABLE</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_word\">pci_write_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_MSIX_FLAGS\">PCI_MSIX_FLAGS</a>, <a class=\"id\" href=\"#control\">control</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#msix_program_entries\">msix_program_entries</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#entries\">entries</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Set MSI-X enabled bits and unmask the function */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_intx_for_msi\">pci_intx_for_msi</a>(<a class=\"id\" href=\"#dev\">dev</a>, 0);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#msix_enabled\">msix_enabled</a> = 1;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#control\">control</a> &= ~<a class=\"id\" href=\"#PCI_MSIX_FLAGS_MASKALL\">PCI_MSIX_FLAGS_MASKALL</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_word\">pci_write_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_MSIX_FLAGS\">PCI_MSIX_FLAGS</a>, <a class=\"id\" href=\"#control\">control</a>);", 
"", 
"<span class=\"ts\"/>return 0;", 
"", 
"<a class=\"id\" href=\"#error\">error</a>:", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#ret\">ret</a> &lt; 0) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * If we had some success, report the number of irqs</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * we succeeded in setting up.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#msi_desc\">msi_desc</a> *<a class=\"id\" href=\"#entry\">entry</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>int <a class=\"id\" href=\"#avail\">avail</a> = 0;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#list_for_each_entry\">list_for_each_entry</a>(<a class=\"id\" href=\"#entry\">entry</a>, &amp;<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#msi_list\">msi_list</a>, <a class=\"id\" href=\"#list\">list</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#entry\">entry</a>-><a class=\"id\" href=\"#irq\">irq</a> != 0)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#avail\">avail</a>++;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#avail\">avail</a> != 0)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#avail\">avail</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#free_msi_irqs\">free_msi_irqs</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ret\">ret</a>;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * pci_msi_check_device - check whether MSI may be enabled on a device</span>", 
"<span class=\"comment\"> * @dev: pointer to the pci_dev data structure of MSI device function</span>", 
"<span class=\"comment\"> * @nvec: how many MSIs have been requested ?</span>", 
"<span class=\"comment\"> * @type: are we checking for MSI or MSI-X ?</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Look at global flags, the device itself, and its parent busses</span>", 
"<span class=\"comment\"> * to determine if MSI/-X are supported for the device. If MSI/-X is</span>", 
"<span class=\"comment\"> * supported return 0, else return an error code.</span>", 
"<span class=\"comment\"> **/</span>", 
"static int <a class=\"id\" href=\"#pci_msi_check_device\">pci_msi_check_device</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>, int <a class=\"id\" href=\"#nvec\">nvec</a>, int <a class=\"id\" href=\"#type\">type</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#pci_bus\">pci_bus</a> *<a class=\"id\" href=\"#bus\">bus</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#ret\">ret</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* MSI must be globally enabled and supported by the device */</span>", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#pci_msi_enable\">pci_msi_enable</a> || !<a class=\"id\" href=\"#dev\">dev</a> || <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#no_msi\">no_msi</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * You can't ask to have 0 or less MSIs configured.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> *  a) it's stupid ..</span>", 
"<span class=\"comment\"><span class=\"ts\"/> *  b) the list manipulation code assumes nvec &gt;= 1.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#nvec\">nvec</a> &lt; 1)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ERANGE\">ERANGE</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Any bridge which does NOT route MSI transactions from its</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * secondary bus to its primary bus must set NO_MSI flag on</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * the secondary pci_bus.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * We expect only arch-specific PCI host bus controller driver</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * or quirks for specific PCI bridges to be setting NO_MSI.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#bus\">bus</a> = <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#bus\">bus</a>; <a class=\"id\" href=\"#bus\">bus</a>; <a class=\"id\" href=\"#bus\">bus</a> = <a class=\"id\" href=\"#bus\">bus</a>-><a class=\"id\" href=\"#parent\">parent</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#bus\">bus</a>-><a class=\"id\" href=\"#bus_flags\">bus_flags</a> &amp; <a class=\"id\" href=\"#PCI_BUS_FLAGS_NO_MSI\">PCI_BUS_FLAGS_NO_MSI</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#arch_msi_check_device\">arch_msi_check_device</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#nvec\">nvec</a>, <a class=\"id\" href=\"#type\">type</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#ret\">ret</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#ret\">ret</a>;", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#pci_find_capability\">pci_find_capability</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#type\">type</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * pci_enable_msi_block - configure device's MSI capability structure</span>", 
"<span class=\"comment\"> * @dev: device to configure</span>", 
"<span class=\"comment\"> * @nvec: number of interrupts to configure</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Allocate IRQs for a device with the MSI capability.</span>", 
"<span class=\"comment\"> * This function returns a negative errno if an error occurs.  If it</span>", 
"<span class=\"comment\"> * is unable to allocate the number of interrupts requested, it returns</span>", 
"<span class=\"comment\"> * the number of interrupts it might be able to allocate.  If it successfully</span>", 
"<span class=\"comment\"> * allocates at least the number of interrupts requested, it returns 0 and</span>", 
"<span class=\"comment\"> * updates the @dev's irq member to the lowest new interrupt number; the</span>", 
"<span class=\"comment\"> * other interrupt numbers allocated to this device are consecutive.</span>", 
"<span class=\"comment\"> */</span>", 
"int <a class=\"id\" href=\"#pci_enable_msi_block\">pci_enable_msi_block</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>, unsigned int <a class=\"id\" href=\"#nvec\">nvec</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#status\">status</a>, <a class=\"id\" href=\"#pos\">pos</a>, <a class=\"id\" href=\"#maxvec\">maxvec</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#msgctl\">msgctl</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pos\">pos</a> = <a class=\"id\" href=\"#pci_find_capability\">pci_find_capability</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#PCI_CAP_ID_MSI\">PCI_CAP_ID_MSI</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#pos\">pos</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_word\">pci_read_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_MSI_FLAGS\">PCI_MSI_FLAGS</a>, &amp;<a class=\"id\" href=\"#msgctl\">msgctl</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#maxvec\">maxvec</a> = 1 << ((<a class=\"id\" href=\"#msgctl\">msgctl</a> &amp; <a class=\"id\" href=\"#PCI_MSI_FLAGS_QMASK\">PCI_MSI_FLAGS_QMASK</a>) >> 1);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#nvec\">nvec</a> &gt; <a class=\"id\" href=\"#maxvec\">maxvec</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#maxvec\">maxvec</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#status\">status</a> = <a class=\"id\" href=\"#pci_msi_check_device\">pci_msi_check_device</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#nvec\">nvec</a>, <a class=\"id\" href=\"#PCI_CAP_ID_MSI\">PCI_CAP_ID_MSI</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#status\">status</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#status\">status</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#WARN_ON\">WARN_ON</a>(!!<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#msi_enabled\">msi_enabled</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Check whether driver already requested MSI-X irqs */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#msix_enabled\">msix_enabled</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#dev_info\">dev_info</a>(&amp;<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#dev\">dev</a>, \"can't enable MSI \"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> \"(MSI-X already enabled)\\n\");", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#status\">status</a> = <a class=\"id\" href=\"#msi_capability_init\">msi_capability_init</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#nvec\">nvec</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#status\">status</a>;", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL\">EXPORT_SYMBOL</a>(<a class=\"id\" href=\"#pci_enable_msi_block\">pci_enable_msi_block</a>);", 
"", 
"void <a class=\"id\" href=\"#pci_msi_shutdown\">pci_msi_shutdown</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#msi_desc\">msi_desc</a> *<a class=\"id\" href=\"#desc\">desc</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#mask\">mask</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#ctrl\">ctrl</a>;", 
"<span class=\"ts\"/>unsigned <a class=\"id\" href=\"#pos\">pos</a>;", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#pci_msi_enable\">pci_msi_enable</a> || !<a class=\"id\" href=\"#dev\">dev</a> || !<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#msi_enabled\">msi_enabled</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#BUG_ON\">BUG_ON</a>(<a class=\"id\" href=\"#list_empty\">list_empty</a>(&amp;<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#msi_list\">msi_list</a>));", 
"<span class=\"ts\"/><a class=\"id\" href=\"#desc\">desc</a> = <a class=\"id\" href=\"#list_first_entry\">list_first_entry</a>(&amp;<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#msi_list\">msi_list</a>, struct <a class=\"id\" href=\"#msi_desc\">msi_desc</a>, <a class=\"id\" href=\"#list\">list</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pos\">pos</a> = <a class=\"id\" href=\"#desc\">desc</a>-><a class=\"id\" href=\"#msi_attrib\">msi_attrib</a>.<a class=\"id\" href=\"#pos\">pos</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#msi_set_enable\">msi_set_enable</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a>, 0);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_intx_for_msi\">pci_intx_for_msi</a>(<a class=\"id\" href=\"#dev\">dev</a>, 1);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#msi_enabled\">msi_enabled</a> = 0;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Return the device with MSI unmasked as initial states */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_word\">pci_read_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_MSI_FLAGS\">PCI_MSI_FLAGS</a>, &amp;<a class=\"id\" href=\"#ctrl\">ctrl</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mask\">mask</a> = <a class=\"id\" href=\"#msi_capable_mask\">msi_capable_mask</a>(<a class=\"id\" href=\"#ctrl\">ctrl</a>);", 
"<span class=\"ts\"/><span class=\"comment\">/* Keep cached state to be restored */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#__msi_mask_irq\">__msi_mask_irq</a>(<a class=\"id\" href=\"#desc\">desc</a>, <a class=\"id\" href=\"#mask\">mask</a>, ~<a class=\"id\" href=\"#mask\">mask</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Restore dev-&gt;irq to its default pin-assertion irq */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#irq\">irq</a> = <a class=\"id\" href=\"#desc\">desc</a>-><a class=\"id\" href=\"#msi_attrib\">msi_attrib</a>.<a class=\"id\" href=\"#default_irq\">default_irq</a>;", 
"}", 
"", 
"void <a class=\"id\" href=\"#pci_disable_msi\">pci_disable_msi</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#pci_msi_enable\">pci_msi_enable</a> || !<a class=\"id\" href=\"#dev\">dev</a> || !<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#msi_enabled\">msi_enabled</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_msi_shutdown\">pci_msi_shutdown</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#free_msi_irqs\">free_msi_irqs</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL\">EXPORT_SYMBOL</a>(<a class=\"id\" href=\"#pci_disable_msi\">pci_disable_msi</a>);", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * pci_msix_table_size - return the number of device's MSI-X table entries</span>", 
"<span class=\"comment\"> * @dev: pointer to the pci_dev data structure of MSI-X device function</span>", 
"<span class=\"comment\"> */</span>", 
"int <a class=\"id\" href=\"#pci_msix_table_size\">pci_msix_table_size</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#pos\">pos</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#control\">control</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pos\">pos</a> = <a class=\"id\" href=\"#pci_find_capability\">pci_find_capability</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#PCI_CAP_ID_MSIX\">PCI_CAP_ID_MSIX</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#pos\">pos</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_word\">pci_read_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#msi_control_reg\">msi_control_reg</a>(<a class=\"id\" href=\"#pos\">pos</a>), &amp;<a class=\"id\" href=\"#control\">control</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#multi_msix_capable\">multi_msix_capable</a>(<a class=\"id\" href=\"#control\">control</a>);", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * pci_enable_msix - configure device's MSI-X capability structure</span>", 
"<span class=\"comment\"> * @dev: pointer to the pci_dev data structure of MSI-X device function</span>", 
"<span class=\"comment\"> * @entries: pointer to an array of MSI-X entries</span>", 
"<span class=\"comment\"> * @nvec: number of MSI-X irqs requested for allocation by device driver</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Setup the MSI-X capability structure of device function with the number</span>", 
"<span class=\"comment\"> * of requested irqs upon its software driver call to request for</span>", 
"<span class=\"comment\"> * MSI-X mode enabled on its hardware device function. A return of zero</span>", 
"<span class=\"comment\"> * indicates the successful configuration of MSI-X capability structure</span>", 
"<span class=\"comment\"> * with new allocated MSI-X irqs. A return of &lt; 0 indicates a failure.</span>", 
"<span class=\"comment\"> * Or a return of &gt; 0 indicates that driver request is exceeding the number</span>", 
"<span class=\"comment\"> * of irqs or MSI-X vectors available. Driver should use the returned value to</span>", 
"<span class=\"comment\"> * re-send its request.</span>", 
"<span class=\"comment\"> **/</span>", 
"int <a class=\"id\" href=\"#pci_enable_msix\">pci_enable_msix</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>, struct <a class=\"id\" href=\"#msix_entry\">msix_entry</a> *<a class=\"id\" href=\"#entries\">entries</a>, int <a class=\"id\" href=\"#nvec\">nvec</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#status\">status</a>, <a class=\"id\" href=\"#nr_entries\">nr_entries</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#i\">i</a>, <a class=\"id\" href=\"#j\">j</a>;", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#entries\">entries</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#status\">status</a> = <a class=\"id\" href=\"#pci_msi_check_device\">pci_msi_check_device</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#nvec\">nvec</a>, <a class=\"id\" href=\"#PCI_CAP_ID_MSIX\">PCI_CAP_ID_MSIX</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#status\">status</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#status\">status</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#nr_entries\">nr_entries</a> = <a class=\"id\" href=\"#pci_msix_table_size\">pci_msix_table_size</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#nvec\">nvec</a> &gt; <a class=\"id\" href=\"#nr_entries\">nr_entries</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#nr_entries\">nr_entries</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Check for any invalid entries */</span>", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = 0; <a class=\"id\" href=\"#i\">i</a> &lt; <a class=\"id\" href=\"#nvec\">nvec</a>; <a class=\"id\" href=\"#i\">i</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#entries\">entries</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#entry\">entry</a> >= <a class=\"id\" href=\"#nr_entries\">nr_entries</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* invalid entry */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>for (<a class=\"id\" href=\"#j\">j</a> = <a class=\"id\" href=\"#i\">i</a> + 1; <a class=\"id\" href=\"#j\">j</a> &lt; <a class=\"id\" href=\"#nvec\">nvec</a>; <a class=\"id\" href=\"#j\">j</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#entries\">entries</a>[<a class=\"id\" href=\"#i\">i</a>].<a class=\"id\" href=\"#entry\">entry</a> == <a class=\"id\" href=\"#entries\">entries</a>[<a class=\"id\" href=\"#j\">j</a>].<a class=\"id\" href=\"#entry\">entry</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;<span class=\"ts\"/><span class=\"comment\">/* duplicate entry */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#WARN_ON\">WARN_ON</a>(!!<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#msix_enabled\">msix_enabled</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Check whether driver already requested for MSI irq */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#msi_enabled\">msi_enabled</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#dev_info\">dev_info</a>(&amp;<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#dev\">dev</a>, \"can't enable MSI-X \"", 
"<span class=\"ts\"/><span class=\"ts\"/>       \"(MSI IRQ already assigned)\\n\");", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EINVAL\">EINVAL</a>;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#status\">status</a> = <a class=\"id\" href=\"#msix_capability_init\">msix_capability_init</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#entries\">entries</a>, <a class=\"id\" href=\"#nvec\">nvec</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#status\">status</a>;", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL\">EXPORT_SYMBOL</a>(<a class=\"id\" href=\"#pci_enable_msix\">pci_enable_msix</a>);", 
"", 
"void <a class=\"id\" href=\"#pci_msix_shutdown\">pci_msix_shutdown</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#msi_desc\">msi_desc</a> *<a class=\"id\" href=\"#entry\">entry</a>;", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#pci_msi_enable\">pci_msi_enable</a> || !<a class=\"id\" href=\"#dev\">dev</a> || !<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#msix_enabled\">msix_enabled</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Return the device with MSI-X masked as initial states */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_for_each_entry\">list_for_each_entry</a>(<a class=\"id\" href=\"#entry\">entry</a>, &amp;<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#msi_list\">msi_list</a>, <a class=\"id\" href=\"#list\">list</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Keep cached states to be restored */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#__msix_mask_irq\">__msix_mask_irq</a>(<a class=\"id\" href=\"#entry\">entry</a>, 1);", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#msix_set_enable\">msix_set_enable</a>(<a class=\"id\" href=\"#dev\">dev</a>, 0);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_intx_for_msi\">pci_intx_for_msi</a>(<a class=\"id\" href=\"#dev\">dev</a>, 1);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#msix_enabled\">msix_enabled</a> = 0;", 
"}", 
"", 
"void <a class=\"id\" href=\"#pci_disable_msix\">pci_disable_msix</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#pci_msi_enable\">pci_msi_enable</a> || !<a class=\"id\" href=\"#dev\">dev</a> || !<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#msix_enabled\">msix_enabled</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_msix_shutdown\">pci_msix_shutdown</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#free_msi_irqs\">free_msi_irqs</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL\">EXPORT_SYMBOL</a>(<a class=\"id\" href=\"#pci_disable_msix\">pci_disable_msix</a>);", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * msi_remove_pci_irq_vectors - reclaim MSI(X) irqs to unused state</span>", 
"<span class=\"comment\"> * @dev: pointer to the pci_dev data structure of MSI(X) device function</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Being called during hotplug remove, from which the device function</span>", 
"<span class=\"comment\"> * is hot-removed. All previous assigned MSI/MSI-X irqs, if</span>", 
"<span class=\"comment\"> * allocated for this device function, are reclaimed to unused state,</span>", 
"<span class=\"comment\"> * which may be used later on.</span>", 
"<span class=\"comment\"> **/</span>", 
"void <a class=\"id\" href=\"#msi_remove_pci_irq_vectors\">msi_remove_pci_irq_vectors</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#pci_msi_enable\">pci_msi_enable</a> || !<a class=\"id\" href=\"#dev\">dev</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#msi_enabled\">msi_enabled</a> || <a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#msix_enabled\">msix_enabled</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#free_msi_irqs\">free_msi_irqs</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"}", 
"", 
"void <a class=\"id\" href=\"#pci_no_msi\">pci_no_msi</a>(void)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_msi_enable\">pci_msi_enable</a> = 0;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * pci_msi_enabled - is MSI enabled?</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Returns true if MSI has not been disabled by the command-line option</span>", 
"<span class=\"comment\"> * pci=nomsi.</span>", 
"<span class=\"comment\"> **/</span>", 
"int <a class=\"id\" href=\"#pci_msi_enabled\">pci_msi_enabled</a>(void)", 
"{", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#pci_msi_enable\">pci_msi_enable</a>;", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL\">EXPORT_SYMBOL</a>(<a class=\"id\" href=\"#pci_msi_enabled\">pci_msi_enabled</a>);", 
"", 
"void <a class=\"id\" href=\"#pci_msi_init_pci_dev\">pci_msi_init_pci_dev</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#INIT_LIST_HEAD\">INIT_LIST_HEAD</a>(&amp;<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#msi_list\">msi_list</a>);", 
"}", 
];
xr_frag_insert('l/a5/e44b320779a11013b86ddb08bd75f48a8fed5e.xr', __xr_tmp);
