var __xr_tmp = [
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> *  linux/drivers/char/pty.c</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> *  Copyright (C) 1991, 1992  Linus Torvalds</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> *  Added support for a Unix98-style ptmx device.</span>", 
"<span class=\"comment\"> *    -- C. Scott Ananian &lt;cananian@alumni.princeton.edu&gt;, 14-Jan-1998</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> *  When reading this code see also fs/devpts. In particular note that the</span>", 
"<span class=\"comment\"> *  driver_data field is used by the devpts side as a binding to the devpts</span>", 
"<span class=\"comment\"> *  inode.</span>", 
"<span class=\"comment\"> */</span>", 
"", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#module\">module</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#errno\">errno</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#interrupt\">interrupt</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#tty\">tty</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#tty_flip\">tty_flip</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#fcntl\">fcntl</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#sched\">sched</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#string\">string</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#major\">major</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#mm\">mm</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#init\">init</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#smp_lock\">smp_lock</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#sysctl\">sysctl</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#device\">device</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#uaccess\">uaccess</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#bitops\">bitops</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#devpts_fs\">devpts_fs</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#slab\">slab</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#asm\">asm</a>/<a class=\"id\" href=\"#system\">system</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"", 
"#<a class=\"id\" href=\"#ifdef\">ifdef</a> <a class=\"id\" href=\"#CONFIG_UNIX98_PTYS\">CONFIG_UNIX98_PTYS</a>", 
"static struct <a class=\"id\" href=\"#tty_driver\">tty_driver</a> *<a class=\"id\" href=\"#ptm_driver\">ptm_driver</a>;", 
"static struct <a class=\"id\" href=\"#tty_driver\">tty_driver</a> *<a class=\"id\" href=\"#pts_driver\">pts_driver</a>;", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
"", 
"static void <a class=\"id\" href=\"#pty_close\">pty_close</a>(struct <a class=\"id\" href=\"#tty_struct\">tty_struct</a> *<a class=\"id\" href=\"#tty\">tty</a>, struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#filp\">filp</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#BUG_ON\">BUG_ON</a>(!<a class=\"id\" href=\"#tty\">tty</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#subtype\">subtype</a> == <a class=\"id\" href=\"#PTY_TYPE_MASTER\">PTY_TYPE_MASTER</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#WARN_ON\">WARN_ON</a>(<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#count\">count</a> &gt; 1);", 
"<span class=\"ts\"/>else {", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#count\">count</a> &gt; 2)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#wake_up_interruptible\">wake_up_interruptible</a>(&amp;<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#read_wait\">read_wait</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#wake_up_interruptible\">wake_up_interruptible</a>(&amp;<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#write_wait\">write_wait</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#packet\">packet</a> = 0;", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#link\">link</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#packet\">packet</a> = 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#set_bit\">set_bit</a>(<a class=\"id\" href=\"#TTY_OTHER_CLOSED\">TTY_OTHER_CLOSED</a>, &amp;<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#wake_up_interruptible\">wake_up_interruptible</a>(&amp;<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#read_wait\">read_wait</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#wake_up_interruptible\">wake_up_interruptible</a>(&amp;<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#write_wait\">write_wait</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#subtype\">subtype</a> == <a class=\"id\" href=\"#PTY_TYPE_MASTER\">PTY_TYPE_MASTER</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#set_bit\">set_bit</a>(<a class=\"id\" href=\"#TTY_OTHER_CLOSED\">TTY_OTHER_CLOSED</a>, &amp;<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#flags\">flags</a>);", 
"#<a class=\"id\" href=\"#ifdef\">ifdef</a> <a class=\"id\" href=\"#CONFIG_UNIX98_PTYS\">CONFIG_UNIX98_PTYS</a>", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#driver\">driver</a> == <a class=\"id\" href=\"#ptm_driver\">ptm_driver</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#devpts_pty_kill\">devpts_pty_kill</a>(<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#link\">link</a>);", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tty_unlock\">tty_unlock</a>();", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tty_vhangup\">tty_vhangup</a>(<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#link\">link</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tty_lock\">tty_lock</a>();", 
"<span class=\"ts\"/>}", 
"}", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * The unthrottle routine is called by the line discipline to signal</span>", 
"<span class=\"comment\"> * that it can receive more characters.  For PTY's, the TTY_THROTTLED</span>", 
"<span class=\"comment\"> * flag is always set, to force the line discipline to always call the</span>", 
"<span class=\"comment\"> * unthrottle routine when there are fewer than TTY_THRESHOLD_UNTHROTTLE</span>", 
"<span class=\"comment\"> * characters in the queue.  This is necessary since each time this</span>", 
"<span class=\"comment\"> * happens, we need to wake up any sleeping processes that could be</span>", 
"<span class=\"comment\"> * (1) trying to send data to the pty, or (2) waiting in wait_until_sent()</span>", 
"<span class=\"comment\"> * for the pty buffer to be drained.</span>", 
"<span class=\"comment\"> */</span>", 
"static void <a class=\"id\" href=\"#pty_unthrottle\">pty_unthrottle</a>(struct <a class=\"id\" href=\"#tty_struct\">tty_struct</a> *<a class=\"id\" href=\"#tty\">tty</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tty_wakeup\">tty_wakeup</a>(<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#link\">link</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#set_bit\">set_bit</a>(<a class=\"id\" href=\"#TTY_THROTTLED\">TTY_THROTTLED</a>, &amp;<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#flags\">flags</a>);", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>pty_space<span class=\"ts\"/>-<span class=\"ts\"/>report space left for writing</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>@to: tty we are writing into</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>The tty buffers allow 64K but we sneak a peak and clip at 8K this</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>allows a lot of overspill room for echo and other fun messes to</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>be handled properly</span>", 
"<span class=\"comment\"> */</span>", 
"", 
"static int <a class=\"id\" href=\"#pty_space\">pty_space</a>(struct <a class=\"id\" href=\"#tty_struct\">tty_struct</a> *<a class=\"id\" href=\"#to\">to</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#n\">n</a> = 8192 - <a class=\"id\" href=\"#to\">to</a>-><a class=\"id\" href=\"#buf\">buf</a>.<a class=\"id\" href=\"#memory_used\">memory_used</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#n\">n</a> &lt; 0)", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#n\">n</a>;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>pty_write<span class=\"ts\"/><span class=\"ts\"/>-<span class=\"ts\"/>write to a pty</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>@tty: the tty we write from</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>@buf: kernel buffer of data</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>@count: bytes to write</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>Our \"hardware\" write method. Data is coming from the ldisc which</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>may be in a non sleeping state. We simply throw this at the other</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>end of the link as if we were an IRQ handler receiving stuff for</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>the other side of the pty/tty pair.</span>", 
"<span class=\"comment\"> */</span>", 
"", 
"static int <a class=\"id\" href=\"#pty_write\">pty_write</a>(struct <a class=\"id\" href=\"#tty_struct\">tty_struct</a> *<a class=\"id\" href=\"#tty\">tty</a>, const unsigned char *<a class=\"id\" href=\"#buf\">buf</a>, int <a class=\"id\" href=\"#c\">c</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#tty_struct\">tty_struct</a> *<a class=\"id\" href=\"#to\">to</a> = <a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#link\">link</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#stopped\">stopped</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#c\">c</a> &gt; 0) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Stuff the data into the input queue of the other end */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#c\">c</a> = <a class=\"id\" href=\"#tty_insert_flip_string\">tty_insert_flip_string</a>(<a class=\"id\" href=\"#to\">to</a>, <a class=\"id\" href=\"#buf\">buf</a>, <a class=\"id\" href=\"#c\">c</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* And shovel */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#c\">c</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tty_flip_buffer_push\">tty_flip_buffer_push</a>(<a class=\"id\" href=\"#to\">to</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tty_wakeup\">tty_wakeup</a>(<a class=\"id\" href=\"#tty\">tty</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#c\">c</a>;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>pty_write_room<span class=\"ts\"/>-<span class=\"ts\"/>write space</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>@tty: tty we are writing from</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>Report how many bytes the ldisc can send into the queue for</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>the other device.</span>", 
"<span class=\"comment\"> */</span>", 
"", 
"static int <a class=\"id\" href=\"#pty_write_room\">pty_write_room</a>(struct <a class=\"id\" href=\"#tty_struct\">tty_struct</a> *<a class=\"id\" href=\"#tty\">tty</a>)", 
"{", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#stopped\">stopped</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#pty_space\">pty_space</a>(<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#link\">link</a>);", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>pty_chars_in_buffer<span class=\"ts\"/>-<span class=\"ts\"/>characters currently in our tx queue</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>@tty: our tty</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>Report how much we have in the transmit queue. As everything is</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>instantly at the other end this is easy to implement.</span>", 
"<span class=\"comment\"> */</span>", 
"", 
"static int <a class=\"id\" href=\"#pty_chars_in_buffer\">pty_chars_in_buffer</a>(struct <a class=\"id\" href=\"#tty_struct\">tty_struct</a> *<a class=\"id\" href=\"#tty\">tty</a>)", 
"{", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"<span class=\"comment\">/* Set the lock flag on a pty */</span>", 
"static int <a class=\"id\" href=\"#pty_set_lock\">pty_set_lock</a>(struct <a class=\"id\" href=\"#tty_struct\">tty_struct</a> *<a class=\"id\" href=\"#tty\">tty</a>, int <a class=\"id\" href=\"#__user\">__user</a> *<a class=\"id\" href=\"#arg\">arg</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#val\">val</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#get_user\">get_user</a>(<a class=\"id\" href=\"#val\">val</a>, <a class=\"id\" href=\"#arg\">arg</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EFAULT\">EFAULT</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#val\">val</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#set_bit\">set_bit</a>(<a class=\"id\" href=\"#TTY_PTY_LOCK\">TTY_PTY_LOCK</a>, &amp;<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/>else", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#clear_bit\">clear_bit</a>(<a class=\"id\" href=\"#TTY_PTY_LOCK\">TTY_PTY_LOCK</a>, &amp;<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"<span class=\"comment\">/* Send a signal to the slave */</span>", 
"static int <a class=\"id\" href=\"#pty_signal\">pty_signal</a>(struct <a class=\"id\" href=\"#tty_struct\">tty_struct</a> *<a class=\"id\" href=\"#tty\">tty</a>, int <a class=\"id\" href=\"#sig\">sig</a>)", 
"{", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#flags\">flags</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#pid\">pid</a> *<a class=\"id\" href=\"#pgrp\">pgrp</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#link\">link</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irqsave\">spin_lock_irqsave</a>(&amp;<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#ctrl_lock\">ctrl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pgrp\">pgrp</a> = <a class=\"id\" href=\"#get_pid\">get_pid</a>(<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#pgrp\">pgrp</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#ctrl_lock\">ctrl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#kill_pgrp\">kill_pgrp</a>(<a class=\"id\" href=\"#pgrp\">pgrp</a>, <a class=\"id\" href=\"#sig\">sig</a>, 1);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#put_pid\">put_pid</a>(<a class=\"id\" href=\"#pgrp\">pgrp</a>);", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"static void <a class=\"id\" href=\"#pty_flush_buffer\">pty_flush_buffer</a>(struct <a class=\"id\" href=\"#tty_struct\">tty_struct</a> *<a class=\"id\" href=\"#tty\">tty</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#tty_struct\">tty_struct</a> *<a class=\"id\" href=\"#to\">to</a> = <a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#link\">link</a>;", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#flags\">flags</a>;", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#to\">to</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"<span class=\"ts\"/><span class=\"comment\">/* tty_buffer_flush(to); FIXME */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#to\">to</a>-><a class=\"id\" href=\"#packet\">packet</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irqsave\">spin_lock_irqsave</a>(&amp;<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#ctrl_lock\">ctrl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#ctrl_status\">ctrl_status</a> |= <a class=\"id\" href=\"#TIOCPKT_FLUSHWRITE\">TIOCPKT_FLUSHWRITE</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#wake_up_interruptible\">wake_up_interruptible</a>(&amp;<a class=\"id\" href=\"#to\">to</a>-><a class=\"id\" href=\"#read_wait\">read_wait</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#ctrl_lock\">ctrl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/>}", 
"}", 
"", 
"static int <a class=\"id\" href=\"#pty_open\">pty_open</a>(struct <a class=\"id\" href=\"#tty_struct\">tty_struct</a> *<a class=\"id\" href=\"#tty\">tty</a>, struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#filp\">filp</a>)", 
"{", 
"<span class=\"ts\"/>int<span class=\"ts\"/><a class=\"id\" href=\"#retval\">retval</a> = -<a class=\"id\" href=\"#ENODEV\">ENODEV</a>;", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#tty\">tty</a> || !<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#link\">link</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#retval\">retval</a> = -<a class=\"id\" href=\"#EIO\">EIO</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#test_bit\">test_bit</a>(<a class=\"id\" href=\"#TTY_OTHER_CLOSED\">TTY_OTHER_CLOSED</a>, &amp;<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#flags\">flags</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#test_bit\">test_bit</a>(<a class=\"id\" href=\"#TTY_PTY_LOCK\">TTY_PTY_LOCK</a>, &amp;<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#flags\">flags</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#count\">count</a> != 1)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#clear_bit\">clear_bit</a>(<a class=\"id\" href=\"#TTY_OTHER_CLOSED\">TTY_OTHER_CLOSED</a>, &amp;<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#link\">link</a>-><a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#set_bit\">set_bit</a>(<a class=\"id\" href=\"#TTY_THROTTLED\">TTY_THROTTLED</a>, &amp;<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#retval\">retval</a> = 0;", 
"<a class=\"id\" href=\"#out\">out</a>:", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#retval\">retval</a>;", 
"}", 
"", 
"static void <a class=\"id\" href=\"#pty_set_termios\">pty_set_termios</a>(struct <a class=\"id\" href=\"#tty_struct\">tty_struct</a> *<a class=\"id\" href=\"#tty\">tty</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#ktermios\">ktermios</a> *<a class=\"id\" href=\"#old_termios\">old_termios</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#termios\">termios</a>-><a class=\"id\" href=\"#c_cflag\">c_cflag</a> &= ~(<a class=\"id\" href=\"#CSIZE\">CSIZE</a> | <a class=\"id\" href=\"#PARENB\">PARENB</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#termios\">termios</a>-><a class=\"id\" href=\"#c_cflag\">c_cflag</a> |= (<a class=\"id\" href=\"#CS8\">CS8</a> | <a class=\"id\" href=\"#CREAD\">CREAD</a>);", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>pty_do_resize<span class=\"ts\"/><span class=\"ts\"/>-<span class=\"ts\"/>resize event</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>@tty: tty being resized</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>@ws: window size being set.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>Update the termios variables and send the necessary signals to</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>peform a terminal resize correctly</span>", 
"<span class=\"comment\"> */</span>", 
"", 
"int <a class=\"id\" href=\"#pty_resize\">pty_resize</a>(struct <a class=\"id\" href=\"#tty_struct\">tty_struct</a> *<a class=\"id\" href=\"#tty\">tty</a>,  struct <a class=\"id\" href=\"#winsize\">winsize</a> *<a class=\"id\" href=\"#ws\">ws</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#pid\">pid</a> *<a class=\"id\" href=\"#pgrp\">pgrp</a>, *<a class=\"id\" href=\"#rpgrp\">rpgrp</a>;", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#flags\">flags</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#tty_struct\">tty_struct</a> *<a class=\"id\" href=\"#pty\">pty</a> = <a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#link\">link</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* For a PTY we need to lock the tty side */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_lock\">mutex_lock</a>(&amp;<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#termios_mutex\">termios_mutex</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#memcmp\">memcmp</a>(<a class=\"id\" href=\"#ws\">ws</a>, &amp;<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#winsize\">winsize</a>, sizeof(*<a class=\"id\" href=\"#ws\">ws</a>)))", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#done\">done</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Get the PID values and reference them so we can</span>", 
"<span class=\"comment\"><span class=\"ts\"/>   avoid holding the tty ctrl lock while sending signals.</span>", 
"<span class=\"comment\"><span class=\"ts\"/>   We need to lock these individually however. */</span>", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irqsave\">spin_lock_irqsave</a>(&amp;<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#ctrl_lock\">ctrl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pgrp\">pgrp</a> = <a class=\"id\" href=\"#get_pid\">get_pid</a>(<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#pgrp\">pgrp</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#ctrl_lock\">ctrl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irqsave\">spin_lock_irqsave</a>(&amp;<a class=\"id\" href=\"#pty\">pty</a>-><a class=\"id\" href=\"#ctrl_lock\">ctrl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rpgrp\">rpgrp</a> = <a class=\"id\" href=\"#get_pid\">get_pid</a>(<a class=\"id\" href=\"#pty\">pty</a>-><a class=\"id\" href=\"#pgrp\">pgrp</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#pty\">pty</a>-><a class=\"id\" href=\"#ctrl_lock\">ctrl_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#pgrp\">pgrp</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#kill_pgrp\">kill_pgrp</a>(<a class=\"id\" href=\"#pgrp\">pgrp</a>, <a class=\"id\" href=\"#SIGWINCH\">SIGWINCH</a>, 1);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#rpgrp\">rpgrp</a> != <a class=\"id\" href=\"#pgrp\">pgrp</a> && <a class=\"id\" href=\"#rpgrp\">rpgrp</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#kill_pgrp\">kill_pgrp</a>(<a class=\"id\" href=\"#rpgrp\">rpgrp</a>, <a class=\"id\" href=\"#SIGWINCH\">SIGWINCH</a>, 1);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#put_pid\">put_pid</a>(<a class=\"id\" href=\"#pgrp\">pgrp</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#put_pid\">put_pid</a>(<a class=\"id\" href=\"#rpgrp\">rpgrp</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#winsize\">winsize</a> = *<a class=\"id\" href=\"#ws\">ws</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty\">pty</a>-><a class=\"id\" href=\"#winsize\">winsize</a> = *<a class=\"id\" href=\"#ws\">ws</a>;<span class=\"ts\"/><span class=\"comment\">/* Never used so will go away soon */</span>", 
"<a class=\"id\" href=\"#done\">done</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_unlock\">mutex_unlock</a>(&amp;<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#termios_mutex\">termios_mutex</a>);", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"<span class=\"comment\">/* Traditional BSD devices */</span>", 
"#<a class=\"id\" href=\"#ifdef\">ifdef</a> <a class=\"id\" href=\"#CONFIG_LEGACY_PTYS\">CONFIG_LEGACY_PTYS</a>", 
"", 
"static int <a class=\"id\" href=\"#pty_install\">pty_install</a>(struct <a class=\"id\" href=\"#tty_driver\">tty_driver</a> *<a class=\"id\" href=\"#driver\">driver</a>, struct <a class=\"id\" href=\"#tty_struct\">tty_struct</a> *<a class=\"id\" href=\"#tty\">tty</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#tty_struct\">tty_struct</a> *<a class=\"id\" href=\"#o_tty\">o_tty</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#idx\">idx</a> = <a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#index\">index</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#retval\">retval</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#o_tty\">o_tty</a> = <a class=\"id\" href=\"#alloc_tty_struct\">alloc_tty_struct</a>();", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#o_tty\">o_tty</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#try_module_get\">try_module_get</a>(<a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#other\">other</a>-><a class=\"id\" href=\"#owner\">owner</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* This cannot in fact currently happen */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#free_tty_struct\">free_tty_struct</a>(<a class=\"id\" href=\"#o_tty\">o_tty</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#initialize_tty_struct\">initialize_tty_struct</a>(<a class=\"id\" href=\"#o_tty\">o_tty</a>, <a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#other\">other</a>, <a class=\"id\" href=\"#idx\">idx</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* We always use new tty termios data so we can do this</span>", 
"<span class=\"comment\"><span class=\"ts\"/>   the easy way .. */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#retval\">retval</a> = <a class=\"id\" href=\"#tty_init_termios\">tty_init_termios</a>(<a class=\"id\" href=\"#tty\">tty</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#retval\">retval</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#free_mem_out\">free_mem_out</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#retval\">retval</a> = <a class=\"id\" href=\"#tty_init_termios\">tty_init_termios</a>(<a class=\"id\" href=\"#o_tty\">o_tty</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#retval\">retval</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tty_free_termios\">tty_free_termios</a>(<a class=\"id\" href=\"#tty\">tty</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#free_mem_out\">free_mem_out</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Everything allocated ... set up the o_tty structure.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#other\">other</a>-><a class=\"id\" href=\"#ttys\">ttys</a>[<a class=\"id\" href=\"#idx\">idx</a>] = <a class=\"id\" href=\"#o_tty\">o_tty</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tty_driver_kref_get\">tty_driver_kref_get</a>(<a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#other\">other</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#subtype\">subtype</a> == <a class=\"id\" href=\"#PTY_TYPE_MASTER\">PTY_TYPE_MASTER</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#o_tty\">o_tty</a>-><a class=\"id\" href=\"#count\">count</a>++;", 
"<span class=\"ts\"/><span class=\"comment\">/* Establish the links in both directions */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#link\">link</a>   = <a class=\"id\" href=\"#o_tty\">o_tty</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#o_tty\">o_tty</a>-><a class=\"id\" href=\"#link\">link</a> = <a class=\"id\" href=\"#tty\">tty</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tty_driver_kref_get\">tty_driver_kref_get</a>(<a class=\"id\" href=\"#driver\">driver</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#count\">count</a>++;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#ttys\">ttys</a>[<a class=\"id\" href=\"#idx\">idx</a>] = <a class=\"id\" href=\"#tty\">tty</a>;", 
"<span class=\"ts\"/>return 0;", 
"<a class=\"id\" href=\"#free_mem_out\">free_mem_out</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#module_put\">module_put</a>(<a class=\"id\" href=\"#o_tty\">o_tty</a>-><a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#owner\">owner</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#free_tty_struct\">free_tty_struct</a>(<a class=\"id\" href=\"#o_tty\">o_tty</a>);", 
"<span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"}", 
"", 
"static int <a class=\"id\" href=\"#pty_bsd_ioctl\">pty_bsd_ioctl</a>(struct <a class=\"id\" href=\"#tty_struct\">tty_struct</a> *<a class=\"id\" href=\"#tty\">tty</a>, struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#file\">file</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> unsigned int <a class=\"id\" href=\"#cmd\">cmd</a>, unsigned long <a class=\"id\" href=\"#arg\">arg</a>)", 
"{", 
"<span class=\"ts\"/>switch (<a class=\"id\" href=\"#cmd\">cmd</a>) {", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#TIOCSPTLCK\">TIOCSPTLCK</a>: <span class=\"comment\">/* Set PT Lock (disallow slave open) */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#pty_set_lock\">pty_set_lock</a>(<a class=\"id\" href=\"#tty\">tty</a>, (int <a class=\"id\" href=\"#__user\">__user</a> *) <a class=\"id\" href=\"#arg\">arg</a>);", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#TIOCSIG\">TIOCSIG</a>:    <span class=\"comment\">/* Send signal to other side of pty */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#pty_signal\">pty_signal</a>(<a class=\"id\" href=\"#tty\">tty</a>, (int) <a class=\"id\" href=\"#arg\">arg</a>);", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOIOCTLCMD\">ENOIOCTLCMD</a>;", 
"}", 
"", 
"static int <a class=\"id\" href=\"#legacy_count\">legacy_count</a> = <a class=\"id\" href=\"#CONFIG_LEGACY_PTY_COUNT\">CONFIG_LEGACY_PTY_COUNT</a>;", 
"<a class=\"id\" href=\"#module_param\">module_param</a>(<a class=\"id\" href=\"#legacy_count\">legacy_count</a>, int, 0);", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * The master side of a pty can do TIOCSPTLCK and thus</span>", 
"<span class=\"comment\"> * has pty_bsd_ioctl.</span>", 
"<span class=\"comment\"> */</span>", 
"static const struct <a class=\"id\" href=\"#tty_operations\">tty_operations</a> <a class=\"id\" href=\"#master_pty_ops_bsd\">master_pty_ops_bsd</a> = {", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#install\">install</a> = <a class=\"id\" href=\"#pty_install\">pty_install</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#open\">open</a> = <a class=\"id\" href=\"#pty_open\">pty_open</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#close\">close</a> = <a class=\"id\" href=\"#pty_close\">pty_close</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#write\">write</a> = <a class=\"id\" href=\"#pty_write\">pty_write</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#write_room\">write_room</a> = <a class=\"id\" href=\"#pty_write_room\">pty_write_room</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#flush_buffer\">flush_buffer</a> = <a class=\"id\" href=\"#pty_flush_buffer\">pty_flush_buffer</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#chars_in_buffer\">chars_in_buffer</a> = <a class=\"id\" href=\"#pty_chars_in_buffer\">pty_chars_in_buffer</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#unthrottle\">unthrottle</a> = <a class=\"id\" href=\"#pty_unthrottle\">pty_unthrottle</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#set_termios\">set_termios</a> = <a class=\"id\" href=\"#pty_set_termios\">pty_set_termios</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#ioctl\">ioctl</a> = <a class=\"id\" href=\"#pty_bsd_ioctl\">pty_bsd_ioctl</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#resize\">resize</a> = <a class=\"id\" href=\"#pty_resize\">pty_resize</a>", 
"};", 
"", 
"static const struct <a class=\"id\" href=\"#tty_operations\">tty_operations</a> <a class=\"id\" href=\"#slave_pty_ops_bsd\">slave_pty_ops_bsd</a> = {", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#install\">install</a> = <a class=\"id\" href=\"#pty_install\">pty_install</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#open\">open</a> = <a class=\"id\" href=\"#pty_open\">pty_open</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#close\">close</a> = <a class=\"id\" href=\"#pty_close\">pty_close</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#write\">write</a> = <a class=\"id\" href=\"#pty_write\">pty_write</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#write_room\">write_room</a> = <a class=\"id\" href=\"#pty_write_room\">pty_write_room</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#flush_buffer\">flush_buffer</a> = <a class=\"id\" href=\"#pty_flush_buffer\">pty_flush_buffer</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#chars_in_buffer\">chars_in_buffer</a> = <a class=\"id\" href=\"#pty_chars_in_buffer\">pty_chars_in_buffer</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#unthrottle\">unthrottle</a> = <a class=\"id\" href=\"#pty_unthrottle\">pty_unthrottle</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#set_termios\">set_termios</a> = <a class=\"id\" href=\"#pty_set_termios\">pty_set_termios</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#resize\">resize</a> = <a class=\"id\" href=\"#pty_resize\">pty_resize</a>", 
"};", 
"", 
"static void <a class=\"id\" href=\"#__init\">__init</a> <a class=\"id\" href=\"#legacy_pty_init\">legacy_pty_init</a>(void)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#tty_driver\">tty_driver</a> *<a class=\"id\" href=\"#pty_driver\">pty_driver</a>, *<a class=\"id\" href=\"#pty_slave_driver\">pty_slave_driver</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#legacy_count\">legacy_count</a> <= 0)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty_driver\">pty_driver</a> = <a class=\"id\" href=\"#alloc_tty_driver\">alloc_tty_driver</a>(<a class=\"id\" href=\"#legacy_count\">legacy_count</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#pty_driver\">pty_driver</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#panic\">panic</a>(\"Couldn't allocate pty driver\");", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty_slave_driver\">pty_slave_driver</a> = <a class=\"id\" href=\"#alloc_tty_driver\">alloc_tty_driver</a>(<a class=\"id\" href=\"#legacy_count\">legacy_count</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#pty_slave_driver\">pty_slave_driver</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#panic\">panic</a>(\"Couldn't allocate pty slave driver\");", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty_driver\">pty_driver</a>-><a class=\"id\" href=\"#owner\">owner</a> = <a class=\"id\" href=\"#THIS_MODULE\">THIS_MODULE</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty_driver\">pty_driver</a>-><a class=\"id\" href=\"#driver_name\">driver_name</a> = \"pty_master\";", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty_driver\">pty_driver</a>-><a class=\"id\" href=\"#name\">name</a> = \"pty\";", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty_driver\">pty_driver</a>-><a class=\"id\" href=\"#major\">major</a> = <a class=\"id\" href=\"#PTY_MASTER_MAJOR\">PTY_MASTER_MAJOR</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty_driver\">pty_driver</a>-><a class=\"id\" href=\"#minor_start\">minor_start</a> = 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty_driver\">pty_driver</a>-><a class=\"id\" href=\"#type\">type</a> = <a class=\"id\" href=\"#TTY_DRIVER_TYPE_PTY\">TTY_DRIVER_TYPE_PTY</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty_driver\">pty_driver</a>-><a class=\"id\" href=\"#subtype\">subtype</a> = <a class=\"id\" href=\"#PTY_TYPE_MASTER\">PTY_TYPE_MASTER</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty_driver\">pty_driver</a>-><a class=\"id\" href=\"#init_termios\">init_termios</a> = <a class=\"id\" href=\"#tty_std_termios\">tty_std_termios</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty_driver\">pty_driver</a>-><a class=\"id\" href=\"#init_termios\">init_termios</a>.<a class=\"id\" href=\"#c_iflag\">c_iflag</a> = 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty_driver\">pty_driver</a>-><a class=\"id\" href=\"#init_termios\">init_termios</a>.<a class=\"id\" href=\"#c_oflag\">c_oflag</a> = 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty_driver\">pty_driver</a>-><a class=\"id\" href=\"#init_termios\">init_termios</a>.<a class=\"id\" href=\"#c_cflag\">c_cflag</a> = <a class=\"id\" href=\"#B38400\">B38400</a> | <a class=\"id\" href=\"#CS8\">CS8</a> | <a class=\"id\" href=\"#CREAD\">CREAD</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty_driver\">pty_driver</a>-><a class=\"id\" href=\"#init_termios\">init_termios</a>.<a class=\"id\" href=\"#c_lflag\">c_lflag</a> = 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty_driver\">pty_driver</a>-><a class=\"id\" href=\"#init_termios\">init_termios</a>.<a class=\"id\" href=\"#c_ispeed\">c_ispeed</a> = 38400;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty_driver\">pty_driver</a>-><a class=\"id\" href=\"#init_termios\">init_termios</a>.<a class=\"id\" href=\"#c_ospeed\">c_ospeed</a> = 38400;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty_driver\">pty_driver</a>-><a class=\"id\" href=\"#flags\">flags</a> = <a class=\"id\" href=\"#TTY_DRIVER_RESET_TERMIOS\">TTY_DRIVER_RESET_TERMIOS</a> | <a class=\"id\" href=\"#TTY_DRIVER_REAL_RAW\">TTY_DRIVER_REAL_RAW</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty_driver\">pty_driver</a>-><a class=\"id\" href=\"#other\">other</a> = <a class=\"id\" href=\"#pty_slave_driver\">pty_slave_driver</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tty_set_operations\">tty_set_operations</a>(<a class=\"id\" href=\"#pty_driver\">pty_driver</a>, &amp;<a class=\"id\" href=\"#master_pty_ops_bsd\">master_pty_ops_bsd</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty_slave_driver\">pty_slave_driver</a>-><a class=\"id\" href=\"#owner\">owner</a> = <a class=\"id\" href=\"#THIS_MODULE\">THIS_MODULE</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty_slave_driver\">pty_slave_driver</a>-><a class=\"id\" href=\"#driver_name\">driver_name</a> = \"pty_slave\";", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty_slave_driver\">pty_slave_driver</a>-><a class=\"id\" href=\"#name\">name</a> = \"ttyp\";", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty_slave_driver\">pty_slave_driver</a>-><a class=\"id\" href=\"#major\">major</a> = <a class=\"id\" href=\"#PTY_SLAVE_MAJOR\">PTY_SLAVE_MAJOR</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty_slave_driver\">pty_slave_driver</a>-><a class=\"id\" href=\"#minor_start\">minor_start</a> = 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty_slave_driver\">pty_slave_driver</a>-><a class=\"id\" href=\"#type\">type</a> = <a class=\"id\" href=\"#TTY_DRIVER_TYPE_PTY\">TTY_DRIVER_TYPE_PTY</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty_slave_driver\">pty_slave_driver</a>-><a class=\"id\" href=\"#subtype\">subtype</a> = <a class=\"id\" href=\"#PTY_TYPE_SLAVE\">PTY_TYPE_SLAVE</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty_slave_driver\">pty_slave_driver</a>-><a class=\"id\" href=\"#init_termios\">init_termios</a> = <a class=\"id\" href=\"#tty_std_termios\">tty_std_termios</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty_slave_driver\">pty_slave_driver</a>-><a class=\"id\" href=\"#init_termios\">init_termios</a>.<a class=\"id\" href=\"#c_cflag\">c_cflag</a> = <a class=\"id\" href=\"#B38400\">B38400</a> | <a class=\"id\" href=\"#CS8\">CS8</a> | <a class=\"id\" href=\"#CREAD\">CREAD</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty_slave_driver\">pty_slave_driver</a>-><a class=\"id\" href=\"#init_termios\">init_termios</a>.<a class=\"id\" href=\"#c_ispeed\">c_ispeed</a> = 38400;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty_slave_driver\">pty_slave_driver</a>-><a class=\"id\" href=\"#init_termios\">init_termios</a>.<a class=\"id\" href=\"#c_ospeed\">c_ospeed</a> = 38400;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty_slave_driver\">pty_slave_driver</a>-><a class=\"id\" href=\"#flags\">flags</a> = <a class=\"id\" href=\"#TTY_DRIVER_RESET_TERMIOS\">TTY_DRIVER_RESET_TERMIOS</a> |", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#TTY_DRIVER_REAL_RAW\">TTY_DRIVER_REAL_RAW</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty_slave_driver\">pty_slave_driver</a>-><a class=\"id\" href=\"#other\">other</a> = <a class=\"id\" href=\"#pty_driver\">pty_driver</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tty_set_operations\">tty_set_operations</a>(<a class=\"id\" href=\"#pty_slave_driver\">pty_slave_driver</a>, &amp;<a class=\"id\" href=\"#slave_pty_ops_bsd\">slave_pty_ops_bsd</a>);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#tty_register_driver\">tty_register_driver</a>(<a class=\"id\" href=\"#pty_driver\">pty_driver</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#panic\">panic</a>(\"Couldn't register pty driver\");", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#tty_register_driver\">tty_register_driver</a>(<a class=\"id\" href=\"#pty_slave_driver\">pty_slave_driver</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#panic\">panic</a>(\"Couldn't register pty slave driver\");", 
"}", 
"#else", 
"static <a class=\"id\" href=\"#inline\">inline</a> void <a class=\"id\" href=\"#legacy_pty_init\">legacy_pty_init</a>(void) { }", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
"", 
"<span class=\"comment\">/* Unix98 devices */</span>", 
"#<a class=\"id\" href=\"#ifdef\">ifdef</a> <a class=\"id\" href=\"#CONFIG_UNIX98_PTYS\">CONFIG_UNIX98_PTYS</a>", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * sysctl support for setting limits on the number of Unix98 ptys allocated.</span>", 
"<span class=\"comment\"> * Otherwise one can eat up all kernel memory by opening /dev/ptmx repeatedly.</span>", 
"<span class=\"comment\"> */</span>", 
"int <a class=\"id\" href=\"#pty_limit\">pty_limit</a> = <a class=\"id\" href=\"#NR_UNIX98_PTY_DEFAULT\">NR_UNIX98_PTY_DEFAULT</a>;", 
"static int <a class=\"id\" href=\"#pty_limit_min\">pty_limit_min</a>;", 
"static int <a class=\"id\" href=\"#pty_limit_max\">pty_limit_max</a> = <a class=\"id\" href=\"#NR_UNIX98_PTY_MAX\">NR_UNIX98_PTY_MAX</a>;", 
"static int <a class=\"id\" href=\"#pty_count\">pty_count</a>;", 
"", 
"static struct <a class=\"id\" href=\"#cdev\">cdev</a> <a class=\"id\" href=\"#ptmx_cdev\">ptmx_cdev</a>;", 
"", 
"static struct <a class=\"id\" href=\"#ctl_table\">ctl_table</a> <a class=\"id\" href=\"#pty_table\">pty_table</a>[] = {", 
"<span class=\"ts\"/>{", 
"<span class=\"ts\"/><span class=\"ts\"/>.<a class=\"id\" href=\"#procname\">procname</a><span class=\"ts\"/>= \"max\",", 
"<span class=\"ts\"/><span class=\"ts\"/>.<a class=\"id\" href=\"#maxlen\">maxlen</a><span class=\"ts\"/><span class=\"ts\"/>= sizeof(int),", 
"<span class=\"ts\"/><span class=\"ts\"/>.<a class=\"id\" href=\"#mode\">mode</a><span class=\"ts\"/><span class=\"ts\"/>= 0644,", 
"<span class=\"ts\"/><span class=\"ts\"/>.<a class=\"id\" href=\"#data\">data</a><span class=\"ts\"/><span class=\"ts\"/>= &amp;<a class=\"id\" href=\"#pty_limit\">pty_limit</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/>.<a class=\"id\" href=\"#proc_handler\">proc_handler</a><span class=\"ts\"/>= <a class=\"id\" href=\"#proc_dointvec_minmax\">proc_dointvec_minmax</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/>.<a class=\"id\" href=\"#extra1\">extra1</a><span class=\"ts\"/><span class=\"ts\"/>= &amp;<a class=\"id\" href=\"#pty_limit_min\">pty_limit_min</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/>.<a class=\"id\" href=\"#extra2\">extra2</a><span class=\"ts\"/><span class=\"ts\"/>= &amp;<a class=\"id\" href=\"#pty_limit_max\">pty_limit_max</a>,", 
"<span class=\"ts\"/>}, {", 
"<span class=\"ts\"/><span class=\"ts\"/>.<a class=\"id\" href=\"#procname\">procname</a><span class=\"ts\"/>= \"nr\",", 
"<span class=\"ts\"/><span class=\"ts\"/>.<a class=\"id\" href=\"#maxlen\">maxlen</a><span class=\"ts\"/><span class=\"ts\"/>= sizeof(int),", 
"<span class=\"ts\"/><span class=\"ts\"/>.<a class=\"id\" href=\"#mode\">mode</a><span class=\"ts\"/><span class=\"ts\"/>= 0444,", 
"<span class=\"ts\"/><span class=\"ts\"/>.<a class=\"id\" href=\"#data\">data</a><span class=\"ts\"/><span class=\"ts\"/>= &amp;<a class=\"id\" href=\"#pty_count\">pty_count</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/>.<a class=\"id\" href=\"#proc_handler\">proc_handler</a><span class=\"ts\"/>= <a class=\"id\" href=\"#proc_dointvec\">proc_dointvec</a>,", 
"<span class=\"ts\"/>}, ", 
"<span class=\"ts\"/>{}", 
"};", 
"", 
"static struct <a class=\"id\" href=\"#ctl_table\">ctl_table</a> <a class=\"id\" href=\"#pty_kern_table\">pty_kern_table</a>[] = {", 
"<span class=\"ts\"/>{", 
"<span class=\"ts\"/><span class=\"ts\"/>.<a class=\"id\" href=\"#procname\">procname</a><span class=\"ts\"/>= \"pty\",", 
"<span class=\"ts\"/><span class=\"ts\"/>.<a class=\"id\" href=\"#mode\">mode</a><span class=\"ts\"/><span class=\"ts\"/>= 0555,", 
"<span class=\"ts\"/><span class=\"ts\"/>.<a class=\"id\" href=\"#child\">child</a><span class=\"ts\"/><span class=\"ts\"/>= <a class=\"id\" href=\"#pty_table\">pty_table</a>,", 
"<span class=\"ts\"/>},", 
"<span class=\"ts\"/>{}", 
"};", 
"", 
"static struct <a class=\"id\" href=\"#ctl_table\">ctl_table</a> <a class=\"id\" href=\"#pty_root_table\">pty_root_table</a>[] = {", 
"<span class=\"ts\"/>{", 
"<span class=\"ts\"/><span class=\"ts\"/>.<a class=\"id\" href=\"#procname\">procname</a><span class=\"ts\"/>= \"kernel\",", 
"<span class=\"ts\"/><span class=\"ts\"/>.<a class=\"id\" href=\"#mode\">mode</a><span class=\"ts\"/><span class=\"ts\"/>= 0555,", 
"<span class=\"ts\"/><span class=\"ts\"/>.<a class=\"id\" href=\"#child\">child</a><span class=\"ts\"/><span class=\"ts\"/>= <a class=\"id\" href=\"#pty_kern_table\">pty_kern_table</a>,", 
"<span class=\"ts\"/>},", 
"<span class=\"ts\"/>{}", 
"};", 
"", 
"", 
"static int <a class=\"id\" href=\"#pty_unix98_ioctl\">pty_unix98_ioctl</a>(struct <a class=\"id\" href=\"#tty_struct\">tty_struct</a> *<a class=\"id\" href=\"#tty\">tty</a>, struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#file\">file</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>    unsigned int <a class=\"id\" href=\"#cmd\">cmd</a>, unsigned long <a class=\"id\" href=\"#arg\">arg</a>)", 
"{", 
"<span class=\"ts\"/>switch (<a class=\"id\" href=\"#cmd\">cmd</a>) {", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#TIOCSPTLCK\">TIOCSPTLCK</a>: <span class=\"comment\">/* Set PT Lock (disallow slave open) */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#pty_set_lock\">pty_set_lock</a>(<a class=\"id\" href=\"#tty\">tty</a>, (int <a class=\"id\" href=\"#__user\">__user</a> *)<a class=\"id\" href=\"#arg\">arg</a>);", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#TIOCGPTN\">TIOCGPTN</a>: <span class=\"comment\">/* Get PT Number */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#put_user\">put_user</a>(<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#index\">index</a>, (unsigned int <a class=\"id\" href=\"#__user\">__user</a> *)<a class=\"id\" href=\"#arg\">arg</a>);", 
"<span class=\"ts\"/>case <a class=\"id\" href=\"#TIOCSIG\">TIOCSIG</a>:    <span class=\"comment\">/* Send signal to other side of pty */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#pty_signal\">pty_signal</a>(<a class=\"id\" href=\"#tty\">tty</a>, (int) <a class=\"id\" href=\"#arg\">arg</a>);", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOIOCTLCMD\">ENOIOCTLCMD</a>;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>ptm_unix98_lookup<span class=\"ts\"/>-<span class=\"ts\"/>find a pty master</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>@driver: ptm driver</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>@idx: tty index</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>Look up a pty master device. Called under the tty_mutex for now.</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>This provides our locking.</span>", 
"<span class=\"comment\"> */</span>", 
"", 
"static struct <a class=\"id\" href=\"#tty_struct\">tty_struct</a> *<a class=\"id\" href=\"#ptm_unix98_lookup\">ptm_unix98_lookup</a>(struct <a class=\"id\" href=\"#tty_driver\">tty_driver</a> *<a class=\"id\" href=\"#driver\">driver</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#inode\">inode</a> *<a class=\"id\" href=\"#ptm_inode\">ptm_inode</a>, int <a class=\"id\" href=\"#idx\">idx</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#tty_struct\">tty_struct</a> *<a class=\"id\" href=\"#tty\">tty</a> = <a class=\"id\" href=\"#devpts_get_tty\">devpts_get_tty</a>(<a class=\"id\" href=\"#ptm_inode\">ptm_inode</a>, <a class=\"id\" href=\"#idx\">idx</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#tty\">tty</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tty\">tty</a> = <a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#link\">link</a>;", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#tty\">tty</a>;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>pts_unix98_lookup<span class=\"ts\"/>-<span class=\"ts\"/>find a pty slave</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>@driver: pts driver</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>@idx: tty index</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>Look up a pty master device. Called under the tty_mutex for now.</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>This provides our locking.</span>", 
"<span class=\"comment\"> */</span>", 
"", 
"static struct <a class=\"id\" href=\"#tty_struct\">tty_struct</a> *<a class=\"id\" href=\"#pts_unix98_lookup\">pts_unix98_lookup</a>(struct <a class=\"id\" href=\"#tty_driver\">tty_driver</a> *<a class=\"id\" href=\"#driver\">driver</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#inode\">inode</a> *<a class=\"id\" href=\"#pts_inode\">pts_inode</a>, int <a class=\"id\" href=\"#idx\">idx</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#tty_struct\">tty_struct</a> *<a class=\"id\" href=\"#tty\">tty</a> = <a class=\"id\" href=\"#devpts_get_tty\">devpts_get_tty</a>(<a class=\"id\" href=\"#pts_inode\">pts_inode</a>, <a class=\"id\" href=\"#idx\">idx</a>);", 
"<span class=\"ts\"/><span class=\"comment\">/* Master must be open before slave */</span>", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#tty\">tty</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#ERR_PTR\">ERR_PTR</a>(-<a class=\"id\" href=\"#EIO\">EIO</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#tty\">tty</a>;", 
"}", 
"", 
"static void <a class=\"id\" href=\"#pty_unix98_shutdown\">pty_unix98_shutdown</a>(struct <a class=\"id\" href=\"#tty_struct\">tty_struct</a> *<a class=\"id\" href=\"#tty\">tty</a>)", 
"{", 
"<span class=\"ts\"/><span class=\"comment\">/* We have our own method as we don't use the tty index */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#termios\">termios</a>);", 
"}", 
"", 
"<span class=\"comment\">/* We have no need to install and remove our tty objects as devpts does all</span>", 
"<span class=\"comment\">   the work for us */</span>", 
"", 
"static int <a class=\"id\" href=\"#pty_unix98_install\">pty_unix98_install</a>(struct <a class=\"id\" href=\"#tty_driver\">tty_driver</a> *<a class=\"id\" href=\"#driver\">driver</a>, struct <a class=\"id\" href=\"#tty_struct\">tty_struct</a> *<a class=\"id\" href=\"#tty\">tty</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#tty_struct\">tty_struct</a> *<a class=\"id\" href=\"#o_tty\">o_tty</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#idx\">idx</a> = <a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#index\">index</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#o_tty\">o_tty</a> = <a class=\"id\" href=\"#alloc_tty_struct\">alloc_tty_struct</a>();", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#o_tty\">o_tty</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#try_module_get\">try_module_get</a>(<a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#other\">other</a>-><a class=\"id\" href=\"#owner\">owner</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* This cannot in fact currently happen */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#free_tty_struct\">free_tty_struct</a>(<a class=\"id\" href=\"#o_tty\">o_tty</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#initialize_tty_struct\">initialize_tty_struct</a>(<a class=\"id\" href=\"#o_tty\">o_tty</a>, <a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#other\">other</a>, <a class=\"id\" href=\"#idx\">idx</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#termios\">termios</a> = <a class=\"id\" href=\"#kzalloc\">kzalloc</a>(sizeof(struct <a class=\"id\" href=\"#ktermios\">ktermios</a>[2]), <a class=\"id\" href=\"#GFP_KERNEL\">GFP_KERNEL</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#termios\">termios</a> == <a class=\"id\" href=\"#NULL\">NULL</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#free_mem_out\">free_mem_out</a>;", 
"<span class=\"ts\"/>*<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#termios\">termios</a> = <a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#init_termios\">init_termios</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#termios_locked\">termios_locked</a> = <a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#termios\">termios</a> + 1;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#o_tty\">o_tty</a>-><a class=\"id\" href=\"#termios\">termios</a> = <a class=\"id\" href=\"#kzalloc\">kzalloc</a>(sizeof(struct <a class=\"id\" href=\"#ktermios\">ktermios</a>[2]), <a class=\"id\" href=\"#GFP_KERNEL\">GFP_KERNEL</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#o_tty\">o_tty</a>-><a class=\"id\" href=\"#termios\">termios</a> == <a class=\"id\" href=\"#NULL\">NULL</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#free_mem_out\">free_mem_out</a>;", 
"<span class=\"ts\"/>*<a class=\"id\" href=\"#o_tty\">o_tty</a>-><a class=\"id\" href=\"#termios\">termios</a> = <a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#other\">other</a>-><a class=\"id\" href=\"#init_termios\">init_termios</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#o_tty\">o_tty</a>-><a class=\"id\" href=\"#termios_locked\">termios_locked</a> = <a class=\"id\" href=\"#o_tty\">o_tty</a>-><a class=\"id\" href=\"#termios\">termios</a> + 1;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tty_driver_kref_get\">tty_driver_kref_get</a>(<a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#other\">other</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#subtype\">subtype</a> == <a class=\"id\" href=\"#PTY_TYPE_MASTER\">PTY_TYPE_MASTER</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#o_tty\">o_tty</a>-><a class=\"id\" href=\"#count\">count</a>++;", 
"<span class=\"ts\"/><span class=\"comment\">/* Establish the links in both directions */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#link\">link</a>   = <a class=\"id\" href=\"#o_tty\">o_tty</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#o_tty\">o_tty</a>-><a class=\"id\" href=\"#link\">link</a> = <a class=\"id\" href=\"#tty\">tty</a>;", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * All structures have been allocated, so now we install them.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Failures after this point use release_tty to clean up, so</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * there's no need to null out the local pointers.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tty_driver_kref_get\">tty_driver_kref_get</a>(<a class=\"id\" href=\"#driver\">driver</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#count\">count</a>++;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty_count\">pty_count</a>++;", 
"<span class=\"ts\"/>return 0;", 
"<a class=\"id\" href=\"#free_mem_out\">free_mem_out</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#o_tty\">o_tty</a>-><a class=\"id\" href=\"#termios\">termios</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#module_put\">module_put</a>(<a class=\"id\" href=\"#o_tty\">o_tty</a>-><a class=\"id\" href=\"#driver\">driver</a>-><a class=\"id\" href=\"#owner\">owner</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#free_tty_struct\">free_tty_struct</a>(<a class=\"id\" href=\"#o_tty\">o_tty</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#termios\">termios</a>);", 
"<span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"}", 
"", 
"static void <a class=\"id\" href=\"#pty_unix98_remove\">pty_unix98_remove</a>(struct <a class=\"id\" href=\"#tty_driver\">tty_driver</a> *<a class=\"id\" href=\"#driver\">driver</a>, struct <a class=\"id\" href=\"#tty_struct\">tty_struct</a> *<a class=\"id\" href=\"#tty\">tty</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pty_count\">pty_count</a>--;", 
"}", 
"", 
"static const struct <a class=\"id\" href=\"#tty_operations\">tty_operations</a> <a class=\"id\" href=\"#ptm_unix98_ops\">ptm_unix98_ops</a> = {", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#lookup\">lookup</a> = <a class=\"id\" href=\"#ptm_unix98_lookup\">ptm_unix98_lookup</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#install\">install</a> = <a class=\"id\" href=\"#pty_unix98_install\">pty_unix98_install</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#remove\">remove</a> = <a class=\"id\" href=\"#pty_unix98_remove\">pty_unix98_remove</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#open\">open</a> = <a class=\"id\" href=\"#pty_open\">pty_open</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#close\">close</a> = <a class=\"id\" href=\"#pty_close\">pty_close</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#write\">write</a> = <a class=\"id\" href=\"#pty_write\">pty_write</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#write_room\">write_room</a> = <a class=\"id\" href=\"#pty_write_room\">pty_write_room</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#flush_buffer\">flush_buffer</a> = <a class=\"id\" href=\"#pty_flush_buffer\">pty_flush_buffer</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#chars_in_buffer\">chars_in_buffer</a> = <a class=\"id\" href=\"#pty_chars_in_buffer\">pty_chars_in_buffer</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#unthrottle\">unthrottle</a> = <a class=\"id\" href=\"#pty_unthrottle\">pty_unthrottle</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#set_termios\">set_termios</a> = <a class=\"id\" href=\"#pty_set_termios\">pty_set_termios</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#ioctl\">ioctl</a> = <a class=\"id\" href=\"#pty_unix98_ioctl\">pty_unix98_ioctl</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#shutdown\">shutdown</a> = <a class=\"id\" href=\"#pty_unix98_shutdown\">pty_unix98_shutdown</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#resize\">resize</a> = <a class=\"id\" href=\"#pty_resize\">pty_resize</a>", 
"};", 
"", 
"static const struct <a class=\"id\" href=\"#tty_operations\">tty_operations</a> <a class=\"id\" href=\"#pty_unix98_ops\">pty_unix98_ops</a> = {", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#lookup\">lookup</a> = <a class=\"id\" href=\"#pts_unix98_lookup\">pts_unix98_lookup</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#install\">install</a> = <a class=\"id\" href=\"#pty_unix98_install\">pty_unix98_install</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#remove\">remove</a> = <a class=\"id\" href=\"#pty_unix98_remove\">pty_unix98_remove</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#open\">open</a> = <a class=\"id\" href=\"#pty_open\">pty_open</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#close\">close</a> = <a class=\"id\" href=\"#pty_close\">pty_close</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#write\">write</a> = <a class=\"id\" href=\"#pty_write\">pty_write</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#write_room\">write_room</a> = <a class=\"id\" href=\"#pty_write_room\">pty_write_room</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#flush_buffer\">flush_buffer</a> = <a class=\"id\" href=\"#pty_flush_buffer\">pty_flush_buffer</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#chars_in_buffer\">chars_in_buffer</a> = <a class=\"id\" href=\"#pty_chars_in_buffer\">pty_chars_in_buffer</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#unthrottle\">unthrottle</a> = <a class=\"id\" href=\"#pty_unthrottle\">pty_unthrottle</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#set_termios\">set_termios</a> = <a class=\"id\" href=\"#pty_set_termios\">pty_set_termios</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#shutdown\">shutdown</a> = <a class=\"id\" href=\"#pty_unix98_shutdown\">pty_unix98_shutdown</a>", 
"};", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>ptmx_open<span class=\"ts\"/><span class=\"ts\"/>-<span class=\"ts\"/>open a unix 98 pty master</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>@inode: inode of device file</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>@filp: file pointer to tty</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>Allocate a unix98 pty master device from the ptmx driver.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>Locking: tty_mutex protects the init_dev work. tty-&gt;count should</span>", 
"<span class=\"comment\"> * <span class=\"ts\"/><span class=\"ts\"/>protect the rest.</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/><span class=\"ts\"/>allocated_ptys_lock handles the list of free pty numbers</span>", 
"<span class=\"comment\"> */</span>", 
"", 
"static int <a class=\"id\" href=\"#ptmx_open\">ptmx_open</a>(struct <a class=\"id\" href=\"#inode\">inode</a> *<a class=\"id\" href=\"#inode\">inode</a>, struct <a class=\"id\" href=\"#file\">file</a> *<a class=\"id\" href=\"#filp\">filp</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#tty_struct\">tty_struct</a> *<a class=\"id\" href=\"#tty\">tty</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#retval\">retval</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#index\">index</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#nonseekable_open\">nonseekable_open</a>(<a class=\"id\" href=\"#inode\">inode</a>, <a class=\"id\" href=\"#filp\">filp</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* find a device that is not in use. */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tty_lock\">tty_lock</a>();", 
"<span class=\"ts\"/><a class=\"id\" href=\"#index\">index</a> = <a class=\"id\" href=\"#devpts_new_index\">devpts_new_index</a>(<a class=\"id\" href=\"#inode\">inode</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tty_unlock\">tty_unlock</a>();", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#index\">index</a> &lt; 0)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#index\">index</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_lock\">mutex_lock</a>(&amp;<a class=\"id\" href=\"#tty_mutex\">tty_mutex</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tty_lock\">tty_lock</a>();", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tty\">tty</a> = <a class=\"id\" href=\"#tty_init_dev\">tty_init_dev</a>(<a class=\"id\" href=\"#ptm_driver\">ptm_driver</a>, <a class=\"id\" href=\"#index\">index</a>, 1);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_unlock\">mutex_unlock</a>(&amp;<a class=\"id\" href=\"#tty_mutex\">tty_mutex</a>);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#IS_ERR\">IS_ERR</a>(<a class=\"id\" href=\"#tty\">tty</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#retval\">retval</a> = <a class=\"id\" href=\"#PTR_ERR\">PTR_ERR</a>(<a class=\"id\" href=\"#tty\">tty</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out\">out</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#set_bit\">set_bit</a>(<a class=\"id\" href=\"#TTY_PTY_LOCK\">TTY_PTY_LOCK</a>, &amp;<a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#flags\">flags</a>); <span class=\"comment\">/* LOCK THE SLAVE */</span>", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tty_add_file\">tty_add_file</a>(<a class=\"id\" href=\"#tty\">tty</a>, <a class=\"id\" href=\"#filp\">filp</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#retval\">retval</a> = <a class=\"id\" href=\"#devpts_pty_new\">devpts_pty_new</a>(<a class=\"id\" href=\"#inode\">inode</a>, <a class=\"id\" href=\"#tty\">tty</a>-><a class=\"id\" href=\"#link\">link</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#retval\">retval</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out1\">out1</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#retval\">retval</a> = <a class=\"id\" href=\"#ptm_driver\">ptm_driver</a>-><a class=\"id\" href=\"#ops\">ops</a>-><a class=\"id\" href=\"#open\">open</a>(<a class=\"id\" href=\"#tty\">tty</a>, <a class=\"id\" href=\"#filp\">filp</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#retval\">retval</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#out2\">out2</a>;", 
"<a class=\"id\" href=\"#out1\">out1</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tty_unlock\">tty_unlock</a>();", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#retval\">retval</a>;", 
"<a class=\"id\" href=\"#out2\">out2</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tty_unlock\">tty_unlock</a>();", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tty_release\">tty_release</a>(<a class=\"id\" href=\"#inode\">inode</a>, <a class=\"id\" href=\"#filp\">filp</a>);", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#retval\">retval</a>;", 
"<a class=\"id\" href=\"#out\">out</a>:", 
"<span class=\"ts\"/><a class=\"id\" href=\"#devpts_kill_index\">devpts_kill_index</a>(<a class=\"id\" href=\"#inode\">inode</a>, <a class=\"id\" href=\"#index\">index</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tty_unlock\">tty_unlock</a>();", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#retval\">retval</a>;", 
"}", 
"", 
"static struct <a class=\"id\" href=\"#file_operations\">file_operations</a> <a class=\"id\" href=\"#ptmx_fops\">ptmx_fops</a>;", 
"", 
"static void <a class=\"id\" href=\"#__init\">__init</a> <a class=\"id\" href=\"#unix98_pty_init\">unix98_pty_init</a>(void)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ptm_driver\">ptm_driver</a> = <a class=\"id\" href=\"#alloc_tty_driver\">alloc_tty_driver</a>(<a class=\"id\" href=\"#NR_UNIX98_PTY_MAX\">NR_UNIX98_PTY_MAX</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#ptm_driver\">ptm_driver</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#panic\">panic</a>(\"Couldn't allocate Unix98 ptm driver\");", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pts_driver\">pts_driver</a> = <a class=\"id\" href=\"#alloc_tty_driver\">alloc_tty_driver</a>(<a class=\"id\" href=\"#NR_UNIX98_PTY_MAX\">NR_UNIX98_PTY_MAX</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#pts_driver\">pts_driver</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#panic\">panic</a>(\"Couldn't allocate Unix98 pts driver\");", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ptm_driver\">ptm_driver</a>-><a class=\"id\" href=\"#owner\">owner</a> = <a class=\"id\" href=\"#THIS_MODULE\">THIS_MODULE</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ptm_driver\">ptm_driver</a>-><a class=\"id\" href=\"#driver_name\">driver_name</a> = \"pty_master\";", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ptm_driver\">ptm_driver</a>-><a class=\"id\" href=\"#name\">name</a> = \"ptm\";", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ptm_driver\">ptm_driver</a>-><a class=\"id\" href=\"#major\">major</a> = <a class=\"id\" href=\"#UNIX98_PTY_MASTER_MAJOR\">UNIX98_PTY_MASTER_MAJOR</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ptm_driver\">ptm_driver</a>-><a class=\"id\" href=\"#minor_start\">minor_start</a> = 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ptm_driver\">ptm_driver</a>-><a class=\"id\" href=\"#type\">type</a> = <a class=\"id\" href=\"#TTY_DRIVER_TYPE_PTY\">TTY_DRIVER_TYPE_PTY</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ptm_driver\">ptm_driver</a>-><a class=\"id\" href=\"#subtype\">subtype</a> = <a class=\"id\" href=\"#PTY_TYPE_MASTER\">PTY_TYPE_MASTER</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ptm_driver\">ptm_driver</a>-><a class=\"id\" href=\"#init_termios\">init_termios</a> = <a class=\"id\" href=\"#tty_std_termios\">tty_std_termios</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ptm_driver\">ptm_driver</a>-><a class=\"id\" href=\"#init_termios\">init_termios</a>.<a class=\"id\" href=\"#c_iflag\">c_iflag</a> = 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ptm_driver\">ptm_driver</a>-><a class=\"id\" href=\"#init_termios\">init_termios</a>.<a class=\"id\" href=\"#c_oflag\">c_oflag</a> = 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ptm_driver\">ptm_driver</a>-><a class=\"id\" href=\"#init_termios\">init_termios</a>.<a class=\"id\" href=\"#c_cflag\">c_cflag</a> = <a class=\"id\" href=\"#B38400\">B38400</a> | <a class=\"id\" href=\"#CS8\">CS8</a> | <a class=\"id\" href=\"#CREAD\">CREAD</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ptm_driver\">ptm_driver</a>-><a class=\"id\" href=\"#init_termios\">init_termios</a>.<a class=\"id\" href=\"#c_lflag\">c_lflag</a> = 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ptm_driver\">ptm_driver</a>-><a class=\"id\" href=\"#init_termios\">init_termios</a>.<a class=\"id\" href=\"#c_ispeed\">c_ispeed</a> = 38400;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ptm_driver\">ptm_driver</a>-><a class=\"id\" href=\"#init_termios\">init_termios</a>.<a class=\"id\" href=\"#c_ospeed\">c_ospeed</a> = 38400;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ptm_driver\">ptm_driver</a>-><a class=\"id\" href=\"#flags\">flags</a> = <a class=\"id\" href=\"#TTY_DRIVER_RESET_TERMIOS\">TTY_DRIVER_RESET_TERMIOS</a> | <a class=\"id\" href=\"#TTY_DRIVER_REAL_RAW\">TTY_DRIVER_REAL_RAW</a> |", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#TTY_DRIVER_DYNAMIC_DEV\">TTY_DRIVER_DYNAMIC_DEV</a> | <a class=\"id\" href=\"#TTY_DRIVER_DEVPTS_MEM\">TTY_DRIVER_DEVPTS_MEM</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ptm_driver\">ptm_driver</a>-><a class=\"id\" href=\"#other\">other</a> = <a class=\"id\" href=\"#pts_driver\">pts_driver</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tty_set_operations\">tty_set_operations</a>(<a class=\"id\" href=\"#ptm_driver\">ptm_driver</a>, &amp;<a class=\"id\" href=\"#ptm_unix98_ops\">ptm_unix98_ops</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pts_driver\">pts_driver</a>-><a class=\"id\" href=\"#owner\">owner</a> = <a class=\"id\" href=\"#THIS_MODULE\">THIS_MODULE</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pts_driver\">pts_driver</a>-><a class=\"id\" href=\"#driver_name\">driver_name</a> = \"pty_slave\";", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pts_driver\">pts_driver</a>-><a class=\"id\" href=\"#name\">name</a> = \"pts\";", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pts_driver\">pts_driver</a>-><a class=\"id\" href=\"#major\">major</a> = <a class=\"id\" href=\"#UNIX98_PTY_SLAVE_MAJOR\">UNIX98_PTY_SLAVE_MAJOR</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pts_driver\">pts_driver</a>-><a class=\"id\" href=\"#minor_start\">minor_start</a> = 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pts_driver\">pts_driver</a>-><a class=\"id\" href=\"#type\">type</a> = <a class=\"id\" href=\"#TTY_DRIVER_TYPE_PTY\">TTY_DRIVER_TYPE_PTY</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pts_driver\">pts_driver</a>-><a class=\"id\" href=\"#subtype\">subtype</a> = <a class=\"id\" href=\"#PTY_TYPE_SLAVE\">PTY_TYPE_SLAVE</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pts_driver\">pts_driver</a>-><a class=\"id\" href=\"#init_termios\">init_termios</a> = <a class=\"id\" href=\"#tty_std_termios\">tty_std_termios</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pts_driver\">pts_driver</a>-><a class=\"id\" href=\"#init_termios\">init_termios</a>.<a class=\"id\" href=\"#c_cflag\">c_cflag</a> = <a class=\"id\" href=\"#B38400\">B38400</a> | <a class=\"id\" href=\"#CS8\">CS8</a> | <a class=\"id\" href=\"#CREAD\">CREAD</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pts_driver\">pts_driver</a>-><a class=\"id\" href=\"#init_termios\">init_termios</a>.<a class=\"id\" href=\"#c_ispeed\">c_ispeed</a> = 38400;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pts_driver\">pts_driver</a>-><a class=\"id\" href=\"#init_termios\">init_termios</a>.<a class=\"id\" href=\"#c_ospeed\">c_ospeed</a> = 38400;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pts_driver\">pts_driver</a>-><a class=\"id\" href=\"#flags\">flags</a> = <a class=\"id\" href=\"#TTY_DRIVER_RESET_TERMIOS\">TTY_DRIVER_RESET_TERMIOS</a> | <a class=\"id\" href=\"#TTY_DRIVER_REAL_RAW\">TTY_DRIVER_REAL_RAW</a> |", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#TTY_DRIVER_DYNAMIC_DEV\">TTY_DRIVER_DYNAMIC_DEV</a> | <a class=\"id\" href=\"#TTY_DRIVER_DEVPTS_MEM\">TTY_DRIVER_DEVPTS_MEM</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pts_driver\">pts_driver</a>-><a class=\"id\" href=\"#other\">other</a> = <a class=\"id\" href=\"#ptm_driver\">ptm_driver</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tty_set_operations\">tty_set_operations</a>(<a class=\"id\" href=\"#pts_driver\">pts_driver</a>, &amp;<a class=\"id\" href=\"#pty_unix98_ops\">pty_unix98_ops</a>);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#tty_register_driver\">tty_register_driver</a>(<a class=\"id\" href=\"#ptm_driver\">ptm_driver</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#panic\">panic</a>(\"Couldn't register Unix98 ptm driver\");", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#tty_register_driver\">tty_register_driver</a>(<a class=\"id\" href=\"#pts_driver\">pts_driver</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#panic\">panic</a>(\"Couldn't register Unix98 pts driver\");", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#register_sysctl_table\">register_sysctl_table</a>(<a class=\"id\" href=\"#pty_root_table\">pty_root_table</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Now create the /dev/ptmx special device */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tty_default_fops\">tty_default_fops</a>(&amp;<a class=\"id\" href=\"#ptmx_fops\">ptmx_fops</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ptmx_fops\">ptmx_fops</a>.<a class=\"id\" href=\"#open\">open</a> = <a class=\"id\" href=\"#ptmx_open\">ptmx_open</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#cdev_init\">cdev_init</a>(&amp;<a class=\"id\" href=\"#ptmx_cdev\">ptmx_cdev</a>, &amp;<a class=\"id\" href=\"#ptmx_fops\">ptmx_fops</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#cdev_add\">cdev_add</a>(&amp;<a class=\"id\" href=\"#ptmx_cdev\">ptmx_cdev</a>, <a class=\"id\" href=\"#MKDEV\">MKDEV</a>(<a class=\"id\" href=\"#TTYAUX_MAJOR\">TTYAUX_MAJOR</a>, 2), 1) ||", 
"<span class=\"ts\"/>    <a class=\"id\" href=\"#register_chrdev_region\">register_chrdev_region</a>(<a class=\"id\" href=\"#MKDEV\">MKDEV</a>(<a class=\"id\" href=\"#TTYAUX_MAJOR\">TTYAUX_MAJOR</a>, 2), 1, \"/dev/ptmx\") &lt; 0)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#panic\">panic</a>(\"Couldn't register /dev/ptmx driver\\n\");", 
"<span class=\"ts\"/><a class=\"id\" href=\"#device_create\">device_create</a>(<a class=\"id\" href=\"#tty_class\">tty_class</a>, <a class=\"id\" href=\"#NULL\">NULL</a>, <a class=\"id\" href=\"#MKDEV\">MKDEV</a>(<a class=\"id\" href=\"#TTYAUX_MAJOR\">TTYAUX_MAJOR</a>, 2), <a class=\"id\" href=\"#NULL\">NULL</a>, \"ptmx\");", 
"}", 
"", 
"#else", 
"static <a class=\"id\" href=\"#inline\">inline</a> void <a class=\"id\" href=\"#unix98_pty_init\">unix98_pty_init</a>(void) { }", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
"", 
"static int <a class=\"id\" href=\"#__init\">__init</a> <a class=\"id\" href=\"#pty_init\">pty_init</a>(void)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#legacy_pty_init\">legacy_pty_init</a>();", 
"<span class=\"ts\"/><a class=\"id\" href=\"#unix98_pty_init\">unix98_pty_init</a>();", 
"<span class=\"ts\"/>return 0;", 
"}", 
"<a class=\"id\" href=\"#module_init\">module_init</a>(<a class=\"id\" href=\"#pty_init\">pty_init</a>);", 
];
xr_frag_insert('l/ae/9e61e1f25b92cc9e76f77f4ee709d78a8ac8e0.xr', __xr_tmp);
