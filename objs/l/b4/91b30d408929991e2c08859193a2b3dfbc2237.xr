var __xr_tmp = [
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Shared support code for AMD K8 northbridges and derivates.</span>", 
"<span class=\"comment\"> * Copyright 2006 Andi Kleen, SUSE Labs. Subject to GPLv2.</span>", 
"<span class=\"comment\"> */</span>", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#types\">types</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#slab\">slab</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#init\">init</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#errno\">errno</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#module\">module</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#spinlock\">spinlock</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#asm\">asm</a>/<a class=\"id\" href=\"#k8\">k8</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"", 
"int <a class=\"id\" href=\"#num_k8_northbridges\">num_k8_northbridges</a>;", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL\">EXPORT_SYMBOL</a>(<a class=\"id\" href=\"#num_k8_northbridges\">num_k8_northbridges</a>);", 
"", 
"static <a class=\"id\" href=\"#u32\">u32</a> *<a class=\"id\" href=\"#flush_words\">flush_words</a>;", 
"", 
"struct <a class=\"id\" href=\"#pci_device_id\">pci_device_id</a> <a class=\"id\" href=\"#k8_nb_ids\">k8_nb_ids</a>[] = {", 
"<span class=\"ts\"/>{ <a class=\"id\" href=\"#PCI_DEVICE\">PCI_DEVICE</a>(<a class=\"id\" href=\"#PCI_VENDOR_ID_AMD\">PCI_VENDOR_ID_AMD</a>, <a class=\"id\" href=\"#PCI_DEVICE_ID_AMD_K8_NB_MISC\">PCI_DEVICE_ID_AMD_K8_NB_MISC</a>) },", 
"<span class=\"ts\"/>{ <a class=\"id\" href=\"#PCI_DEVICE\">PCI_DEVICE</a>(<a class=\"id\" href=\"#PCI_VENDOR_ID_AMD\">PCI_VENDOR_ID_AMD</a>, <a class=\"id\" href=\"#PCI_DEVICE_ID_AMD_10H_NB_MISC\">PCI_DEVICE_ID_AMD_10H_NB_MISC</a>) },", 
"<span class=\"ts\"/>{}", 
"};", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL\">EXPORT_SYMBOL</a>(<a class=\"id\" href=\"#k8_nb_ids\">k8_nb_ids</a>);", 
"", 
"struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> **<a class=\"id\" href=\"#k8_northbridges\">k8_northbridges</a>;", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL\">EXPORT_SYMBOL</a>(<a class=\"id\" href=\"#k8_northbridges\">k8_northbridges</a>);", 
"", 
"static struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#next_k8_northbridge\">next_k8_northbridge</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/>do {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#dev\">dev</a> = <a class=\"id\" href=\"#pci_get_device\">pci_get_device</a>(<a class=\"id\" href=\"#PCI_ANY_ID\">PCI_ANY_ID</a>, <a class=\"id\" href=\"#PCI_ANY_ID\">PCI_ANY_ID</a>, <a class=\"id\" href=\"#dev\">dev</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#dev\">dev</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>} while (!<a class=\"id\" href=\"#pci_match_id\">pci_match_id</a>(&amp;<a class=\"id\" href=\"#k8_nb_ids\">k8_nb_ids</a>[0], <a class=\"id\" href=\"#dev\">dev</a>));", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#dev\">dev</a>;", 
"}", 
"", 
"int <a class=\"id\" href=\"#cache_k8_northbridges\">cache_k8_northbridges</a>(void)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#i\">i</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#num_k8_northbridges\">num_k8_northbridges</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dev\">dev</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/>while ((<a class=\"id\" href=\"#dev\">dev</a> = <a class=\"id\" href=\"#next_k8_northbridge\">next_k8_northbridge</a>(<a class=\"id\" href=\"#dev\">dev</a>)) != <a class=\"id\" href=\"#NULL\">NULL</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#num_k8_northbridges\">num_k8_northbridges</a>++;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#k8_northbridges\">k8_northbridges</a> = <a class=\"id\" href=\"#kmalloc\">kmalloc</a>((<a class=\"id\" href=\"#num_k8_northbridges\">num_k8_northbridges</a> + 1) * sizeof(void *),", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>  <a class=\"id\" href=\"#GFP_KERNEL\">GFP_KERNEL</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#k8_northbridges\">k8_northbridges</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#num_k8_northbridges\">num_k8_northbridges</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#k8_northbridges\">k8_northbridges</a>[0] = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#flush_words\">flush_words</a> = <a class=\"id\" href=\"#kmalloc\">kmalloc</a>(<a class=\"id\" href=\"#num_k8_northbridges\">num_k8_northbridges</a> * sizeof(<a class=\"id\" href=\"#u32\">u32</a>), <a class=\"id\" href=\"#GFP_KERNEL\">GFP_KERNEL</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#flush_words\">flush_words</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#k8_northbridges\">k8_northbridges</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dev\">dev</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#i\">i</a> = 0;", 
"<span class=\"ts\"/>while ((<a class=\"id\" href=\"#dev\">dev</a> = <a class=\"id\" href=\"#next_k8_northbridge\">next_k8_northbridge</a>(<a class=\"id\" href=\"#dev\">dev</a>)) != <a class=\"id\" href=\"#NULL\">NULL</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#k8_northbridges\">k8_northbridges</a>[<a class=\"id\" href=\"#i\">i</a>] = <a class=\"id\" href=\"#dev\">dev</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_dword\">pci_read_config_dword</a>(<a class=\"id\" href=\"#dev\">dev</a>, 0x9c, &amp;<a class=\"id\" href=\"#flush_words\">flush_words</a>[<a class=\"id\" href=\"#i\">i</a>++]);", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#k8_northbridges\">k8_northbridges</a>[<a class=\"id\" href=\"#i\">i</a>] = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/>return 0;", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#cache_k8_northbridges\">cache_k8_northbridges</a>);", 
"", 
"<span class=\"comment\">/* Ignores subdevice/subvendor but as far as I can figure out</span>", 
"<span class=\"comment\">   they're useless anyways */</span>", 
"int <a class=\"id\" href=\"#__init\">__init</a> <a class=\"id\" href=\"#early_is_k8_nb\">early_is_k8_nb</a>(<a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#device\">device</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#pci_device_id\">pci_device_id</a> *<a class=\"id\" href=\"#id\">id</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#vendor\">vendor</a> = <a class=\"id\" href=\"#device\">device</a> &amp; 0xffff;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#device\">device</a> >>= 16;", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#id\">id</a> = <a class=\"id\" href=\"#k8_nb_ids\">k8_nb_ids</a>; <a class=\"id\" href=\"#id\">id</a>-><a class=\"id\" href=\"#vendor\">vendor</a>; <a class=\"id\" href=\"#id\">id</a>++)", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#vendor\">vendor</a> == <a class=\"id\" href=\"#id\">id</a>-><a class=\"id\" href=\"#vendor\">vendor</a> && <a class=\"id\" href=\"#device\">device</a> == <a class=\"id\" href=\"#id\">id</a>-><a class=\"id\" href=\"#device\">device</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return 1;", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"void <a class=\"id\" href=\"#k8_flush_garts\">k8_flush_garts</a>(void)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#flushed\">flushed</a>, <a class=\"id\" href=\"#i\">i</a>;", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#flags\">flags</a>;", 
"<span class=\"ts\"/>static <a class=\"id\" href=\"#DEFINE_SPINLOCK\">DEFINE_SPINLOCK</a>(<a class=\"id\" href=\"#gart_lock\">gart_lock</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Avoid races between AGP and IOMMU. In theory it's not needed</span>", 
"<span class=\"comment\"><span class=\"ts\"/>   but I'm not sure if the hardware won't lose flush requests</span>", 
"<span class=\"comment\"><span class=\"ts\"/>   when another is pending. This whole thing is so expensive anyways</span>", 
"<span class=\"comment\"><span class=\"ts\"/>   that it doesn't matter to serialize more. -AK */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irqsave\">spin_lock_irqsave</a>(&amp;<a class=\"id\" href=\"#gart_lock\">gart_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#flushed\">flushed</a> = 0;", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = 0; <a class=\"id\" href=\"#i\">i</a> &lt; <a class=\"id\" href=\"#num_k8_northbridges\">num_k8_northbridges</a>; <a class=\"id\" href=\"#i\">i</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_dword\">pci_write_config_dword</a>(<a class=\"id\" href=\"#k8_northbridges\">k8_northbridges</a>[<a class=\"id\" href=\"#i\">i</a>], 0x9c,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       <a class=\"id\" href=\"#flush_words\">flush_words</a>[<a class=\"id\" href=\"#i\">i</a>]|1);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#flushed\">flushed</a>++;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = 0; <a class=\"id\" href=\"#i\">i</a> &lt; <a class=\"id\" href=\"#num_k8_northbridges\">num_k8_northbridges</a>; <a class=\"id\" href=\"#i\">i</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#w\">w</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Make sure the hardware actually executed the flush*/</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>for (;;) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_dword\">pci_read_config_dword</a>(<a class=\"id\" href=\"#k8_northbridges\">k8_northbridges</a>[<a class=\"id\" href=\"#i\">i</a>],", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>      0x9c, &amp;<a class=\"id\" href=\"#w\">w</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (!(<a class=\"id\" href=\"#w\">w</a> &amp; 1))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#cpu_relax\">cpu_relax</a>();", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#gart_lock\">gart_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#flushed\">flushed</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(\"nothing to flush?\\n\");", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#k8_flush_garts\">k8_flush_garts</a>);", 
"", 
"static <a class=\"id\" href=\"#__init\">__init</a> int <a class=\"id\" href=\"#init_k8_nbs\">init_k8_nbs</a>(void)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#err\">err</a> = 0;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#err\">err</a> = <a class=\"id\" href=\"#cache_k8_northbridges\">cache_k8_northbridges</a>();", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#err\">err</a> &lt; 0)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_NOTICE\">KERN_NOTICE</a> \"K8 NB: Cannot enumerate AMD northbridges.\\n\");", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#err\">err</a>;", 
"}", 
"", 
"<span class=\"comment\">/* This has to go after the PCI subsystem */</span>", 
"<a class=\"id\" href=\"#fs_initcall\">fs_initcall</a>(<a class=\"id\" href=\"#init_k8_nbs\">init_k8_nbs</a>);", 
];
xr_frag_insert('l/b4/91b30d408929991e2c08859193a2b3dfbc2237.xr', __xr_tmp);
