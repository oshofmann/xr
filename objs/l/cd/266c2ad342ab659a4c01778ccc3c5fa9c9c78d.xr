var __xr_tmp = [
"<span class=\"comment\">/******************************************************************************</span>", 
"<span class=\"comment\"> * platform-pci-unplug.c</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Xen platform PCI device driver</span>", 
"<span class=\"comment\"> * Copyright (c) 2010, Citrix</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * This program is free software; you can redistribute it and/or modify it</span>", 
"<span class=\"comment\"> * under the terms and conditions of the GNU General Public License,</span>", 
"<span class=\"comment\"> * version 2, as published by the Free Software Foundation.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * This program is distributed in the hope it will be useful, but WITHOUT</span>", 
"<span class=\"comment\"> * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or</span>", 
"<span class=\"comment\"> * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for</span>", 
"<span class=\"comment\"> * more details.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * You should have received a copy of the GNU General Public License along with</span>", 
"<span class=\"comment\"> * this program; if not, write to the Free Software Foundation, Inc., 59 Temple</span>", 
"<span class=\"comment\"> * Place - Suite 330, Boston, MA 02111-1307 USA.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> */</span>", 
"", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#init\">init</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#io\">io</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#module\">module</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#xen\">xen</a>/<a class=\"id\" href=\"#platform_pci\">platform_pci</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#XEN_PLATFORM_ERR_MAGIC\">XEN_PLATFORM_ERR_MAGIC</a> -1", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#XEN_PLATFORM_ERR_PROTOCOL\">XEN_PLATFORM_ERR_PROTOCOL</a> -2", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#XEN_PLATFORM_ERR_BLACKLIST\">XEN_PLATFORM_ERR_BLACKLIST</a> -3", 
"", 
"<span class=\"comment\">/* store the value of xen_emul_unplug after the unplug is done */</span>", 
"int <a class=\"id\" href=\"#xen_platform_pci_unplug\">xen_platform_pci_unplug</a>;", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#xen_platform_pci_unplug\">xen_platform_pci_unplug</a>);", 
"#<a class=\"id\" href=\"#ifdef\">ifdef</a> <a class=\"id\" href=\"#CONFIG_XEN_PVHVM\">CONFIG_XEN_PVHVM</a>", 
"static int <a class=\"id\" href=\"#xen_emul_unplug\">xen_emul_unplug</a>;", 
"", 
"static int <a class=\"id\" href=\"#__init\">__init</a> <a class=\"id\" href=\"#check_platform_magic\">check_platform_magic</a>(void)", 
"{", 
"<span class=\"ts\"/>short <a class=\"id\" href=\"#magic\">magic</a>;", 
"<span class=\"ts\"/>char <a class=\"id\" href=\"#protocol\">protocol</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#magic\">magic</a> = <a class=\"id\" href=\"#inw\">inw</a>(<a class=\"id\" href=\"#XEN_IOPORT_MAGIC\">XEN_IOPORT_MAGIC</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#magic\">magic</a> != <a class=\"id\" href=\"#XEN_IOPORT_MAGIC_VAL\">XEN_IOPORT_MAGIC_VAL</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_ERR\">KERN_ERR</a> \"Xen Platform PCI: unrecognised magic value\\n\");", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#XEN_PLATFORM_ERR_MAGIC\">XEN_PLATFORM_ERR_MAGIC</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#protocol\">protocol</a> = <a class=\"id\" href=\"#inb\">inb</a>(<a class=\"id\" href=\"#XEN_IOPORT_PROTOVER\">XEN_IOPORT_PROTOVER</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_DEBUG\">KERN_DEBUG</a> \"Xen Platform PCI: I/O protocol version %d\\n\",", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#protocol\">protocol</a>);", 
"", 
"<span class=\"ts\"/>switch (<a class=\"id\" href=\"#protocol\">protocol</a>) {", 
"<span class=\"ts\"/>case 1:", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#outw\">outw</a>(<a class=\"id\" href=\"#XEN_IOPORT_LINUX_PRODNUM\">XEN_IOPORT_LINUX_PRODNUM</a>, <a class=\"id\" href=\"#XEN_IOPORT_PRODNUM\">XEN_IOPORT_PRODNUM</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#outl\">outl</a>(<a class=\"id\" href=\"#XEN_IOPORT_LINUX_DRVVER\">XEN_IOPORT_LINUX_DRVVER</a>, <a class=\"id\" href=\"#XEN_IOPORT_DRVVER\">XEN_IOPORT_DRVVER</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#inw\">inw</a>(<a class=\"id\" href=\"#XEN_IOPORT_MAGIC\">XEN_IOPORT_MAGIC</a>) != <a class=\"id\" href=\"#XEN_IOPORT_MAGIC_VAL\">XEN_IOPORT_MAGIC_VAL</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_ERR\">KERN_ERR</a> \"Xen Platform: blacklisted by host\\n\");", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#XEN_PLATFORM_ERR_BLACKLIST\">XEN_PLATFORM_ERR_BLACKLIST</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>default:", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_WARNING\">KERN_WARNING</a> \"Xen Platform PCI: unknown I/O protocol version\");", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#XEN_PLATFORM_ERR_PROTOCOL\">XEN_PLATFORM_ERR_PROTOCOL</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"void <a class=\"id\" href=\"#__init\">__init</a> <a class=\"id\" href=\"#xen_unplug_emulated_devices\">xen_unplug_emulated_devices</a>(void)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#r\">r</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* user explicitly requested no unplug */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#xen_emul_unplug\">xen_emul_unplug</a> &amp; <a class=\"id\" href=\"#XEN_UNPLUG_NEVER\">XEN_UNPLUG_NEVER</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"<span class=\"ts\"/><span class=\"comment\">/* check the version of the xen platform PCI device */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#r\">r</a> = <a class=\"id\" href=\"#check_platform_magic\">check_platform_magic</a>();", 
"<span class=\"ts\"/><span class=\"comment\">/* If the version matches enable the Xen platform PCI driver.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Also enable the Xen platform PCI driver if the host does</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * not support the unplug protocol (XEN_PLATFORM_ERR_MAGIC)</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * but the user told us that unplugging is unnecessary. */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#r\">r</a> && !(<a class=\"id\" href=\"#r\">r</a> == <a class=\"id\" href=\"#XEN_PLATFORM_ERR_MAGIC\">XEN_PLATFORM_ERR_MAGIC</a> &&", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>(<a class=\"id\" href=\"#xen_emul_unplug\">xen_emul_unplug</a> &amp; <a class=\"id\" href=\"#XEN_UNPLUG_UNNECESSARY\">XEN_UNPLUG_UNNECESSARY</a>)))", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"<span class=\"ts\"/><span class=\"comment\">/* Set the default value of xen_emul_unplug depending on whether or</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * not the Xen PV frontends and the Xen platform PCI driver have</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * been compiled for this kernel (modules or built-in are both OK). */</span>", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#xen_emul_unplug\">xen_emul_unplug</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#xen_must_unplug_nics\">xen_must_unplug_nics</a>()) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_INFO\">KERN_INFO</a> \"Netfront and the Xen platform PCI driver have \"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>\"been compiled for this kernel: unplug emulated NICs.\\n\");", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#xen_emul_unplug\">xen_emul_unplug</a> |= <a class=\"id\" href=\"#XEN_UNPLUG_ALL_NICS\">XEN_UNPLUG_ALL_NICS</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#xen_must_unplug_disks\">xen_must_unplug_disks</a>()) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_INFO\">KERN_INFO</a> \"Blkfront and the Xen platform PCI driver have \"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>\"been compiled for this kernel: unplug emulated disks.\\n\"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>\"You might have to change the root device\\n\"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>\"from /dev/hd[a-d] to /dev/xvd[a-d]\\n\"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>\"in your root= kernel command line option\\n\");", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#xen_emul_unplug\">xen_emul_unplug</a> |= <a class=\"id\" href=\"#XEN_UNPLUG_ALL_IDE_DISKS\">XEN_UNPLUG_ALL_IDE_DISKS</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"comment\">/* Now unplug the emulated devices */</span>", 
"<span class=\"ts\"/>if (!(<a class=\"id\" href=\"#xen_emul_unplug\">xen_emul_unplug</a> &amp; <a class=\"id\" href=\"#XEN_UNPLUG_UNNECESSARY\">XEN_UNPLUG_UNNECESSARY</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#outw\">outw</a>(<a class=\"id\" href=\"#xen_emul_unplug\">xen_emul_unplug</a>, <a class=\"id\" href=\"#XEN_IOPORT_UNPLUG\">XEN_IOPORT_UNPLUG</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#xen_platform_pci_unplug\">xen_platform_pci_unplug</a> = <a class=\"id\" href=\"#xen_emul_unplug\">xen_emul_unplug</a>;", 
"}", 
"", 
"static int <a class=\"id\" href=\"#__init\">__init</a> <a class=\"id\" href=\"#parse_xen_emul_unplug\">parse_xen_emul_unplug</a>(char *<a class=\"id\" href=\"#arg\">arg</a>)", 
"{", 
"<span class=\"ts\"/>char *<a class=\"id\" href=\"#p\">p</a>, *<a class=\"id\" href=\"#q\">q</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#l\">l</a>;", 
"", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#p\">p</a> = <a class=\"id\" href=\"#arg\">arg</a>; <a class=\"id\" href=\"#p\">p</a>; <a class=\"id\" href=\"#p\">p</a> = <a class=\"id\" href=\"#q\">q</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#q\">q</a> = <a class=\"id\" href=\"#strchr\">strchr</a>(<a class=\"id\" href=\"#p\">p</a>, ',');", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#q\">q</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#l\">l</a> = <a class=\"id\" href=\"#q\">q</a> - <a class=\"id\" href=\"#p\">p</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#q\">q</a>++;", 
"<span class=\"ts\"/><span class=\"ts\"/>} else {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#l\">l</a> = <a class=\"id\" href=\"#strlen\">strlen</a>(<a class=\"id\" href=\"#p\">p</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#strncmp\">strncmp</a>(<a class=\"id\" href=\"#p\">p</a>, \"all\", <a class=\"id\" href=\"#l\">l</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#xen_emul_unplug\">xen_emul_unplug</a> |= <a class=\"id\" href=\"#XEN_UNPLUG_ALL\">XEN_UNPLUG_ALL</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>else if (!<a class=\"id\" href=\"#strncmp\">strncmp</a>(<a class=\"id\" href=\"#p\">p</a>, \"ide-disks\", <a class=\"id\" href=\"#l\">l</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#xen_emul_unplug\">xen_emul_unplug</a> |= <a class=\"id\" href=\"#XEN_UNPLUG_ALL_IDE_DISKS\">XEN_UNPLUG_ALL_IDE_DISKS</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>else if (!<a class=\"id\" href=\"#strncmp\">strncmp</a>(<a class=\"id\" href=\"#p\">p</a>, \"aux-ide-disks\", <a class=\"id\" href=\"#l\">l</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#xen_emul_unplug\">xen_emul_unplug</a> |= <a class=\"id\" href=\"#XEN_UNPLUG_AUX_IDE_DISKS\">XEN_UNPLUG_AUX_IDE_DISKS</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>else if (!<a class=\"id\" href=\"#strncmp\">strncmp</a>(<a class=\"id\" href=\"#p\">p</a>, \"nics\", <a class=\"id\" href=\"#l\">l</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#xen_emul_unplug\">xen_emul_unplug</a> |= <a class=\"id\" href=\"#XEN_UNPLUG_ALL_NICS\">XEN_UNPLUG_ALL_NICS</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>else if (!<a class=\"id\" href=\"#strncmp\">strncmp</a>(<a class=\"id\" href=\"#p\">p</a>, \"unnecessary\", <a class=\"id\" href=\"#l\">l</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#xen_emul_unplug\">xen_emul_unplug</a> |= <a class=\"id\" href=\"#XEN_UNPLUG_UNNECESSARY\">XEN_UNPLUG_UNNECESSARY</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>else if (!<a class=\"id\" href=\"#strncmp\">strncmp</a>(<a class=\"id\" href=\"#p\">p</a>, \"never\", <a class=\"id\" href=\"#l\">l</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#xen_emul_unplug\">xen_emul_unplug</a> |= <a class=\"id\" href=\"#XEN_UNPLUG_NEVER\">XEN_UNPLUG_NEVER</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>else", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_WARNING\">KERN_WARNING</a> \"unrecognised option '%s' \"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> \"in parameter 'xen_emul_unplug'\\n\", <a class=\"id\" href=\"#p\">p</a>);", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>return 0;", 
"}", 
"<a class=\"id\" href=\"#early_param\">early_param</a>(\"xen_emul_unplug\", <a class=\"id\" href=\"#parse_xen_emul_unplug\">parse_xen_emul_unplug</a>);", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
];
xr_frag_insert('l/cd/266c2ad342ab659a4c01778ccc3c5fa9c9c78d.xr', __xr_tmp);
