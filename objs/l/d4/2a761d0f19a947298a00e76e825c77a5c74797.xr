var __xr_tmp = [
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * drivers/pci/pcie/aer/aerdrv.c</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * This file is subject to the terms and conditions of the GNU General Public</span>", 
"<span class=\"comment\"> * License.  See the file \"COPYING\" in the main directory of this archive</span>", 
"<span class=\"comment\"> * for more details.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * This file implements the AER root port service driver. The driver will</span>", 
"<span class=\"comment\"> * register an irq handler. When root port triggers an AER interrupt, the irq</span>", 
"<span class=\"comment\"> * handler will collect root port status and schedule a work.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Copyright (C) 2006 Intel Corp.</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>Tom Long Nguyen (tom.l.nguyen@intel.com)</span>", 
"<span class=\"comment\"> *<span class=\"ts\"/>Zhang Yanmin (yanmin.zhang@intel.com)</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> */</span>", 
"", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#module\">module</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#pci\">pci</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#sched\">sched</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#kernel\">kernel</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#errno\">errno</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#pm\">pm</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#init\">init</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#interrupt\">interrupt</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#delay\">delay</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#pcieport_if\">pcieport_if</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#slab\">slab</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"", 
"#<a class=\"id\" href=\"#include\">include</a> \"aerdrv.h\"", 
"#<a class=\"id\" href=\"#include\">include</a> \"../../pci.h\"", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Version Information</span>", 
"<span class=\"comment\"> */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#DRIVER_VERSION\">DRIVER_VERSION</a> \"v1.0\"", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#DRIVER_AUTHOR\">DRIVER_AUTHOR</a> \"tom.l.nguyen@intel.com\"", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#DRIVER_DESC\">DRIVER_DESC</a> \"Root Port Advanced Error Reporting Driver\"", 
"<a class=\"id\" href=\"#MODULE_AUTHOR\">MODULE_AUTHOR</a>(<a class=\"id\" href=\"#DRIVER_AUTHOR\">DRIVER_AUTHOR</a>);", 
"<a class=\"id\" href=\"#MODULE_DESCRIPTION\">MODULE_DESCRIPTION</a>(<a class=\"id\" href=\"#DRIVER_DESC\">DRIVER_DESC</a>);", 
"<a class=\"id\" href=\"#MODULE_LICENSE\">MODULE_LICENSE</a>(\"GPL\");", 
"", 
"static int <a class=\"id\" href=\"#__devinit\">__devinit</a> <a class=\"id\" href=\"#aer_probe\">aer_probe</a>(struct <a class=\"id\" href=\"#pcie_device\">pcie_device</a> *<a class=\"id\" href=\"#dev\">dev</a>);", 
"static void <a class=\"id\" href=\"#aer_remove\">aer_remove</a>(struct <a class=\"id\" href=\"#pcie_device\">pcie_device</a> *<a class=\"id\" href=\"#dev\">dev</a>);", 
"static <a class=\"id\" href=\"#pci_ers_result_t\">pci_ers_result_t</a> <a class=\"id\" href=\"#aer_error_detected\">aer_error_detected</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>,", 
"<span class=\"ts\"/>enum <a class=\"id\" href=\"#pci_channel_state\">pci_channel_state</a> <a class=\"id\" href=\"#error\">error</a>);", 
"static void <a class=\"id\" href=\"#aer_error_resume\">aer_error_resume</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>);", 
"static <a class=\"id\" href=\"#pci_ers_result_t\">pci_ers_result_t</a> <a class=\"id\" href=\"#aer_root_reset\">aer_root_reset</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>);", 
"", 
"static struct <a class=\"id\" href=\"#pci_error_handlers\">pci_error_handlers</a> <a class=\"id\" href=\"#aer_error_handlers\">aer_error_handlers</a> = {", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#error_detected\">error_detected</a> = <a class=\"id\" href=\"#aer_error_detected\">aer_error_detected</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#resume\">resume</a><span class=\"ts\"/><span class=\"ts\"/>= <a class=\"id\" href=\"#aer_error_resume\">aer_error_resume</a>,", 
"};", 
"", 
"static struct <a class=\"id\" href=\"#pcie_port_service_driver\">pcie_port_service_driver</a> <a class=\"id\" href=\"#aerdriver\">aerdriver</a> = {", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#name\">name</a><span class=\"ts\"/><span class=\"ts\"/>= \"aer\",", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#port_type\">port_type</a><span class=\"ts\"/>= <a class=\"id\" href=\"#PCI_EXP_TYPE_ROOT_PORT\">PCI_EXP_TYPE_ROOT_PORT</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#service\">service</a><span class=\"ts\"/>= <a class=\"id\" href=\"#PCIE_PORT_SERVICE_AER\">PCIE_PORT_SERVICE_AER</a>,", 
"", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#probe\">probe</a><span class=\"ts\"/><span class=\"ts\"/>= <a class=\"id\" href=\"#aer_probe\">aer_probe</a>,", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#remove\">remove</a><span class=\"ts\"/><span class=\"ts\"/>= <a class=\"id\" href=\"#aer_remove\">aer_remove</a>,", 
"", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#err_handler\">err_handler</a><span class=\"ts\"/>= &amp;<a class=\"id\" href=\"#aer_error_handlers\">aer_error_handlers</a>,", 
"", 
"<span class=\"ts\"/>.<a class=\"id\" href=\"#reset_link\">reset_link</a><span class=\"ts\"/>= <a class=\"id\" href=\"#aer_root_reset\">aer_root_reset</a>,", 
"};", 
"", 
"static int <a class=\"id\" href=\"#pcie_aer_disable\">pcie_aer_disable</a>;", 
"", 
"void <a class=\"id\" href=\"#pci_no_aer\">pci_no_aer</a>(void)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pcie_aer_disable\">pcie_aer_disable</a> = 1;<span class=\"ts\"/><span class=\"comment\">/* has priority over 'forceload' */</span>", 
"}", 
"", 
"<a class=\"id\" href=\"#bool\">bool</a> <a class=\"id\" href=\"#pci_aer_available\">pci_aer_available</a>(void)", 
"{", 
"<span class=\"ts\"/>return !<a class=\"id\" href=\"#pcie_aer_disable\">pcie_aer_disable</a> && <a class=\"id\" href=\"#pci_msi_enabled\">pci_msi_enabled</a>();", 
"}", 
"", 
"static int <a class=\"id\" href=\"#set_device_error_reporting\">set_device_error_reporting</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>, void *<a class=\"id\" href=\"#data\">data</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bool\">bool</a> <a class=\"id\" href=\"#enable\">enable</a> = *((<a class=\"id\" href=\"#bool\">bool</a> *)<a class=\"id\" href=\"#data\">data</a>);", 
"", 
"<span class=\"ts\"/>if ((<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#pcie_type\">pcie_type</a> == <a class=\"id\" href=\"#PCI_EXP_TYPE_ROOT_PORT\">PCI_EXP_TYPE_ROOT_PORT</a>) ||", 
"<span class=\"ts\"/>    (<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#pcie_type\">pcie_type</a> == <a class=\"id\" href=\"#PCI_EXP_TYPE_UPSTREAM\">PCI_EXP_TYPE_UPSTREAM</a>) ||", 
"<span class=\"ts\"/>    (<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#pcie_type\">pcie_type</a> == <a class=\"id\" href=\"#PCI_EXP_TYPE_DOWNSTREAM\">PCI_EXP_TYPE_DOWNSTREAM</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#enable\">enable</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pci_enable_pcie_error_reporting\">pci_enable_pcie_error_reporting</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>else", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pci_disable_pcie_error_reporting\">pci_disable_pcie_error_reporting</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#enable\">enable</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pcie_set_ecrc_checking\">pcie_set_ecrc_checking</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * set_downstream_devices_error_reporting - enable/disable the error reporting  bits on the root port and its downstream ports.</span>", 
"<span class=\"comment\"> * @dev: pointer to root port's pci_dev data structure</span>", 
"<span class=\"comment\"> * @enable: true = enable error reporting, false = disable error reporting.</span>", 
"<span class=\"comment\"> */</span>", 
"static void <a class=\"id\" href=\"#set_downstream_devices_error_reporting\">set_downstream_devices_error_reporting</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>   <a class=\"id\" href=\"#bool\">bool</a> <a class=\"id\" href=\"#enable\">enable</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#set_device_error_reporting\">set_device_error_reporting</a>(<a class=\"id\" href=\"#dev\">dev</a>, &amp;<a class=\"id\" href=\"#enable\">enable</a>);", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#subordinate\">subordinate</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_walk_bus\">pci_walk_bus</a>(<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#subordinate\">subordinate</a>, <a class=\"id\" href=\"#set_device_error_reporting\">set_device_error_reporting</a>, &amp;<a class=\"id\" href=\"#enable\">enable</a>);", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * aer_enable_rootport - enable Root Port's interrupts when receiving messages</span>", 
"<span class=\"comment\"> * @rpc: pointer to a Root Port data structure</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Invoked when PCIe bus loads AER service driver.</span>", 
"<span class=\"comment\"> */</span>", 
"static void <a class=\"id\" href=\"#aer_enable_rootport\">aer_enable_rootport</a>(struct <a class=\"id\" href=\"#aer_rpc\">aer_rpc</a> *<a class=\"id\" href=\"#rpc\">rpc</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#pdev\">pdev</a> = <a class=\"id\" href=\"#rpc\">rpc</a>-><a class=\"id\" href=\"#rpd\">rpd</a>-><a class=\"id\" href=\"#port\">port</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#pos\">pos</a>, <a class=\"id\" href=\"#aer_pos\">aer_pos</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#reg16\">reg16</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#reg32\">reg32</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pos\">pos</a> = <a class=\"id\" href=\"#pci_pcie_cap\">pci_pcie_cap</a>(<a class=\"id\" href=\"#pdev\">pdev</a>);", 
"<span class=\"ts\"/><span class=\"comment\">/* Clear PCIe Capability's Device Status */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_word\">pci_read_config_word</a>(<a class=\"id\" href=\"#pdev\">pdev</a>, <a class=\"id\" href=\"#pos\">pos</a>+<a class=\"id\" href=\"#PCI_EXP_DEVSTA\">PCI_EXP_DEVSTA</a>, &amp;<a class=\"id\" href=\"#reg16\">reg16</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_word\">pci_write_config_word</a>(<a class=\"id\" href=\"#pdev\">pdev</a>, <a class=\"id\" href=\"#pos\">pos</a>+<a class=\"id\" href=\"#PCI_EXP_DEVSTA\">PCI_EXP_DEVSTA</a>, <a class=\"id\" href=\"#reg16\">reg16</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Disable system error generation in response to error messages */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_word\">pci_read_config_word</a>(<a class=\"id\" href=\"#pdev\">pdev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_EXP_RTCTL\">PCI_EXP_RTCTL</a>, &amp;<a class=\"id\" href=\"#reg16\">reg16</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#reg16\">reg16</a> &= ~(<a class=\"id\" href=\"#SYSTEM_ERROR_INTR_ON_MESG_MASK\">SYSTEM_ERROR_INTR_ON_MESG_MASK</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_word\">pci_write_config_word</a>(<a class=\"id\" href=\"#pdev\">pdev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_EXP_RTCTL\">PCI_EXP_RTCTL</a>, <a class=\"id\" href=\"#reg16\">reg16</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#aer_pos\">aer_pos</a> = <a class=\"id\" href=\"#pci_find_ext_capability\">pci_find_ext_capability</a>(<a class=\"id\" href=\"#pdev\">pdev</a>, <a class=\"id\" href=\"#PCI_EXT_CAP_ID_ERR\">PCI_EXT_CAP_ID_ERR</a>);", 
"<span class=\"ts\"/><span class=\"comment\">/* Clear error status */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_dword\">pci_read_config_dword</a>(<a class=\"id\" href=\"#pdev\">pdev</a>, <a class=\"id\" href=\"#aer_pos\">aer_pos</a> + <a class=\"id\" href=\"#PCI_ERR_ROOT_STATUS\">PCI_ERR_ROOT_STATUS</a>, &amp;<a class=\"id\" href=\"#reg32\">reg32</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_dword\">pci_write_config_dword</a>(<a class=\"id\" href=\"#pdev\">pdev</a>, <a class=\"id\" href=\"#aer_pos\">aer_pos</a> + <a class=\"id\" href=\"#PCI_ERR_ROOT_STATUS\">PCI_ERR_ROOT_STATUS</a>, <a class=\"id\" href=\"#reg32\">reg32</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_dword\">pci_read_config_dword</a>(<a class=\"id\" href=\"#pdev\">pdev</a>, <a class=\"id\" href=\"#aer_pos\">aer_pos</a> + <a class=\"id\" href=\"#PCI_ERR_COR_STATUS\">PCI_ERR_COR_STATUS</a>, &amp;<a class=\"id\" href=\"#reg32\">reg32</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_dword\">pci_write_config_dword</a>(<a class=\"id\" href=\"#pdev\">pdev</a>, <a class=\"id\" href=\"#aer_pos\">aer_pos</a> + <a class=\"id\" href=\"#PCI_ERR_COR_STATUS\">PCI_ERR_COR_STATUS</a>, <a class=\"id\" href=\"#reg32\">reg32</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_dword\">pci_read_config_dword</a>(<a class=\"id\" href=\"#pdev\">pdev</a>, <a class=\"id\" href=\"#aer_pos\">aer_pos</a> + <a class=\"id\" href=\"#PCI_ERR_UNCOR_STATUS\">PCI_ERR_UNCOR_STATUS</a>, &amp;<a class=\"id\" href=\"#reg32\">reg32</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_dword\">pci_write_config_dword</a>(<a class=\"id\" href=\"#pdev\">pdev</a>, <a class=\"id\" href=\"#aer_pos\">aer_pos</a> + <a class=\"id\" href=\"#PCI_ERR_UNCOR_STATUS\">PCI_ERR_UNCOR_STATUS</a>, <a class=\"id\" href=\"#reg32\">reg32</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Enable error reporting for the root port device and downstream port</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * devices.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#set_downstream_devices_error_reporting\">set_downstream_devices_error_reporting</a>(<a class=\"id\" href=\"#pdev\">pdev</a>, <a class=\"id\" href=\"#true\">true</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Enable Root Port's interrupt in response to error messages */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_dword\">pci_read_config_dword</a>(<a class=\"id\" href=\"#pdev\">pdev</a>, <a class=\"id\" href=\"#aer_pos\">aer_pos</a> + <a class=\"id\" href=\"#PCI_ERR_ROOT_COMMAND\">PCI_ERR_ROOT_COMMAND</a>, &amp;<a class=\"id\" href=\"#reg32\">reg32</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#reg32\">reg32</a> |= <a class=\"id\" href=\"#ROOT_PORT_INTR_ON_MESG_MASK\">ROOT_PORT_INTR_ON_MESG_MASK</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_dword\">pci_write_config_dword</a>(<a class=\"id\" href=\"#pdev\">pdev</a>, <a class=\"id\" href=\"#aer_pos\">aer_pos</a> + <a class=\"id\" href=\"#PCI_ERR_ROOT_COMMAND\">PCI_ERR_ROOT_COMMAND</a>, <a class=\"id\" href=\"#reg32\">reg32</a>);", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * aer_disable_rootport - disable Root Port's interrupts when receiving messages</span>", 
"<span class=\"comment\"> * @rpc: pointer to a Root Port data structure</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Invoked when PCIe bus unloads AER service driver.</span>", 
"<span class=\"comment\"> */</span>", 
"static void <a class=\"id\" href=\"#aer_disable_rootport\">aer_disable_rootport</a>(struct <a class=\"id\" href=\"#aer_rpc\">aer_rpc</a> *<a class=\"id\" href=\"#rpc\">rpc</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#pdev\">pdev</a> = <a class=\"id\" href=\"#rpc\">rpc</a>-><a class=\"id\" href=\"#rpd\">rpd</a>-><a class=\"id\" href=\"#port\">port</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#reg32\">reg32</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#pos\">pos</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Disable error reporting for the root port device and downstream port</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * devices.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#set_downstream_devices_error_reporting\">set_downstream_devices_error_reporting</a>(<a class=\"id\" href=\"#pdev\">pdev</a>, <a class=\"id\" href=\"#false\">false</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pos\">pos</a> = <a class=\"id\" href=\"#pci_find_ext_capability\">pci_find_ext_capability</a>(<a class=\"id\" href=\"#pdev\">pdev</a>, <a class=\"id\" href=\"#PCI_EXT_CAP_ID_ERR\">PCI_EXT_CAP_ID_ERR</a>);", 
"<span class=\"ts\"/><span class=\"comment\">/* Disable Root's interrupt in response to error messages */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_dword\">pci_read_config_dword</a>(<a class=\"id\" href=\"#pdev\">pdev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_ERR_ROOT_COMMAND\">PCI_ERR_ROOT_COMMAND</a>, &amp;<a class=\"id\" href=\"#reg32\">reg32</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#reg32\">reg32</a> &= ~<a class=\"id\" href=\"#ROOT_PORT_INTR_ON_MESG_MASK\">ROOT_PORT_INTR_ON_MESG_MASK</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_dword\">pci_write_config_dword</a>(<a class=\"id\" href=\"#pdev\">pdev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_ERR_ROOT_COMMAND\">PCI_ERR_ROOT_COMMAND</a>, <a class=\"id\" href=\"#reg32\">reg32</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Clear Root's error status reg */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_dword\">pci_read_config_dword</a>(<a class=\"id\" href=\"#pdev\">pdev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_ERR_ROOT_STATUS\">PCI_ERR_ROOT_STATUS</a>, &amp;<a class=\"id\" href=\"#reg32\">reg32</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_dword\">pci_write_config_dword</a>(<a class=\"id\" href=\"#pdev\">pdev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_ERR_ROOT_STATUS\">PCI_ERR_ROOT_STATUS</a>, <a class=\"id\" href=\"#reg32\">reg32</a>);", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * aer_irq - Root Port's ISR</span>", 
"<span class=\"comment\"> * @irq: IRQ assigned to Root Port</span>", 
"<span class=\"comment\"> * @context: pointer to Root Port data structure</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Invoked when Root Port detects AER messages.</span>", 
"<span class=\"comment\"> */</span>", 
"<a class=\"id\" href=\"#irqreturn_t\">irqreturn_t</a> <a class=\"id\" href=\"#aer_irq\">aer_irq</a>(int <a class=\"id\" href=\"#irq\">irq</a>, void *<a class=\"id\" href=\"#context\">context</a>)", 
"{", 
"<span class=\"ts\"/>unsigned int <a class=\"id\" href=\"#status\">status</a>, <a class=\"id\" href=\"#id\">id</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#pcie_device\">pcie_device</a> *<a class=\"id\" href=\"#pdev\">pdev</a> = (struct <a class=\"id\" href=\"#pcie_device\">pcie_device</a> *)<a class=\"id\" href=\"#context\">context</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#aer_rpc\">aer_rpc</a> *<a class=\"id\" href=\"#rpc\">rpc</a> = <a class=\"id\" href=\"#get_service_data\">get_service_data</a>(<a class=\"id\" href=\"#pdev\">pdev</a>);", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#next_prod_idx\">next_prod_idx</a>;", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#flags\">flags</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#pos\">pos</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pos\">pos</a> = <a class=\"id\" href=\"#pci_find_ext_capability\">pci_find_ext_capability</a>(<a class=\"id\" href=\"#pdev\">pdev</a>-><a class=\"id\" href=\"#port\">port</a>, <a class=\"id\" href=\"#PCI_EXT_CAP_ID_ERR\">PCI_EXT_CAP_ID_ERR</a>);", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Must lock access to Root Error Status Reg, Root Error ID Reg,</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * and Root error producer/consumer index</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_irqsave\">spin_lock_irqsave</a>(&amp;<a class=\"id\" href=\"#rpc\">rpc</a>-><a class=\"id\" href=\"#e_lock\">e_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Read error status */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_dword\">pci_read_config_dword</a>(<a class=\"id\" href=\"#pdev\">pdev</a>-><a class=\"id\" href=\"#port\">port</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_ERR_ROOT_STATUS\">PCI_ERR_ROOT_STATUS</a>, &amp;<a class=\"id\" href=\"#status\">status</a>);", 
"<span class=\"ts\"/>if (!(<a class=\"id\" href=\"#status\">status</a> &amp; (<a class=\"id\" href=\"#PCI_ERR_ROOT_UNCOR_RCV\">PCI_ERR_ROOT_UNCOR_RCV</a>|<a class=\"id\" href=\"#PCI_ERR_ROOT_COR_RCV\">PCI_ERR_ROOT_COR_RCV</a>))) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#rpc\">rpc</a>-><a class=\"id\" href=\"#e_lock\">e_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#IRQ_NONE\">IRQ_NONE</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Read error source and clear error status */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_dword\">pci_read_config_dword</a>(<a class=\"id\" href=\"#pdev\">pdev</a>-><a class=\"id\" href=\"#port\">port</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_ERR_ROOT_ERR_SRC\">PCI_ERR_ROOT_ERR_SRC</a>, &amp;<a class=\"id\" href=\"#id\">id</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_dword\">pci_write_config_dword</a>(<a class=\"id\" href=\"#pdev\">pdev</a>-><a class=\"id\" href=\"#port\">port</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_ERR_ROOT_STATUS\">PCI_ERR_ROOT_STATUS</a>, <a class=\"id\" href=\"#status\">status</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Store error source for later DPC handler */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#next_prod_idx\">next_prod_idx</a> = <a class=\"id\" href=\"#rpc\">rpc</a>-><a class=\"id\" href=\"#prod_idx\">prod_idx</a> + 1;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#next_prod_idx\">next_prod_idx</a> == <a class=\"id\" href=\"#AER_ERROR_SOURCES_MAX\">AER_ERROR_SOURCES_MAX</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#next_prod_idx\">next_prod_idx</a> = 0;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#next_prod_idx\">next_prod_idx</a> == <a class=\"id\" href=\"#rpc\">rpc</a>-><a class=\"id\" href=\"#cons_idx\">cons_idx</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * Error Storm Condition - possibly the same error occurred.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * Drop the error.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#rpc\">rpc</a>-><a class=\"id\" href=\"#e_lock\">e_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#IRQ_HANDLED\">IRQ_HANDLED</a>;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rpc\">rpc</a>-><a class=\"id\" href=\"#e_sources\">e_sources</a>[<a class=\"id\" href=\"#rpc\">rpc</a>-><a class=\"id\" href=\"#prod_idx\">prod_idx</a>].<a class=\"id\" href=\"#status\">status</a> =  <a class=\"id\" href=\"#status\">status</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rpc\">rpc</a>-><a class=\"id\" href=\"#e_sources\">e_sources</a>[<a class=\"id\" href=\"#rpc\">rpc</a>-><a class=\"id\" href=\"#prod_idx\">prod_idx</a>].<a class=\"id\" href=\"#id\">id</a> = <a class=\"id\" href=\"#id\">id</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rpc\">rpc</a>-><a class=\"id\" href=\"#prod_idx\">prod_idx</a> = <a class=\"id\" href=\"#next_prod_idx\">next_prod_idx</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_unlock_irqrestore\">spin_unlock_irqrestore</a>(&amp;<a class=\"id\" href=\"#rpc\">rpc</a>-><a class=\"id\" href=\"#e_lock\">e_lock</a>, <a class=\"id\" href=\"#flags\">flags</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*  Invoke DPC handler */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#schedule_work\">schedule_work</a>(&amp;<a class=\"id\" href=\"#rpc\">rpc</a>-><a class=\"id\" href=\"#dpc_handler\">dpc_handler</a>);", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#IRQ_HANDLED\">IRQ_HANDLED</a>;", 
"}", 
"<a class=\"id\" href=\"#EXPORT_SYMBOL_GPL\">EXPORT_SYMBOL_GPL</a>(<a class=\"id\" href=\"#aer_irq\">aer_irq</a>);", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * aer_alloc_rpc - allocate Root Port data structure</span>", 
"<span class=\"comment\"> * @dev: pointer to the pcie_dev data structure</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Invoked when Root Port's AER service is loaded.</span>", 
"<span class=\"comment\"> */</span>", 
"static struct <a class=\"id\" href=\"#aer_rpc\">aer_rpc</a> *<a class=\"id\" href=\"#aer_alloc_rpc\">aer_alloc_rpc</a>(struct <a class=\"id\" href=\"#pcie_device\">pcie_device</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#aer_rpc\">aer_rpc</a> *<a class=\"id\" href=\"#rpc\">rpc</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rpc\">rpc</a> = <a class=\"id\" href=\"#kzalloc\">kzalloc</a>(sizeof(struct <a class=\"id\" href=\"#aer_rpc\">aer_rpc</a>), <a class=\"id\" href=\"#GFP_KERNEL\">GFP_KERNEL</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#rpc\">rpc</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Initialize Root lock access, e_lock, to Root Error Status Reg */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spin_lock_init\">spin_lock_init</a>(&amp;<a class=\"id\" href=\"#rpc\">rpc</a>-><a class=\"id\" href=\"#e_lock\">e_lock</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rpc\">rpc</a>-><a class=\"id\" href=\"#rpd\">rpd</a> = <a class=\"id\" href=\"#dev\">dev</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#INIT_WORK\">INIT_WORK</a>(&amp;<a class=\"id\" href=\"#rpc\">rpc</a>-><a class=\"id\" href=\"#dpc_handler\">dpc_handler</a>, <a class=\"id\" href=\"#aer_isr\">aer_isr</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mutex_init\">mutex_init</a>(&amp;<a class=\"id\" href=\"#rpc\">rpc</a>-><a class=\"id\" href=\"#rpc_mutex\">rpc_mutex</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#init_waitqueue_head\">init_waitqueue_head</a>(&amp;<a class=\"id\" href=\"#rpc\">rpc</a>-><a class=\"id\" href=\"#wait_release\">wait_release</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Use PCIe bus function to store rpc into PCIe device */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#set_service_data\">set_service_data</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#rpc\">rpc</a>);", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#rpc\">rpc</a>;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * aer_remove - clean up resources</span>", 
"<span class=\"comment\"> * @dev: pointer to the pcie_dev data structure</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Invoked when PCI Express bus unloads or AER probe fails.</span>", 
"<span class=\"comment\"> */</span>", 
"static void <a class=\"id\" href=\"#aer_remove\">aer_remove</a>(struct <a class=\"id\" href=\"#pcie_device\">pcie_device</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#aer_rpc\">aer_rpc</a> *<a class=\"id\" href=\"#rpc\">rpc</a> = <a class=\"id\" href=\"#get_service_data\">get_service_data</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#rpc\">rpc</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* If register interrupt service, it must be free. */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#rpc\">rpc</a>-><a class=\"id\" href=\"#isr\">isr</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#free_irq\">free_irq</a>(<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#irq\">irq</a>, <a class=\"id\" href=\"#dev\">dev</a>);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#wait_event\">wait_event</a>(<a class=\"id\" href=\"#rpc\">rpc</a>-><a class=\"id\" href=\"#wait_release\">wait_release</a>, <a class=\"id\" href=\"#rpc\">rpc</a>-><a class=\"id\" href=\"#prod_idx\">prod_idx</a> == <a class=\"id\" href=\"#rpc\">rpc</a>-><a class=\"id\" href=\"#cons_idx\">cons_idx</a>);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#aer_disable_rootport\">aer_disable_rootport</a>(<a class=\"id\" href=\"#rpc\">rpc</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#kfree\">kfree</a>(<a class=\"id\" href=\"#rpc\">rpc</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#set_service_data\">set_service_data</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#NULL\">NULL</a>);", 
"<span class=\"ts\"/>}", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * aer_probe - initialize resources</span>", 
"<span class=\"comment\"> * @dev: pointer to the pcie_dev data structure</span>", 
"<span class=\"comment\"> * @id: pointer to the service id data structure</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Invoked when PCI Express bus loads AER service driver.</span>", 
"<span class=\"comment\"> */</span>", 
"static int <a class=\"id\" href=\"#__devinit\">__devinit</a> <a class=\"id\" href=\"#aer_probe\">aer_probe</a>(struct <a class=\"id\" href=\"#pcie_device\">pcie_device</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#status\">status</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#aer_rpc\">aer_rpc</a> *<a class=\"id\" href=\"#rpc\">rpc</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#device\">device</a> *<a class=\"id\" href=\"#device\">device</a> = &amp;<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#device\">device</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Init */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#status\">status</a> = <a class=\"id\" href=\"#aer_init\">aer_init</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#status\">status</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#status\">status</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Alloc rpc data structure */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rpc\">rpc</a> = <a class=\"id\" href=\"#aer_alloc_rpc\">aer_alloc_rpc</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#rpc\">rpc</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#dev_printk\">dev_printk</a>(<a class=\"id\" href=\"#KERN_DEBUG\">KERN_DEBUG</a>, <a class=\"id\" href=\"#device\">device</a>, \"alloc rpc failed\\n\");", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#aer_remove\">aer_remove</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENOMEM\">ENOMEM</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Request IRQ ISR */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#status\">status</a> = <a class=\"id\" href=\"#request_irq\">request_irq</a>(<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#irq\">irq</a>, <a class=\"id\" href=\"#aer_irq\">aer_irq</a>, <a class=\"id\" href=\"#IRQF_SHARED\">IRQF_SHARED</a>, \"aerdrv\", <a class=\"id\" href=\"#dev\">dev</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#status\">status</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#dev_printk\">dev_printk</a>(<a class=\"id\" href=\"#KERN_DEBUG\">KERN_DEBUG</a>, <a class=\"id\" href=\"#device\">device</a>, \"request IRQ failed\\n\");", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#aer_remove\">aer_remove</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#status\">status</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rpc\">rpc</a>-><a class=\"id\" href=\"#isr\">isr</a> = 1;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#aer_enable_rootport\">aer_enable_rootport</a>(<a class=\"id\" href=\"#rpc\">rpc</a>);", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#status\">status</a>;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * aer_root_reset - reset link on Root Port</span>", 
"<span class=\"comment\"> * @dev: pointer to Root Port's pci_dev data structure</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Invoked by Port Bus driver when performing link reset at Root Port.</span>", 
"<span class=\"comment\"> */</span>", 
"static <a class=\"id\" href=\"#pci_ers_result_t\">pci_ers_result_t</a> <a class=\"id\" href=\"#aer_root_reset\">aer_root_reset</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#reg32\">reg32</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#pos\">pos</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pos\">pos</a> = <a class=\"id\" href=\"#pci_find_ext_capability\">pci_find_ext_capability</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#PCI_EXT_CAP_ID_ERR\">PCI_EXT_CAP_ID_ERR</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Disable Root's interrupt in response to error messages */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_dword\">pci_read_config_dword</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_ERR_ROOT_COMMAND\">PCI_ERR_ROOT_COMMAND</a>, &amp;<a class=\"id\" href=\"#reg32\">reg32</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#reg32\">reg32</a> &= ~<a class=\"id\" href=\"#ROOT_PORT_INTR_ON_MESG_MASK\">ROOT_PORT_INTR_ON_MESG_MASK</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_dword\">pci_write_config_dword</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_ERR_ROOT_COMMAND\">PCI_ERR_ROOT_COMMAND</a>, <a class=\"id\" href=\"#reg32\">reg32</a>);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#aer_do_secondary_bus_reset\">aer_do_secondary_bus_reset</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#dev_printk\">dev_printk</a>(<a class=\"id\" href=\"#KERN_DEBUG\">KERN_DEBUG</a>, &amp;<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#dev\">dev</a>, \"Root Port link has been reset\\n\");", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Clear Root Error Status */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_dword\">pci_read_config_dword</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_ERR_ROOT_STATUS\">PCI_ERR_ROOT_STATUS</a>, &amp;<a class=\"id\" href=\"#reg32\">reg32</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_dword\">pci_write_config_dword</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_ERR_ROOT_STATUS\">PCI_ERR_ROOT_STATUS</a>, <a class=\"id\" href=\"#reg32\">reg32</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Enable Root Port's interrupt in response to error messages */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_dword\">pci_read_config_dword</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_ERR_ROOT_COMMAND\">PCI_ERR_ROOT_COMMAND</a>, &amp;<a class=\"id\" href=\"#reg32\">reg32</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#reg32\">reg32</a> |= <a class=\"id\" href=\"#ROOT_PORT_INTR_ON_MESG_MASK\">ROOT_PORT_INTR_ON_MESG_MASK</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_dword\">pci_write_config_dword</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_ERR_ROOT_COMMAND\">PCI_ERR_ROOT_COMMAND</a>, <a class=\"id\" href=\"#reg32\">reg32</a>);", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#PCI_ERS_RESULT_RECOVERED\">PCI_ERS_RESULT_RECOVERED</a>;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * aer_error_detected - update severity status</span>", 
"<span class=\"comment\"> * @dev: pointer to Root Port's pci_dev data structure</span>", 
"<span class=\"comment\"> * @error: error severity being notified by port bus</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Invoked by Port Bus driver during error recovery.</span>", 
"<span class=\"comment\"> */</span>", 
"static <a class=\"id\" href=\"#pci_ers_result_t\">pci_ers_result_t</a> <a class=\"id\" href=\"#aer_error_detected\">aer_error_detected</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>enum <a class=\"id\" href=\"#pci_channel_state\">pci_channel_state</a> <a class=\"id\" href=\"#error\">error</a>)", 
"{", 
"<span class=\"ts\"/><span class=\"comment\">/* Root Port has no impact. Always recovers. */</span>", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#PCI_ERS_RESULT_CAN_RECOVER\">PCI_ERS_RESULT_CAN_RECOVER</a>;", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * aer_error_resume - clean up corresponding error status bits</span>", 
"<span class=\"comment\"> * @dev: pointer to Root Port's pci_dev data structure</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Invoked by Port Bus driver during nonfatal recovery.</span>", 
"<span class=\"comment\"> */</span>", 
"static void <a class=\"id\" href=\"#aer_error_resume\">aer_error_resume</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#pos\">pos</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#status\">status</a>, <a class=\"id\" href=\"#mask\">mask</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#reg16\">reg16</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Clean up Root device status */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pos\">pos</a> = <a class=\"id\" href=\"#pci_pcie_cap\">pci_pcie_cap</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_word\">pci_read_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_EXP_DEVSTA\">PCI_EXP_DEVSTA</a>, &amp;<a class=\"id\" href=\"#reg16\">reg16</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_word\">pci_write_config_word</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_EXP_DEVSTA\">PCI_EXP_DEVSTA</a>, <a class=\"id\" href=\"#reg16\">reg16</a>);", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Clean AER Root Error Status */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pos\">pos</a> = <a class=\"id\" href=\"#pci_find_ext_capability\">pci_find_ext_capability</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#PCI_EXT_CAP_ID_ERR\">PCI_EXT_CAP_ID_ERR</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_dword\">pci_read_config_dword</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_ERR_UNCOR_STATUS\">PCI_ERR_UNCOR_STATUS</a>, &amp;<a class=\"id\" href=\"#status\">status</a>);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_read_config_dword\">pci_read_config_dword</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_ERR_UNCOR_SEVER\">PCI_ERR_UNCOR_SEVER</a>, &amp;<a class=\"id\" href=\"#mask\">mask</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#error_state\">error_state</a> == <a class=\"id\" href=\"#pci_channel_io_normal\">pci_channel_io_normal</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#status\">status</a> &= ~<a class=\"id\" href=\"#mask\">mask</a>; <span class=\"comment\">/* Clear corresponding nonfatal bits */</span>", 
"<span class=\"ts\"/>else", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#status\">status</a> &= <a class=\"id\" href=\"#mask\">mask</a>; <span class=\"comment\">/* Clear corresponding fatal bits */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pci_write_config_dword\">pci_write_config_dword</a>(<a class=\"id\" href=\"#dev\">dev</a>, <a class=\"id\" href=\"#pos\">pos</a> + <a class=\"id\" href=\"#PCI_ERR_UNCOR_STATUS\">PCI_ERR_UNCOR_STATUS</a>, <a class=\"id\" href=\"#status\">status</a>);", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * aer_service_init - register AER root service driver</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Invoked when AER root service driver is loaded.</span>", 
"<span class=\"comment\"> */</span>", 
"static int <a class=\"id\" href=\"#__init\">__init</a> <a class=\"id\" href=\"#aer_service_init\">aer_service_init</a>(void)", 
"{", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#pci_aer_available\">pci_aer_available</a>())", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENXIO\">ENXIO</a>;", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#pcie_port_service_register\">pcie_port_service_register</a>(&amp;<a class=\"id\" href=\"#aerdriver\">aerdriver</a>);", 
"}", 
"", 
"<span class=\"comment\">/**</span>", 
"<span class=\"comment\"> * aer_service_exit - unregister AER root service driver</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Invoked when AER root service driver is unloaded.</span>", 
"<span class=\"comment\"> */</span>", 
"static void <a class=\"id\" href=\"#__exit\">__exit</a> <a class=\"id\" href=\"#aer_service_exit\">aer_service_exit</a>(void)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pcie_port_service_unregister\">pcie_port_service_unregister</a>(&amp;<a class=\"id\" href=\"#aerdriver\">aerdriver</a>);", 
"}", 
"", 
"<a class=\"id\" href=\"#module_init\">module_init</a>(<a class=\"id\" href=\"#aer_service_init\">aer_service_init</a>);", 
"<a class=\"id\" href=\"#module_exit\">module_exit</a>(<a class=\"id\" href=\"#aer_service_exit\">aer_service_exit</a>);", 
];
xr_frag_insert('l/d4/2a761d0f19a947298a00e76e825c77a5c74797.xr', __xr_tmp);
