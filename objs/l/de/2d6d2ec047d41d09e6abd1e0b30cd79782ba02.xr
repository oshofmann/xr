var __xr_tmp = [
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#dev\">dev</a> = <a class=\"id\" href=\"#pci_get_device\">pci_get_device</a>(<a class=\"id\" href=\"#PCI_VENDOR_ID_IBM\">PCI_VENDOR_ID_IBM</a>, <a class=\"id\" href=\"#PCI_ANY_ID\">PCI_ANY_ID</a>, <a class=\"id\" href=\"#dev\">dev</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#dev\">dev</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#is_cal_pci_dev\">is_cal_pci_dev</a>(<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#device\">device</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#info\">info</a> = &amp;<a class=\"id\" href=\"#bus_info\">bus_info</a>[<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#bus\">bus</a>-><a class=\"id\" href=\"#number\">number</a>];", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#info\">info</a>-><a class=\"id\" href=\"#translation_disabled\">translation_disabled</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pci_dev_put\">pci_dev_put</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#info\">info</a>-><a class=\"id\" href=\"#tce_space\">tce_space</a> && !<a class=\"id\" href=\"#translate_empty_slots\">translate_empty_slots</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#calgary_disable_translation\">calgary_disable_translation</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#calgary_free_bus\">calgary_free_bus</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pci_dev_put\">pci_dev_put</a>(<a class=\"id\" href=\"#dev\">dev</a>); <span class=\"comment\">/* Undo calgary_init_one()'s pci_dev_get() */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#dev\">dev</a>.<a class=\"id\" href=\"#archdata\">archdata</a>.<a class=\"id\" href=\"#dma_ops\">dma_ops</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/>} while (1);", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ret\">ret</a>;", 
"}", 
"", 
"static <a class=\"id\" href=\"#inline\">inline</a> int <a class=\"id\" href=\"#__init\">__init</a> <a class=\"id\" href=\"#determine_tce_table_size\">determine_tce_table_size</a>(<a class=\"id\" href=\"#u64\">u64</a> <a class=\"id\" href=\"#ram\">ram</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#ret\">ret</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#specified_table_size\">specified_table_size</a> != <a class=\"id\" href=\"#TCE_TABLE_SIZE_UNSPECIFIED\">TCE_TABLE_SIZE_UNSPECIFIED</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#specified_table_size\">specified_table_size</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Table sizes are from 0 to 7 (TCE_TABLE_SIZE_64K to</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * TCE_TABLE_SIZE_8M). Table size 0 has 8K entries and each</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * larger table size has twice as many entries, so shift the</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * max ram address by 13 to divide by 8K and then look at the</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * order of the result to choose between 0-7.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#get_order\">get_order</a>(<a class=\"id\" href=\"#ram\">ram</a> >> 13);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#ret\">ret</a> &gt; <a class=\"id\" href=\"#TCE_TABLE_SIZE_8M\">TCE_TABLE_SIZE_8M</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#TCE_TABLE_SIZE_8M\">TCE_TABLE_SIZE_8M</a>;", 
"", 
"<span class=\"ts\"/>return <a class=\"id\" href=\"#ret\">ret</a>;", 
"}", 
"", 
"static int <a class=\"id\" href=\"#__init\">__init</a> <a class=\"id\" href=\"#build_detail_arrays\">build_detail_arrays</a>(void)", 
"{", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#ptr\">ptr</a>;", 
"<span class=\"ts\"/>unsigned <a class=\"id\" href=\"#numnodes\">numnodes</a>, <a class=\"id\" href=\"#i\">i</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#scal_detail_size\">scal_detail_size</a>, <a class=\"id\" href=\"#rio_detail_size\">rio_detail_size</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#numnodes\">numnodes</a> = <a class=\"id\" href=\"#rio_table_hdr\">rio_table_hdr</a>-><a class=\"id\" href=\"#num_scal_dev\">num_scal_dev</a>;", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#numnodes\">numnodes</a> &gt; <a class=\"id\" href=\"#MAX_NUMNODES\">MAX_NUMNODES</a>){", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_WARNING\">KERN_WARNING</a>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>\"Calgary: MAX_NUMNODES too low! Defined as %d, \"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>\"but system has %d nodes.\\n\",", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#MAX_NUMNODES\">MAX_NUMNODES</a>, <a class=\"id\" href=\"#numnodes\">numnodes</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENODEV\">ENODEV</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>switch (<a class=\"id\" href=\"#rio_table_hdr\">rio_table_hdr</a>-><a class=\"id\" href=\"#version\">version</a>){", 
"<span class=\"ts\"/>case 2:", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#scal_detail_size\">scal_detail_size</a> = 11;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rio_detail_size\">rio_detail_size</a> = 13;", 
"<span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>case 3:", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#scal_detail_size\">scal_detail_size</a> = 12;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rio_detail_size\">rio_detail_size</a> = 15;", 
"<span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>default:", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_WARNING\">KERN_WARNING</a>", 
"<span class=\"ts\"/><span class=\"ts\"/>       \"Calgary: Invalid Rio Grande Table Version: %d\\n\",", 
"<span class=\"ts\"/><span class=\"ts\"/>       <a class=\"id\" href=\"#rio_table_hdr\">rio_table_hdr</a>-><a class=\"id\" href=\"#version\">version</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#EPROTO\">EPROTO</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ptr\">ptr</a> = ((unsigned long)<a class=\"id\" href=\"#rio_table_hdr\">rio_table_hdr</a>) + 3;", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = 0; <a class=\"id\" href=\"#i\">i</a> &lt; <a class=\"id\" href=\"#numnodes\">numnodes</a>; <a class=\"id\" href=\"#i\">i</a>++, <a class=\"id\" href=\"#ptr\">ptr</a> += <a class=\"id\" href=\"#scal_detail_size\">scal_detail_size</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#scal_devs\">scal_devs</a>[<a class=\"id\" href=\"#i\">i</a>] = (struct <a class=\"id\" href=\"#scal_detail\">scal_detail</a> *)<a class=\"id\" href=\"#ptr\">ptr</a>;", 
"", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = 0; <a class=\"id\" href=\"#i\">i</a> &lt; <a class=\"id\" href=\"#rio_table_hdr\">rio_table_hdr</a>-><a class=\"id\" href=\"#num_rio_dev\">num_rio_dev</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>    <a class=\"id\" href=\"#i\">i</a>++, <a class=\"id\" href=\"#ptr\">ptr</a> += <a class=\"id\" href=\"#rio_detail_size\">rio_detail_size</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rio_devs\">rio_devs</a>[<a class=\"id\" href=\"#i\">i</a>] = (struct <a class=\"id\" href=\"#rio_detail\">rio_detail</a> *)<a class=\"id\" href=\"#ptr\">ptr</a>;", 
"", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"static int <a class=\"id\" href=\"#__init\">__init</a> <a class=\"id\" href=\"#calgary_bus_has_devices\">calgary_bus_has_devices</a>(int <a class=\"id\" href=\"#bus\">bus</a>, unsigned short <a class=\"id\" href=\"#pci_dev\">pci_dev</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#dev\">dev</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#val\">val</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#pci_dev\">pci_dev</a> == <a class=\"id\" href=\"#PCI_DEVICE_ID_IBM_CALIOC2\">PCI_DEVICE_ID_IBM_CALIOC2</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * FIXME: properly scan for devices accross the</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> * PCI-to-PCI bridge on every CalIOC2 port.</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>return 1;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#dev\">dev</a> = 1; <a class=\"id\" href=\"#dev\">dev</a> &lt; 8; <a class=\"id\" href=\"#dev\">dev</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#val\">val</a> = <a class=\"id\" href=\"#read_pci_config\">read_pci_config</a>(<a class=\"id\" href=\"#bus\">bus</a>, <a class=\"id\" href=\"#dev\">dev</a>, 0, 0);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#val\">val</a> != 0xffffffff)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>return (<a class=\"id\" href=\"#val\">val</a> != 0xffffffff);", 
"}", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * calgary_init_bitmap_from_tce_table():</span>", 
"<span class=\"comment\"> * Funtion for kdump case. In the second/kdump kernel initialize</span>", 
"<span class=\"comment\"> * the bitmap based on the tce table entries obtained from first kernel</span>", 
"<span class=\"comment\"> */</span>", 
"static void <a class=\"id\" href=\"#calgary_init_bitmap_from_tce_table\">calgary_init_bitmap_from_tce_table</a>(struct <a class=\"id\" href=\"#iommu_table\">iommu_table</a> *<a class=\"id\" href=\"#tbl\">tbl</a>)", 
"{", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u64\">u64</a> *<a class=\"id\" href=\"#tp\">tp</a>;", 
"<span class=\"ts\"/>unsigned int <a class=\"id\" href=\"#index\">index</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tp\">tp</a> = ((<a class=\"id\" href=\"#u64\">u64</a> *)<a class=\"id\" href=\"#tbl\">tbl</a>-><a class=\"id\" href=\"#it_base\">it_base</a>);", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#index\">index</a> = 0 ; <a class=\"id\" href=\"#index\">index</a> &lt; <a class=\"id\" href=\"#tbl\">tbl</a>-><a class=\"id\" href=\"#it_size\">it_size</a>; <a class=\"id\" href=\"#index\">index</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/>if (*<a class=\"id\" href=\"#tp\">tp</a> != 0x0)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#set_bit\">set_bit</a>(<a class=\"id\" href=\"#index\">index</a>, <a class=\"id\" href=\"#tbl\">tbl</a>-><a class=\"id\" href=\"#it_map\">it_map</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tp\">tp</a>++;", 
"<span class=\"ts\"/>}", 
"}", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * get_tce_space_from_tar():</span>", 
"<span class=\"comment\"> * Function for kdump case. Get the tce tables from first kernel</span>", 
"<span class=\"comment\"> * by reading the contents of the base address register of calgary iommu</span>", 
"<span class=\"comment\"> */</span>", 
"static void <a class=\"id\" href=\"#__init\">__init</a> <a class=\"id\" href=\"#get_tce_space_from_tar\">get_tce_space_from_tar</a>(void)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#bus\">bus</a>;", 
"<span class=\"ts\"/>void <a class=\"id\" href=\"#__iomem\">__iomem</a> *<a class=\"id\" href=\"#target\">target</a>;", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#tce_space\">tce_space</a>;", 
"", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#bus\">bus</a> = 0; <a class=\"id\" href=\"#bus\">bus</a> &lt; <a class=\"id\" href=\"#MAX_PHB_BUS_NUM\">MAX_PHB_BUS_NUM</a>; <a class=\"id\" href=\"#bus\">bus</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#calgary_bus_info\">calgary_bus_info</a> *<a class=\"id\" href=\"#info\">info</a> = &amp;<a class=\"id\" href=\"#bus_info\">bus_info</a>[<a class=\"id\" href=\"#bus\">bus</a>];", 
"<span class=\"ts\"/><span class=\"ts\"/>unsigned short <a class=\"id\" href=\"#pci_device\">pci_device</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#val\">val</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#val\">val</a> = <a class=\"id\" href=\"#read_pci_config\">read_pci_config</a>(<a class=\"id\" href=\"#bus\">bus</a>, 0, 0, 0);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pci_device\">pci_device</a> = (<a class=\"id\" href=\"#val\">val</a> &amp; 0xFFFF0000) >> 16;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#is_cal_pci_dev\">is_cal_pci_dev</a>(<a class=\"id\" href=\"#pci_device\">pci_device</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#info\">info</a>-><a class=\"id\" href=\"#translation_disabled\">translation_disabled</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#calgary_bus_has_devices\">calgary_bus_has_devices</a>(<a class=\"id\" href=\"#bus\">bus</a>, <a class=\"id\" href=\"#pci_device\">pci_device</a>) ||", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#translate_empty_slots\">translate_empty_slots</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#target\">target</a> = <a class=\"id\" href=\"#calgary_reg\">calgary_reg</a>(<a class=\"id\" href=\"#bus_info\">bus_info</a>[<a class=\"id\" href=\"#bus\">bus</a>].<a class=\"id\" href=\"#bbar\">bbar</a>,", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tar_offset\">tar_offset</a>(<a class=\"id\" href=\"#bus\">bus</a>));", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tce_space\">tce_space</a> = <a class=\"id\" href=\"#be64_to_cpu\">be64_to_cpu</a>(<a class=\"id\" href=\"#readq\">readq</a>(<a class=\"id\" href=\"#target\">target</a>));", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tce_space\">tce_space</a> = <a class=\"id\" href=\"#tce_space\">tce_space</a> &amp; <a class=\"id\" href=\"#TAR_SW_BITS\">TAR_SW_BITS</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tce_space\">tce_space</a> = <a class=\"id\" href=\"#tce_space\">tce_space</a> &amp; (~<a class=\"id\" href=\"#specified_table_size\">specified_table_size</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#info\">info</a>-><a class=\"id\" href=\"#tce_space\">tce_space</a> = (<a class=\"id\" href=\"#u64\">u64</a> *)<a class=\"id\" href=\"#__va\">__va</a>(<a class=\"id\" href=\"#tce_space\">tce_space</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>return;", 
"}", 
"", 
"static int <a class=\"id\" href=\"#__init\">__init</a> <a class=\"id\" href=\"#calgary_iommu_init\">calgary_iommu_init</a>(void)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#ret\">ret</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* ok, we're trying to use Calgary - let's roll */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_INFO\">KERN_INFO</a> \"PCI-DMA: Using Calgary IOMMU\\n\");", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#calgary_init\">calgary_init</a>();", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#ret\">ret</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_ERR\">KERN_ERR</a> \"PCI-DMA: Calgary init failed %d, \"", 
"<span class=\"ts\"/><span class=\"ts\"/>       \"falling back to no_iommu\\n\", <a class=\"id\" href=\"#ret\">ret</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#ret\">ret</a>;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"void <a class=\"id\" href=\"#__init\">__init</a> <a class=\"id\" href=\"#detect_calgary\">detect_calgary</a>(void)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#bus\">bus</a>;", 
"<span class=\"ts\"/>void *<a class=\"id\" href=\"#tbl\">tbl</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#calgary_found\">calgary_found</a> = 0;", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#ptr\">ptr</a>;", 
"<span class=\"ts\"/>unsigned int <a class=\"id\" href=\"#offset\">offset</a>, <a class=\"id\" href=\"#prev_offset\">prev_offset</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#ret\">ret</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * if the user specified iommu=off or iommu=soft or we found</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * another HW IOMMU already, bail out.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#no_iommu\">no_iommu</a> || <a class=\"id\" href=\"#iommu_detected\">iommu_detected</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#use_calgary\">use_calgary</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#early_pci_allowed\">early_pci_allowed</a>())", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_DEBUG\">KERN_DEBUG</a> \"Calgary: detecting Calgary via BIOS EBDA area\\n\");", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ptr\">ptr</a> = (unsigned long)<a class=\"id\" href=\"#phys_to_virt\">phys_to_virt</a>(<a class=\"id\" href=\"#get_bios_ebda\">get_bios_ebda</a>());", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rio_table_hdr\">rio_table_hdr</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#prev_offset\">prev_offset</a> = 0;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#offset\">offset</a> = 0x180;", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * The next offset is stored in the 1st word.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Only parse up until the offset increases:</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/>while (<a class=\"id\" href=\"#offset\">offset</a> &gt; <a class=\"id\" href=\"#prev_offset\">prev_offset</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* The block id is stored in the 2nd word */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>if (*((unsigned short *)(<a class=\"id\" href=\"#ptr\">ptr</a> + <a class=\"id\" href=\"#offset\">offset</a> + 2)) == 0x4752){", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* set the pointer past the offset &amp; block id */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#rio_table_hdr\">rio_table_hdr</a> = (struct <a class=\"id\" href=\"#rio_table_hdr\">rio_table_hdr</a> *)(<a class=\"id\" href=\"#ptr\">ptr</a> + <a class=\"id\" href=\"#offset\">offset</a> + 4);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#prev_offset\">prev_offset</a> = <a class=\"id\" href=\"#offset\">offset</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#offset\">offset</a> = *((unsigned short *)(<a class=\"id\" href=\"#ptr\">ptr</a> + <a class=\"id\" href=\"#offset\">offset</a>));", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>if (!<a class=\"id\" href=\"#rio_table_hdr\">rio_table_hdr</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_DEBUG\">KERN_DEBUG</a> \"Calgary: Unable to locate Rio Grande table \"", 
"<span class=\"ts\"/><span class=\"ts\"/>       \"in EBDA - bailing!\\n\");", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ret\">ret</a> = <a class=\"id\" href=\"#build_detail_arrays\">build_detail_arrays</a>();", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#ret\">ret</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_DEBUG\">KERN_DEBUG</a> \"Calgary: build_detail_arrays ret %d\\n\", <a class=\"id\" href=\"#ret\">ret</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#specified_table_size\">specified_table_size</a> = <a class=\"id\" href=\"#determine_tce_table_size\">determine_tce_table_size</a>((<a class=\"id\" href=\"#is_kdump_kernel\">is_kdump_kernel</a>() ?", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#saved_max_pfn\">saved_max_pfn</a> : <a class=\"id\" href=\"#max_pfn\">max_pfn</a>) * <a class=\"id\" href=\"#PAGE_SIZE\">PAGE_SIZE</a>);", 
"", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#bus\">bus</a> = 0; <a class=\"id\" href=\"#bus\">bus</a> &lt; <a class=\"id\" href=\"#MAX_PHB_BUS_NUM\">MAX_PHB_BUS_NUM</a>; <a class=\"id\" href=\"#bus\">bus</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#calgary_bus_info\">calgary_bus_info</a> *<a class=\"id\" href=\"#info\">info</a> = &amp;<a class=\"id\" href=\"#bus_info\">bus_info</a>[<a class=\"id\" href=\"#bus\">bus</a>];", 
"<span class=\"ts\"/><span class=\"ts\"/>unsigned short <a class=\"id\" href=\"#pci_device\">pci_device</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#val\">val</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#val\">val</a> = <a class=\"id\" href=\"#read_pci_config\">read_pci_config</a>(<a class=\"id\" href=\"#bus\">bus</a>, 0, 0, 0);", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#pci_device\">pci_device</a> = (<a class=\"id\" href=\"#val\">val</a> &amp; 0xFFFF0000) >> 16;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#is_cal_pci_dev\">is_cal_pci_dev</a>(<a class=\"id\" href=\"#pci_device\">pci_device</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#info\">info</a>-><a class=\"id\" href=\"#translation_disabled\">translation_disabled</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#calgary_bus_has_devices\">calgary_bus_has_devices</a>(<a class=\"id\" href=\"#bus\">bus</a>, <a class=\"id\" href=\"#pci_device\">pci_device</a>) ||", 
"<span class=\"ts\"/><span class=\"ts\"/>    <a class=\"id\" href=\"#translate_empty_slots\">translate_empty_slots</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> * If it is kdump kernel, find and use tce tables</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> * from first kernel, else allocate tce tables here</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#is_kdump_kernel\">is_kdump_kernel</a>()) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#tbl\">tbl</a> = <a class=\"id\" href=\"#alloc_tce_table\">alloc_tce_table</a>();", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#tbl\">tbl</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>goto <a class=\"id\" href=\"#cleanup\">cleanup</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#info\">info</a>-><a class=\"id\" href=\"#tce_space\">tce_space</a> = <a class=\"id\" href=\"#tbl\">tbl</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#calgary_found\">calgary_found</a> = 1;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_DEBUG\">KERN_DEBUG</a> \"Calgary: finished detection, Calgary %s\\n\",", 
"<span class=\"ts\"/>       <a class=\"id\" href=\"#calgary_found\">calgary_found</a> ? \"found\" : \"not found\");", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#calgary_found\">calgary_found</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#iommu_detected\">iommu_detected</a> = 1;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#calgary_detected\">calgary_detected</a> = 1;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_INFO\">KERN_INFO</a> \"PCI-DMA: Calgary IOMMU detected.\\n\");", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_INFO\">KERN_INFO</a> \"PCI-DMA: Calgary TCE table spec is %d\\n\",", 
"<span class=\"ts\"/><span class=\"ts\"/>       <a class=\"id\" href=\"#specified_table_size\">specified_table_size</a>);", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#x86_init\">x86_init</a>.<a class=\"id\" href=\"#iommu\">iommu</a>.<a class=\"id\" href=\"#iommu_init\">iommu_init</a> = <a class=\"id\" href=\"#calgary_iommu_init\">calgary_iommu_init</a>;", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>return;", 
"", 
"<a class=\"id\" href=\"#cleanup\">cleanup</a>:", 
"<span class=\"ts\"/>for (--<a class=\"id\" href=\"#bus\">bus</a>; <a class=\"id\" href=\"#bus\">bus</a> >= 0; --<a class=\"id\" href=\"#bus\">bus</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#calgary_bus_info\">calgary_bus_info</a> *<a class=\"id\" href=\"#info\">info</a> = &amp;<a class=\"id\" href=\"#bus_info\">bus_info</a>[<a class=\"id\" href=\"#bus\">bus</a>];", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#info\">info</a>-><a class=\"id\" href=\"#tce_space\">tce_space</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#free_tce_table\">free_tce_table</a>(<a class=\"id\" href=\"#info\">info</a>-><a class=\"id\" href=\"#tce_space\">tce_space</a>);", 
"<span class=\"ts\"/>}", 
"}", 
"", 
"static int <a class=\"id\" href=\"#__init\">__init</a> <a class=\"id\" href=\"#calgary_parse_options\">calgary_parse_options</a>(char *<a class=\"id\" href=\"#p\">p</a>)", 
"{", 
"<span class=\"ts\"/>unsigned int <a class=\"id\" href=\"#bridge\">bridge</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#size_t\">size_t</a> <a class=\"id\" href=\"#len\">len</a>;", 
"<span class=\"ts\"/>char* <a class=\"id\" href=\"#endp\">endp</a>;", 
"", 
"<span class=\"ts\"/>while (*<a class=\"id\" href=\"#p\">p</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#strncmp\">strncmp</a>(<a class=\"id\" href=\"#p\">p</a>, \"64k\", 3))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#specified_table_size\">specified_table_size</a> = <a class=\"id\" href=\"#TCE_TABLE_SIZE_64K\">TCE_TABLE_SIZE_64K</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>else if (!<a class=\"id\" href=\"#strncmp\">strncmp</a>(<a class=\"id\" href=\"#p\">p</a>, \"128k\", 4))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#specified_table_size\">specified_table_size</a> = <a class=\"id\" href=\"#TCE_TABLE_SIZE_128K\">TCE_TABLE_SIZE_128K</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>else if (!<a class=\"id\" href=\"#strncmp\">strncmp</a>(<a class=\"id\" href=\"#p\">p</a>, \"256k\", 4))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#specified_table_size\">specified_table_size</a> = <a class=\"id\" href=\"#TCE_TABLE_SIZE_256K\">TCE_TABLE_SIZE_256K</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>else if (!<a class=\"id\" href=\"#strncmp\">strncmp</a>(<a class=\"id\" href=\"#p\">p</a>, \"512k\", 4))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#specified_table_size\">specified_table_size</a> = <a class=\"id\" href=\"#TCE_TABLE_SIZE_512K\">TCE_TABLE_SIZE_512K</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>else if (!<a class=\"id\" href=\"#strncmp\">strncmp</a>(<a class=\"id\" href=\"#p\">p</a>, \"1M\", 2))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#specified_table_size\">specified_table_size</a> = <a class=\"id\" href=\"#TCE_TABLE_SIZE_1M\">TCE_TABLE_SIZE_1M</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>else if (!<a class=\"id\" href=\"#strncmp\">strncmp</a>(<a class=\"id\" href=\"#p\">p</a>, \"2M\", 2))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#specified_table_size\">specified_table_size</a> = <a class=\"id\" href=\"#TCE_TABLE_SIZE_2M\">TCE_TABLE_SIZE_2M</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>else if (!<a class=\"id\" href=\"#strncmp\">strncmp</a>(<a class=\"id\" href=\"#p\">p</a>, \"4M\", 2))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#specified_table_size\">specified_table_size</a> = <a class=\"id\" href=\"#TCE_TABLE_SIZE_4M\">TCE_TABLE_SIZE_4M</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>else if (!<a class=\"id\" href=\"#strncmp\">strncmp</a>(<a class=\"id\" href=\"#p\">p</a>, \"8M\", 2))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#specified_table_size\">specified_table_size</a> = <a class=\"id\" href=\"#TCE_TABLE_SIZE_8M\">TCE_TABLE_SIZE_8M</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#len\">len</a> = <a class=\"id\" href=\"#strlen\">strlen</a>(\"translate_empty_slots\");", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#strncmp\">strncmp</a>(<a class=\"id\" href=\"#p\">p</a>, \"translate_empty_slots\", <a class=\"id\" href=\"#len\">len</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#translate_empty_slots\">translate_empty_slots</a> = 1;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#len\">len</a> = <a class=\"id\" href=\"#strlen\">strlen</a>(\"disable\");", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#strncmp\">strncmp</a>(<a class=\"id\" href=\"#p\">p</a>, \"disable\", <a class=\"id\" href=\"#len\">len</a>)) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#p\">p</a> += <a class=\"id\" href=\"#len\">len</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (*<a class=\"id\" href=\"#p\">p</a> == '=')", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>++<a class=\"id\" href=\"#p\">p</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (*<a class=\"id\" href=\"#p\">p</a> == '\\0')", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bridge\">bridge</a> = <a class=\"id\" href=\"#simple_strtoul\">simple_strtoul</a>(<a class=\"id\" href=\"#p\">p</a>, &amp;<a class=\"id\" href=\"#endp\">endp</a>, 0);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#p\">p</a> == <a class=\"id\" href=\"#endp\">endp</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#bridge\">bridge</a> &lt; <a class=\"id\" href=\"#MAX_PHB_BUS_NUM\">MAX_PHB_BUS_NUM</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_INFO\">KERN_INFO</a> \"Calgary: disabling \"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>       \"translation for PHB %#x\\n\", <a class=\"id\" href=\"#bridge\">bridge</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#bus_info\">bus_info</a>[<a class=\"id\" href=\"#bridge\">bridge</a>].<a class=\"id\" href=\"#translation_disabled\">translation_disabled</a> = 1;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#p\">p</a> = <a class=\"id\" href=\"#strpbrk\">strpbrk</a>(<a class=\"id\" href=\"#p\">p</a>, \",\");", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#p\">p</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#p\">p</a>++; <span class=\"comment\">/* skip ',' */</span>", 
"<span class=\"ts\"/>}", 
"<span class=\"ts\"/>return 1;", 
"}", 
"<a class=\"id\" href=\"#__setup\">__setup</a>(\"calgary=\", <a class=\"id\" href=\"#calgary_parse_options\">calgary_parse_options</a>);", 
"", 
"static void <a class=\"id\" href=\"#__init\">__init</a> <a class=\"id\" href=\"#calgary_fixup_one_tce_space\">calgary_fixup_one_tce_space</a>(struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#iommu_table\">iommu_table</a> *<a class=\"id\" href=\"#tbl\">tbl</a>;", 
"<span class=\"ts\"/>unsigned int <a class=\"id\" href=\"#npages\">npages</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#i\">i</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#tbl\">tbl</a> = <a class=\"id\" href=\"#pci_iommu\">pci_iommu</a>(<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#bus\">bus</a>);", 
"", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = 0; <a class=\"id\" href=\"#i\">i</a> &lt; 4; <a class=\"id\" href=\"#i\">i</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#resource\">resource</a> *<a class=\"id\" href=\"#r\">r</a> = &amp;<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#resource\">resource</a>[<a class=\"id\" href=\"#PCI_BRIDGE_RESOURCES\">PCI_BRIDGE_RESOURCES</a> + <a class=\"id\" href=\"#i\">i</a>];", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Don't give out TCEs that map MEM resources */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!(<a class=\"id\" href=\"#r\">r</a>-><a class=\"id\" href=\"#flags\">flags</a> &amp; <a class=\"id\" href=\"#IORESOURCE_MEM\">IORESOURCE_MEM</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* 0-based? we reserve the whole 1st MB anyway */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#r\">r</a>-><a class=\"id\" href=\"#start\">start</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* cover the whole region */</span>", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#npages\">npages</a> = (<a class=\"id\" href=\"#r\">r</a>-><a class=\"id\" href=\"#end\">end</a> - <a class=\"id\" href=\"#r\">r</a>-><a class=\"id\" href=\"#start\">start</a>) >> <a class=\"id\" href=\"#PAGE_SHIFT\">PAGE_SHIFT</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#npages\">npages</a>++;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#iommu_range_reserve\">iommu_range_reserve</a>(<a class=\"id\" href=\"#tbl\">tbl</a>, <a class=\"id\" href=\"#r\">r</a>-><a class=\"id\" href=\"#start\">start</a>, <a class=\"id\" href=\"#npages\">npages</a>);", 
"<span class=\"ts\"/>}", 
"}", 
"", 
"static int <a class=\"id\" href=\"#__init\">__init</a> <a class=\"id\" href=\"#calgary_fixup_tce_spaces\">calgary_fixup_tce_spaces</a>(void)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a> = <a class=\"id\" href=\"#NULL\">NULL</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#calgary_bus_info\">calgary_bus_info</a> *<a class=\"id\" href=\"#info\">info</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#no_iommu\">no_iommu</a> || <a class=\"id\" href=\"#swiotlb\">swiotlb</a> || !<a class=\"id\" href=\"#calgary_detected\">calgary_detected</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return -<a class=\"id\" href=\"#ENODEV\">ENODEV</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_DEBUG\">KERN_DEBUG</a> \"Calgary: fixing up tce spaces\\n\");", 
"", 
"<span class=\"ts\"/>do {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#dev\">dev</a> = <a class=\"id\" href=\"#pci_get_device\">pci_get_device</a>(<a class=\"id\" href=\"#PCI_VENDOR_ID_IBM\">PCI_VENDOR_ID_IBM</a>, <a class=\"id\" href=\"#PCI_ANY_ID\">PCI_ANY_ID</a>, <a class=\"id\" href=\"#dev\">dev</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#dev\">dev</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>break;", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#is_cal_pci_dev\">is_cal_pci_dev</a>(<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#device\">device</a>))", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#info\">info</a> = &amp;<a class=\"id\" href=\"#bus_info\">bus_info</a>[<a class=\"id\" href=\"#dev\">dev</a>-><a class=\"id\" href=\"#bus\">bus</a>-><a class=\"id\" href=\"#number\">number</a>];", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#info\">info</a>-><a class=\"id\" href=\"#translation_disabled\">translation_disabled</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/>if (!<a class=\"id\" href=\"#info\">info</a>-><a class=\"id\" href=\"#tce_space\">tce_space</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>continue;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#calgary_fixup_one_tce_space\">calgary_fixup_one_tce_space</a>(<a class=\"id\" href=\"#dev\">dev</a>);", 
"", 
"<span class=\"ts\"/>} while (1);", 
"", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * We need to be call after pcibios_assign_resources (fs_initcall level)</span>", 
"<span class=\"comment\"> * and before device_initcall.</span>", 
"<span class=\"comment\"> */</span>", 
"<a class=\"id\" href=\"#rootfs_initcall\">rootfs_initcall</a>(<a class=\"id\" href=\"#calgary_fixup_tce_spaces\">calgary_fixup_tce_spaces</a>);", 
];
xr_frag_insert('l/de/2d6d2ec047d41d09e6abd1e0b30cd79782ba02.xr', __xr_tmp);
