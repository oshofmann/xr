var __xr_tmp = [
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Copyright (C) 2007-2009 Advanced Micro Devices, Inc.</span>", 
"<span class=\"comment\"> * Author: Joerg Roedel &lt;joerg.roedel@amd.com&gt;</span>", 
"<span class=\"comment\"> *         Leo Duran &lt;leo.duran@amd.com&gt;</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * This program is free software; you can redistribute it and/or modify it</span>", 
"<span class=\"comment\"> * under the terms of the GNU General Public License version 2 as published</span>", 
"<span class=\"comment\"> * by the Free Software Foundation.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * This program is distributed in the hope that it will be useful,</span>", 
"<span class=\"comment\"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span>", 
"<span class=\"comment\"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>", 
"<span class=\"comment\"> * GNU General Public License for more details.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * You should have received a copy of the GNU General Public License</span>", 
"<span class=\"comment\"> * along with this program; if not, write to the Free Software</span>", 
"<span class=\"comment\"> * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA</span>", 
"<span class=\"comment\"> */</span>", 
"", 
"#<a class=\"id\" href=\"#ifndef\">ifndef</a> <a class=\"id\" href=\"#_ASM_X86_AMD_IOMMU_TYPES_H\">_ASM_X86_AMD_IOMMU_TYPES_H</a>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#_ASM_X86_AMD_IOMMU_TYPES_H\">_ASM_X86_AMD_IOMMU_TYPES_H</a>", 
"", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#types\">types</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#mutex\">mutex</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#list\">list</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"#<a class=\"id\" href=\"#include\">include</a> &lt;<a class=\"id\" href=\"#linux\">linux</a>/<a class=\"id\" href=\"#spinlock\">spinlock</a>.<a class=\"id\" href=\"#h\">h</a>&gt;", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Maximum number of IOMMUs supported</span>", 
"<span class=\"comment\"> */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#MAX_IOMMUS\">MAX_IOMMUS</a><span class=\"ts\"/>32", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * some size calculation constants</span>", 
"<span class=\"comment\"> */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#DEV_TABLE_ENTRY_SIZE\">DEV_TABLE_ENTRY_SIZE</a><span class=\"ts\"/><span class=\"ts\"/>32", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#ALIAS_TABLE_ENTRY_SIZE\">ALIAS_TABLE_ENTRY_SIZE</a><span class=\"ts\"/><span class=\"ts\"/>2", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#RLOOKUP_TABLE_ENTRY_SIZE\">RLOOKUP_TABLE_ENTRY_SIZE</a><span class=\"ts\"/>(sizeof(void *))", 
"", 
"<span class=\"comment\">/* Length of the MMIO region for the AMD IOMMU */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#MMIO_REGION_LENGTH\">MMIO_REGION_LENGTH</a>       0x4000", 
"", 
"<span class=\"comment\">/* Capability offsets used by the driver */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#MMIO_CAP_HDR_OFFSET\">MMIO_CAP_HDR_OFFSET</a><span class=\"ts\"/>0x00", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#MMIO_RANGE_OFFSET\">MMIO_RANGE_OFFSET</a><span class=\"ts\"/>0x0c", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#MMIO_MISC_OFFSET\">MMIO_MISC_OFFSET</a><span class=\"ts\"/>0x10", 
"", 
"<span class=\"comment\">/* Masks, shifts and macros to parse the device range capability */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#MMIO_RANGE_LD_MASK\">MMIO_RANGE_LD_MASK</a><span class=\"ts\"/>0xff000000", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#MMIO_RANGE_FD_MASK\">MMIO_RANGE_FD_MASK</a><span class=\"ts\"/>0x00ff0000", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#MMIO_RANGE_BUS_MASK\">MMIO_RANGE_BUS_MASK</a><span class=\"ts\"/>0x0000ff00", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#MMIO_RANGE_LD_SHIFT\">MMIO_RANGE_LD_SHIFT</a><span class=\"ts\"/>24", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#MMIO_RANGE_FD_SHIFT\">MMIO_RANGE_FD_SHIFT</a><span class=\"ts\"/>16", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#MMIO_RANGE_BUS_SHIFT\">MMIO_RANGE_BUS_SHIFT</a><span class=\"ts\"/>8", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#MMIO_GET_LD\">MMIO_GET_LD</a>(<a class=\"id\" href=\"#x\">x</a>)  (((<a class=\"id\" href=\"#x\">x</a>) &amp; <a class=\"id\" href=\"#MMIO_RANGE_LD_MASK\">MMIO_RANGE_LD_MASK</a>) >> <a class=\"id\" href=\"#MMIO_RANGE_LD_SHIFT\">MMIO_RANGE_LD_SHIFT</a>)", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#MMIO_GET_FD\">MMIO_GET_FD</a>(<a class=\"id\" href=\"#x\">x</a>)  (((<a class=\"id\" href=\"#x\">x</a>) &amp; <a class=\"id\" href=\"#MMIO_RANGE_FD_MASK\">MMIO_RANGE_FD_MASK</a>) >> <a class=\"id\" href=\"#MMIO_RANGE_FD_SHIFT\">MMIO_RANGE_FD_SHIFT</a>)", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#MMIO_GET_BUS\">MMIO_GET_BUS</a>(<a class=\"id\" href=\"#x\">x</a>) (((<a class=\"id\" href=\"#x\">x</a>) &amp; <a class=\"id\" href=\"#MMIO_RANGE_BUS_MASK\">MMIO_RANGE_BUS_MASK</a>) >> <a class=\"id\" href=\"#MMIO_RANGE_BUS_SHIFT\">MMIO_RANGE_BUS_SHIFT</a>)", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#MMIO_MSI_NUM\">MMIO_MSI_NUM</a>(<a class=\"id\" href=\"#x\">x</a>)<span class=\"ts\"/>((<a class=\"id\" href=\"#x\">x</a>) &amp; 0x1f)", 
"", 
"<span class=\"comment\">/* Flag masks for the AMD IOMMU exclusion range */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#MMIO_EXCL_ENABLE_MASK\">MMIO_EXCL_ENABLE_MASK</a> 0x01ULL", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#MMIO_EXCL_ALLOW_MASK\">MMIO_EXCL_ALLOW_MASK</a>  0x02ULL", 
"", 
"<span class=\"comment\">/* Used offsets into the MMIO space */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#MMIO_DEV_TABLE_OFFSET\">MMIO_DEV_TABLE_OFFSET</a>   0x0000", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#MMIO_CMD_BUF_OFFSET\">MMIO_CMD_BUF_OFFSET</a>     0x0008", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#MMIO_EVT_BUF_OFFSET\">MMIO_EVT_BUF_OFFSET</a>     0x0010", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#MMIO_CONTROL_OFFSET\">MMIO_CONTROL_OFFSET</a>     0x0018", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#MMIO_EXCL_BASE_OFFSET\">MMIO_EXCL_BASE_OFFSET</a>   0x0020", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#MMIO_EXCL_LIMIT_OFFSET\">MMIO_EXCL_LIMIT_OFFSET</a>  0x0028", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#MMIO_CMD_HEAD_OFFSET\">MMIO_CMD_HEAD_OFFSET</a><span class=\"ts\"/>0x2000", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#MMIO_CMD_TAIL_OFFSET\">MMIO_CMD_TAIL_OFFSET</a><span class=\"ts\"/>0x2008", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#MMIO_EVT_HEAD_OFFSET\">MMIO_EVT_HEAD_OFFSET</a><span class=\"ts\"/>0x2010", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#MMIO_EVT_TAIL_OFFSET\">MMIO_EVT_TAIL_OFFSET</a><span class=\"ts\"/>0x2018", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#MMIO_STATUS_OFFSET\">MMIO_STATUS_OFFSET</a><span class=\"ts\"/>0x2020", 
"", 
"<span class=\"comment\">/* MMIO status bits */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#MMIO_STATUS_COM_WAIT_INT_MASK\">MMIO_STATUS_COM_WAIT_INT_MASK</a><span class=\"ts\"/>0x04", 
"", 
"<span class=\"comment\">/* event logging constants */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#EVENT_ENTRY_SIZE\">EVENT_ENTRY_SIZE</a><span class=\"ts\"/>0x10", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#EVENT_TYPE_SHIFT\">EVENT_TYPE_SHIFT</a><span class=\"ts\"/>28", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#EVENT_TYPE_MASK\">EVENT_TYPE_MASK</a><span class=\"ts\"/><span class=\"ts\"/>0xf", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#EVENT_TYPE_ILL_DEV\">EVENT_TYPE_ILL_DEV</a><span class=\"ts\"/>0x1", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#EVENT_TYPE_IO_FAULT\">EVENT_TYPE_IO_FAULT</a><span class=\"ts\"/>0x2", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#EVENT_TYPE_DEV_TAB_ERR\">EVENT_TYPE_DEV_TAB_ERR</a><span class=\"ts\"/>0x3", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#EVENT_TYPE_PAGE_TAB_ERR\">EVENT_TYPE_PAGE_TAB_ERR</a><span class=\"ts\"/>0x4", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#EVENT_TYPE_ILL_CMD\">EVENT_TYPE_ILL_CMD</a><span class=\"ts\"/>0x5", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#EVENT_TYPE_CMD_HARD_ERR\">EVENT_TYPE_CMD_HARD_ERR</a><span class=\"ts\"/>0x6", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#EVENT_TYPE_IOTLB_INV_TO\">EVENT_TYPE_IOTLB_INV_TO</a><span class=\"ts\"/>0x7", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#EVENT_TYPE_INV_DEV_REQ\">EVENT_TYPE_INV_DEV_REQ</a><span class=\"ts\"/>0x8", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#EVENT_DEVID_MASK\">EVENT_DEVID_MASK</a><span class=\"ts\"/>0xffff", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#EVENT_DEVID_SHIFT\">EVENT_DEVID_SHIFT</a><span class=\"ts\"/>0", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#EVENT_DOMID_MASK\">EVENT_DOMID_MASK</a><span class=\"ts\"/>0xffff", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#EVENT_DOMID_SHIFT\">EVENT_DOMID_SHIFT</a><span class=\"ts\"/>0", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#EVENT_FLAGS_MASK\">EVENT_FLAGS_MASK</a><span class=\"ts\"/>0xfff", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#EVENT_FLAGS_SHIFT\">EVENT_FLAGS_SHIFT</a><span class=\"ts\"/>0x10", 
"", 
"<span class=\"comment\">/* feature control bits */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#CONTROL_IOMMU_EN\">CONTROL_IOMMU_EN</a>        0x00ULL", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#CONTROL_HT_TUN_EN\">CONTROL_HT_TUN_EN</a>       0x01ULL", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#CONTROL_EVT_LOG_EN\">CONTROL_EVT_LOG_EN</a>      0x02ULL", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#CONTROL_EVT_INT_EN\">CONTROL_EVT_INT_EN</a>      0x03ULL", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#CONTROL_COMWAIT_EN\">CONTROL_COMWAIT_EN</a>      0x04ULL", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#CONTROL_PASSPW_EN\">CONTROL_PASSPW_EN</a>       0x08ULL", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#CONTROL_RESPASSPW_EN\">CONTROL_RESPASSPW_EN</a>    0x09ULL", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#CONTROL_COHERENT_EN\">CONTROL_COHERENT_EN</a>     0x0aULL", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#CONTROL_ISOC_EN\">CONTROL_ISOC_EN</a>         0x0bULL", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#CONTROL_CMDBUF_EN\">CONTROL_CMDBUF_EN</a>       0x0cULL", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#CONTROL_PPFLOG_EN\">CONTROL_PPFLOG_EN</a>       0x0dULL", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#CONTROL_PPFINT_EN\">CONTROL_PPFINT_EN</a>       0x0eULL", 
"", 
"<span class=\"comment\">/* command specific defines */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#CMD_COMPL_WAIT\">CMD_COMPL_WAIT</a>          0x01", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#CMD_INV_DEV_ENTRY\">CMD_INV_DEV_ENTRY</a>       0x02", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#CMD_INV_IOMMU_PAGES\">CMD_INV_IOMMU_PAGES</a>     0x03", 
"", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#CMD_COMPL_WAIT_STORE_MASK\">CMD_COMPL_WAIT_STORE_MASK</a><span class=\"ts\"/>0x01", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#CMD_COMPL_WAIT_INT_MASK\">CMD_COMPL_WAIT_INT_MASK</a><span class=\"ts\"/><span class=\"ts\"/>0x02", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#CMD_INV_IOMMU_PAGES_SIZE_MASK\">CMD_INV_IOMMU_PAGES_SIZE_MASK</a><span class=\"ts\"/>0x01", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#CMD_INV_IOMMU_PAGES_PDE_MASK\">CMD_INV_IOMMU_PAGES_PDE_MASK</a><span class=\"ts\"/>0x02", 
"", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#CMD_INV_IOMMU_ALL_PAGES_ADDRESS\">CMD_INV_IOMMU_ALL_PAGES_ADDRESS</a><span class=\"ts\"/>0x7fffffffffffffffULL", 
"", 
"<span class=\"comment\">/* macros and definitions for device table entries */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#DEV_ENTRY_VALID\">DEV_ENTRY_VALID</a>         0x00", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#DEV_ENTRY_TRANSLATION\">DEV_ENTRY_TRANSLATION</a>   0x01", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#DEV_ENTRY_IR\">DEV_ENTRY_IR</a>            0x3d", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#DEV_ENTRY_IW\">DEV_ENTRY_IW</a>            0x3e", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#DEV_ENTRY_NO_PAGE_FAULT\">DEV_ENTRY_NO_PAGE_FAULT</a><span class=\"ts\"/>0x62", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#DEV_ENTRY_EX\">DEV_ENTRY_EX</a>            0x67", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#DEV_ENTRY_SYSMGT1\">DEV_ENTRY_SYSMGT1</a>       0x68", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#DEV_ENTRY_SYSMGT2\">DEV_ENTRY_SYSMGT2</a>       0x69", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#DEV_ENTRY_INIT_PASS\">DEV_ENTRY_INIT_PASS</a>     0xb8", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#DEV_ENTRY_EINT_PASS\">DEV_ENTRY_EINT_PASS</a>     0xb9", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#DEV_ENTRY_NMI_PASS\">DEV_ENTRY_NMI_PASS</a>      0xba", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#DEV_ENTRY_LINT0_PASS\">DEV_ENTRY_LINT0_PASS</a>    0xbe", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#DEV_ENTRY_LINT1_PASS\">DEV_ENTRY_LINT1_PASS</a>    0xbf", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#DEV_ENTRY_MODE_MASK\">DEV_ENTRY_MODE_MASK</a><span class=\"ts\"/>0x07", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#DEV_ENTRY_MODE_SHIFT\">DEV_ENTRY_MODE_SHIFT</a><span class=\"ts\"/>0x09", 
"", 
"<span class=\"comment\">/* constants to configure the command buffer */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#CMD_BUFFER_SIZE\">CMD_BUFFER_SIZE</a>    8192", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#CMD_BUFFER_UNINITIALIZED\">CMD_BUFFER_UNINITIALIZED</a> 1", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#CMD_BUFFER_ENTRIES\">CMD_BUFFER_ENTRIES</a> 512", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#MMIO_CMD_SIZE_SHIFT\">MMIO_CMD_SIZE_SHIFT</a> 56", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#MMIO_CMD_SIZE_512\">MMIO_CMD_SIZE_512</a> (0x9ULL << <a class=\"id\" href=\"#MMIO_CMD_SIZE_SHIFT\">MMIO_CMD_SIZE_SHIFT</a>)", 
"", 
"<span class=\"comment\">/* constants for event buffer handling */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#EVT_BUFFER_SIZE\">EVT_BUFFER_SIZE</a><span class=\"ts\"/><span class=\"ts\"/>8192 <span class=\"comment\">/* 512 entries */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#EVT_LEN_MASK\">EVT_LEN_MASK</a><span class=\"ts\"/><span class=\"ts\"/>(0x9ULL << 56)", 
"", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#PAGE_MODE_NONE\">PAGE_MODE_NONE</a>    0x00", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#PAGE_MODE_1_LEVEL\">PAGE_MODE_1_LEVEL</a> 0x01", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#PAGE_MODE_2_LEVEL\">PAGE_MODE_2_LEVEL</a> 0x02", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#PAGE_MODE_3_LEVEL\">PAGE_MODE_3_LEVEL</a> 0x03", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#PAGE_MODE_4_LEVEL\">PAGE_MODE_4_LEVEL</a> 0x04", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#PAGE_MODE_5_LEVEL\">PAGE_MODE_5_LEVEL</a> 0x05", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#PAGE_MODE_6_LEVEL\">PAGE_MODE_6_LEVEL</a> 0x06", 
"", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#PM_LEVEL_SHIFT\">PM_LEVEL_SHIFT</a>(<a class=\"id\" href=\"#x\">x</a>)<span class=\"ts\"/>(12 + ((<a class=\"id\" href=\"#x\">x</a>) * 9))", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#PM_LEVEL_SIZE\">PM_LEVEL_SIZE</a>(<a class=\"id\" href=\"#x\">x</a>)<span class=\"ts\"/>(((<a class=\"id\" href=\"#x\">x</a>) &lt; 6) ? \\", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>  ((1ULL << <a class=\"id\" href=\"#PM_LEVEL_SHIFT\">PM_LEVEL_SHIFT</a>((<a class=\"id\" href=\"#x\">x</a>))) - 1): \\", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>   (0xffffffffffffffffULL))", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#PM_LEVEL_INDEX\">PM_LEVEL_INDEX</a>(<a class=\"id\" href=\"#x\">x</a>, <a class=\"id\" href=\"#a\">a</a>)<span class=\"ts\"/>(((<a class=\"id\" href=\"#a\">a</a>) >> <a class=\"id\" href=\"#PM_LEVEL_SHIFT\">PM_LEVEL_SHIFT</a>((<a class=\"id\" href=\"#x\">x</a>))) &amp; 0x1ffULL)", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#PM_LEVEL_ENC\">PM_LEVEL_ENC</a>(<a class=\"id\" href=\"#x\">x</a>)<span class=\"ts\"/><span class=\"ts\"/>(((<a class=\"id\" href=\"#x\">x</a>) << 9) &amp; 0xe00ULL)", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#PM_LEVEL_PDE\">PM_LEVEL_PDE</a>(<a class=\"id\" href=\"#x\">x</a>, <a class=\"id\" href=\"#a\">a</a>)<span class=\"ts\"/>((<a class=\"id\" href=\"#a\">a</a>) | <a class=\"id\" href=\"#PM_LEVEL_ENC\">PM_LEVEL_ENC</a>((<a class=\"id\" href=\"#x\">x</a>)) | \\", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/> <a class=\"id\" href=\"#IOMMU_PTE_P\">IOMMU_PTE_P</a> | <a class=\"id\" href=\"#IOMMU_PTE_IR\">IOMMU_PTE_IR</a> | <a class=\"id\" href=\"#IOMMU_PTE_IW\">IOMMU_PTE_IW</a>)", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#PM_PTE_LEVEL\">PM_PTE_LEVEL</a>(<a class=\"id\" href=\"#pte\">pte</a>)<span class=\"ts\"/>(((<a class=\"id\" href=\"#pte\">pte</a>) >> 9) &amp; 0x7ULL)", 
"", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#PM_MAP_4k\">PM_MAP_4k</a><span class=\"ts\"/><span class=\"ts\"/>0", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#PM_ADDR_MASK\">PM_ADDR_MASK</a><span class=\"ts\"/><span class=\"ts\"/>0x000ffffffffff000ULL", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#PM_MAP_MASK\">PM_MAP_MASK</a>(<a class=\"id\" href=\"#lvl\">lvl</a>)<span class=\"ts\"/>(<a class=\"id\" href=\"#PM_ADDR_MASK\">PM_ADDR_MASK</a> &amp; \\", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>(~((1ULL << (12 + ((<a class=\"id\" href=\"#lvl\">lvl</a>) * 9))) - 1)))", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#PM_ALIGNED\">PM_ALIGNED</a>(<a class=\"id\" href=\"#lvl\">lvl</a>, <a class=\"id\" href=\"#addr\">addr</a>)<span class=\"ts\"/>((<a class=\"id\" href=\"#PM_MAP_MASK\">PM_MAP_MASK</a>(<a class=\"id\" href=\"#lvl\">lvl</a>) &amp; (<a class=\"id\" href=\"#addr\">addr</a>)) == (<a class=\"id\" href=\"#addr\">addr</a>))", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Returns the page table level to use for a given page size</span>", 
"<span class=\"comment\"> * Pagesize is expected to be a power-of-two</span>", 
"<span class=\"comment\"> */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#PAGE_SIZE_LEVEL\">PAGE_SIZE_LEVEL</a>(<a class=\"id\" href=\"#pagesize\">pagesize</a>) \\", 
"<span class=\"ts\"/><span class=\"ts\"/>((<a class=\"id\" href=\"#__ffs\">__ffs</a>(<a class=\"id\" href=\"#pagesize\">pagesize</a>) - 12) / 9)", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Returns the number of ptes to use for a given page size</span>", 
"<span class=\"comment\"> * Pagesize is expected to be a power-of-two</span>", 
"<span class=\"comment\"> */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#PAGE_SIZE_PTE_COUNT\">PAGE_SIZE_PTE_COUNT</a>(<a class=\"id\" href=\"#pagesize\">pagesize</a>) \\", 
"<span class=\"ts\"/><span class=\"ts\"/>(1ULL << ((<a class=\"id\" href=\"#__ffs\">__ffs</a>(<a class=\"id\" href=\"#pagesize\">pagesize</a>) - 12) % 9))", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Aligns a given io-virtual address to a given page size</span>", 
"<span class=\"comment\"> * Pagesize is expected to be a power-of-two</span>", 
"<span class=\"comment\"> */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#PAGE_SIZE_ALIGN\">PAGE_SIZE_ALIGN</a>(<a class=\"id\" href=\"#address\">address</a>, <a class=\"id\" href=\"#pagesize\">pagesize</a>) \\", 
"<span class=\"ts\"/><span class=\"ts\"/>((<a class=\"id\" href=\"#address\">address</a>) &amp; ~((<a class=\"id\" href=\"#pagesize\">pagesize</a>) - 1))", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Creates an IOMMU PTE for an address an a given pagesize</span>", 
"<span class=\"comment\"> * The PTE has no permission bits set</span>", 
"<span class=\"comment\"> * Pagesize is expected to be a power-of-two larger than 4096</span>", 
"<span class=\"comment\"> */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#PAGE_SIZE_PTE\">PAGE_SIZE_PTE</a>(<a class=\"id\" href=\"#address\">address</a>, <a class=\"id\" href=\"#pagesize\">pagesize</a>)<span class=\"ts\"/><span class=\"ts\"/>\\", 
"<span class=\"ts\"/><span class=\"ts\"/>(((<a class=\"id\" href=\"#address\">address</a>) | ((<a class=\"id\" href=\"#pagesize\">pagesize</a>) - 1)) &amp;<span class=\"ts\"/>\\", 
"<span class=\"ts\"/><span class=\"ts\"/> (~(<a class=\"id\" href=\"#pagesize\">pagesize</a> >> 1)) &amp; <a class=\"id\" href=\"#PM_ADDR_MASK\">PM_ADDR_MASK</a>)", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Takes a PTE value with mode=0x07 and returns the page size it maps</span>", 
"<span class=\"comment\"> */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#PTE_PAGE_SIZE\">PTE_PAGE_SIZE</a>(<a class=\"id\" href=\"#pte\">pte</a>) \\", 
"<span class=\"ts\"/>(1ULL << (1 + <a class=\"id\" href=\"#ffz\">ffz</a>(((<a class=\"id\" href=\"#pte\">pte</a>) | 0xfffULL))))", 
"", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#IOMMU_PTE_P\">IOMMU_PTE_P</a>  (1ULL << 0)", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#IOMMU_PTE_TV\">IOMMU_PTE_TV</a> (1ULL << 1)", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#IOMMU_PTE_U\">IOMMU_PTE_U</a>  (1ULL << 59)", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#IOMMU_PTE_FC\">IOMMU_PTE_FC</a> (1ULL << 60)", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#IOMMU_PTE_IR\">IOMMU_PTE_IR</a> (1ULL << 61)", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#IOMMU_PTE_IW\">IOMMU_PTE_IW</a> (1ULL << 62)", 
"", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#IOMMU_PAGE_MASK\">IOMMU_PAGE_MASK</a> (((1ULL << 52) - 1) &amp; ~0xfffULL)", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#IOMMU_PTE_PRESENT\">IOMMU_PTE_PRESENT</a>(<a class=\"id\" href=\"#pte\">pte</a>) ((<a class=\"id\" href=\"#pte\">pte</a>) &amp; <a class=\"id\" href=\"#IOMMU_PTE_P\">IOMMU_PTE_P</a>)", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#IOMMU_PTE_PAGE\">IOMMU_PTE_PAGE</a>(<a class=\"id\" href=\"#pte\">pte</a>) (<a class=\"id\" href=\"#phys_to_virt\">phys_to_virt</a>((<a class=\"id\" href=\"#pte\">pte</a>) &amp; <a class=\"id\" href=\"#IOMMU_PAGE_MASK\">IOMMU_PAGE_MASK</a>))", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#IOMMU_PTE_MODE\">IOMMU_PTE_MODE</a>(<a class=\"id\" href=\"#pte\">pte</a>) (((<a class=\"id\" href=\"#pte\">pte</a>) >> 9) &amp; 0x07)", 
"", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#IOMMU_PROT_MASK\">IOMMU_PROT_MASK</a> 0x03", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#IOMMU_PROT_IR\">IOMMU_PROT_IR</a> 0x01", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#IOMMU_PROT_IW\">IOMMU_PROT_IW</a> 0x02", 
"", 
"<span class=\"comment\">/* IOMMU capabilities */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#IOMMU_CAP_IOTLB\">IOMMU_CAP_IOTLB</a>   24", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#IOMMU_CAP_NPCACHE\">IOMMU_CAP_NPCACHE</a> 26", 
"", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#MAX_DOMAIN_ID\">MAX_DOMAIN_ID</a> 65536", 
"", 
"<span class=\"comment\">/* FIXME: move this macro to &lt;linux/pci.h&gt; */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#PCI_BUS\">PCI_BUS</a>(<a class=\"id\" href=\"#x\">x</a>) (((<a class=\"id\" href=\"#x\">x</a>) >> 8) &amp; 0xff)", 
"", 
"<span class=\"comment\">/* Protection domain flags */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#PD_DMA_OPS_MASK\">PD_DMA_OPS_MASK</a><span class=\"ts\"/><span class=\"ts\"/>(1UL << 0) <span class=\"comment\">/* domain used for dma_ops */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#PD_DEFAULT_MASK\">PD_DEFAULT_MASK</a><span class=\"ts\"/><span class=\"ts\"/>(1UL << 1) <span class=\"comment\">/* domain is a default dma_ops</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>      domain for an IOMMU */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#PD_PASSTHROUGH_MASK\">PD_PASSTHROUGH_MASK</a><span class=\"ts\"/>(1UL << 2) <span class=\"comment\">/* domain has no page</span>", 
"<span class=\"comment\"><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>      translation */</span>", 
"", 
"extern <a class=\"id\" href=\"#bool\">bool</a> <a class=\"id\" href=\"#amd_iommu_dump\">amd_iommu_dump</a>;", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#DUMP_printk\">DUMP_printk</a>(<a class=\"id\" href=\"#format\">format</a>, <a class=\"id\" href=\"#arg\">arg</a>...)<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>\\", 
"<span class=\"ts\"/>do {<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>\\", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#amd_iommu_dump\">amd_iommu_dump</a>)<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>\\", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#printk\">printk</a>(<a class=\"id\" href=\"#KERN_INFO\">KERN_INFO</a> \"AMD-Vi: \" <a class=\"id\" href=\"#format\">format</a>, ## <a class=\"id\" href=\"#arg\">arg</a>);<span class=\"ts\"/>\\", 
"<span class=\"ts\"/>} while(0);", 
"", 
"<span class=\"comment\">/* global flag if IOMMUs cache non-present entries */</span>", 
"extern <a class=\"id\" href=\"#bool\">bool</a> <a class=\"id\" href=\"#amd_iommu_np_cache\">amd_iommu_np_cache</a>;", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Make iterating over all IOMMUs easier</span>", 
"<span class=\"comment\"> */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#for_each_iommu\">for_each_iommu</a>(<a class=\"id\" href=\"#iommu\">iommu</a>) \\", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_for_each_entry\">list_for_each_entry</a>((<a class=\"id\" href=\"#iommu\">iommu</a>), &amp;<a class=\"id\" href=\"#amd_iommu_list\">amd_iommu_list</a>, <a class=\"id\" href=\"#list\">list</a>)", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#for_each_iommu_safe\">for_each_iommu_safe</a>(<a class=\"id\" href=\"#iommu\">iommu</a>, <a class=\"id\" href=\"#next\">next</a>) \\", 
"<span class=\"ts\"/><a class=\"id\" href=\"#list_for_each_entry_safe\">list_for_each_entry_safe</a>((<a class=\"id\" href=\"#iommu\">iommu</a>), (<a class=\"id\" href=\"#next\">next</a>), &amp;<a class=\"id\" href=\"#amd_iommu_list\">amd_iommu_list</a>, <a class=\"id\" href=\"#list\">list</a>)", 
"", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#APERTURE_RANGE_SHIFT\">APERTURE_RANGE_SHIFT</a><span class=\"ts\"/>27<span class=\"ts\"/><span class=\"comment\">/* 128 MB */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#APERTURE_RANGE_SIZE\">APERTURE_RANGE_SIZE</a><span class=\"ts\"/>(1ULL << <a class=\"id\" href=\"#APERTURE_RANGE_SHIFT\">APERTURE_RANGE_SHIFT</a>)", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#APERTURE_RANGE_PAGES\">APERTURE_RANGE_PAGES</a><span class=\"ts\"/>(<a class=\"id\" href=\"#APERTURE_RANGE_SIZE\">APERTURE_RANGE_SIZE</a> >> <a class=\"id\" href=\"#PAGE_SHIFT\">PAGE_SHIFT</a>)", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#APERTURE_MAX_RANGES\">APERTURE_MAX_RANGES</a><span class=\"ts\"/>32<span class=\"ts\"/><span class=\"comment\">/* allows 4GB of DMA address space */</span>", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#APERTURE_RANGE_INDEX\">APERTURE_RANGE_INDEX</a>(<a class=\"id\" href=\"#a\">a</a>)<span class=\"ts\"/>((<a class=\"id\" href=\"#a\">a</a>) >> <a class=\"id\" href=\"#APERTURE_RANGE_SHIFT\">APERTURE_RANGE_SHIFT</a>)", 
"#<a class=\"id\" href=\"#define\">define</a> <a class=\"id\" href=\"#APERTURE_PAGE_INDEX\">APERTURE_PAGE_INDEX</a>(<a class=\"id\" href=\"#a\">a</a>)<span class=\"ts\"/>(((<a class=\"id\" href=\"#a\">a</a>) >> 21) &amp; 0x3fULL)", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * This structure contains generic data for  IOMMU protection domains</span>", 
"<span class=\"comment\"> * independent of their use.</span>", 
"<span class=\"comment\"> */</span>", 
"struct <a class=\"id\" href=\"#protection_domain\">protection_domain</a> {", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#list_head\">list_head</a> <a class=\"id\" href=\"#list\">list</a>;  <span class=\"comment\">/* for list of all protection domains */</span>", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#list_head\">list_head</a> <a class=\"id\" href=\"#dev_list\">dev_list</a>; <span class=\"comment\">/* List of all devices in this domain */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spinlock_t\">spinlock_t</a> <a class=\"id\" href=\"#lock\">lock</a>;<span class=\"ts\"/><span class=\"comment\">/* mostly used to lock the page table*/</span>", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#mutex\">mutex</a> <a class=\"id\" href=\"#api_lock\">api_lock</a>;<span class=\"ts\"/><span class=\"comment\">/* protect page tables in the iommu-api path */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#id\">id</a>;<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* the domain id written to the device table */</span>", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#mode\">mode</a>;<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* paging mode (0-6 levels) */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u64\">u64</a> *<a class=\"id\" href=\"#pt_root\">pt_root</a>;<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* page table root pointer */</span>", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#flags\">flags</a>;<span class=\"ts\"/><span class=\"comment\">/* flags to find out type of domain */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bool\">bool</a> <a class=\"id\" href=\"#updated\">updated</a>;<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* complete domain flush required */</span>", 
"<span class=\"ts\"/>unsigned <a class=\"id\" href=\"#dev_cnt\">dev_cnt</a>;<span class=\"ts\"/><span class=\"comment\">/* devices assigned to this domain */</span>", 
"<span class=\"ts\"/>unsigned <a class=\"id\" href=\"#dev_iommu\">dev_iommu</a>[<a class=\"id\" href=\"#MAX_IOMMUS\">MAX_IOMMUS</a>]; <span class=\"comment\">/* per-IOMMU reference count */</span>", 
"<span class=\"ts\"/>void *<a class=\"id\" href=\"#priv\">priv</a>;<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* private data */</span>", 
"", 
"};", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * This struct contains device specific data for the IOMMU</span>", 
"<span class=\"comment\"> */</span>", 
"struct <a class=\"id\" href=\"#iommu_dev_data\">iommu_dev_data</a> {", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#list_head\">list_head</a> <a class=\"id\" href=\"#list\">list</a>;<span class=\"ts\"/><span class=\"ts\"/>  <span class=\"comment\">/* For domain-&gt;dev_list */</span>", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#device\">device</a> *<a class=\"id\" href=\"#dev\">dev</a>;<span class=\"ts\"/><span class=\"ts\"/>  <span class=\"comment\">/* Device this data belong to */</span>", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#device\">device</a> *<a class=\"id\" href=\"#alias\">alias</a>;<span class=\"ts\"/><span class=\"ts\"/>  <span class=\"comment\">/* The Alias Device */</span>", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#protection_domain\">protection_domain</a> *<a class=\"id\" href=\"#domain\">domain</a>; <span class=\"comment\">/* Domain the device is bound to */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#atomic_t\">atomic_t</a> <a class=\"id\" href=\"#bind\">bind</a>;<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>  <span class=\"comment\">/* Domain attach reverent count */</span>", 
"};", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * For dynamic growth the aperture size is split into ranges of 128MB of</span>", 
"<span class=\"comment\"> * DMA address space each. This struct represents one such range.</span>", 
"<span class=\"comment\"> */</span>", 
"struct <a class=\"id\" href=\"#aperture_range\">aperture_range</a> {", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* address allocation bitmap */</span>", 
"<span class=\"ts\"/>unsigned long *<a class=\"id\" href=\"#bitmap\">bitmap</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Array of PTE pages for the aperture. In this array we save all the</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * leaf pages of the domain page table used for the aperture. This way</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * we don't need to walk the page table to find a specific PTE. We can</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * just calculate its address in constant time.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u64\">u64</a> *<a class=\"id\" href=\"#pte_pages\">pte_pages</a>[64];", 
"", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#offset\">offset</a>;", 
"};", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Data container for a dma_ops specific protection domain</span>", 
"<span class=\"comment\"> */</span>", 
"struct <a class=\"id\" href=\"#dma_ops_domain\">dma_ops_domain</a> {", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#list_head\">list_head</a> <a class=\"id\" href=\"#list\">list</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* generic protection domain information */</span>", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#protection_domain\">protection_domain</a> <a class=\"id\" href=\"#domain\">domain</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* size of the aperture for the mappings */</span>", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#aperture_size\">aperture_size</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* address we start to search for free addresses */</span>", 
"<span class=\"ts\"/>unsigned long <a class=\"id\" href=\"#next_address\">next_address</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* address space relevant data */</span>", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#aperture_range\">aperture_range</a> *<a class=\"id\" href=\"#aperture\">aperture</a>[<a class=\"id\" href=\"#APERTURE_MAX_RANGES\">APERTURE_MAX_RANGES</a>];", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* This will be set to true when TLB needs to be flushed */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bool\">bool</a> <a class=\"id\" href=\"#need_flush\">need_flush</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * if this is a preallocated domain, keep the device for which it was</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * preallocated in this variable</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#target_dev\">target_dev</a>;", 
"};", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Structure where we save information about one hardware AMD IOMMU in the</span>", 
"<span class=\"comment\"> * system.</span>", 
"<span class=\"comment\"> */</span>", 
"struct <a class=\"id\" href=\"#amd_iommu\">amd_iommu</a> {", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#list_head\">list_head</a> <a class=\"id\" href=\"#list\">list</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Index within the IOMMU array */</span>", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#index\">index</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* locks the accesses to the hardware */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#spinlock_t\">spinlock_t</a> <a class=\"id\" href=\"#lock\">lock</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Pointer to PCI device of this IOMMU */</span>", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#pci_dev\">pci_dev</a> *<a class=\"id\" href=\"#dev\">dev</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* physical address of MMIO space */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u64\">u64</a> <a class=\"id\" href=\"#mmio_phys\">mmio_phys</a>;", 
"<span class=\"ts\"/><span class=\"comment\">/* virtual address of MMIO space */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u8\">u8</a> *<a class=\"id\" href=\"#mmio_base\">mmio_base</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* capabilities of that IOMMU read from ACPI */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#cap\">cap</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* flags read from acpi table */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u8\">u8</a> <a class=\"id\" href=\"#acpi_flags\">acpi_flags</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * Capability pointer. There could be more than one IOMMU per PCI</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * device function if there are more than one AMD IOMMU capability</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * pointers.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#cap_ptr\">cap_ptr</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* pci domain of this IOMMU */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#pci_seg\">pci_seg</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* first device this IOMMU handles. read from PCI */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#first_device\">first_device</a>;", 
"<span class=\"ts\"/><span class=\"comment\">/* last device this IOMMU handles. read from PCI */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#last_device\">last_device</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* start of exclusion range of that IOMMU */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u64\">u64</a> <a class=\"id\" href=\"#exclusion_start\">exclusion_start</a>;", 
"<span class=\"ts\"/><span class=\"comment\">/* length of exclusion range of that IOMMU */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u64\">u64</a> <a class=\"id\" href=\"#exclusion_length\">exclusion_length</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* command buffer virtual address */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u8\">u8</a> *<a class=\"id\" href=\"#cmd_buf\">cmd_buf</a>;", 
"<span class=\"ts\"/><span class=\"comment\">/* size of command buffer */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#cmd_buf_size\">cmd_buf_size</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* size of event buffer */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#evt_buf_size\">evt_buf_size</a>;", 
"<span class=\"ts\"/><span class=\"comment\">/* event buffer virtual address */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u8\">u8</a> *<a class=\"id\" href=\"#evt_buf\">evt_buf</a>;", 
"<span class=\"ts\"/><span class=\"comment\">/* MSI number for event interrupt */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#evt_msi_num\">evt_msi_num</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* true if interrupts for this IOMMU are already enabled */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bool\">bool</a> <a class=\"id\" href=\"#int_enabled\">int_enabled</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* if one, we need to send a completion wait command */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bool\">bool</a> <a class=\"id\" href=\"#need_sync\">need_sync</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* becomes true if a command buffer reset is running */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#bool\">bool</a> <a class=\"id\" href=\"#reset_in_progress\">reset_in_progress</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* default dma_ops domain for that IOMMU */</span>", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#dma_ops_domain\">dma_ops_domain</a> *<a class=\"id\" href=\"#default_dom\">default_dom</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/*</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * This array is required to work around a potential BIOS bug.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * The BIOS may miss to restore parts of the PCI configuration</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * space when the system resumes from S3. The result is that the</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * IOMMU does not execute commands anymore which leads to system</span>", 
"<span class=\"comment\"><span class=\"ts\"/> * failure.</span>", 
"<span class=\"comment\"><span class=\"ts\"/> */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#cache_cfg\">cache_cfg</a>[4];", 
"};", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * List with all IOMMUs in the system. This list is not locked because it is</span>", 
"<span class=\"comment\"> * only written and read at driver initialization or suspend time</span>", 
"<span class=\"comment\"> */</span>", 
"extern struct <a class=\"id\" href=\"#list_head\">list_head</a> <a class=\"id\" href=\"#amd_iommu_list\">amd_iommu_list</a>;", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Array with pointers to each IOMMU struct</span>", 
"<span class=\"comment\"> * The indices are referenced in the protection domains</span>", 
"<span class=\"comment\"> */</span>", 
"extern struct <a class=\"id\" href=\"#amd_iommu\">amd_iommu</a> *<a class=\"id\" href=\"#amd_iommus\">amd_iommus</a>[<a class=\"id\" href=\"#MAX_IOMMUS\">MAX_IOMMUS</a>];", 
"", 
"<span class=\"comment\">/* Number of IOMMUs present in the system */</span>", 
"extern int <a class=\"id\" href=\"#amd_iommus_present\">amd_iommus_present</a>;", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Declarations for the global list of all protection domains</span>", 
"<span class=\"comment\"> */</span>", 
"extern <a class=\"id\" href=\"#spinlock_t\">spinlock_t</a> <a class=\"id\" href=\"#amd_iommu_pd_lock\">amd_iommu_pd_lock</a>;", 
"extern struct <a class=\"id\" href=\"#list_head\">list_head</a> <a class=\"id\" href=\"#amd_iommu_pd_list\">amd_iommu_pd_list</a>;", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Structure defining one entry in the device table</span>", 
"<span class=\"comment\"> */</span>", 
"struct <a class=\"id\" href=\"#dev_table_entry\">dev_table_entry</a> {", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u32\">u32</a> <a class=\"id\" href=\"#data\">data</a>[8];", 
"};", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * One entry for unity mappings parsed out of the ACPI table.</span>", 
"<span class=\"comment\"> */</span>", 
"struct <a class=\"id\" href=\"#unity_map_entry\">unity_map_entry</a> {", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#list_head\">list_head</a> <a class=\"id\" href=\"#list\">list</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* starting device id this entry is used for (including) */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#devid_start\">devid_start</a>;", 
"<span class=\"ts\"/><span class=\"comment\">/* end device id this entry is used for (including) */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#devid_end\">devid_end</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* start address to unity map (including) */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u64\">u64</a> <a class=\"id\" href=\"#address_start\">address_start</a>;", 
"<span class=\"ts\"/><span class=\"comment\">/* end address to unity map (including) */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u64\">u64</a> <a class=\"id\" href=\"#address_end\">address_end</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* required protection */</span>", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#prot\">prot</a>;", 
"};", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * List of all unity mappings. It is not locked because as runtime it is only</span>", 
"<span class=\"comment\"> * read. It is created at ACPI table parsing time.</span>", 
"<span class=\"comment\"> */</span>", 
"extern struct <a class=\"id\" href=\"#list_head\">list_head</a> <a class=\"id\" href=\"#amd_iommu_unity_map\">amd_iommu_unity_map</a>;", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Data structures for device handling</span>", 
"<span class=\"comment\"> */</span>", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Device table used by hardware. Read and write accesses by software are</span>", 
"<span class=\"comment\"> * locked with the amd_iommu_pd_table lock.</span>", 
"<span class=\"comment\"> */</span>", 
"extern struct <a class=\"id\" href=\"#dev_table_entry\">dev_table_entry</a> *<a class=\"id\" href=\"#amd_iommu_dev_table\">amd_iommu_dev_table</a>;", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Alias table to find requestor ids to device ids. Not locked because only</span>", 
"<span class=\"comment\"> * read on runtime.</span>", 
"<span class=\"comment\"> */</span>", 
"extern <a class=\"id\" href=\"#u16\">u16</a> *<a class=\"id\" href=\"#amd_iommu_alias_table\">amd_iommu_alias_table</a>;", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Reverse lookup table to find the IOMMU which translates a specific device.</span>", 
"<span class=\"comment\"> */</span>", 
"extern struct <a class=\"id\" href=\"#amd_iommu\">amd_iommu</a> **<a class=\"id\" href=\"#amd_iommu_rlookup_table\">amd_iommu_rlookup_table</a>;", 
"", 
"<span class=\"comment\">/* size of the dma_ops aperture as power of 2 */</span>", 
];
xr_frag_insert('l/e6/aa17e2eb62778603453eb7139d3a5617469a40.xr', __xr_tmp);
