var __xr_tmp = [
"<span class=\"comment\">/* -*- linux-c -*- ------------------------------------------------------- *</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> *   Copyright (C) 1991, 1992 Linus Torvalds</span>", 
"<span class=\"comment\"> *   Copyright 2007-2008 rPath, Inc. - All Rights Reserved</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> *   This file is part of the Linux kernel, and is made available under</span>", 
"<span class=\"comment\"> *   the terms of the GNU General Public License version 2.</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * ----------------------------------------------------------------------- */</span>", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * arch/i386/boot/video-mode.c</span>", 
"<span class=\"comment\"> *</span>", 
"<span class=\"comment\"> * Set the video mode.  This is separated out into a different</span>", 
"<span class=\"comment\"> * file in order to be shared with the ACPI wakeup code.</span>", 
"<span class=\"comment\"> */</span>", 
"", 
"#<a class=\"id\" href=\"#include\">include</a> \"boot.h\"", 
"#<a class=\"id\" href=\"#include\">include</a> \"video.h\"", 
"#<a class=\"id\" href=\"#include\">include</a> \"vesa.h\"", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Common variables</span>", 
"<span class=\"comment\"> */</span>", 
"int <a class=\"id\" href=\"#adapter\">adapter</a>;<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* 0=CGA/MDA/HGC, 1=EGA, 2=VGA+ */</span>", 
"<a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#video_segment\">video_segment</a>;", 
"int <a class=\"id\" href=\"#force_x\">force_x</a>, <a class=\"id\" href=\"#force_y\">force_y</a>;<span class=\"ts\"/><span class=\"comment\">/* Don't query the BIOS for cols/rows */</span>", 
"", 
"int <a class=\"id\" href=\"#do_restore\">do_restore</a>;<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Screen contents changed during mode flip */</span>", 
"int <a class=\"id\" href=\"#graphic_mode\">graphic_mode</a>;<span class=\"ts\"/><span class=\"comment\">/* Graphic mode with linear frame buffer */</span>", 
"", 
"<span class=\"comment\">/* Probe the video drivers and have them generate their mode lists. */</span>", 
"void <a class=\"id\" href=\"#probe_cards\">probe_cards</a>(int <a class=\"id\" href=\"#unsafe\">unsafe</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#card_info\">card_info</a> *<a class=\"id\" href=\"#card\">card</a>;", 
"<span class=\"ts\"/>static <a class=\"id\" href=\"#u8\">u8</a> <a class=\"id\" href=\"#probed\">probed</a>[2];", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#probed\">probed</a>[<a class=\"id\" href=\"#unsafe\">unsafe</a>])", 
"<span class=\"ts\"/><span class=\"ts\"/>return;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#probed\">probed</a>[<a class=\"id\" href=\"#unsafe\">unsafe</a>] = 1;", 
"", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#card\">card</a> = <a class=\"id\" href=\"#video_cards\">video_cards</a>; <a class=\"id\" href=\"#card\">card</a> &lt; <a class=\"id\" href=\"#video_cards_end\">video_cards_end</a>; <a class=\"id\" href=\"#card\">card</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#card\">card</a>-><a class=\"id\" href=\"#unsafe\">unsafe</a> == <a class=\"id\" href=\"#unsafe\">unsafe</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#card\">card</a>-><a class=\"id\" href=\"#probe\">probe</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#card\">card</a>-><a class=\"id\" href=\"#nmodes\">nmodes</a> = <a class=\"id\" href=\"#card\">card</a>-><a class=\"id\" href=\"#probe\">probe</a>();", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>else", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#card\">card</a>-><a class=\"id\" href=\"#nmodes\">nmodes</a> = 0;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"}", 
"", 
"<span class=\"comment\">/* Test if a mode is defined */</span>", 
"int <a class=\"id\" href=\"#mode_defined\">mode_defined</a>(<a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#mode\">mode</a>)", 
"{", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#card_info\">card_info</a> *<a class=\"id\" href=\"#card\">card</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#mode_info\">mode_info</a> *<a class=\"id\" href=\"#mi\">mi</a>;", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#i\">i</a>;", 
"", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#card\">card</a> = <a class=\"id\" href=\"#video_cards\">video_cards</a>; <a class=\"id\" href=\"#card\">card</a> &lt; <a class=\"id\" href=\"#video_cards_end\">video_cards_end</a>; <a class=\"id\" href=\"#card\">card</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#mi\">mi</a> = <a class=\"id\" href=\"#card\">card</a>-><a class=\"id\" href=\"#modes\">modes</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = 0; <a class=\"id\" href=\"#i\">i</a> &lt; <a class=\"id\" href=\"#card\">card</a>-><a class=\"id\" href=\"#nmodes\">nmodes</a>; <a class=\"id\" href=\"#i\">i</a>++, <a class=\"id\" href=\"#mi\">mi</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#mi\">mi</a>-><a class=\"id\" href=\"#mode\">mode</a> == <a class=\"id\" href=\"#mode\">mode</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return 1;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/>return 0;", 
"}", 
"", 
"<span class=\"comment\">/* Set mode (without recalc) */</span>", 
"static int <a class=\"id\" href=\"#raw_set_mode\">raw_set_mode</a>(<a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#mode\">mode</a>, <a class=\"id\" href=\"#u16\">u16</a> *<a class=\"id\" href=\"#real_mode\">real_mode</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#nmode\">nmode</a>, <a class=\"id\" href=\"#i\">i</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#card_info\">card_info</a> *<a class=\"id\" href=\"#card\">card</a>;", 
"<span class=\"ts\"/>struct <a class=\"id\" href=\"#mode_info\">mode_info</a> *<a class=\"id\" href=\"#mi\">mi</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Drop the recalc bit if set */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#mode\">mode</a> &= ~<a class=\"id\" href=\"#VIDEO_RECALC\">VIDEO_RECALC</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Scan for mode based on fixed ID, position, or resolution */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#nmode\">nmode</a> = 0;", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#card\">card</a> = <a class=\"id\" href=\"#video_cards\">video_cards</a>; <a class=\"id\" href=\"#card\">card</a> &lt; <a class=\"id\" href=\"#video_cards_end\">video_cards_end</a>; <a class=\"id\" href=\"#card\">card</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#mi\">mi</a> = <a class=\"id\" href=\"#card\">card</a>-><a class=\"id\" href=\"#modes\">modes</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/>for (<a class=\"id\" href=\"#i\">i</a> = 0; <a class=\"id\" href=\"#i\">i</a> &lt; <a class=\"id\" href=\"#card\">card</a>-><a class=\"id\" href=\"#nmodes\">nmodes</a>; <a class=\"id\" href=\"#i\">i</a>++, <a class=\"id\" href=\"#mi\">mi</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>int <a class=\"id\" href=\"#visible\">visible</a> = <a class=\"id\" href=\"#mi\">mi</a>-><a class=\"id\" href=\"#x\">x</a> || <a class=\"id\" href=\"#mi\">mi</a>-><a class=\"id\" href=\"#y\">y</a>;", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if ((<a class=\"id\" href=\"#mode\">mode</a> == <a class=\"id\" href=\"#nmode\">nmode</a> && <a class=\"id\" href=\"#visible\">visible</a>) ||", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>    <a class=\"id\" href=\"#mode\">mode</a> == <a class=\"id\" href=\"#mi\">mi</a>-><a class=\"id\" href=\"#mode\">mode</a> ||", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>    <a class=\"id\" href=\"#mode\">mode</a> == (<a class=\"id\" href=\"#mi\">mi</a>-><a class=\"id\" href=\"#y\">y</a> << 8)+<a class=\"id\" href=\"#mi\">mi</a>-><a class=\"id\" href=\"#x\">x</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>*<a class=\"id\" href=\"#real_mode\">real_mode</a> = <a class=\"id\" href=\"#mi\">mi</a>-><a class=\"id\" href=\"#mode\">mode</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#card\">card</a>-><a class=\"id\" href=\"#set_mode\">set_mode</a>(<a class=\"id\" href=\"#mi\">mi</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#visible\">visible</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#nmode\">nmode</a>++;", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Nothing found?  Is it an \"exceptional\" (unprobed) mode? */</span>", 
"<span class=\"ts\"/>for (<a class=\"id\" href=\"#card\">card</a> = <a class=\"id\" href=\"#video_cards\">video_cards</a>; <a class=\"id\" href=\"#card\">card</a> &lt; <a class=\"id\" href=\"#video_cards_end\">video_cards_end</a>; <a class=\"id\" href=\"#card\">card</a>++) {", 
"<span class=\"ts\"/><span class=\"ts\"/>if (<a class=\"id\" href=\"#mode\">mode</a> >= <a class=\"id\" href=\"#card\">card</a>-><a class=\"id\" href=\"#xmode_first\">xmode_first</a> &&", 
"<span class=\"ts\"/><span class=\"ts\"/>    <a class=\"id\" href=\"#mode\">mode</a> &lt; <a class=\"id\" href=\"#card\">card</a>-><a class=\"id\" href=\"#xmode_first\">xmode_first</a>+<a class=\"id\" href=\"#card\">card</a>-><a class=\"id\" href=\"#xmode_n\">xmode_n</a>) {", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>struct <a class=\"id\" href=\"#mode_info\">mode_info</a> <a class=\"id\" href=\"#mix\">mix</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>*<a class=\"id\" href=\"#real_mode\">real_mode</a> = <a class=\"id\" href=\"#mix\">mix</a>.<a class=\"id\" href=\"#mode\">mode</a> = <a class=\"id\" href=\"#mode\">mode</a>;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#mix\">mix</a>.<a class=\"id\" href=\"#x\">x</a> = <a class=\"id\" href=\"#mix\">mix</a>.<a class=\"id\" href=\"#y\">y</a> = 0;", 
"<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#card\">card</a>-><a class=\"id\" href=\"#set_mode\">set_mode</a>(&amp;<a class=\"id\" href=\"#mix\">mix</a>);", 
"<span class=\"ts\"/><span class=\"ts\"/>}", 
"<span class=\"ts\"/>}", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Otherwise, failure... */</span>", 
"<span class=\"ts\"/>return -1;", 
"}", 
"", 
"<span class=\"comment\">/*</span>", 
"<span class=\"comment\"> * Recalculate the vertical video cutoff (hack!)</span>", 
"<span class=\"comment\"> */</span>", 
"static void <a class=\"id\" href=\"#vga_recalc_vertical\">vga_recalc_vertical</a>(void)", 
"{", 
"<span class=\"ts\"/>unsigned int <a class=\"id\" href=\"#font_size\">font_size</a>, <a class=\"id\" href=\"#rows\">rows</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#crtc\">crtc</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u8\">u8</a> <a class=\"id\" href=\"#pt\">pt</a>, <a class=\"id\" href=\"#ov\">ov</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#set_fs\">set_fs</a>(0);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#font_size\">font_size</a> = <a class=\"id\" href=\"#rdfs8\">rdfs8</a>(0x485); <span class=\"comment\">/* BIOS: font size (pixels) */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rows\">rows</a> = <a class=\"id\" href=\"#force_y\">force_y</a> ? <a class=\"id\" href=\"#force_y\">force_y</a> : <a class=\"id\" href=\"#rdfs8\">rdfs8</a>(0x484)+1; <span class=\"comment\">/* Text rows */</span>", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rows\">rows</a> *= <a class=\"id\" href=\"#font_size\">font_size</a>;<span class=\"ts\"/><span class=\"comment\">/* Visible scan lines */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rows\">rows</a>--;<span class=\"ts\"/><span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* ... minus one */</span>", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#crtc\">crtc</a> = <a class=\"id\" href=\"#vga_crtc\">vga_crtc</a>();", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pt\">pt</a> = <a class=\"id\" href=\"#in_idx\">in_idx</a>(<a class=\"id\" href=\"#crtc\">crtc</a>, 0x11);", 
"<span class=\"ts\"/><a class=\"id\" href=\"#pt\">pt</a> &= ~0x80;<span class=\"ts\"/><span class=\"ts\"/><span class=\"comment\">/* Unlock CR0-7 */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#out_idx\">out_idx</a>(<a class=\"id\" href=\"#pt\">pt</a>, <a class=\"id\" href=\"#crtc\">crtc</a>, 0x11);", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#out_idx\">out_idx</a>((<a class=\"id\" href=\"#u8\">u8</a>)<a class=\"id\" href=\"#rows\">rows</a>, <a class=\"id\" href=\"#crtc\">crtc</a>, 0x12); <span class=\"comment\">/* Lower height register */</span>", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ov\">ov</a> = <a class=\"id\" href=\"#in_idx\">in_idx</a>(<a class=\"id\" href=\"#crtc\">crtc</a>, 0x07); <span class=\"comment\">/* Overflow register */</span>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ov\">ov</a> &= 0xbd;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ov\">ov</a> |= (<a class=\"id\" href=\"#rows\">rows</a> >> (8-1)) &amp; 0x02;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#ov\">ov</a> |= (<a class=\"id\" href=\"#rows\">rows</a> >> (9-6)) &amp; 0x40;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#out_idx\">out_idx</a>(<a class=\"id\" href=\"#ov\">ov</a>, <a class=\"id\" href=\"#crtc\">crtc</a>, 0x07);", 
"}", 
"", 
"<span class=\"comment\">/* Set mode (with recalc if specified) */</span>", 
"int <a class=\"id\" href=\"#set_mode\">set_mode</a>(<a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#mode\">mode</a>)", 
"{", 
"<span class=\"ts\"/>int <a class=\"id\" href=\"#rv\">rv</a>;", 
"<span class=\"ts\"/><a class=\"id\" href=\"#u16\">u16</a> <a class=\"id\" href=\"#real_mode\">real_mode</a>;", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Very special mode numbers... */</span>", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#mode\">mode</a> == <a class=\"id\" href=\"#VIDEO_CURRENT_MODE\">VIDEO_CURRENT_MODE</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return 0;<span class=\"ts\"/><span class=\"comment\">/* Nothing to do... */</span>", 
"<span class=\"ts\"/>else if (<a class=\"id\" href=\"#mode\">mode</a> == <a class=\"id\" href=\"#NORMAL_VGA\">NORMAL_VGA</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#mode\">mode</a> = <a class=\"id\" href=\"#VIDEO_80x25\">VIDEO_80x25</a>;", 
"<span class=\"ts\"/>else if (<a class=\"id\" href=\"#mode\">mode</a> == <a class=\"id\" href=\"#EXTENDED_VGA\">EXTENDED_VGA</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#mode\">mode</a> = <a class=\"id\" href=\"#VIDEO_8POINT\">VIDEO_8POINT</a>;", 
"", 
"<span class=\"ts\"/><a class=\"id\" href=\"#rv\">rv</a> = <a class=\"id\" href=\"#raw_set_mode\">raw_set_mode</a>(<a class=\"id\" href=\"#mode\">mode</a>, &amp;<a class=\"id\" href=\"#real_mode\">real_mode</a>);", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#rv\">rv</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/>return <a class=\"id\" href=\"#rv\">rv</a>;", 
"", 
"<span class=\"ts\"/>if (<a class=\"id\" href=\"#mode\">mode</a> &amp; <a class=\"id\" href=\"#VIDEO_RECALC\">VIDEO_RECALC</a>)", 
"<span class=\"ts\"/><span class=\"ts\"/><a class=\"id\" href=\"#vga_recalc_vertical\">vga_recalc_vertical</a>();", 
"", 
"<span class=\"ts\"/><span class=\"comment\">/* Save the canonical mode number for the kernel, not</span>", 
"<span class=\"comment\"><span class=\"ts\"/>   an alias, size specification or menu position */</span>", 
"#<a class=\"id\" href=\"#ifndef\">ifndef</a> <a class=\"id\" href=\"#_WAKEUP\">_WAKEUP</a>", 
"<span class=\"ts\"/><a class=\"id\" href=\"#boot_params\">boot_params</a>.<a class=\"id\" href=\"#hdr\">hdr</a>.<a class=\"id\" href=\"#vid_mode\">vid_mode</a> = <a class=\"id\" href=\"#real_mode\">real_mode</a>;", 
"#<a class=\"id\" href=\"#endif\">endif</a>", 
"<span class=\"ts\"/>return 0;", 
"}", 
];
xr_frag_insert('l/fa/1fb6ad064c8125fb280b31a003a6cb069df905.xr', __xr_tmp);
